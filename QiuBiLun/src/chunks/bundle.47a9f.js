System.register([], function(_export, _context) { return { execute: function () {
System.register("chunks:///_virtual/adapter_core.js", ['./cjs-loader.mjs', './adapter_factory.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports["default"] = void 0;
        var _adapter_factory = require("./adapter_factory.js");
        var adapter = (0, _adapter_factory.adapterFactory)({
          window: typeof window === 'undefined' ? undefined : window
        });
        var _default = exports["default"] = adapter;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        _default = module.exports["default"];
      }, function () {
        return {
          './adapter_factory.js': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/adapter_factory.js", ['./cjs-loader.mjs', './utils.js', './chrome_shim.js', './firefox_shim.js', './safari_shim.js', './common_shim.js', './sdp.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3, __cjsMetaURL$4, __cjsMetaURL$5, __cjsMetaURL$6;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$4 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$5 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$6 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.adapterFactory = adapterFactory;
        var utils = _interopRequireWildcard(require("./utils"));
        var chromeShim = _interopRequireWildcard(require("./chrome/chrome_shim"));
        var firefoxShim = _interopRequireWildcard(require("./firefox/firefox_shim"));
        var safariShim = _interopRequireWildcard(require("./safari/safari_shim"));
        var commonShim = _interopRequireWildcard(require("./common_shim"));
        var sdp = _interopRequireWildcard(require("sdp"));
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        /*
         *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
         *
         *  Use of this source code is governed by a BSD-style license
         *  that can be found in the LICENSE file in the root of the source
         *  tree.
         */

        // Browser shims.

        // Shimming starts here.
        function adapterFactory() {
          var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
            window = _ref.window;
          var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
            shimChrome: true,
            shimFirefox: true,
            shimSafari: true
          };
          // Utils.
          var logging = utils.log;
          var browserDetails = utils.detectBrowser(window);
          var adapter = {
            browserDetails: browserDetails,
            commonShim: commonShim,
            extractVersion: utils.extractVersion,
            disableLog: utils.disableLog,
            disableWarnings: utils.disableWarnings,
            // Expose sdp as a convenience. For production apps include directly.
            sdp: sdp
          };

          // Shim browser if found.
          switch (browserDetails.browser) {
            case 'chrome':
              if (!chromeShim || !chromeShim.shimPeerConnection || !options.shimChrome) {
                logging('Chrome shim is not included in this adapter release.');
                return adapter;
              }
              if (browserDetails.version === null) {
                logging('Chrome shim can not determine version, not shimming.');
                return adapter;
              }
              logging('adapter.js shimming chrome.');
              // Export to the adapter global object visible in the browser.
              adapter.browserShim = chromeShim;

              // Must be called before shimPeerConnection.
              commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);
              commonShim.shimParameterlessSetLocalDescription(window, browserDetails);
              chromeShim.shimGetUserMedia(window, browserDetails);
              chromeShim.shimMediaStream(window, browserDetails);
              chromeShim.shimPeerConnection(window, browserDetails);
              chromeShim.shimOnTrack(window, browserDetails);
              chromeShim.shimAddTrackRemoveTrack(window, browserDetails);
              chromeShim.shimGetSendersWithDtmf(window, browserDetails);
              chromeShim.shimSenderReceiverGetStats(window, browserDetails);
              chromeShim.fixNegotiationNeeded(window, browserDetails);
              commonShim.shimRTCIceCandidate(window, browserDetails);
              commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);
              commonShim.shimConnectionState(window, browserDetails);
              commonShim.shimMaxMessageSize(window, browserDetails);
              commonShim.shimSendThrowTypeError(window, browserDetails);
              commonShim.removeExtmapAllowMixed(window, browserDetails);
              break;
            case 'firefox':
              if (!firefoxShim || !firefoxShim.shimPeerConnection || !options.shimFirefox) {
                logging('Firefox shim is not included in this adapter release.');
                return adapter;
              }
              logging('adapter.js shimming firefox.');
              // Export to the adapter global object visible in the browser.
              adapter.browserShim = firefoxShim;

              // Must be called before shimPeerConnection.
              commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);
              commonShim.shimParameterlessSetLocalDescription(window, browserDetails);
              firefoxShim.shimGetUserMedia(window, browserDetails);
              firefoxShim.shimPeerConnection(window, browserDetails);
              firefoxShim.shimOnTrack(window, browserDetails);
              firefoxShim.shimRemoveStream(window, browserDetails);
              firefoxShim.shimSenderGetStats(window, browserDetails);
              firefoxShim.shimReceiverGetStats(window, browserDetails);
              firefoxShim.shimRTCDataChannel(window, browserDetails);
              firefoxShim.shimAddTransceiver(window, browserDetails);
              firefoxShim.shimGetParameters(window, browserDetails);
              firefoxShim.shimCreateOffer(window, browserDetails);
              firefoxShim.shimCreateAnswer(window, browserDetails);
              commonShim.shimRTCIceCandidate(window, browserDetails);
              commonShim.shimConnectionState(window, browserDetails);
              commonShim.shimMaxMessageSize(window, browserDetails);
              commonShim.shimSendThrowTypeError(window, browserDetails);
              break;
            case 'safari':
              if (!safariShim || !options.shimSafari) {
                logging('Safari shim is not included in this adapter release.');
                return adapter;
              }
              logging('adapter.js shimming safari.');
              // Export to the adapter global object visible in the browser.
              adapter.browserShim = safariShim;

              // Must be called before shimCallbackAPI.
              commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);
              commonShim.shimParameterlessSetLocalDescription(window, browserDetails);
              safariShim.shimRTCIceServerUrls(window, browserDetails);
              safariShim.shimCreateOfferLegacy(window, browserDetails);
              safariShim.shimCallbacksAPI(window, browserDetails);
              safariShim.shimLocalStreamsAPI(window, browserDetails);
              safariShim.shimRemoteStreamsAPI(window, browserDetails);
              safariShim.shimTrackEventTransceiver(window, browserDetails);
              safariShim.shimGetUserMedia(window, browserDetails);
              safariShim.shimAudioContext(window, browserDetails);
              commonShim.shimRTCIceCandidate(window, browserDetails);
              commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);
              commonShim.shimMaxMessageSize(window, browserDetails);
              commonShim.shimSendThrowTypeError(window, browserDetails);
              commonShim.removeExtmapAllowMixed(window, browserDetails);
              break;
            default:
              logging('Unsupported browser!');
              break;
          }
          return adapter;
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.adapterFactory;
      }, function () {
        return {
          './utils': __cjsMetaURL$1,
          './chrome/chrome_shim': __cjsMetaURL$2,
          './firefox/firefox_shim': __cjsMetaURL$3,
          './safari/safari_shim': __cjsMetaURL$4,
          './common_shim': __cjsMetaURL$5,
          'sdp': __cjsMetaURL$6
        };
      });
    }
  };
});

System.register("chunks:///_virtual/binarypack.cjs", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      function _createForOfIteratorHelperLoose(o, allowArrayLike) {
        var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
        if (it) return (it = it.call(o)).next.bind(it);
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          return function () {
            if (i >= o.length) return {
              done: true
            };
            return {
              done: false,
              value: o[i++]
            };
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }
      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;
        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
        return arr2;
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // #region ORIGINAL CODE

        function $parcel$export(e, n, v, s) {
          Object.defineProperty(e, n, {
            get: v,
            set: s,
            enumerable: true,
            configurable: true
          });
        }
        $parcel$export(module.exports, "unpack", function () {
          return $305e16fc3067229c$export$417857010dc9287f;
        });
        $parcel$export(module.exports, "pack", function () {
          return $305e16fc3067229c$export$2a703dbb0cb35339;
        });
        $parcel$export(module.exports, "Packer", function () {
          return $305e16fc3067229c$export$b9ec4b114aa40074;
        });
        var $df5e3223d81bc678$export$93654d4f2d6cd524 = /*#__PURE__*/function () {
          function $df5e3223d81bc678$export$93654d4f2d6cd524() {
            this.encoder = new TextEncoder();
            this._pieces = [];
            this._parts = [];
          }
          var _proto = $df5e3223d81bc678$export$93654d4f2d6cd524.prototype;
          _proto.append_buffer = function append_buffer(data) {
            this.flush();
            this._parts.push(data);
          };
          _proto.append = function append(data) {
            this._pieces.push(data);
          };
          _proto.flush = function flush() {
            if (this._pieces.length > 0) {
              var buf = new Uint8Array(this._pieces);
              this._parts.push(buf);
              this._pieces = [];
            }
          };
          _proto.toArrayBuffer = function toArrayBuffer() {
            var buffer = [];
            for (var _iterator = _createForOfIteratorHelperLoose(this._parts), _step; !(_step = _iterator()).done;) {
              var part = _step.value;
              buffer.push(part);
            }
            return $df5e3223d81bc678$var$concatArrayBuffers(buffer).buffer;
          };
          return $df5e3223d81bc678$export$93654d4f2d6cd524;
        }();
        function $df5e3223d81bc678$var$concatArrayBuffers(bufs) {
          var size = 0;
          for (var _iterator2 = _createForOfIteratorHelperLoose(bufs), _step2; !(_step2 = _iterator2()).done;) {
            var buf = _step2.value;
            size += buf.byteLength;
          }
          var result = new Uint8Array(size);
          var offset = 0;
          for (var _iterator3 = _createForOfIteratorHelperLoose(bufs), _step3; !(_step3 = _iterator3()).done;) {
            var _buf = _step3.value;
            var view = new Uint8Array(_buf.buffer, _buf.byteOffset, _buf.byteLength);
            result.set(view, offset);
            offset += _buf.byteLength;
          }
          return result;
        }
        function $305e16fc3067229c$export$417857010dc9287f(data) {
          var unpacker = new $305e16fc3067229c$var$Unpacker(data);
          return unpacker.unpack();
        }
        function $305e16fc3067229c$export$2a703dbb0cb35339(data) {
          var packer = new $305e16fc3067229c$export$b9ec4b114aa40074();
          var res = packer.pack(data);
          if (res instanceof Promise) return res.then(function () {
            return packer.getBuffer();
          });
          return packer.getBuffer();
        }
        var $305e16fc3067229c$var$Unpacker = /*#__PURE__*/function () {
          function $305e16fc3067229c$var$Unpacker(data) {
            this.index = 0;
            this.dataBuffer = data;
            this.dataView = new Uint8Array(this.dataBuffer);
            this.length = this.dataBuffer.byteLength;
          }
          var _proto2 = $305e16fc3067229c$var$Unpacker.prototype;
          _proto2.unpack = function unpack() {
            var type = this.unpack_uint8();
            if (type < 0x80) return type;else if ((type ^ 0xe0) < 0x20) return (type ^ 0xe0) - 0x20;
            var size;
            if ((size = type ^ 0xa0) <= 0x0f) return this.unpack_raw(size);else if ((size = type ^ 0xb0) <= 0x0f) return this.unpack_string(size);else if ((size = type ^ 0x90) <= 0x0f) return this.unpack_array(size);else if ((size = type ^ 0x80) <= 0x0f) return this.unpack_map(size);
            switch (type) {
              case 0xc0:
                return null;
              case 0xc1:
                return undefined;
              case 0xc2:
                return false;
              case 0xc3:
                return true;
              case 0xca:
                return this.unpack_float();
              case 0xcb:
                return this.unpack_double();
              case 0xcc:
                return this.unpack_uint8();
              case 0xcd:
                return this.unpack_uint16();
              case 0xce:
                return this.unpack_uint32();
              case 0xcf:
                return this.unpack_uint64();
              case 0xd0:
                return this.unpack_int8();
              case 0xd1:
                return this.unpack_int16();
              case 0xd2:
                return this.unpack_int32();
              case 0xd3:
                return this.unpack_int64();
              case 0xd4:
                return undefined;
              case 0xd5:
                return undefined;
              case 0xd6:
                return undefined;
              case 0xd7:
                return undefined;
              case 0xd8:
                size = this.unpack_uint16();
                return this.unpack_string(size);
              case 0xd9:
                size = this.unpack_uint32();
                return this.unpack_string(size);
              case 0xda:
                size = this.unpack_uint16();
                return this.unpack_raw(size);
              case 0xdb:
                size = this.unpack_uint32();
                return this.unpack_raw(size);
              case 0xdc:
                size = this.unpack_uint16();
                return this.unpack_array(size);
              case 0xdd:
                size = this.unpack_uint32();
                return this.unpack_array(size);
              case 0xde:
                size = this.unpack_uint16();
                return this.unpack_map(size);
              case 0xdf:
                size = this.unpack_uint32();
                return this.unpack_map(size);
            }
          };
          _proto2.unpack_uint8 = function unpack_uint8() {
            var _byte = this.dataView[this.index] & 0xff;
            this.index++;
            return _byte;
          };
          _proto2.unpack_uint16 = function unpack_uint16() {
            var bytes = this.read(2);
            var uint16 = (bytes[0] & 0xff) * 256 + (bytes[1] & 0xff);
            this.index += 2;
            return uint16;
          };
          _proto2.unpack_uint32 = function unpack_uint32() {
            var bytes = this.read(4);
            var uint32 = ((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3];
            this.index += 4;
            return uint32;
          };
          _proto2.unpack_uint64 = function unpack_uint64() {
            var bytes = this.read(8);
            var uint64 = ((((((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3]) * 256 + bytes[4]) * 256 + bytes[5]) * 256 + bytes[6]) * 256 + bytes[7];
            this.index += 8;
            return uint64;
          };
          _proto2.unpack_int8 = function unpack_int8() {
            var uint8 = this.unpack_uint8();
            return uint8 < 0x80 ? uint8 : uint8 - 256;
          };
          _proto2.unpack_int16 = function unpack_int16() {
            var uint16 = this.unpack_uint16();
            return uint16 < 0x8000 ? uint16 : uint16 - 65536;
          };
          _proto2.unpack_int32 = function unpack_int32() {
            var uint32 = this.unpack_uint32();
            return uint32 < Math.pow(2, 31) ? uint32 : uint32 - Math.pow(2, 32);
          };
          _proto2.unpack_int64 = function unpack_int64() {
            var uint64 = this.unpack_uint64();
            return uint64 < Math.pow(2, 63) ? uint64 : uint64 - Math.pow(2, 64);
          };
          _proto2.unpack_raw = function unpack_raw(size) {
            if (this.length < this.index + size) throw new Error("BinaryPackFailure: index is out of range " + this.index + " " + size + " " + this.length);
            var buf = this.dataBuffer.slice(this.index, this.index + size);
            this.index += size;
            return buf;
          };
          _proto2.unpack_string = function unpack_string(size) {
            var bytes = this.read(size);
            var i = 0;
            var str = "";
            var c;
            var code;
            while (i < size) {
              c = bytes[i];
              // The length of a UTF-8 sequence is specified in the first byte:
              // 0xxxxxxx means length 1,
              // 110xxxxx means length 2,
              // 1110xxxx means length 3,
              // 11110xxx means length 4.
              // 10xxxxxx is for non-initial bytes.
              if (c < 0xa0) {
                // One-byte sequence: bits 0xxxxxxx
                code = c;
                i++;
              } else if ((c ^ 0xc0) < 0x20) {
                // Two-byte sequence: bits 110xxxxx 10xxxxxx
                code = (c & 0x1f) << 6 | bytes[i + 1] & 0x3f;
                i += 2;
              } else if ((c ^ 0xe0) < 0x10) {
                // Three-byte sequence: bits 1110xxxx 10xxxxxx 10xxxxxx
                code = (c & 0x0f) << 12 | (bytes[i + 1] & 0x3f) << 6 | bytes[i + 2] & 0x3f;
                i += 3;
              } else {
                // Four-byte sequence: bits 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
                code = (c & 0x07) << 18 | (bytes[i + 1] & 0x3f) << 12 | (bytes[i + 2] & 0x3f) << 6 | bytes[i + 3] & 0x3f;
                i += 4;
              }
              str += String.fromCodePoint(code);
            }
            this.index += size;
            return str;
          };
          _proto2.unpack_array = function unpack_array(size) {
            var objects = new Array(size);
            for (var i = 0; i < size; i++) objects[i] = this.unpack();
            return objects;
          };
          _proto2.unpack_map = function unpack_map(size) {
            var map = {};
            for (var i = 0; i < size; i++) {
              var key = this.unpack();
              map[key] = this.unpack();
            }
            return map;
          };
          _proto2.unpack_float = function unpack_float() {
            var uint32 = this.unpack_uint32();
            var sign = uint32 >> 31;
            var exp = (uint32 >> 23 & 0xff) - 127;
            var fraction = uint32 & 0x7fffff | 0x800000;
            return (sign === 0 ? 1 : -1) * fraction * Math.pow(2, exp - 23);
          };
          _proto2.unpack_double = function unpack_double() {
            var h32 = this.unpack_uint32();
            var l32 = this.unpack_uint32();
            var sign = h32 >> 31;
            var exp = (h32 >> 20 & 0x7ff) - 1023;
            var hfrac = h32 & 0xfffff | 0x100000;
            var frac = hfrac * Math.pow(2, exp - 20) + l32 * Math.pow(2, exp - 52);
            return (sign === 0 ? 1 : -1) * frac;
          };
          _proto2.read = function read(length) {
            var j = this.index;
            if (j + length <= this.length) return this.dataView.subarray(j, j + length);else throw new Error("BinaryPackFailure: read index out of range");
          };
          return $305e16fc3067229c$var$Unpacker;
        }();
        var $305e16fc3067229c$export$b9ec4b114aa40074 = /*#__PURE__*/function () {
          var _proto3 = $305e16fc3067229c$export$b9ec4b114aa40074.prototype;
          _proto3.getBuffer = function getBuffer() {
            return this._bufferBuilder.toArrayBuffer();
          };
          _proto3.pack = function pack(value) {
            var _this = this;
            if (typeof value === "string") this.pack_string(value);else if (typeof value === "number") {
              if (Math.floor(value) === value) this.pack_integer(value);else this.pack_double(value);
            } else if (typeof value === "boolean") {
              if (value === true) this._bufferBuilder.append(0xc3);else if (value === false) this._bufferBuilder.append(0xc2);
            } else if (value === undefined) this._bufferBuilder.append(0xc0);else if (typeof value === "object") {
              if (value === null) this._bufferBuilder.append(0xc0);else {
                var _constructor = value.constructor;
                if (value instanceof Array) {
                  var res = this.pack_array(value);
                  if (res instanceof Promise) return res.then(function () {
                    return _this._bufferBuilder.flush();
                  });
                } else if (value instanceof ArrayBuffer) this.pack_bin(new Uint8Array(value));else if ("BYTES_PER_ELEMENT" in value) {
                  var v = value;
                  this.pack_bin(new Uint8Array(v.buffer, v.byteOffset, v.byteLength));
                } else if (value instanceof Date) this.pack_string(value.toString());else if (value instanceof Blob) return value.arrayBuffer().then(function (buffer) {
                  _this.pack_bin(new Uint8Array(buffer));
                  _this._bufferBuilder.flush();
                });else if (_constructor == Object || _constructor.toString().startsWith("class")) {
                  var _res = this.pack_object(value);
                  if (_res instanceof Promise) return _res.then(function () {
                    return _this._bufferBuilder.flush();
                  });
                } else throw new Error("Type \"" + _constructor.toString() + "\" not yet supported");
              }
            } else throw new Error("Type \"" + typeof value + "\" not yet supported");
            this._bufferBuilder.flush();
          };
          _proto3.pack_bin = function pack_bin(blob) {
            var length = blob.length;
            if (length <= 0x0f) this.pack_uint8(0xa0 + length);else if (length <= 0xffff) {
              this._bufferBuilder.append(0xda);
              this.pack_uint16(length);
            } else if (length <= 0xffffffff) {
              this._bufferBuilder.append(0xdb);
              this.pack_uint32(length);
            } else throw new Error("Invalid length");
            this._bufferBuilder.append_buffer(blob);
          };
          _proto3.pack_string = function pack_string(str) {
            var encoded = this._textEncoder.encode(str);
            var length = encoded.length;
            if (length <= 0x0f) this.pack_uint8(0xb0 + length);else if (length <= 0xffff) {
              this._bufferBuilder.append(0xd8);
              this.pack_uint16(length);
            } else if (length <= 0xffffffff) {
              this._bufferBuilder.append(0xd9);
              this.pack_uint32(length);
            } else throw new Error("Invalid length");
            this._bufferBuilder.append_buffer(encoded);
          };
          _proto3.pack_array = function pack_array(ary) {
            var _this2 = this;
            var length = ary.length;
            if (length <= 0x0f) this.pack_uint8(0x90 + length);else if (length <= 0xffff) {
              this._bufferBuilder.append(0xdc);
              this.pack_uint16(length);
            } else if (length <= 0xffffffff) {
              this._bufferBuilder.append(0xdd);
              this.pack_uint32(length);
            } else throw new Error("Invalid length");
            var packNext = function packNext(index) {
              if (index < length) {
                var res = _this2.pack(ary[index]);
                if (res instanceof Promise) return res.then(function () {
                  return packNext(index + 1);
                });
                return packNext(index + 1);
              }
            };
            return packNext(0);
          };
          _proto3.pack_integer = function pack_integer(num) {
            if (num >= -32 && num <= 0x7f) this._bufferBuilder.append(num & 0xff);else if (num >= 0x00 && num <= 0xff) {
              this._bufferBuilder.append(0xcc);
              this.pack_uint8(num);
            } else if (num >= -128 && num <= 0x7f) {
              this._bufferBuilder.append(0xd0);
              this.pack_int8(num);
            } else if (num >= 0x0000 && num <= 0xffff) {
              this._bufferBuilder.append(0xcd);
              this.pack_uint16(num);
            } else if (num >= -32768 && num <= 0x7fff) {
              this._bufferBuilder.append(0xd1);
              this.pack_int16(num);
            } else if (num >= 0x00000000 && num <= 0xffffffff) {
              this._bufferBuilder.append(0xce);
              this.pack_uint32(num);
            } else if (num >= -2147483648 && num <= 0x7fffffff) {
              this._bufferBuilder.append(0xd2);
              this.pack_int32(num);
            } else if (num >= -9223372036854776000 && num <= 0x7fffffffffffffff) {
              this._bufferBuilder.append(0xd3);
              this.pack_int64(num);
            } else if (num >= 0x0000000000000000 && num <= 0xffffffffffffffff) {
              this._bufferBuilder.append(0xcf);
              this.pack_uint64(num);
            } else throw new Error("Invalid integer");
          };
          _proto3.pack_double = function pack_double(num) {
            var sign = 0;
            if (num < 0) {
              sign = 1;
              num = -num;
            }
            var exp = Math.floor(Math.log(num) / Math.LN2);
            var frac0 = num / Math.pow(2, exp) - 1;
            var frac1 = Math.floor(frac0 * Math.pow(2, 52));
            var b32 = Math.pow(2, 32);
            var h32 = sign << 31 | exp + 1023 << 20 | frac1 / b32 & 0x0fffff;
            var l32 = frac1 % b32;
            this._bufferBuilder.append(0xcb);
            this.pack_int32(h32);
            this.pack_int32(l32);
          };
          _proto3.pack_object = function pack_object(obj) {
            var _this3 = this;
            var keys = Object.keys(obj);
            var length = keys.length;
            if (length <= 0x0f) this.pack_uint8(0x80 + length);else if (length <= 0xffff) {
              this._bufferBuilder.append(0xde);
              this.pack_uint16(length);
            } else if (length <= 0xffffffff) {
              this._bufferBuilder.append(0xdf);
              this.pack_uint32(length);
            } else throw new Error("Invalid length");
            var packNext = function packNext(index) {
              if (index < keys.length) {
                var prop = keys[index];
                // eslint-disable-next-line no-prototype-builtins
                if (obj.hasOwnProperty(prop)) {
                  _this3.pack(prop);
                  var res = _this3.pack(obj[prop]);
                  if (res instanceof Promise) return res.then(function () {
                    return packNext(index + 1);
                  });
                }
                return packNext(index + 1);
              }
            };
            return packNext(0);
          };
          _proto3.pack_uint8 = function pack_uint8(num) {
            this._bufferBuilder.append(num);
          };
          _proto3.pack_uint16 = function pack_uint16(num) {
            this._bufferBuilder.append(num >> 8);
            this._bufferBuilder.append(num & 0xff);
          };
          _proto3.pack_uint32 = function pack_uint32(num) {
            var n = num & 0xffffffff;
            this._bufferBuilder.append((n & 0xff000000) >>> 24);
            this._bufferBuilder.append((n & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((n & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(n & 0x000000ff);
          };
          _proto3.pack_uint64 = function pack_uint64(num) {
            var high = num / Math.pow(2, 32);
            var low = num % Math.pow(2, 32);
            this._bufferBuilder.append((high & 0xff000000) >>> 24);
            this._bufferBuilder.append((high & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((high & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(high & 0x000000ff);
            this._bufferBuilder.append((low & 0xff000000) >>> 24);
            this._bufferBuilder.append((low & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((low & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(low & 0x000000ff);
          };
          _proto3.pack_int8 = function pack_int8(num) {
            this._bufferBuilder.append(num & 0xff);
          };
          _proto3.pack_int16 = function pack_int16(num) {
            this._bufferBuilder.append((num & 0xff00) >> 8);
            this._bufferBuilder.append(num & 0xff);
          };
          _proto3.pack_int32 = function pack_int32(num) {
            this._bufferBuilder.append(num >>> 24 & 0xff);
            this._bufferBuilder.append((num & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((num & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(num & 0x000000ff);
          };
          _proto3.pack_int64 = function pack_int64(num) {
            var high = Math.floor(num / Math.pow(2, 32));
            var low = num % Math.pow(2, 32);
            this._bufferBuilder.append((high & 0xff000000) >>> 24);
            this._bufferBuilder.append((high & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((high & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(high & 0x000000ff);
            this._bufferBuilder.append((low & 0xff000000) >>> 24);
            this._bufferBuilder.append((low & 0x00ff0000) >>> 16);
            this._bufferBuilder.append((low & 0x0000ff00) >>> 8);
            this._bufferBuilder.append(low & 0x000000ff);
          };
          function $305e16fc3067229c$export$b9ec4b114aa40074() {
            this._bufferBuilder = new $df5e3223d81bc678$export$93654d4f2d6cd524();
            this._textEncoder = new TextEncoder();
          }
          return $305e16fc3067229c$export$b9ec4b114aa40074;
        }(); // #endregion ORIGINAL CODE
        module.exports;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/bundler.cjs", ['./cjs-loader.mjs', './binarypack.cjs', './adapter_core.js', './index.js', './index2.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3, __cjsMetaURL$4;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$4 = module.__cjsMetaURL;
    }],
    execute: function () {
      exports('default', void 0);
      var id = 0;
      function _classPrivateFieldLooseKey(name) {
        return "__private_" + id++ + "_" + name;
      }
      function _assertThisInitialized(self) {
        if (self === void 0) {
          throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        }
        return self;
      }
      function _wrapNativeSuper(Class) {
        var _cache = typeof Map === "function" ? new Map() : undefined;
        _wrapNativeSuper = function _wrapNativeSuper(Class) {
          if (Class === null || !_isNativeFunction(Class)) return Class;
          if (typeof Class !== "function") {
            throw new TypeError("Super expression must either be null or a function");
          }
          if (typeof _cache !== "undefined") {
            if (_cache.has(Class)) return _cache.get(Class);
            _cache.set(Class, Wrapper);
          }
          function Wrapper() {
            return _construct(Class, arguments, _getPrototypeOf(this).constructor);
          }
          Wrapper.prototype = Object.create(Class.prototype, {
            constructor: {
              value: Wrapper,
              enumerable: false,
              writable: true,
              configurable: true
            }
          });
          return _setPrototypeOf(Wrapper, Class);
        };
        return _wrapNativeSuper(Class);
      }
      function _construct(Parent, args, Class) {
        if (_isNativeReflectConstruct()) {
          _construct = Reflect.construct.bind();
        } else {
          _construct = function _construct(Parent, args, Class) {
            var a = [null];
            a.push.apply(a, args);
            var Constructor = Function.bind.apply(Parent, a);
            var instance = new Constructor();
            if (Class) _setPrototypeOf(instance, Class.prototype);
            return instance;
          };
        }
        return _construct.apply(null, arguments);
      }
      function _isNativeReflectConstruct() {
        if (typeof Reflect === "undefined" || !Reflect.construct) return false;
        if (Reflect.construct.sham) return false;
        if (typeof Proxy === "function") return true;
        try {
          Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
          return true;
        } catch (e) {
          return false;
        }
      }
      function _isNativeFunction(fn) {
        return Function.toString.call(fn).indexOf("[native code]") !== -1;
      }
      function _getPrototypeOf(o) {
        _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {
          return o.__proto__ || Object.getPrototypeOf(o);
        };
        return _getPrototypeOf(o);
      }
      function _regeneratorRuntime() {
        /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime = function _regeneratorRuntime() {
          return e;
        };
        var t,
          e = {},
          r = Object.prototype,
          n = r.hasOwnProperty,
          o = Object.defineProperty || function (t, e, r) {
            t[e] = r.value;
          },
          i = "function" == typeof Symbol ? Symbol : {},
          a = i.iterator || "@@iterator",
          c = i.asyncIterator || "@@asyncIterator",
          u = i.toStringTag || "@@toStringTag";
        function define(t, e, r) {
          return Object.defineProperty(t, e, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }), t[e];
        }
        try {
          define({}, "");
        } catch (t) {
          define = function define(t, e, r) {
            return t[e] = r;
          };
        }
        function wrap(t, e, r, n) {
          var i = e && e.prototype instanceof Generator ? e : Generator,
            a = Object.create(i.prototype),
            c = new Context(n || []);
          return o(a, "_invoke", {
            value: makeInvokeMethod(t, r, c)
          }), a;
        }
        function tryCatch(t, e, r) {
          try {
            return {
              type: "normal",
              arg: t.call(e, r)
            };
          } catch (t) {
            return {
              type: "throw",
              arg: t
            };
          }
        }
        e.wrap = wrap;
        var h = "suspendedStart",
          l = "suspendedYield",
          f = "executing",
          s = "completed",
          y = {};
        function Generator() {}
        function GeneratorFunction() {}
        function GeneratorFunctionPrototype() {}
        var p = {};
        define(p, a, function () {
          return this;
        });
        var d = Object.getPrototypeOf,
          v = d && d(d(values([])));
        v && v !== r && n.call(v, a) && (p = v);
        var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);
        function defineIteratorMethods(t) {
          ["next", "throw", "return"].forEach(function (e) {
            define(t, e, function (t) {
              return this._invoke(e, t);
            });
          });
        }
        function AsyncIterator(t, e) {
          function invoke(r, o, i, a) {
            var c = tryCatch(t[r], t, o);
            if ("throw" !== c.type) {
              var u = c.arg,
                h = u.value;
              return h && "object" == typeof h && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) {
                invoke("next", t, i, a);
              }, function (t) {
                invoke("throw", t, i, a);
              }) : e.resolve(h).then(function (t) {
                u.value = t, i(u);
              }, function (t) {
                return invoke("throw", t, i, a);
              });
            }
            a(c.arg);
          }
          var r;
          o(this, "_invoke", {
            value: function value(t, n) {
              function callInvokeWithMethodAndArg() {
                return new e(function (e, r) {
                  invoke(t, n, e, r);
                });
              }
              return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
          });
        }
        function makeInvokeMethod(e, r, n) {
          var o = h;
          return function (i, a) {
            if (o === f) throw new Error("Generator is already running");
            if (o === s) {
              if ("throw" === i) throw a;
              return {
                value: t,
                done: !0
              };
            }
            for (n.method = i, n.arg = a;;) {
              var c = n.delegate;
              if (c) {
                var u = maybeInvokeDelegate(c, n);
                if (u) {
                  if (u === y) continue;
                  return u;
                }
              }
              if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) {
                if (o === h) throw o = s, n.arg;
                n.dispatchException(n.arg);
              } else "return" === n.method && n.abrupt("return", n.arg);
              o = f;
              var p = tryCatch(e, r, n);
              if ("normal" === p.type) {
                if (o = n.done ? s : l, p.arg === y) continue;
                return {
                  value: p.arg,
                  done: n.done
                };
              }
              "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg);
            }
          };
        }
        function maybeInvokeDelegate(e, r) {
          var n = r.method,
            o = e.iterator[n];
          if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y;
          var i = tryCatch(o, e.iterator, r.arg);
          if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y;
          var a = i.arg;
          return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y);
        }
        function pushTryEntry(t) {
          var e = {
            tryLoc: t[0]
          };
          1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
        }
        function resetTryEntry(t) {
          var e = t.completion || {};
          e.type = "normal", delete e.arg, t.completion = e;
        }
        function Context(t) {
          this.tryEntries = [{
            tryLoc: "root"
          }], t.forEach(pushTryEntry, this), this.reset(!0);
        }
        function values(e) {
          if (e || "" === e) {
            var r = e[a];
            if (r) return r.call(e);
            if ("function" == typeof e.next) return e;
            if (!isNaN(e.length)) {
              var o = -1,
                i = function next() {
                  for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;
                  return next.value = t, next.done = !0, next;
                };
              return i.next = i;
            }
          }
          throw new TypeError(typeof e + " is not iterable");
        }
        return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", {
          value: GeneratorFunctionPrototype,
          configurable: !0
        }), o(GeneratorFunctionPrototype, "constructor", {
          value: GeneratorFunction,
          configurable: !0
        }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
          var e = "function" == typeof t && t.constructor;
          return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name));
        }, e.mark = function (t) {
          return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t;
        }, e.awrap = function (t) {
          return {
            __await: t
          };
        }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {
          return this;
        }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {
          void 0 === i && (i = Promise);
          var a = new AsyncIterator(wrap(t, r, n, o), i);
          return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {
            return t.done ? t.value : a.next();
          });
        }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () {
          return this;
        }), define(g, "toString", function () {
          return "[object Generator]";
        }), e.keys = function (t) {
          var e = Object(t),
            r = [];
          for (var n in e) r.push(n);
          return r.reverse(), function next() {
            for (; r.length;) {
              var t = r.pop();
              if (t in e) return next.value = t, next.done = !1, next;
            }
            return next.done = !0, next;
          };
        }, e.values = values, Context.prototype = {
          constructor: Context,
          reset: function reset(e) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);
          },
          stop: function stop() {
            this.done = !0;
            var t = this.tryEntries[0].completion;
            if ("throw" === t.type) throw t.arg;
            return this.rval;
          },
          dispatchException: function dispatchException(e) {
            if (this.done) throw e;
            var r = this;
            function handle(n, o) {
              return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o;
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var i = this.tryEntries[o],
                a = i.completion;
              if ("root" === i.tryLoc) return handle("end");
              if (i.tryLoc <= this.prev) {
                var c = n.call(i, "catchLoc"),
                  u = n.call(i, "finallyLoc");
                if (c && u) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                } else if (c) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                } else {
                  if (!u) throw new Error("try statement without catch or finally");
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                }
              }
            }
          },
          abrupt: function abrupt(t, e) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var o = this.tryEntries[r];
              if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                var i = o;
                break;
              }
            }
            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
            var a = i ? i.completion : {};
            return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a);
          },
          complete: function complete(t, e) {
            if ("throw" === t.type) throw t.arg;
            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y;
          },
          finish: function finish(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;
            }
          },
          "catch": function _catch(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.tryLoc === t) {
                var n = r.completion;
                if ("throw" === n.type) {
                  var o = n.arg;
                  resetTryEntry(r);
                }
                return o;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function delegateYield(e, r, n) {
            return this.delegate = {
              iterator: values(e),
              resultName: r,
              nextLoc: n
            }, "next" === this.method && (this.arg = t), y;
          }
        }, e;
      }
      function _extends() {
        _extends = Object.assign ? Object.assign.bind() : function (target) {
          for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i];
            for (var key in source) {
              if (Object.prototype.hasOwnProperty.call(source, key)) {
                target[key] = source[key];
              }
            }
          }
          return target;
        };
        return _extends.apply(this, arguments);
      }
      function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }
        if (info.done) {
          resolve(value);
        } else {
          Promise.resolve(value).then(_next, _throw);
        }
      }
      function _asyncToGenerator(fn) {
        return function () {
          var self = this,
            args = arguments;
          return new Promise(function (resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
          });
        };
      }
      function _defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
          var descriptor = props[i];
          descriptor.enumerable = descriptor.enumerable || false;
          descriptor.configurable = true;
          if ("value" in descriptor) descriptor.writable = true;
          Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);
        }
      }
      function _createClass(Constructor, protoProps, staticProps) {
        if (protoProps) _defineProperties(Constructor.prototype, protoProps);
        if (staticProps) _defineProperties(Constructor, staticProps);
        Object.defineProperty(Constructor, "prototype", {
          writable: false
        });
        return Constructor;
      }
      function _toPropertyKey(arg) {
        var key = _toPrimitive(arg, "string");
        return typeof key === "symbol" ? key : String(key);
      }
      function _toPrimitive(input, hint) {
        if (typeof input !== "object" || input === null) return input;
        var prim = input[Symbol.toPrimitive];
        if (prim !== undefined) {
          var res = prim.call(input, hint || "default");
          if (typeof res !== "object") return res;
          throw new TypeError("@@toPrimitive must return a primitive value.");
        }
        return (hint === "string" ? String : Number)(input);
      }
      function _inheritsLoose(subClass, superClass) {
        subClass.prototype = Object.create(superClass.prototype);
        subClass.prototype.constructor = subClass;
        _setPrototypeOf(subClass, superClass);
      }
      function _setPrototypeOf(o, p) {
        _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {
          o.__proto__ = p;
          return o;
        };
        return _setPrototypeOf(o, p);
      }
      function _createForOfIteratorHelperLoose(o, allowArrayLike) {
        var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
        if (it) return (it = it.call(o)).next.bind(it);
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          return function () {
            if (i >= o.length) return {
              done: true
            };
            return {
              done: false,
              value: o[i++]
            };
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }
      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;
        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
        return arr2;
      }
      function _asyncIterator(r) {
        var n,
          t,
          o,
          e = 2;
        for ("undefined" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) {
          if (t && null != (n = r[t])) return n.call(r);
          if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));
          t = "@@asyncIterator", o = "@@iterator";
        }
        throw new TypeError("Object is not async iterable");
      }
      function AsyncFromSyncIterator(r) {
        function AsyncFromSyncIteratorContinuation(r) {
          if (Object(r) !== r) return Promise.reject(new TypeError(r + " is not an object."));
          var n = r.done;
          return Promise.resolve(r.value).then(function (r) {
            return {
              value: r,
              done: n
            };
          });
        }
        return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) {
          this.s = r, this.n = r.next;
        }, AsyncFromSyncIterator.prototype = {
          s: null,
          n: null,
          next: function next() {
            return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));
          },
          "return": function _return(r) {
            var n = this.s["return"];
            return void 0 === n ? Promise.resolve({
              value: r,
              done: !0
            }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));
          },
          "throw": function _throw(r) {
            var n = this.s["return"];
            return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));
          }
        }, new AsyncFromSyncIterator(r);
      }
      var _cjsExports;
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports$1, require, module, __filename, __dirname) {
        var _class2, _class3, _class4;
        // #region ORIGINAL CODE

        var $2QID2$peerjsjsbinarypack = require("peerjs-js-binarypack");
        var $2QID2$webrtcadapter = require("webrtc-adapter");
        var $2QID2$eventemitter3 = require("eventemitter3");
        var $2QID2$msgpackmsgpack = require("@msgpack/msgpack");
        function $parcel$defineInteropFlag(a) {
          Object.defineProperty(a, '__esModule', {
            value: true,
            configurable: true
          });
        }
        function $parcel$exportWildcard(dest, source) {
          Object.keys(source).forEach(function (key) {
            if (key === 'default' || key === '__esModule' || Object.prototype.hasOwnProperty.call(dest, key)) {
              return;
            }
            Object.defineProperty(dest, key, {
              enumerable: true,
              get: function get() {
                return source[key];
              }
            });
          });
          return dest;
        }
        function $parcel$export(e, n, v, s) {
          Object.defineProperty(e, n, {
            get: v,
            set: s,
            enumerable: true,
            configurable: true
          });
        }
        function $parcel$interopDefault(a) {
          return a && a.__esModule ? a["default"] : a;
        }
        $parcel$defineInteropFlag(module.exports);
        $parcel$export(module.exports, "default", function () {
          return $8c8bca0fa9aa4b8b$export$2e2bcd8739ae039;
        });
        $parcel$export(module.exports, "util", function () {
          return $b83e6a166cc3008f$export$7debb50ef11d5e0b;
        });
        $parcel$export(module.exports, "BufferedConnection", function () {
          return $8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b;
        });
        $parcel$export(module.exports, "StreamConnection", function () {
          return $544799118fa637e6$export$72aa44612e2200cd;
        });
        $parcel$export(module.exports, "MsgPack", function () {
          return $7e477efb76e02214$export$80f5de1a66c4d624;
        });
        $parcel$export(module.exports, "Peer", function () {
          return $2ddecb16305b5a82$export$ecd1fc136c422448;
        });
        $parcel$export(module.exports, "MsgPackPeer", function () {
          return $8c8805059443e9b3$export$d72c7bf8eef50853;
        });
        $parcel$export(module.exports, "PeerError", function () {
          return $cf62563e7a9fbce5$export$98871882f492de82;
        });
        var $7ce5389b504cc06c$export$f1c5f4c9cb95390b = function $7ce5389b504cc06c$export$f1c5f4c9cb95390b() {
          var _this = this;
          this.chunkedMTU = 16300 // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is "cut off" after 16384 bytes and delivered individually.
          ;
          // Binary stuff
          this._dataCount = 1;
          this.chunk = function (blob) {
            var chunks = [];
            var size = blob.byteLength;
            var total = Math.ceil(size / _this.chunkedMTU);
            var index = 0;
            var start = 0;
            while (start < size) {
              var end = Math.min(size, start + _this.chunkedMTU);
              var b = blob.slice(start, end);
              var chunk = {
                __peerData: _this._dataCount,
                n: index,
                data: b,
                total: total
              };
              chunks.push(chunk);
              start = end;
              index++;
            }
            _this._dataCount++;
            return chunks;
          };
        };
        function $7ce5389b504cc06c$export$52c89ebcdc4f53f2(bufs) {
          var size = 0;
          for (var _iterator2 = _createForOfIteratorHelperLoose(bufs), _step2; !(_step2 = _iterator2()).done;) {
            var buf = _step2.value;
            size += buf.byteLength;
          }
          var result = new Uint8Array(size);
          var offset = 0;
          for (var _iterator3 = _createForOfIteratorHelperLoose(bufs), _step3; !(_step3 = _iterator3()).done;) {
            var _buf = _step3.value;
            result.set(_buf, offset);
            offset += _buf.byteLength;
          }
          return result;
        }
        var $07e4f6a369d1179a$var$webRTCAdapter =
        //@ts-ignore
        $parcel$interopDefault($2QID2$webrtcadapter)["default"] || $parcel$interopDefault($2QID2$webrtcadapter);
        var $07e4f6a369d1179a$export$25be9502477c137d = new ( /*#__PURE__*/function () {
          var _proto = _class.prototype;
          _proto.isWebRTCSupported = function isWebRTCSupported() {
            return typeof RTCPeerConnection !== "undefined";
          };
          _proto.isBrowserSupported = function isBrowserSupported() {
            var browser = this.getBrowser();
            var version = this.getVersion();
            var validBrowser = this.supportedBrowsers.includes(browser);
            if (!validBrowser) return false;
            if (browser === "chrome") return version >= this.minChromeVersion;
            if (browser === "firefox") return version >= this.minFirefoxVersion;
            if (browser === "safari") return !this.isIOS && version >= this.minSafariVersion;
            return false;
          };
          _proto.getBrowser = function getBrowser() {
            return $07e4f6a369d1179a$var$webRTCAdapter.browserDetails.browser;
          };
          _proto.getVersion = function getVersion() {
            return $07e4f6a369d1179a$var$webRTCAdapter.browserDetails.version || 0;
          };
          _proto.isUnifiedPlanSupported = function isUnifiedPlanSupported() {
            var browser = this.getBrowser();
            var version = $07e4f6a369d1179a$var$webRTCAdapter.browserDetails.version || 0;
            if (browser === "chrome" && version < this.minChromeVersion) return false;
            if (browser === "firefox" && version >= this.minFirefoxVersion) return true;
            if (!window.RTCRtpTransceiver || !("currentDirection" in RTCRtpTransceiver.prototype)) return false;
            var tempPc;
            var supported = false;
            try {
              tempPc = new RTCPeerConnection();
              tempPc.addTransceiver("audio");
              supported = true;
            } catch (e) {} finally {
              if (tempPc) tempPc.close();
            }
            return supported;
          };
          _proto.toString = function toString() {
            return "Supports:\n     browser:" + this.getBrowser() + "\n     version:" + this.getVersion() + "\n     isIOS:" + this.isIOS + "\n     isWebRTCSupported:" + this.isWebRTCSupported() + "\n     isBrowserSupported:" + this.isBrowserSupported() + "\n     isUnifiedPlanSupported:" + this.isUnifiedPlanSupported();
          };
          function _class() {
            this.isIOS = typeof navigator !== "undefined" ? ["iPad", "iPhone", "iPod"].includes(navigator.platform) : false;
            this.supportedBrowsers = ["firefox", "chrome", "safari"];
            this.minFirefoxVersion = 59;
            this.minChromeVersion = 72;
            this.minSafariVersion = 605;
          }
          return _class;
        }())();
        var $706cd7d90eca90d6$export$f35f128fd59ea256 = function $706cd7d90eca90d6$export$f35f128fd59ea256(id) {
          // Allow empty ids
          return !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);
        };
        var $6a375544f634961e$export$4e61f672936bec77 = function $6a375544f634961e$export$4e61f672936bec77() {
          return Math.random().toString(36).slice(2);
        };
        var $b83e6a166cc3008f$var$DEFAULT_CONFIG = {
          iceServers: [{
            urls: "stun:stun.l.google.com:19302"
          }, {
            urls: ["turn:eu-0.turn.peerjs.com:3478", "turn:us-0.turn.peerjs.com:3478"],
            username: "peerjs",
            credential: "peerjsp"
          }],
          sdpSemantics: "unified-plan"
        };
        var $b83e6a166cc3008f$export$f8f26dd395d7e1bd = /*#__PURE__*/function (_ref) {
          _inheritsLoose($b83e6a166cc3008f$export$f8f26dd395d7e1bd, _ref);
          var _proto2 = $b83e6a166cc3008f$export$f8f26dd395d7e1bd.prototype;
          _proto2.noop = function noop() {};
          _proto2.blobToArrayBuffer = function blobToArrayBuffer(blob, cb) {
            var fr = new FileReader();
            fr.onload = function (evt) {
              if (evt.target) cb(evt.target.result);
            };
            fr.readAsArrayBuffer(blob);
            return fr;
          };
          _proto2.binaryStringToArrayBuffer = function binaryStringToArrayBuffer(binary) {
            var byteArray = new Uint8Array(binary.length);
            for (var i = 0; i < binary.length; i++) byteArray[i] = binary.charCodeAt(i) & 0xff;
            return byteArray.buffer;
          };
          _proto2.isSecure = function isSecure() {
            return location.protocol === "https:";
          };
          function $b83e6a166cc3008f$export$f8f26dd395d7e1bd() {
            var _this2;
            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
              args[_key] = arguments[_key];
            }
            _this2 = _ref.call.apply(_ref, [this].concat(args)) || this, _this2.CLOUD_HOST = "0.peerjs.com", _this2.CLOUD_PORT = 443,
            // Browsers that need chunking:
            _this2.chunkedBrowsers = {
              Chrome: 1,
              chrome: 1
            },
            // Returns browser-agnostic default config
            _this2.defaultConfig = $b83e6a166cc3008f$var$DEFAULT_CONFIG, _this2.browser = $07e4f6a369d1179a$export$25be9502477c137d.getBrowser(), _this2.browserVersion = $07e4f6a369d1179a$export$25be9502477c137d.getVersion(), _this2.pack = $2QID2$peerjsjsbinarypack.pack, _this2.unpack = $2QID2$peerjsjsbinarypack.unpack,
            /**
            * A hash of WebRTC features mapped to booleans that correspond to whether the feature is supported by the current browser.
            *
            * :::caution
            * Only the properties documented here are guaranteed to be present on `util.supports`
            * :::
            */
            _this2.supports = function () {
              var supported = {
                browser: $07e4f6a369d1179a$export$25be9502477c137d.isBrowserSupported(),
                webRTC: $07e4f6a369d1179a$export$25be9502477c137d.isWebRTCSupported(),
                audioVideo: false,
                data: false,
                binaryBlob: false,
                reliable: false
              };
              if (!supported.webRTC) return supported;
              var pc;
              try {
                pc = new RTCPeerConnection($b83e6a166cc3008f$var$DEFAULT_CONFIG);
                supported.audioVideo = true;
                var dc;
                try {
                  dc = pc.createDataChannel("_PEERJSTEST", {
                    ordered: true
                  });
                  supported.data = true;
                  supported.reliable = !!dc.ordered;
                  // Binary test
                  try {
                    dc.binaryType = "blob";
                    supported.binaryBlob = !(0, $07e4f6a369d1179a$export$25be9502477c137d).isIOS;
                  } catch (e) {}
                } catch (e) {} finally {
                  if (dc) dc.close();
                }
              } catch (e) {} finally {
                if (pc) pc.close();
              }
              return supported;
            }(),
            // Ensure alphanumeric ids
            _this2.validateId = $706cd7d90eca90d6$export$f35f128fd59ea256, _this2.randomToken = $6a375544f634961e$export$4e61f672936bec77;
            return _this2;
          }
          return $b83e6a166cc3008f$export$f8f26dd395d7e1bd;
        }($7ce5389b504cc06c$export$f1c5f4c9cb95390b);
        var $b83e6a166cc3008f$export$7debb50ef11d5e0b = new $b83e6a166cc3008f$export$f8f26dd395d7e1bd();
        var $df9d8b89ee908b8b$var$LOG_PREFIX = "PeerJS: ";
        var $df9d8b89ee908b8b$var$Logger = /*#__PURE__*/function () {
          var _proto3 = $df9d8b89ee908b8b$var$Logger.prototype;
          _proto3.log = function log() {
            for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
              args[_key2] = arguments[_key2];
            }
            if (this._logLevel >= 3) this._print.apply(this, [3].concat(args));
          };
          _proto3.warn = function warn() {
            for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
              args[_key3] = arguments[_key3];
            }
            if (this._logLevel >= 2) this._print.apply(this, [2].concat(args));
          };
          _proto3.error = function error() {
            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
              args[_key4] = arguments[_key4];
            }
            if (this._logLevel >= 1) this._print.apply(this, [1].concat(args));
          };
          _proto3.setLogFunction = function setLogFunction(fn) {
            this._print = fn;
          };
          _proto3._print = function _print(logLevel) {
            var _console, _console2, _console3;
            for (var _len5 = arguments.length, rest = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {
              rest[_key5 - 1] = arguments[_key5];
            }
            var copy = [$df9d8b89ee908b8b$var$LOG_PREFIX].concat(rest);
            for (var i in copy) if (copy[i] instanceof Error) copy[i] = "(" + copy[i].name + ") " + copy[i].message;
            if (logLevel >= 3) (_console = console).log.apply(_console, copy);else if (logLevel >= 2) (_console2 = console).warn.apply(_console2, ["WARNING"].concat(copy));else if (logLevel >= 1) (_console3 = console).error.apply(_console3, ["ERROR"].concat(copy));
          };
          function $df9d8b89ee908b8b$var$Logger() {
            this._logLevel = 0;
          }
          _createClass($df9d8b89ee908b8b$var$Logger, [{
            key: "logLevel",
            get: function get() {
              return this._logLevel;
            },
            set: function set(logLevel) {
              this._logLevel = logLevel;
            }
          }]);
          return $df9d8b89ee908b8b$var$Logger;
        }();
        var $df9d8b89ee908b8b$export$2e2bcd8739ae039 = new $df9d8b89ee908b8b$var$Logger();
        var $1a7e7edd560505fc$exports = {};
        $parcel$export($1a7e7edd560505fc$exports, "ConnectionType", function () {
          return $1a7e7edd560505fc$export$3157d57b4135e3bc;
        });
        $parcel$export($1a7e7edd560505fc$exports, "PeerErrorType", function () {
          return $1a7e7edd560505fc$export$9547aaa2e39030ff;
        });
        $parcel$export($1a7e7edd560505fc$exports, "BaseConnectionErrorType", function () {
          return $1a7e7edd560505fc$export$7974935686149686;
        });
        $parcel$export($1a7e7edd560505fc$exports, "DataConnectionErrorType", function () {
          return $1a7e7edd560505fc$export$49ae800c114df41d;
        });
        $parcel$export($1a7e7edd560505fc$exports, "SerializationType", function () {
          return $1a7e7edd560505fc$export$89f507cf986a947;
        });
        $parcel$export($1a7e7edd560505fc$exports, "SocketEventType", function () {
          return $1a7e7edd560505fc$export$3b5c4a4b6354f023;
        });
        $parcel$export($1a7e7edd560505fc$exports, "ServerMessageType", function () {
          return $1a7e7edd560505fc$export$adb4a1754da6f10d;
        });
        var $1a7e7edd560505fc$export$3157d57b4135e3bc = /*#__PURE__*/function (ConnectionType) {
          ConnectionType["Data"] = "data";
          ConnectionType["Media"] = "media";
          return ConnectionType;
        }({});
        var $1a7e7edd560505fc$export$9547aaa2e39030ff = /*#__PURE__*/function (PeerErrorType) {
          /**
          * The client's browser does not support some or all WebRTC features that you are trying to use.
          */
          PeerErrorType["BrowserIncompatible"] = "browser-incompatible";
          /**
          * You've already disconnected this peer from the server and can no longer make any new connections on it.
          */
          PeerErrorType["Disconnected"] = "disconnected";
          /**
          * The ID passed into the Peer constructor contains illegal characters.
          */
          PeerErrorType["InvalidID"] = "invalid-id";
          /**
          * The API key passed into the Peer constructor contains illegal characters or is not in the system (cloud server only).
          */
          PeerErrorType["InvalidKey"] = "invalid-key";
          /**
          * Lost or cannot establish a connection to the signalling server.
          */
          PeerErrorType["Network"] = "network";
          /**
          * The peer you're trying to connect to does not exist.
          */
          PeerErrorType["PeerUnavailable"] = "peer-unavailable";
          /**
          * PeerJS is being used securely, but the cloud server does not support SSL. Use a custom PeerServer.
          */
          PeerErrorType["SslUnavailable"] = "ssl-unavailable";
          /**
          * Unable to reach the server.
          */
          PeerErrorType["ServerError"] = "server-error";
          /**
          * An error from the underlying socket.
          */
          PeerErrorType["SocketError"] = "socket-error";
          /**
          * The underlying socket closed unexpectedly.
          */
          PeerErrorType["SocketClosed"] = "socket-closed";
          /**
          * The ID passed into the Peer constructor is already taken.
          *
          * :::caution
          * This error is not fatal if your peer has open peer-to-peer connections.
          * This can happen if you attempt to {@apilink Peer.reconnect} a peer that has been disconnected from the server,
          * but its old ID has now been taken.
          * :::
          */
          PeerErrorType["UnavailableID"] = "unavailable-id";
          /**
          * Native WebRTC errors.
          */
          PeerErrorType["WebRTC"] = "webrtc";
          return PeerErrorType;
        }({});
        var $1a7e7edd560505fc$export$7974935686149686 = /*#__PURE__*/function (BaseConnectionErrorType) {
          BaseConnectionErrorType["NegotiationFailed"] = "negotiation-failed";
          BaseConnectionErrorType["ConnectionClosed"] = "connection-closed";
          return BaseConnectionErrorType;
        }({});
        var $1a7e7edd560505fc$export$49ae800c114df41d = /*#__PURE__*/function (DataConnectionErrorType) {
          DataConnectionErrorType["NotOpenYet"] = "not-open-yet";
          DataConnectionErrorType["MessageToBig"] = "message-too-big";
          return DataConnectionErrorType;
        }({});
        var $1a7e7edd560505fc$export$89f507cf986a947 = /*#__PURE__*/function (SerializationType) {
          SerializationType["Binary"] = "binary";
          SerializationType["BinaryUTF8"] = "binary-utf8";
          SerializationType["JSON"] = "json";
          SerializationType["None"] = "raw";
          return SerializationType;
        }({});
        var $1a7e7edd560505fc$export$3b5c4a4b6354f023 = /*#__PURE__*/function (SocketEventType) {
          SocketEventType["Message"] = "message";
          SocketEventType["Disconnected"] = "disconnected";
          SocketEventType["Error"] = "error";
          SocketEventType["Close"] = "close";
          return SocketEventType;
        }({});
        var $1a7e7edd560505fc$export$adb4a1754da6f10d = /*#__PURE__*/function (ServerMessageType) {
          ServerMessageType["Heartbeat"] = "HEARTBEAT";
          ServerMessageType["Candidate"] = "CANDIDATE";
          ServerMessageType["Offer"] = "OFFER";
          ServerMessageType["Answer"] = "ANSWER";
          ServerMessageType["Open"] = "OPEN";
          ServerMessageType["Error"] = "ERROR";
          ServerMessageType["IdTaken"] = "ID-TAKEN";
          ServerMessageType["InvalidKey"] = "INVALID-KEY";
          ServerMessageType["Leave"] = "LEAVE";
          ServerMessageType["Expire"] = "EXPIRE";
          return ServerMessageType;
        }({});
        var $3a25eea6a06ee968$export$83d89fbfd8236492 = "1.5.5";
        var $e5e868bf3ea73e5b$export$4798917dbf149b79 = /*#__PURE__*/function (_ref2) {
          _inheritsLoose($e5e868bf3ea73e5b$export$4798917dbf149b79, _ref2);
          function $e5e868bf3ea73e5b$export$4798917dbf149b79(secure, host, port, path, key, pingInterval) {
            var _this3;
            if (pingInterval === void 0) {
              pingInterval = 5000;
            }
            _this3 = _ref2.call(this) || this, _this3.pingInterval = pingInterval, _this3._disconnected = true, _this3._messagesQueue = [];
            var wsProtocol = secure ? "wss://" : "ws://";
            _this3._baseUrl = wsProtocol + host + ":" + port + path + "peerjs?key=" + key;
            return _this3;
          }
          var _proto4 = $e5e868bf3ea73e5b$export$4798917dbf149b79.prototype;
          _proto4.start = function start(id, token) {
            var _this4 = this;
            this._id = id;
            var wsUrl = this._baseUrl + "&id=" + id + "&token=" + token;
            if (!!this._socket || !this._disconnected) return;
            this._socket = new WebSocket(wsUrl + "&version=" + $3a25eea6a06ee968$export$83d89fbfd8236492);
            this._disconnected = false;
            this._socket.onmessage = function (event) {
              var data;
              try {
                data = JSON.parse(event.data);
                (0, $df9d8b89ee908b8b$export$2e2bcd8739ae039).log("Server message received:", data);
              } catch (e) {
                $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Invalid server message", event.data);
                return;
              }
              _this4.emit($1a7e7edd560505fc$export$3b5c4a4b6354f023.Message, data);
            };
            this._socket.onclose = function (event) {
              if (_this4._disconnected) return;
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Socket closed.", event);
              _this4._cleanup();
              _this4._disconnected = true;
              _this4.emit($1a7e7edd560505fc$export$3b5c4a4b6354f023.Disconnected);
            };
            // Take care of the queue of connections if necessary and make sure Peer knows
            // socket is open.
            this._socket.onopen = function () {
              if (_this4._disconnected) return;
              _this4._sendQueuedMessages();
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Socket open");
              _this4._scheduleHeartbeat();
            };
          };
          _proto4._scheduleHeartbeat = function _scheduleHeartbeat() {
            var _this5 = this;
            this._wsPingTimer = setTimeout(function () {
              _this5._sendHeartbeat();
            }, this.pingInterval);
          };
          _proto4._sendHeartbeat = function _sendHeartbeat() {
            if (!this._wsOpen()) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Cannot send heartbeat, because socket closed");
              return;
            }
            var message = JSON.stringify({
              type: $1a7e7edd560505fc$export$adb4a1754da6f10d.Heartbeat
            });
            this._socket.send(message);
            this._scheduleHeartbeat();
          }
          /** Is the websocket currently open? */;
          _proto4._wsOpen = function _wsOpen() {
            return !!this._socket && this._socket.readyState === 1;
          }
          /** Send queued messages. */;
          _proto4._sendQueuedMessages = function _sendQueuedMessages() {
            //Create copy of queue and clear it,
            //because send method push the message back to queue if smth will go wrong
            var copiedQueue = [].concat(this._messagesQueue);
            this._messagesQueue = [];
            for (var _iterator4 = _createForOfIteratorHelperLoose(copiedQueue), _step4; !(_step4 = _iterator4()).done;) {
              var message = _step4.value;
              this.send(message);
            }
          }
          /** Exposed send for DC & Peer. */;
          _proto4.send = function send(data) {
            if (this._disconnected) return;
            // If we didn't get an ID yet, we can't yet send anything so we should queue
            // up these messages.
            if (!this._id) {
              this._messagesQueue.push(data);
              return;
            }
            if (!data.type) {
              this.emit($1a7e7edd560505fc$export$3b5c4a4b6354f023.Error, "Invalid message");
              return;
            }
            if (!this._wsOpen()) return;
            var message = JSON.stringify(data);
            this._socket.send(message);
          };
          _proto4.close = function close() {
            if (this._disconnected) return;
            this._cleanup();
            this._disconnected = true;
          };
          _proto4._cleanup = function _cleanup() {
            if (this._socket) {
              this._socket.onopen = this._socket.onmessage = this._socket.onclose = null;
              this._socket.close();
              this._socket = undefined;
            }
            clearTimeout(this._wsPingTimer);
          };
          return $e5e868bf3ea73e5b$export$4798917dbf149b79;
        }($2QID2$eventemitter3.EventEmitter);
        var $a8347a6741c5df8a$export$89e6bb5ad64bf4a = /*#__PURE__*/function () {
          function $a8347a6741c5df8a$export$89e6bb5ad64bf4a(connection) {
            this.connection = connection;
          }
          /** Returns a PeerConnection object set up correctly (for data, media). */
          var _proto5 = $a8347a6741c5df8a$export$89e6bb5ad64bf4a.prototype;
          _proto5.startConnection = function startConnection(options) {
            var peerConnection = this._startPeerConnection();
            // Set the connection's PC.
            this.connection.peerConnection = peerConnection;
            if (this.connection.type === $1a7e7edd560505fc$export$3157d57b4135e3bc.Media && options._stream) this._addTracksToConnection(options._stream, peerConnection);
            // What do we need to do now?
            if (options.originator) {
              var dataConnection = this.connection;
              var config = {
                ordered: !!options.reliable
              };
              var dataChannel = peerConnection.createDataChannel(dataConnection.label, config);
              dataConnection._initializeDataChannel(dataChannel);
              this._makeOffer();
            } else this.handleSDP("OFFER", options.sdp);
          }
          /** Start a PC. */;
          _proto5._startPeerConnection = function _startPeerConnection() {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Creating RTCPeerConnection.");
            var peerConnection = new RTCPeerConnection(this.connection.provider.options.config);
            this._setupListeners(peerConnection);
            return peerConnection;
          }
          /** Set up various WebRTC listeners. */;
          _proto5._setupListeners = function _setupListeners(peerConnection) {
            var _this6 = this;
            var peerId = this.connection.peer;
            var connectionId = this.connection.connectionId;
            var connectionType = this.connection.type;
            var provider = this.connection.provider;
            // ICE CANDIDATES.
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Listening for ICE candidates.");
            peerConnection.onicecandidate = function (evt) {
              if (!evt.candidate || !evt.candidate.candidate) return;
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Received ICE candidates for " + peerId + ":", evt.candidate);
              provider.socket.send({
                type: $1a7e7edd560505fc$export$adb4a1754da6f10d.Candidate,
                payload: {
                  candidate: evt.candidate,
                  type: connectionType,
                  connectionId: connectionId
                },
                dst: peerId
              });
            };
            peerConnection.oniceconnectionstatechange = function () {
              switch (peerConnection.iceConnectionState) {
                case "failed":
                  $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("iceConnectionState is failed, closing connections to " + peerId);
                  _this6.connection.emitError($1a7e7edd560505fc$export$7974935686149686.NegotiationFailed, "Negotiation of connection to " + peerId + " failed.");
                  _this6.connection.close();
                  break;
                case "closed":
                  $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("iceConnectionState is closed, closing connections to " + peerId);
                  _this6.connection.emitError($1a7e7edd560505fc$export$7974935686149686.ConnectionClosed, "Connection to " + peerId + " closed.");
                  _this6.connection.close();
                  break;
                case "disconnected":
                  $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("iceConnectionState changed to disconnected on the connection with " + peerId);
                  break;
                case "completed":
                  peerConnection.onicecandidate = function () {};
                  break;
              }
              _this6.connection.emit("iceStateChanged", peerConnection.iceConnectionState);
            };
            // DATACONNECTION.
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Listening for data channel");
            // Fired between offer and answer, so options should already be saved
            // in the options hash.
            peerConnection.ondatachannel = function (evt) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Received data channel");
              var dataChannel = evt.channel;
              var connection = provider.getConnection(peerId, connectionId);
              connection._initializeDataChannel(dataChannel);
            };
            // MEDIACONNECTION.
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Listening for remote stream");
            peerConnection.ontrack = function (evt) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Received remote stream");
              var stream = evt.streams[0];
              var connection = provider.getConnection(peerId, connectionId);
              if (connection.type === $1a7e7edd560505fc$export$3157d57b4135e3bc.Media) {
                var mediaConnection = connection;
                _this6._addStreamToMediaConnection(stream, mediaConnection);
              }
            };
          };
          _proto5.cleanup = function cleanup() {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Cleaning up PeerConnection to " + this.connection.peer);
            var peerConnection = this.connection.peerConnection;
            if (!peerConnection) return;
            this.connection.peerConnection = null;
            //unsubscribe from all PeerConnection's events
            peerConnection.onicecandidate = peerConnection.oniceconnectionstatechange = peerConnection.ondatachannel = peerConnection.ontrack = function () {};
            var peerConnectionNotClosed = peerConnection.signalingState !== "closed";
            var dataChannelNotClosed = false;
            var dataChannel = this.connection.dataChannel;
            if (dataChannel) dataChannelNotClosed = !!dataChannel.readyState && dataChannel.readyState !== "closed";
            if (peerConnectionNotClosed || dataChannelNotClosed) peerConnection.close();
          };
          _proto5._makeOffer = /*#__PURE__*/function () {
            var _makeOffer2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
              var peerConnection, provider, offer, payload, dataConnection;
              return _regeneratorRuntime().wrap(function _callee$(_context) {
                while (1) switch (_context.prev = _context.next) {
                  case 0:
                    peerConnection = this.connection.peerConnection;
                    provider = this.connection.provider;
                    _context.prev = 2;
                    _context.next = 5;
                    return peerConnection.createOffer(this.connection.options.constraints);
                  case 5:
                    offer = _context.sent;
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Created offer.");
                    if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === "function") offer.sdp = this.connection.options.sdpTransform(offer.sdp) || offer.sdp;
                    _context.prev = 8;
                    _context.next = 11;
                    return peerConnection.setLocalDescription(offer);
                  case 11:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Set localDescription:", offer, "for:" + this.connection.peer);
                    payload = {
                      sdp: offer,
                      type: this.connection.type,
                      connectionId: this.connection.connectionId,
                      metadata: this.connection.metadata
                    };
                    if (this.connection.type === $1a7e7edd560505fc$export$3157d57b4135e3bc.Data) {
                      dataConnection = this.connection;
                      payload = _extends({}, payload, {
                        label: dataConnection.label,
                        reliable: dataConnection.reliable,
                        serialization: dataConnection.serialization
                      });
                    }
                    provider.socket.send({
                      type: $1a7e7edd560505fc$export$adb4a1754da6f10d.Offer,
                      payload: payload,
                      dst: this.connection.peer
                    });
                    _context.next = 20;
                    break;
                  case 17:
                    _context.prev = 17;
                    _context.t0 = _context["catch"](8);
                    // TODO: investigate why _makeOffer is being called from the answer
                    if (_context.t0 != "OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer") {
                      provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context.t0);
                      $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to setLocalDescription, ", _context.t0);
                    }
                  case 20:
                    _context.next = 26;
                    break;
                  case 22:
                    _context.prev = 22;
                    _context.t1 = _context["catch"](2);
                    provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context.t1);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to createOffer, ", _context.t1);
                  case 26:
                  case "end":
                    return _context.stop();
                }
              }, _callee, this, [[2, 22], [8, 17]]);
            }));
            function _makeOffer() {
              return _makeOffer2.apply(this, arguments);
            }
            return _makeOffer;
          }();
          _proto5._makeAnswer = /*#__PURE__*/function () {
            var _makeAnswer2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
              var peerConnection, provider, answer;
              return _regeneratorRuntime().wrap(function _callee2$(_context2) {
                while (1) switch (_context2.prev = _context2.next) {
                  case 0:
                    peerConnection = this.connection.peerConnection;
                    provider = this.connection.provider;
                    _context2.prev = 2;
                    _context2.next = 5;
                    return peerConnection.createAnswer();
                  case 5:
                    answer = _context2.sent;
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Created answer.");
                    if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === "function") answer.sdp = this.connection.options.sdpTransform(answer.sdp) || answer.sdp;
                    _context2.prev = 8;
                    _context2.next = 11;
                    return peerConnection.setLocalDescription(answer);
                  case 11:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Set localDescription:", answer, "for:" + this.connection.peer);
                    provider.socket.send({
                      type: $1a7e7edd560505fc$export$adb4a1754da6f10d.Answer,
                      payload: {
                        sdp: answer,
                        type: this.connection.type,
                        connectionId: this.connection.connectionId
                      },
                      dst: this.connection.peer
                    });
                    _context2.next = 19;
                    break;
                  case 15:
                    _context2.prev = 15;
                    _context2.t0 = _context2["catch"](8);
                    provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context2.t0);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to setLocalDescription, ", _context2.t0);
                  case 19:
                    _context2.next = 25;
                    break;
                  case 21:
                    _context2.prev = 21;
                    _context2.t1 = _context2["catch"](2);
                    provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context2.t1);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to create answer, ", _context2.t1);
                  case 25:
                  case "end":
                    return _context2.stop();
                }
              }, _callee2, this, [[2, 21], [8, 15]]);
            }));
            function _makeAnswer() {
              return _makeAnswer2.apply(this, arguments);
            }
            return _makeAnswer;
          }() /** Handle an SDP. */;
          _proto5.handleSDP = /*#__PURE__*/
          function () {
            var _handleSDP = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(type, sdp) {
              var peerConnection, provider, self;
              return _regeneratorRuntime().wrap(function _callee3$(_context3) {
                while (1) switch (_context3.prev = _context3.next) {
                  case 0:
                    sdp = new RTCSessionDescription(sdp);
                    peerConnection = this.connection.peerConnection;
                    provider = this.connection.provider;
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Setting remote description", sdp);
                    self = this;
                    _context3.prev = 5;
                    _context3.next = 8;
                    return peerConnection.setRemoteDescription(sdp);
                  case 8:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Set remoteDescription:" + type + " for:" + this.connection.peer);
                    if (!(type === "OFFER")) {
                      _context3.next = 12;
                      break;
                    }
                    _context3.next = 12;
                    return self._makeAnswer();
                  case 12:
                    _context3.next = 18;
                    break;
                  case 14:
                    _context3.prev = 14;
                    _context3.t0 = _context3["catch"](5);
                    provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context3.t0);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to setRemoteDescription, ", _context3.t0);
                  case 18:
                  case "end":
                    return _context3.stop();
                }
              }, _callee3, this, [[5, 14]]);
            }));
            function handleSDP(_x, _x2) {
              return _handleSDP.apply(this, arguments);
            }
            return handleSDP;
          }() /** Handle a candidate. */;
          _proto5.handleCandidate = /*#__PURE__*/
          function () {
            var _handleCandidate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(ice) {
              return _regeneratorRuntime().wrap(function _callee4$(_context4) {
                while (1) switch (_context4.prev = _context4.next) {
                  case 0:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("handleCandidate:", ice);
                    _context4.prev = 1;
                    _context4.next = 4;
                    return this.connection.peerConnection.addIceCandidate(ice);
                  case 4:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Added ICE candidate for:" + this.connection.peer);
                    _context4.next = 11;
                    break;
                  case 7:
                    _context4.prev = 7;
                    _context4.t0 = _context4["catch"](1);
                    this.connection.provider.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.WebRTC, _context4.t0);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Failed to handleCandidate, ", _context4.t0);
                  case 11:
                  case "end":
                    return _context4.stop();
                }
              }, _callee4, this, [[1, 7]]);
            }));
            function handleCandidate(_x3) {
              return _handleCandidate.apply(this, arguments);
            }
            return handleCandidate;
          }();
          _proto5._addTracksToConnection = function _addTracksToConnection(stream, peerConnection) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("add tracks from stream " + stream.id + " to peer connection");
            if (!peerConnection.addTrack) return $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");
            stream.getTracks().forEach(function (track) {
              peerConnection.addTrack(track, stream);
            });
          };
          _proto5._addStreamToMediaConnection = function _addStreamToMediaConnection(stream, mediaConnection) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("add stream " + stream.id + " to media connection " + mediaConnection.connectionId);
            mediaConnection.addStream(stream);
          };
          return $a8347a6741c5df8a$export$89e6bb5ad64bf4a;
        }();
        var $cf62563e7a9fbce5$export$6a678e589c8a4542 = /*#__PURE__*/function (_ref3) {
          _inheritsLoose($cf62563e7a9fbce5$export$6a678e589c8a4542, _ref3);
          function $cf62563e7a9fbce5$export$6a678e589c8a4542() {
            return _ref3.apply(this, arguments) || this;
          }
          var _proto6 = $cf62563e7a9fbce5$export$6a678e589c8a4542.prototype;
          /**
          * Emits a typed error message.
          *
          * @internal
          */
          _proto6.emitError = function emitError(type, err) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("Error:", err);
            // @ts-ignore
            this.emit("error", new $cf62563e7a9fbce5$export$98871882f492de82("" + type, err));
          };
          return $cf62563e7a9fbce5$export$6a678e589c8a4542;
        }($2QID2$eventemitter3.EventEmitter);
        var $cf62563e7a9fbce5$export$98871882f492de82 = /*#__PURE__*/function (_Error) {
          _inheritsLoose($cf62563e7a9fbce5$export$98871882f492de82, _Error);
          /**
          * @internal
          */
          function $cf62563e7a9fbce5$export$98871882f492de82(type, err) {
            var _this7;
            if (typeof err === "string") _this7 = _Error.call(this, err) || this;else {
              _this7 = _Error.call(this) || this;
              Object.assign(_assertThisInitialized(_this7), err);
            }
            _this7.type = type;
            return _assertThisInitialized(_this7);
          }
          return $cf62563e7a9fbce5$export$98871882f492de82;
        }( /*#__PURE__*/_wrapNativeSuper(Error));
        var $cb834ab0363d9153$export$23a2a68283c24d80 = /*#__PURE__*/function (_ref4) {
          _inheritsLoose($cb834ab0363d9153$export$23a2a68283c24d80, _ref4);
          function $cb834ab0363d9153$export$23a2a68283c24d80(
          /**
          * The ID of the peer on the other end of this connection.
          */
          peer, provider, options) {
            var _this8;
            _this8 = _ref4.call(this) || this, _this8.peer = peer, _this8.provider = provider, _this8.options = options, _this8._open = false;
            _this8.metadata = options.metadata;
            return _this8;
          }
          _createClass($cb834ab0363d9153$export$23a2a68283c24d80, [{
            key: "open",
            get:
            /**
            * Whether the media connection is active (e.g. your call has been answered).
            * You can check this if you want to set a maximum wait time for a one-sided call.
            */
            function get() {
              return this._open;
            }
          }]);
          return $cb834ab0363d9153$export$23a2a68283c24d80;
        }($cf62563e7a9fbce5$export$6a678e589c8a4542);
        var _2 = /*#__PURE__*/_classPrivateFieldLooseKey("_");
        var $f3a554d4328c6b5f$export$4a84e95a2324ac29 = /*#__PURE__*/function (_ref5) {
          _inheritsLoose($f3a554d4328c6b5f$export$4a84e95a2324ac29, _ref5);
          function $f3a554d4328c6b5f$export$4a84e95a2324ac29(peerId, provider, options) {
            var _this9;
            _this9 = _ref5.call(this, peerId, provider, options) || this;
            _this9._localStream = _this9.options._stream;
            _this9.connectionId = _this9.options.connectionId || $f3a554d4328c6b5f$export$4a84e95a2324ac29.ID_PREFIX + $b83e6a166cc3008f$export$7debb50ef11d5e0b.randomToken();
            _this9._negotiator = new $a8347a6741c5df8a$export$89e6bb5ad64bf4a(_assertThisInitialized(_this9));
            if (_this9._localStream) _this9._negotiator.startConnection({
              _stream: _this9._localStream,
              originator: true
            });
            return _this9;
          }
          /** Called by the Negotiator when the DataChannel is ready. */
          var _proto7 = $f3a554d4328c6b5f$export$4a84e95a2324ac29.prototype;
          _proto7._initializeDataChannel = function _initializeDataChannel(dc) {
            var _this10 = this;
            this.dataChannel = dc;
            this.dataChannel.onopen = function () {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + _this10.connectionId + " dc connection success");
              _this10.emit("willCloseOnRemote");
            };
            this.dataChannel.onclose = function () {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + _this10.connectionId + " dc closed for:", _this10.peer);
              _this10.close();
            };
          };
          _proto7.addStream = function addStream(remoteStream) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Receiving stream", remoteStream);
            this._remoteStream = remoteStream;
            _ref5.prototype.emit.call(this, "stream", remoteStream); // Should we call this `open`?
          }
          /**
          * @internal
          */;
          _proto7.handleMessage = function handleMessage(message) {
            var type = message.type;
            var payload = message.payload;
            switch (message.type) {
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Answer:
                // Forward to negotiator
                this._negotiator.handleSDP(type, payload.sdp);
                this._open = true;
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Candidate:
                this._negotiator.handleCandidate(payload.candidate);
                break;
              default:
                $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("Unrecognized message type:" + type + " from peer:" + this.peer);
                break;
            }
          }
          /**
           * When receiving a {@apilink PeerEvents | `call`} event on a peer, you can call
           * `answer` on the media connection provided by the callback to accept the call
           * and optionally send your own media stream.
            *
           * @param stream A WebRTC media stream.
           * @param options
           * @returns
           */;
          _proto7.answer = function answer(stream, options) {
            if (options === void 0) {
              options = {};
            }
            if (this._localStream) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");
              return;
            }
            this._localStream = stream;
            if (options && options.sdpTransform) this.options.sdpTransform = options.sdpTransform;
            this._negotiator.startConnection(_extends({}, this.options._payload, {
              _stream: stream
            }));
            // Retrieve lost messages stored because PeerConnection not set up.
            var messages = this.provider._getMessages(this.connectionId);
            for (var _iterator5 = _createForOfIteratorHelperLoose(messages), _step5; !(_step5 = _iterator5()).done;) {
              var message = _step5.value;
              this.handleMessage(message);
            }
            this._open = true;
          }
          /**
          * Exposed functionality for users.
          */ /**
             * Closes the media connection.
             */;
          _proto7.close = function close() {
            if (this._negotiator) {
              this._negotiator.cleanup();
              this._negotiator = null;
            }
            this._localStream = null;
            this._remoteStream = null;
            if (this.provider) {
              this.provider._removeConnection(this);
              this.provider = null;
            }
            if (this.options && this.options._stream) this.options._stream = null;
            if (!this.open) return;
            this._open = false;
            _ref5.prototype.emit.call(this, "close");
          };
          _createClass($f3a554d4328c6b5f$export$4a84e95a2324ac29, [{
            key: "type",
            get:
            /**
            * For media connections, this is always 'media'.
            */
            function get() {
              return $1a7e7edd560505fc$export$3157d57b4135e3bc.Media;
            }
          }, {
            key: "localStream",
            get: function get() {
              return this._localStream;
            }
          }, {
            key: "remoteStream",
            get: function get() {
              return this._remoteStream;
            }
          }]);
          return $f3a554d4328c6b5f$export$4a84e95a2324ac29;
        }($cb834ab0363d9153$export$23a2a68283c24d80);
        _class2 = $f3a554d4328c6b5f$export$4a84e95a2324ac29;
        Object.defineProperty($f3a554d4328c6b5f$export$4a84e95a2324ac29, _2, {
          writable: true,
          value: _class2.ID_PREFIX = "mc_"
        });
        var $684fc411629b137b$export$2c4e825dc9120f87 = /*#__PURE__*/function () {
          function $684fc411629b137b$export$2c4e825dc9120f87(_options) {
            this._options = _options;
          }
          var _proto8 = $684fc411629b137b$export$2c4e825dc9120f87.prototype;
          _proto8._buildRequest = function _buildRequest(method) {
            var protocol = this._options.secure ? "https" : "http";
            var _this$_options = this._options,
              host = _this$_options.host,
              port = _this$_options.port,
              path = _this$_options.path,
              key = _this$_options.key;
            var url = new URL(protocol + "://" + host + ":" + port + path + key + "/" + method);
            // TODO: Why timestamp, why random?
            url.searchParams.set("ts", "" + Date.now() + Math.random());
            url.searchParams.set("version", $3a25eea6a06ee968$export$83d89fbfd8236492);
            return fetch(url.href, {
              referrerPolicy: this._options.referrerPolicy
            });
          }
          /** Get a unique ID from the server via XHR and initialize with it. */;
          _proto8.retrieveId = /*#__PURE__*/
          function () {
            var _retrieveId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {
              var response, pathError;
              return _regeneratorRuntime().wrap(function _callee5$(_context5) {
                while (1) switch (_context5.prev = _context5.next) {
                  case 0:
                    _context5.prev = 0;
                    _context5.next = 3;
                    return this._buildRequest("id");
                  case 3:
                    response = _context5.sent;
                    if (!(response.status !== 200)) {
                      _context5.next = 6;
                      break;
                    }
                    throw new Error("Error. Status:" + response.status);
                  case 6:
                    return _context5.abrupt("return", response.text());
                  case 9:
                    _context5.prev = 9;
                    _context5.t0 = _context5["catch"](0);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("Error retrieving ID", _context5.t0);
                    pathError = "";
                    if (this._options.path === "/" && this._options.host !== $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_HOST) pathError = " If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer.";
                    throw new Error("Could not get an ID from the server." + pathError);
                  case 15:
                  case "end":
                    return _context5.stop();
                }
              }, _callee5, this, [[0, 9]]);
            }));
            function retrieveId() {
              return _retrieveId.apply(this, arguments);
            }
            return retrieveId;
          }() /** @deprecated */;
          _proto8.listAllPeers = /*#__PURE__*/
          function () {
            var _listAllPeers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {
              var response, helpfulError;
              return _regeneratorRuntime().wrap(function _callee6$(_context6) {
                while (1) switch (_context6.prev = _context6.next) {
                  case 0:
                    _context6.prev = 0;
                    _context6.next = 3;
                    return this._buildRequest("peers");
                  case 3:
                    response = _context6.sent;
                    if (!(response.status !== 200)) {
                      _context6.next = 10;
                      break;
                    }
                    if (!(response.status === 401)) {
                      _context6.next = 9;
                      break;
                    }
                    helpfulError = "";
                    if (this._options.host === $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_HOST) helpfulError = "It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.";else helpfulError = "You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.";
                    throw new Error("It doesn't look like you have permission to list peers IDs. " + helpfulError);
                  case 9:
                    throw new Error("Error. Status:" + response.status);
                  case 10:
                    return _context6.abrupt("return", response.json());
                  case 13:
                    _context6.prev = 13;
                    _context6.t0 = _context6["catch"](0);
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("Error retrieving list peers", _context6.t0);
                    throw new Error("Could not get list peers from the server." + _context6.t0);
                  case 17:
                  case "end":
                    return _context6.stop();
                }
              }, _callee6, this, [[0, 13]]);
            }));
            function listAllPeers() {
              return _listAllPeers.apply(this, arguments);
            }
            return listAllPeers;
          }();
          return $684fc411629b137b$export$2c4e825dc9120f87;
        }();
        var _3 = /*#__PURE__*/_classPrivateFieldLooseKey("_");
        var _4 = /*#__PURE__*/_classPrivateFieldLooseKey("_2");
        var $f188f8cb0f63b180$export$d365f7ad9d7df9c9 = /*#__PURE__*/function (_ref6) {
          _inheritsLoose($f188f8cb0f63b180$export$d365f7ad9d7df9c9, _ref6);
          function $f188f8cb0f63b180$export$d365f7ad9d7df9c9(peerId, provider, options) {
            var _this11;
            _this11 = _ref6.call(this, peerId, provider, options) || this;
            _this11.connectionId = _this11.options.connectionId || $f188f8cb0f63b180$export$d365f7ad9d7df9c9.ID_PREFIX + $6a375544f634961e$export$4e61f672936bec77();
            _this11.label = _this11.options.label || _this11.connectionId;
            _this11.reliable = !!_this11.options.reliable;
            _this11._negotiator = new $a8347a6741c5df8a$export$89e6bb5ad64bf4a(_assertThisInitialized(_this11));
            _this11._negotiator.startConnection(_this11.options._payload || {
              originator: true,
              reliable: _this11.reliable
            });
            return _this11;
          }
          /** Called by the Negotiator when the DataChannel is ready. */
          var _proto9 = $f188f8cb0f63b180$export$d365f7ad9d7df9c9.prototype;
          _proto9._initializeDataChannel = function _initializeDataChannel(dc) {
            var _this12 = this;
            this.dataChannel = dc;
            this.dataChannel.onopen = function () {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + _this12.connectionId + " dc connection success");
              _this12._open = true;
              _this12.emit("open");
            };
            this.dataChannel.onmessage = function (e) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + _this12.connectionId + " dc onmessage:", e.data);
              // this._handleDataMessage(e);
            };

            this.dataChannel.onclose = function () {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + _this12.connectionId + " dc closed for:", _this12.peer);
              _this12.close();
            };
          }
          /**
          * Exposed functionality for users.
          */ /** Allows user to close connection. */;
          _proto9.close = function close(options) {
            if (options != null && options.flush) {
              this.send({
                __peerData: {
                  type: "close"
                }
              });
              return;
            }
            if (this._negotiator) {
              this._negotiator.cleanup();
              this._negotiator = null;
            }
            if (this.provider) {
              this.provider._removeConnection(this);
              this.provider = null;
            }
            if (this.dataChannel) {
              this.dataChannel.onopen = null;
              this.dataChannel.onmessage = null;
              this.dataChannel.onclose = null;
              this.dataChannel = null;
            }
            if (!this.open) return;
            this._open = false;
            _ref6.prototype.emit.call(this, "close");
          }
          /** Allows user to send data. */;
          _proto9.send = function send(data, chunked) {
            if (chunked === void 0) {
              chunked = false;
            }
            if (!this.open) {
              this.emitError($1a7e7edd560505fc$export$49ae800c114df41d.NotOpenYet, "Connection is not open. You should listen for the `open` event before sending messages.");
              return;
            }
            return this._send(data, chunked);
          };
          _proto9.handleMessage = /*#__PURE__*/function () {
            var _handleMessage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(message) {
              var payload;
              return _regeneratorRuntime().wrap(function _callee7$(_context7) {
                while (1) switch (_context7.prev = _context7.next) {
                  case 0:
                    payload = message.payload;
                    _context7.t0 = message.type;
                    _context7.next = _context7.t0 === $1a7e7edd560505fc$export$adb4a1754da6f10d.Answer ? 4 : _context7.t0 === $1a7e7edd560505fc$export$adb4a1754da6f10d.Candidate ? 7 : 10;
                    break;
                  case 4:
                    _context7.next = 6;
                    return this._negotiator.handleSDP(message.type, payload.sdp);
                  case 6:
                    return _context7.abrupt("break", 12);
                  case 7:
                    _context7.next = 9;
                    return this._negotiator.handleCandidate(payload.candidate);
                  case 9:
                    return _context7.abrupt("break", 12);
                  case 10:
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("Unrecognized message type:", message.type, "from peer:", this.peer);
                    return _context7.abrupt("break", 12);
                  case 12:
                  case "end":
                    return _context7.stop();
                }
              }, _callee7, this);
            }));
            function handleMessage(_x4) {
              return _handleMessage.apply(this, arguments);
            }
            return handleMessage;
          }();
          _createClass($f188f8cb0f63b180$export$d365f7ad9d7df9c9, [{
            key: "type",
            get: function get() {
              return $1a7e7edd560505fc$export$3157d57b4135e3bc.Data;
            }
          }]);
          return $f188f8cb0f63b180$export$d365f7ad9d7df9c9;
        }($cb834ab0363d9153$export$23a2a68283c24d80);
        _class3 = $f188f8cb0f63b180$export$d365f7ad9d7df9c9;
        Object.defineProperty($f188f8cb0f63b180$export$d365f7ad9d7df9c9, _3, {
          writable: true,
          value: _class3.ID_PREFIX = "dc_"
        });
        Object.defineProperty($f188f8cb0f63b180$export$d365f7ad9d7df9c9, _4, {
          writable: true,
          value: _class3.MAX_BUFFERED_AMOUNT = 8388608
        });
        var $8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b = /*#__PURE__*/function (_ref7) {
          _inheritsLoose($8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b, _ref7);
          var _proto10 = $8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b.prototype;
          _proto10._initializeDataChannel = function _initializeDataChannel(dc) {
            var _this14 = this;
            _ref7.prototype._initializeDataChannel.call(this, dc);
            this.dataChannel.binaryType = "arraybuffer";
            this.dataChannel.addEventListener("message", function (e) {
              return _this14._handleDataMessage(e);
            });
          };
          _proto10._bufferedSend = function _bufferedSend(msg) {
            if (this._buffering || !this._trySend(msg)) {
              this._buffer.push(msg);
              this._bufferSize = this._buffer.length;
            }
          }
          // Returns true if the send succeeds.
          ;

          _proto10._trySend = function _trySend(msg) {
            var _this15 = this;
            if (!this.open) return false;
            if (this.dataChannel.bufferedAmount > $f188f8cb0f63b180$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT) {
              this._buffering = true;
              setTimeout(function () {
                _this15._buffering = false;
                _this15._tryBuffer();
              }, 50);
              return false;
            }
            try {
              this.dataChannel.send(msg);
            } catch (e) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("DC#:" + this.connectionId + " Error when sending:", e);
              this._buffering = true;
              this.close();
              return false;
            }
            return true;
          }
          // Try to send the first message in the buffer.
          ;

          _proto10._tryBuffer = function _tryBuffer() {
            if (!this.open) return;
            if (this._buffer.length === 0) return;
            var msg = this._buffer[0];
            if (this._trySend(msg)) {
              this._buffer.shift();
              this._bufferSize = this._buffer.length;
              this._tryBuffer();
            }
          };
          _proto10.close = function close(options) {
            if (options != null && options.flush) {
              this.send({
                __peerData: {
                  type: "close"
                }
              });
              return;
            }
            this._buffer = [];
            this._bufferSize = 0;
            _ref7.prototype.close.call(this);
          };
          function $8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b() {
            var _this13;
            for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
              args[_key6] = arguments[_key6];
            }
            _this13 = _ref7.call.apply(_ref7, [this].concat(args)) || this, _this13._buffer = [], _this13._bufferSize = 0, _this13._buffering = false;
            return _this13;
          }
          _createClass($8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b, [{
            key: "bufferSize",
            get: function get() {
              return this._bufferSize;
            }
          }]);
          return $8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b;
        }($f188f8cb0f63b180$export$d365f7ad9d7df9c9);
        var $9cfea3ad93e740b9$export$f0a5a64d5bb37108 = /*#__PURE__*/function (_ref8) {
          _inheritsLoose($9cfea3ad93e740b9$export$f0a5a64d5bb37108, _ref8);
          var _proto11 = $9cfea3ad93e740b9$export$f0a5a64d5bb37108.prototype;
          _proto11.close = function close(options) {
            _ref8.prototype.close.call(this, options);
            this._chunkedData = {};
          };
          function $9cfea3ad93e740b9$export$f0a5a64d5bb37108(peerId, provider, options) {
            var _this16;
            _this16 = _ref8.call(this, peerId, provider, options) || this, _this16.chunker = new $7ce5389b504cc06c$export$f1c5f4c9cb95390b(), _this16.serialization = $1a7e7edd560505fc$export$89f507cf986a947.Binary, _this16._chunkedData = {};
            return _this16;
          }
          // Handles a DataChannel message.
          _proto11._handleDataMessage = function _handleDataMessage(_ref9) {
            var data = _ref9.data;
            var deserializedData = (0, $2QID2$peerjsjsbinarypack.unpack)(data);
            // PeerJS specific message
            var peerData = deserializedData["__peerData"];
            if (peerData) {
              if (peerData.type === "close") {
                this.close();
                return;
              }
              // Chunked data -- piece things back together.
              // @ts-ignore
              this._handleChunk(deserializedData);
              return;
            }
            this.emit("data", deserializedData);
          };
          _proto11._handleChunk = function _handleChunk(data) {
            var id = data.__peerData;
            var chunkInfo = this._chunkedData[id] || {
              data: [],
              count: 0,
              total: data.total
            };
            chunkInfo.data[data.n] = new Uint8Array(data.data);
            chunkInfo.count++;
            this._chunkedData[id] = chunkInfo;
            if (chunkInfo.total === chunkInfo.count) {
              // Clean up before making the recursive call to `_handleDataMessage`.
              delete this._chunkedData[id];
              // We've received all the chunks--time to construct the complete data.
              // const data = new Blob(chunkInfo.data);
              var _data = $7ce5389b504cc06c$export$52c89ebcdc4f53f2(chunkInfo.data);
              this._handleDataMessage({
                data: _data
              });
            }
          };
          _proto11._send = function _send(data, chunked) {
            var blob = (0, $2QID2$peerjsjsbinarypack.pack)(data);
            if (blob instanceof Promise) return this._send_blob(blob);
            if (!chunked && blob.byteLength > this.chunker.chunkedMTU) {
              this._sendChunks(blob);
              return;
            }
            this._bufferedSend(blob);
          };
          _proto11._send_blob = /*#__PURE__*/function () {
            var _send_blob2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(blobPromise) {
              var blob;
              return _regeneratorRuntime().wrap(function _callee8$(_context8) {
                while (1) switch (_context8.prev = _context8.next) {
                  case 0:
                    _context8.next = 2;
                    return blobPromise;
                  case 2:
                    blob = _context8.sent;
                    if (!(blob.byteLength > this.chunker.chunkedMTU)) {
                      _context8.next = 6;
                      break;
                    }
                    this._sendChunks(blob);
                    return _context8.abrupt("return");
                  case 6:
                    this._bufferedSend(blob);
                  case 7:
                  case "end":
                    return _context8.stop();
                }
              }, _callee8, this);
            }));
            function _send_blob(_x5) {
              return _send_blob2.apply(this, arguments);
            }
            return _send_blob;
          }();
          _proto11._sendChunks = function _sendChunks(blob) {
            var blobs = this.chunker.chunk(blob);
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("DC#" + this.connectionId + " Try to send " + blobs.length + " chunks...");
            for (var _iterator6 = _createForOfIteratorHelperLoose(blobs), _step6; !(_step6 = _iterator6()).done;) {
              var _blob = _step6.value;
              this.send(_blob, true);
            }
          };
          return $9cfea3ad93e740b9$export$f0a5a64d5bb37108;
        }($8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b);
        var $c1c7a35edd5f55d2$export$6f88fe47d32c9c94 = /*#__PURE__*/function (_ref10) {
          _inheritsLoose($c1c7a35edd5f55d2$export$6f88fe47d32c9c94, _ref10);
          var _proto12 = $c1c7a35edd5f55d2$export$6f88fe47d32c9c94.prototype;
          _proto12._handleDataMessage = function _handleDataMessage(_ref11) {
            var data = _ref11.data;
            _ref10.prototype.emit.call(this, "data", data);
          };
          _proto12._send = function _send(data, _chunked) {
            this._bufferedSend(data);
          };
          function $c1c7a35edd5f55d2$export$6f88fe47d32c9c94() {
            var _this17;
            for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {
              args[_key7] = arguments[_key7];
            }
            _this17 = _ref10.call.apply(_ref10, [this].concat(args)) || this, _this17.serialization = $1a7e7edd560505fc$export$89f507cf986a947.None;
            return _this17;
          }
          return $c1c7a35edd5f55d2$export$6f88fe47d32c9c94;
        }($8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b);
        var $f3415bb65bf67923$export$48880ac635f47186 = /*#__PURE__*/function (_ref12) {
          _inheritsLoose($f3415bb65bf67923$export$48880ac635f47186, _ref12);
          var _proto13 = $f3415bb65bf67923$export$48880ac635f47186.prototype;
          // Handles a DataChannel message.
          _proto13._handleDataMessage = function _handleDataMessage(_ref13) {
            var data = _ref13.data;
            var deserializedData = this.parse(this.decoder.decode(data));
            // PeerJS specific message
            var peerData = deserializedData["__peerData"];
            if (peerData && peerData.type === "close") {
              this.close();
              return;
            }
            this.emit("data", deserializedData);
          };
          _proto13._send = function _send(data, _chunked) {
            var encodedData = this.encoder.encode(this.stringify(data));
            if (encodedData.byteLength >= $b83e6a166cc3008f$export$7debb50ef11d5e0b.chunkedMTU) {
              this.emitError($1a7e7edd560505fc$export$49ae800c114df41d.MessageToBig, "Message too big for JSON channel");
              return;
            }
            this._bufferedSend(encodedData);
          };
          function $f3415bb65bf67923$export$48880ac635f47186() {
            var _this18;
            for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {
              args[_key8] = arguments[_key8];
            }
            _this18 = _ref12.call.apply(_ref12, [this].concat(args)) || this, _this18.serialization = $1a7e7edd560505fc$export$89f507cf986a947.JSON, _this18.encoder = new TextEncoder(), _this18.decoder = new TextDecoder(), _this18.stringify = JSON.stringify, _this18.parse = JSON.parse;
            return _this18;
          }
          return $f3415bb65bf67923$export$48880ac635f47186;
        }($8d5124d0cf36ebe0$export$ff7c9d4c11d94e8b);
        var _5 = /*#__PURE__*/_classPrivateFieldLooseKey("_");
        var $2ddecb16305b5a82$export$ecd1fc136c422448 = /*#__PURE__*/function (_ref14) {
          _inheritsLoose($2ddecb16305b5a82$export$ecd1fc136c422448, _ref14);
          function $2ddecb16305b5a82$export$ecd1fc136c422448(id, options) {
            var _this19;
            _this19 = _ref14.call(this) || this, _this19._serializers = {
              raw: $c1c7a35edd5f55d2$export$6f88fe47d32c9c94,
              json: $f3415bb65bf67923$export$48880ac635f47186,
              binary: $9cfea3ad93e740b9$export$f0a5a64d5bb37108,
              "binary-utf8": $9cfea3ad93e740b9$export$f0a5a64d5bb37108,
              "default": $9cfea3ad93e740b9$export$f0a5a64d5bb37108
            }, _this19._id = null, _this19._lastServerId = null,
            // States.
            _this19._destroyed = false // Connections have been killed
            , _this19._disconnected = false // Connection to PeerServer killed but P2P connections still active
            , _this19._open = false // Sockets and such are not yet open.
            , _this19._connections = new Map() // All connections for this peer.
            , _this19._lostMessages = new Map() // src => [list of messages]
            ;

            var userId;
            // Deal with overloading
            if (id && id.constructor == Object) options = id;else if (id) userId = id.toString();
            // Configurize options
            options = _extends({
              debug: 0,
              host: $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_HOST,
              port: $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_PORT,
              path: "/",
              key: $2ddecb16305b5a82$export$ecd1fc136c422448.DEFAULT_KEY,
              token: $b83e6a166cc3008f$export$7debb50ef11d5e0b.randomToken(),
              config: $b83e6a166cc3008f$export$7debb50ef11d5e0b.defaultConfig,
              referrerPolicy: "strict-origin-when-cross-origin",
              serializers: {}
            }, options);
            _this19._options = options;
            _this19._serializers = _extends({}, _this19._serializers, _this19.options.serializers);
            // Detect relative URL host.
            if (_this19._options.host === "/") _this19._options.host = window.location.hostname;
            // Set path correctly.
            if (_this19._options.path) {
              if (_this19._options.path[0] !== "/") _this19._options.path = "/" + _this19._options.path;
              if (_this19._options.path[_this19._options.path.length - 1] !== "/") _this19._options.path += "/";
            }
            // Set whether we use SSL to same as current host
            if (_this19._options.secure === undefined && _this19._options.host !== $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_HOST) _this19._options.secure = $b83e6a166cc3008f$export$7debb50ef11d5e0b.isSecure();else if (_this19._options.host == $b83e6a166cc3008f$export$7debb50ef11d5e0b.CLOUD_HOST) _this19._options.secure = true;
            // Set a custom log function if present
            if (_this19._options.logFunction) $df9d8b89ee908b8b$export$2e2bcd8739ae039.setLogFunction(_this19._options.logFunction);
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.logLevel = _this19._options.debug || 0;
            _this19._api = new $684fc411629b137b$export$2c4e825dc9120f87(options);
            _this19._socket = _this19._createServerConnection();
            // Sanity checks
            // Ensure WebRTC supported
            if (!$b83e6a166cc3008f$export$7debb50ef11d5e0b.supports.audioVideo && !$b83e6a166cc3008f$export$7debb50ef11d5e0b.supports.data) {
              _this19._delayedAbort($1a7e7edd560505fc$export$9547aaa2e39030ff.BrowserIncompatible, "The current browser does not support WebRTC");
              return _assertThisInitialized(_this19);
            }
            // Ensure alphanumeric id
            if (!!userId && !$b83e6a166cc3008f$export$7debb50ef11d5e0b.validateId(userId)) {
              _this19._delayedAbort($1a7e7edd560505fc$export$9547aaa2e39030ff.InvalidID, "ID \"" + userId + "\" is invalid");
              return _assertThisInitialized(_this19);
            }
            if (userId) _this19._initialize(userId);else _this19._api.retrieveId().then(function (id) {
              return _this19._initialize(id);
            })["catch"](function (error) {
              return _this19._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.ServerError, error);
            });
            return _this19;
          }
          var _proto14 = $2ddecb16305b5a82$export$ecd1fc136c422448.prototype;
          _proto14._createServerConnection = function _createServerConnection() {
            var _this20 = this;
            var socket = new $e5e868bf3ea73e5b$export$4798917dbf149b79(this._options.secure, this._options.host, this._options.port, this._options.path, this._options.key, this._options.pingInterval);
            socket.on($1a7e7edd560505fc$export$3b5c4a4b6354f023.Message, function (data) {
              _this20._handleMessage(data);
            });
            socket.on($1a7e7edd560505fc$export$3b5c4a4b6354f023.Error, function (error) {
              _this20._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.SocketError, error);
            });
            socket.on($1a7e7edd560505fc$export$3b5c4a4b6354f023.Disconnected, function () {
              if (_this20.disconnected) return;
              _this20.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.Network, "Lost connection to server.");
              _this20.disconnect();
            });
            socket.on($1a7e7edd560505fc$export$3b5c4a4b6354f023.Close, function () {
              if (_this20.disconnected) return;
              _this20._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.SocketClosed, "Underlying socket is already closed.");
            });
            return socket;
          }
          /** Initialize a connection with the server. */;
          _proto14._initialize = function _initialize(id) {
            this._id = id;
            this.socket.start(id, this._options.token);
          }
          /** Handles messages from the server. */;
          _proto14._handleMessage = function _handleMessage(message) {
            var type = message.type;
            var payload = message.payload;
            var peerId = message.src;
            switch (type) {
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Open:
                this._lastServerId = this.id;
                this._open = true;
                this.emit("open", this.id);
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Error:
                this._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.ServerError, payload.msg);
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.IdTaken:
                this._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.UnavailableID, "ID \"" + this.id + "\" is taken");
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.InvalidKey:
                this._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.InvalidKey, "API KEY \"" + this._options.key + "\" is invalid");
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Leave:
                $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Received leave message from " + peerId);
                this._cleanupPeer(peerId);
                this._connections["delete"](peerId);
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Expire:
                this.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.PeerUnavailable, "Could not connect to peer " + peerId);
                break;
              case $1a7e7edd560505fc$export$adb4a1754da6f10d.Offer:
                {
                  // we should consider switching this to CALL/CONNECT, but this is the least breaking option.
                  var connectionId = payload.connectionId;
                  var connection = this.getConnection(peerId, connectionId);
                  if (connection) {
                    connection.close();
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("Offer received for existing Connection ID:" + connectionId);
                  }
                  // Create a new connection.
                  if (payload.type === $1a7e7edd560505fc$export$3157d57b4135e3bc.Media) {
                    var mediaConnection = new $f3a554d4328c6b5f$export$4a84e95a2324ac29(peerId, this, {
                      connectionId: connectionId,
                      _payload: payload,
                      metadata: payload.metadata
                    });
                    connection = mediaConnection;
                    this._addConnection(peerId, connection);
                    this.emit("call", mediaConnection);
                  } else if (payload.type === $1a7e7edd560505fc$export$3157d57b4135e3bc.Data) {
                    var dataConnection = new this._serializers[payload.serialization](peerId, this, {
                      connectionId: connectionId,
                      _payload: payload,
                      metadata: payload.metadata,
                      label: payload.label,
                      serialization: payload.serialization,
                      reliable: payload.reliable
                    });
                    connection = dataConnection;
                    this._addConnection(peerId, connection);
                    this.emit("connection", dataConnection);
                  } else {
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("Received malformed connection type:" + payload.type);
                    return;
                  }
                  // Find messages.
                  var messages = this._getMessages(connectionId);
                  for (var _iterator7 = _createForOfIteratorHelperLoose(messages), _step7; !(_step7 = _iterator7()).done;) {
                    var _message = _step7.value;
                    connection.handleMessage(_message);
                  }
                  break;
                }
              default:
                {
                  if (!payload) {
                    $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("You received a malformed message from " + peerId + " of type " + type);
                    return;
                  }
                  var _connectionId = payload.connectionId;
                  var _connection = this.getConnection(peerId, _connectionId);
                  if (_connection && _connection.peerConnection)
                    // Pass it on.
                    _connection.handleMessage(message);else if (_connectionId)
                    // Store for possible later use
                    this._storeMessage(_connectionId, message);else $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("You received an unrecognized message:", message);
                  break;
                }
            }
          }
          /** Stores messages without a set up connection, to be claimed later. */;
          _proto14._storeMessage = function _storeMessage(connectionId, message) {
            if (!this._lostMessages.has(connectionId)) this._lostMessages.set(connectionId, []);
            this._lostMessages.get(connectionId).push(message);
          }
          /**
          * Retrieve messages from lost message store
          * @internal
          */ //TODO Change it to private
          ;

          _proto14._getMessages = function _getMessages(connectionId) {
            var messages = this._lostMessages.get(connectionId);
            if (messages) {
              this._lostMessages["delete"](connectionId);
              return messages;
            }
            return [];
          }
          /**
          * Connects to the remote peer specified by id and returns a data connection.
          * @param peer The brokering ID of the remote peer (their {@apilink Peer.id}).
          * @param options for specifying details about Peer Connection
          */;
          _proto14.connect = function connect(peer, options) {
            if (options === void 0) {
              options = {};
            }
            options = _extends({
              serialization: "default"
            }, options);
            if (this.disconnected) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.");
              this.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.Disconnected, "Cannot connect to new Peer after disconnecting from server.");
              return;
            }
            var dataConnection = new this._serializers[options.serialization](peer, this, options);
            this._addConnection(peer, dataConnection);
            return dataConnection;
          }
          /**
          * Calls the remote peer specified by id and returns a media connection.
          * @param peer The brokering ID of the remote peer (their peer.id).
          * @param stream The caller's media stream
          * @param options Metadata associated with the connection, passed in by whoever initiated the connection.
          */;
          _proto14.call = function call(peer, stream, options) {
            if (options === void 0) {
              options = {};
            }
            if (this.disconnected) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.");
              this.emitError($1a7e7edd560505fc$export$9547aaa2e39030ff.Disconnected, "Cannot connect to new Peer after disconnecting from server.");
              return;
            }
            if (!stream) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");
              return;
            }
            var mediaConnection = new $f3a554d4328c6b5f$export$4a84e95a2324ac29(peer, this, _extends({}, options, {
              _stream: stream
            }));
            this._addConnection(peer, mediaConnection);
            return mediaConnection;
          }
          /** Add a data/media connection to this peer. */;
          _proto14._addConnection = function _addConnection(peerId, connection) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("add connection " + connection.type + ":" + connection.connectionId + " to peerId:" + peerId);
            if (!this._connections.has(peerId)) this._connections.set(peerId, []);
            this._connections.get(peerId).push(connection);
          }
          //TODO should be private
          ;

          _proto14._removeConnection = function _removeConnection(connection) {
            var connections = this._connections.get(connection.peer);
            if (connections) {
              var index = connections.indexOf(connection);
              if (index !== -1) connections.splice(index, 1);
            }
            //remove from lost messages
            this._lostMessages["delete"](connection.connectionId);
          }
          /** Retrieve a data/media connection for this peer. */;
          _proto14.getConnection = function getConnection(peerId, connectionId) {
            var connections = this._connections.get(peerId);
            if (!connections) return null;
            for (var _iterator8 = _createForOfIteratorHelperLoose(connections), _step8; !(_step8 = _iterator8()).done;) {
              var connection = _step8.value;
              if (connection.connectionId === connectionId) return connection;
            }
            return null;
          };
          _proto14._delayedAbort = function _delayedAbort(type, message) {
            var _this21 = this;
            setTimeout(function () {
              _this21._abort(type, message);
            }, 0);
          }
          /**
          * Emits an error message and destroys the Peer.
          * The Peer is not destroyed if it's in a disconnected state, in which case
          * it retains its disconnected state and its existing connections.
          */;
          _proto14._abort = function _abort(type, message) {
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("Aborting!");
            this.emitError(type, message);
            if (!this._lastServerId) this.destroy();else this.disconnect();
          }
          /**
          * Destroys the Peer: closes all active connections as well as the connection
          * to the server.
          *
          * :::caution
          * This cannot be undone; the respective peer object will no longer be able
          * to create or receive any connections, its ID will be forfeited on the server,
          * and all of its data and media connections will be closed.
          * :::
          */;
          _proto14.destroy = function destroy() {
            if (this.destroyed) return;
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Destroy peer with ID:" + this.id);
            this.disconnect();
            this._cleanup();
            this._destroyed = true;
            this.emit("close");
          }
          /** Disconnects every connection on this peer. */;
          _proto14._cleanup = function _cleanup() {
            for (var _iterator9 = _createForOfIteratorHelperLoose(this._connections.keys()), _step9; !(_step9 = _iterator9()).done;) {
              var peerId = _step9.value;
              this._cleanupPeer(peerId);
              this._connections["delete"](peerId);
            }
            this.socket.removeAllListeners();
          }
          /** Closes all connections to this peer. */;
          _proto14._cleanupPeer = function _cleanupPeer(peerId) {
            var connections = this._connections.get(peerId);
            if (!connections) return;
            for (var _iterator10 = _createForOfIteratorHelperLoose(connections), _step10; !(_step10 = _iterator10()).done;) {
              var connection = _step10.value;
              connection.close();
            }
          }
          /**
          * Disconnects the Peer's connection to the PeerServer. Does not close any
          *  active connections.
          * Warning: The peer can no longer create or accept connections after being
          *  disconnected. It also cannot reconnect to the server.
          */;
          _proto14.disconnect = function disconnect() {
            if (this.disconnected) return;
            var currentId = this.id;
            $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Disconnect peer with ID:" + currentId);
            this._disconnected = true;
            this._open = false;
            this.socket.close();
            this._lastServerId = currentId;
            this._id = null;
            this.emit("disconnected", currentId);
          }
          /** Attempts to reconnect with the same ID.
          *
          * Only {@apilink Peer.disconnect | disconnected peers} can be reconnected.
          * Destroyed peers cannot be reconnected.
          * If the connection fails (as an example, if the peer's old ID is now taken),
          * the peer's existing connections will not close, but any associated errors events will fire.
          */;
          _proto14.reconnect = function reconnect() {
            if (this.disconnected && !this.destroyed) {
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.log("Attempting reconnection to server with ID " + this._lastServerId);
              this._disconnected = false;
              this._initialize(this._lastServerId);
            } else if (this.destroyed) throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");else if (!this.disconnected && !this.open)
              // Do nothing. We're still connecting the first time.
              $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer " + this.id + " cannot reconnect because it is not disconnected from the server!");
          }
          /**
          * Get a list of available peer IDs. If you're running your own server, you'll
          * want to set allow_discovery: true in the PeerServer options. If you're using
          * the cloud server, email team@peerjs.com to get the functionality enabled for
          * your key.
          */;
          _proto14.listAllPeers = function listAllPeers(cb) {
            var _this22 = this;
            if (cb === void 0) {
              cb = function cb(_) {};
            }
            this._api.listAllPeers().then(function (peers) {
              return cb(peers);
            })["catch"](function (error) {
              return _this22._abort($1a7e7edd560505fc$export$9547aaa2e39030ff.ServerError, error);
            });
          };
          _createClass($2ddecb16305b5a82$export$ecd1fc136c422448, [{
            key: "id",
            get:
            /**
            * The brokering ID of this peer
            *
            * If no ID was specified in {@apilink Peer | the constructor},
            * this will be `undefined` until the {@apilink PeerEvents | `open`} event is emitted.
            */
            function get() {
              return this._id;
            }
          }, {
            key: "options",
            get: function get() {
              return this._options;
            }
          }, {
            key: "open",
            get: function get() {
              return this._open;
            }
            /**
            * @internal
            */
          }, {
            key: "socket",
            get: function get() {
              return this._socket;
            }
            /**
            * A hash of all connections associated with this peer, keyed by the remote peer's ID.
            * @deprecated
            * Return type will change from Object to Map<string,[]>
            */
          }, {
            key: "connections",
            get: function get() {
              var plainConnections = Object.create(null);
              for (var _iterator11 = _createForOfIteratorHelperLoose(this._connections), _step11; !(_step11 = _iterator11()).done;) {
                var _step11$value = _step11.value,
                  k = _step11$value[0],
                  v = _step11$value[1];
                plainConnections[k] = v;
              }
              return plainConnections;
            }
            /**
            * true if this peer and all of its connections can no longer be used.
            */
          }, {
            key: "destroyed",
            get: function get() {
              return this._destroyed;
            }
            /**
            * false if there is an active connection to the PeerServer.
            */
          }, {
            key: "disconnected",
            get: function get() {
              return this._disconnected;
            }
          }]);
          return $2ddecb16305b5a82$export$ecd1fc136c422448;
        }($cf62563e7a9fbce5$export$6a678e589c8a4542);
        _class4 = $2ddecb16305b5a82$export$ecd1fc136c422448;
        Object.defineProperty($2ddecb16305b5a82$export$ecd1fc136c422448, _5, {
          writable: true,
          value: _class4.DEFAULT_KEY = "peerjs"
        });
        var $544799118fa637e6$export$72aa44612e2200cd = /*#__PURE__*/function (_ref15) {
          _inheritsLoose($544799118fa637e6$export$72aa44612e2200cd, _ref15);
          function $544799118fa637e6$export$72aa44612e2200cd(peerId, provider, options) {
            var _this23;
            _this23 = _ref15.call(this, peerId, provider, _extends({}, options, {
              reliable: true
            })) || this, _this23._CHUNK_SIZE = 32768, _this23._splitStream = new TransformStream({
              transform: function transform(chunk, controller) {
                for (var split = 0; split < chunk.length; split += _this23._CHUNK_SIZE) controller.enqueue(chunk.subarray(split, split + _this23._CHUNK_SIZE));
              }
            }), _this23._rawSendStream = new WritableStream({
              write: function () {
                var _write = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(chunk, controller) {
                  var openEvent;
                  return _regeneratorRuntime().wrap(function _callee9$(_context9) {
                    while (1) switch (_context9.prev = _context9.next) {
                      case 0:
                        openEvent = new Promise(function (resolve) {
                          return _this23.dataChannel.addEventListener("bufferedamountlow", resolve, {
                            once: true
                          });
                        }); // if we can send the chunk now, send it
                        // if not, we wait until at least half of the sending buffer is free again
                        _context9.next = 3;
                        return _this23.dataChannel.bufferedAmount <= $f188f8cb0f63b180$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT - chunk.byteLength || openEvent;
                      case 3:
                        // TODO: what can go wrong here?
                        try {
                          _this23.dataChannel.send(chunk);
                        } catch (e) {
                          $df9d8b89ee908b8b$export$2e2bcd8739ae039.error("DC#:" + _this23.connectionId + " Error when sending:", e);
                          controller.error(e);
                          _this23.close();
                        }
                      case 4:
                      case "end":
                        return _context9.stop();
                    }
                  }, _callee9);
                }));
                function write(_x6, _x7) {
                  return _write.apply(this, arguments);
                }
                return write;
              }()
            }), _this23.writer = _this23._splitStream.writable.getWriter(), _this23._rawReadStream = new ReadableStream({
              start: function start(controller) {
                _this23.once("open", function () {
                  _this23.dataChannel.addEventListener("message", function (e) {
                    controller.enqueue(e.data);
                  });
                });
              }
            });
            _this23._splitStream.readable.pipeTo(_this23._rawSendStream);
            return _this23;
          }
          var _proto15 = $544799118fa637e6$export$72aa44612e2200cd.prototype;
          _proto15._initializeDataChannel = function _initializeDataChannel(dc) {
            _ref15.prototype._initializeDataChannel.call(this, dc);
            this.dataChannel.binaryType = "arraybuffer";
            this.dataChannel.bufferedAmountLowThreshold = $f188f8cb0f63b180$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT / 2;
          };
          return $544799118fa637e6$export$72aa44612e2200cd;
        }($f188f8cb0f63b180$export$d365f7ad9d7df9c9);
        var $7e477efb76e02214$export$80f5de1a66c4d624 = /*#__PURE__*/function (_ref16) {
          _inheritsLoose($7e477efb76e02214$export$80f5de1a66c4d624, _ref16);
          function $7e477efb76e02214$export$80f5de1a66c4d624(peerId, provider, options) {
            var _this24;
            _this24 = _ref16.call(this, peerId, provider, options) || this, _this24.serialization = "MsgPack", _this24._encoder = new $2QID2$msgpackmsgpack.Encoder();
            _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {
              var _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, msg, _msg$__peerData;
              return _regeneratorRuntime().wrap(function _callee10$(_context10) {
                while (1) switch (_context10.prev = _context10.next) {
                  case 0:
                    _iteratorAbruptCompletion = false;
                    _didIteratorError = false;
                    _context10.prev = 2;
                    _iterator = _asyncIterator((0, $2QID2$msgpackmsgpack.decodeMultiStream)(_this24._rawReadStream));
                  case 4:
                    _context10.next = 6;
                    return _iterator.next();
                  case 6:
                    if (!(_iteratorAbruptCompletion = !(_step = _context10.sent).done)) {
                      _context10.next = 15;
                      break;
                    }
                    msg = _step.value;
                    if (!(((_msg$__peerData = msg.__peerData) == null ? void 0 : _msg$__peerData.type) === "close")) {
                      _context10.next = 11;
                      break;
                    }
                    _this24.close();
                    return _context10.abrupt("return");
                  case 11:
                    _this24.emit("data", msg);
                  case 12:
                    _iteratorAbruptCompletion = false;
                    _context10.next = 4;
                    break;
                  case 15:
                    _context10.next = 21;
                    break;
                  case 17:
                    _context10.prev = 17;
                    _context10.t0 = _context10["catch"](2);
                    _didIteratorError = true;
                    _iteratorError = _context10.t0;
                  case 21:
                    _context10.prev = 21;
                    _context10.prev = 22;
                    if (!(_iteratorAbruptCompletion && _iterator["return"] != null)) {
                      _context10.next = 26;
                      break;
                    }
                    _context10.next = 26;
                    return _iterator["return"]();
                  case 26:
                    _context10.prev = 26;
                    if (!_didIteratorError) {
                      _context10.next = 29;
                      break;
                    }
                    throw _iteratorError;
                  case 29:
                    return _context10.finish(26);
                  case 30:
                    return _context10.finish(21);
                  case 31:
                  case "end":
                    return _context10.stop();
                }
              }, _callee10, null, [[2, 17, 21, 31], [22,, 26, 30]]);
            }))();
            return _this24;
          }
          var _proto16 = $7e477efb76e02214$export$80f5de1a66c4d624.prototype;
          _proto16._send = function _send(data) {
            return this.writer.write(this._encoder.encode(data));
          };
          return $7e477efb76e02214$export$80f5de1a66c4d624;
        }($544799118fa637e6$export$72aa44612e2200cd);
        var $8c8805059443e9b3$export$d72c7bf8eef50853 = /*#__PURE__*/function (_ref18) {
          _inheritsLoose($8c8805059443e9b3$export$d72c7bf8eef50853, _ref18);
          function $8c8805059443e9b3$export$d72c7bf8eef50853() {
            var _this25;
            for (var _len9 = arguments.length, args = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {
              args[_key9] = arguments[_key9];
            }
            _this25 = _ref18.call.apply(_ref18, [this].concat(args)) || this, _this25._serializers = {
              MsgPack: $7e477efb76e02214$export$80f5de1a66c4d624,
              "default": $7e477efb76e02214$export$80f5de1a66c4d624
            };
            return _this25;
          }
          return $8c8805059443e9b3$export$d72c7bf8eef50853;
        }($2ddecb16305b5a82$export$ecd1fc136c422448);
        var $8c8bca0fa9aa4b8b$export$2e2bcd8739ae039 = $2ddecb16305b5a82$export$ecd1fc136c422448;
        $parcel$exportWildcard(module.exports, $1a7e7edd560505fc$exports);

        // #endregion ORIGINAL CODE

        _cjsExports = exports('default', module.exports);
      }, function () {
        return {
          'peerjs-js-binarypack': __cjsMetaURL$1,
          'webrtc-adapter': __cjsMetaURL$2,
          'eventemitter3': __cjsMetaURL$3,
          '@msgpack/msgpack': __cjsMetaURL$4
        };
      });
    }
  };
});

System.register("chunks:///_virtual/bundler.mjs_cjs=&original=.cjs", ['./bundler.cjs', './cjs-loader.mjs'], function (exports, module) {
  var __cjsMetaURL, loader;
  return {
    setters: [function (module) {
      __cjsMetaURL = module.__cjsMetaURL;
      var _setter = {};
      _setter.__cjsMetaURL = module.__cjsMetaURL;
      _setter.default = module.default;
      exports(_setter);
    }, function (module) {
      loader = module.default;
    }],
    execute: function () {
      // I am the facade module who provides access to the CommonJS module './bundler.cjs'~
      if (!__cjsMetaURL) {
        loader.throwInvalidWrapper('./bundler.cjs', module.meta.url);
      }
      loader.require(__cjsMetaURL);
    }
  };
});

System.register("chunks:///_virtual/CachedKeyDecoder.js", ['./cjs-loader.mjs', './utf8.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      function _createForOfIteratorHelperLoose(o, allowArrayLike) {
        var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
        if (it) return (it = it.call(o)).next.bind(it);
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          return function () {
            if (i >= o.length) return {
              done: true
            };
            return {
              done: false,
              value: o[i++]
            };
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }
      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;
        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
        return arr2;
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.CachedKeyDecoder = void 0;
        var utf8_1 = require("./utils/utf8");
        var DEFAULT_MAX_KEY_LENGTH = 16;
        var DEFAULT_MAX_LENGTH_PER_KEY = 16;
        var CachedKeyDecoder = /*#__PURE__*/function () {
          function CachedKeyDecoder(maxKeyLength, maxLengthPerKey) {
            if (maxKeyLength === void 0) {
              maxKeyLength = DEFAULT_MAX_KEY_LENGTH;
            }
            if (maxLengthPerKey === void 0) {
              maxLengthPerKey = DEFAULT_MAX_LENGTH_PER_KEY;
            }
            this.maxKeyLength = maxKeyLength;
            this.maxLengthPerKey = maxLengthPerKey;
            this.hit = 0;
            this.miss = 0;
            // avoid `new Array(N)`, which makes a sparse array,
            // because a sparse array is typically slower than a non-sparse array.
            this.caches = [];
            for (var i = 0; i < this.maxKeyLength; i++) {
              this.caches.push([]);
            }
          }
          var _proto = CachedKeyDecoder.prototype;
          _proto.canBeCached = function canBeCached(byteLength) {
            return byteLength > 0 && byteLength <= this.maxKeyLength;
          };
          _proto.find = function find(bytes, inputOffset, byteLength) {
            var records = this.caches[byteLength - 1];
            FIND_CHUNK: for (var _iterator = _createForOfIteratorHelperLoose(records), _step; !(_step = _iterator()).done;) {
              var record = _step.value;
              var recordBytes = record.bytes;
              for (var j = 0; j < byteLength; j++) {
                if (recordBytes[j] !== bytes[inputOffset + j]) {
                  continue FIND_CHUNK;
                }
              }
              return record.str;
            }
            return null;
          };
          _proto.store = function store(bytes, value) {
            var records = this.caches[bytes.length - 1];
            var record = {
              bytes: bytes,
              str: value
            };
            if (records.length >= this.maxLengthPerKey) {
              // `records` are full!
              // Set `record` to an arbitrary position.
              records[Math.random() * records.length | 0] = record;
            } else {
              records.push(record);
            }
          };
          _proto.decode = function decode(bytes, inputOffset, byteLength) {
            var cachedValue = this.find(bytes, inputOffset, byteLength);
            if (cachedValue != null) {
              this.hit++;
              return cachedValue;
            }
            this.miss++;
            var str = (0, utf8_1.utf8DecodeJs)(bytes, inputOffset, byteLength);
            // Ensure to copy a slice of bytes because the byte may be NodeJS Buffer and Buffer#slice() returns a reference to its internal ArrayBuffer.
            var slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);
            this.store(slicedCopyOfBytes, str);
            return str;
          };
          return CachedKeyDecoder;
        }();
        exports.CachedKeyDecoder = CachedKeyDecoder;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.CachedKeyDecoder;
      }, function () {
        return {
          './utils/utf8': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/chrome_shim.js", ['./cjs-loader.mjs', './utils.js', './getusermedia.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.fixNegotiationNeeded = fixNegotiationNeeded;
        exports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;
        exports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;
        exports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;
        Object.defineProperty(exports, "shimGetUserMedia", {
          enumerable: true,
          get: function get() {
            return _getusermedia.shimGetUserMedia;
          }
        });
        exports.shimMediaStream = shimMediaStream;
        exports.shimOnTrack = shimOnTrack;
        exports.shimPeerConnection = shimPeerConnection;
        exports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;
        var utils = _interopRequireWildcard(require("../utils.js"));
        var _getusermedia = require("./getusermedia");
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _defineProperty(e, r, t) {
          return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {
            value: t,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }) : e[r] = t, e;
        }
        function _toPropertyKey(t) {
          var i = _toPrimitive(t, "string");
          return "symbol" == _typeof(i) ? i : i + "";
        }
        function _toPrimitive(t, r) {
          if ("object" != _typeof(t) || !t) return t;
          var e = t[Symbol.toPrimitive];
          if (void 0 !== e) {
            var i = e.call(t, r || "default");
            if ("object" != _typeof(i)) return i;
            throw new TypeError("@@toPrimitive must return a primitive value.");
          }
          return ("string" === r ? String : Number)(t);
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        function shimMediaStream(window) {
          window.MediaStream = window.MediaStream || window.webkitMediaStream;
        }
        function shimOnTrack(window) {
          if (_typeof(window) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {
            Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {
              get: function get() {
                return this._ontrack;
              },
              set: function set(f) {
                if (this._ontrack) {
                  this.removeEventListener('track', this._ontrack);
                }
                this.addEventListener('track', this._ontrack = f);
              },
              enumerable: true,
              configurable: true
            });
            var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;
            window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {
              var _this = this;
              if (!this._ontrackpoly) {
                this._ontrackpoly = function (e) {
                  // onaddstream does not fire when a track is added to an existing
                  // stream. But stream.onaddtrack is implemented so we use that.
                  e.stream.addEventListener('addtrack', function (te) {
                    var receiver;
                    if (window.RTCPeerConnection.prototype.getReceivers) {
                      receiver = _this.getReceivers().find(function (r) {
                        return r.track && r.track.id === te.track.id;
                      });
                    } else {
                      receiver = {
                        track: te.track
                      };
                    }
                    var event = new Event('track');
                    event.track = te.track;
                    event.receiver = receiver;
                    event.transceiver = {
                      receiver: receiver
                    };
                    event.streams = [e.stream];
                    _this.dispatchEvent(event);
                  });
                  e.stream.getTracks().forEach(function (track) {
                    var receiver;
                    if (window.RTCPeerConnection.prototype.getReceivers) {
                      receiver = _this.getReceivers().find(function (r) {
                        return r.track && r.track.id === track.id;
                      });
                    } else {
                      receiver = {
                        track: track
                      };
                    }
                    var event = new Event('track');
                    event.track = track;
                    event.receiver = receiver;
                    event.transceiver = {
                      receiver: receiver
                    };
                    event.streams = [e.stream];
                    _this.dispatchEvent(event);
                  });
                };
                this.addEventListener('addstream', this._ontrackpoly);
              }
              return origSetRemoteDescription.apply(this, arguments);
            };
          } else {
            // even if RTCRtpTransceiver is in window, it is only used and
            // emitted in unified-plan. Unfortunately this means we need
            // to unconditionally wrap the event.
            utils.wrapPeerConnectionEvent(window, 'track', function (e) {
              if (!e.transceiver) {
                Object.defineProperty(e, 'transceiver', {
                  value: {
                    receiver: e.receiver
                  }
                });
              }
              return e;
            });
          }
        }
        function shimGetSendersWithDtmf(window) {
          // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.
          if (_typeof(window) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {
            var shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {
              return {
                track: track,
                get dtmf() {
                  if (this._dtmf === undefined) {
                    if (track.kind === 'audio') {
                      this._dtmf = pc.createDTMFSender(track);
                    } else {
                      this._dtmf = null;
                    }
                  }
                  return this._dtmf;
                },
                _pc: pc
              };
            };

            // augment addTrack when getSenders is not available.
            if (!window.RTCPeerConnection.prototype.getSenders) {
              window.RTCPeerConnection.prototype.getSenders = function getSenders() {
                this._senders = this._senders || [];
                return this._senders.slice(); // return a copy of the internal state.
              };

              var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
              window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {
                var sender = origAddTrack.apply(this, arguments);
                if (!sender) {
                  sender = shimSenderWithDtmf(this, track);
                  this._senders.push(sender);
                }
                return sender;
              };
              var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;
              window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {
                origRemoveTrack.apply(this, arguments);
                var idx = this._senders.indexOf(sender);
                if (idx !== -1) {
                  this._senders.splice(idx, 1);
                }
              };
            }
            var origAddStream = window.RTCPeerConnection.prototype.addStream;
            window.RTCPeerConnection.prototype.addStream = function addStream(stream) {
              var _this2 = this;
              this._senders = this._senders || [];
              origAddStream.apply(this, [stream]);
              stream.getTracks().forEach(function (track) {
                _this2._senders.push(shimSenderWithDtmf(_this2, track));
              });
            };
            var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
            window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {
              var _this3 = this;
              this._senders = this._senders || [];
              origRemoveStream.apply(this, [stream]);
              stream.getTracks().forEach(function (track) {
                var sender = _this3._senders.find(function (s) {
                  return s.track === track;
                });
                if (sender) {
                  // remove sender
                  _this3._senders.splice(_this3._senders.indexOf(sender), 1);
                }
              });
            };
          } else if (_typeof(window) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {
            var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
            window.RTCPeerConnection.prototype.getSenders = function getSenders() {
              var _this4 = this;
              var senders = origGetSenders.apply(this, []);
              senders.forEach(function (sender) {
                return sender._pc = _this4;
              });
              return senders;
            };
            Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {
              get: function get() {
                if (this._dtmf === undefined) {
                  if (this.track.kind === 'audio') {
                    this._dtmf = this._pc.createDTMFSender(this.track);
                  } else {
                    this._dtmf = null;
                  }
                }
                return this._dtmf;
              }
            });
          }
        }
        function shimSenderReceiverGetStats(window) {
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {
            return;
          }

          // shim sender stats.
          if (!('getStats' in window.RTCRtpSender.prototype)) {
            var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
            if (origGetSenders) {
              window.RTCPeerConnection.prototype.getSenders = function getSenders() {
                var _this5 = this;
                var senders = origGetSenders.apply(this, []);
                senders.forEach(function (sender) {
                  return sender._pc = _this5;
                });
                return senders;
              };
            }
            var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
            if (origAddTrack) {
              window.RTCPeerConnection.prototype.addTrack = function addTrack() {
                var sender = origAddTrack.apply(this, arguments);
                sender._pc = this;
                return sender;
              };
            }
            window.RTCRtpSender.prototype.getStats = function getStats() {
              var sender = this;
              return this._pc.getStats().then(function (result) {
                return (
                  /* Note: this will include stats of all senders that
                   *   send a track with the same id as sender.track as
                   *   it is not possible to identify the RTCRtpSender.
                   */
                  utils.filterStats(result, sender.track, true)
                );
              });
            };
          }

          // shim receiver stats.
          if (!('getStats' in window.RTCRtpReceiver.prototype)) {
            var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;
            if (origGetReceivers) {
              window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {
                var _this6 = this;
                var receivers = origGetReceivers.apply(this, []);
                receivers.forEach(function (receiver) {
                  return receiver._pc = _this6;
                });
                return receivers;
              };
            }
            utils.wrapPeerConnectionEvent(window, 'track', function (e) {
              e.receiver._pc = e.srcElement;
              return e;
            });
            window.RTCRtpReceiver.prototype.getStats = function getStats() {
              var receiver = this;
              return this._pc.getStats().then(function (result) {
                return utils.filterStats(result, receiver.track, false);
              });
            };
          }
          if (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {
            return;
          }

          // shim RTCPeerConnection.getStats(track).
          var origGetStats = window.RTCPeerConnection.prototype.getStats;
          window.RTCPeerConnection.prototype.getStats = function getStats() {
            if (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {
              var track = arguments[0];
              var sender;
              var receiver;
              var err;
              this.getSenders().forEach(function (s) {
                if (s.track === track) {
                  if (sender) {
                    err = true;
                  } else {
                    sender = s;
                  }
                }
              });
              this.getReceivers().forEach(function (r) {
                if (r.track === track) {
                  if (receiver) {
                    err = true;
                  } else {
                    receiver = r;
                  }
                }
                return r.track === track;
              });
              if (err || sender && receiver) {
                return Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));
              } else if (sender) {
                return sender.getStats();
              } else if (receiver) {
                return receiver.getStats();
              }
              return Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));
            }
            return origGetStats.apply(this, arguments);
          };
        }
        function shimAddTrackRemoveTrackWithNative(window) {
          // shim addTrack/removeTrack with native variants in order to make
          // the interactions with legacy getLocalStreams behave as in other browsers.
          // Keeps a mapping stream.id => [stream, rtpsenders...]
          window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {
            var _this7 = this;
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            return Object.keys(this._shimmedLocalStreams).map(function (streamId) {
              return _this7._shimmedLocalStreams[streamId][0];
            });
          };
          var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
          window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {
            if (!stream) {
              return origAddTrack.apply(this, arguments);
            }
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            var sender = origAddTrack.apply(this, arguments);
            if (!this._shimmedLocalStreams[stream.id]) {
              this._shimmedLocalStreams[stream.id] = [stream, sender];
            } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {
              this._shimmedLocalStreams[stream.id].push(sender);
            }
            return sender;
          };
          var origAddStream = window.RTCPeerConnection.prototype.addStream;
          window.RTCPeerConnection.prototype.addStream = function addStream(stream) {
            var _this8 = this;
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            stream.getTracks().forEach(function (track) {
              var alreadyExists = _this8.getSenders().find(function (s) {
                return s.track === track;
              });
              if (alreadyExists) {
                throw new DOMException('Track already exists.', 'InvalidAccessError');
              }
            });
            var existingSenders = this.getSenders();
            origAddStream.apply(this, arguments);
            var newSenders = this.getSenders().filter(function (newSender) {
              return existingSenders.indexOf(newSender) === -1;
            });
            this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);
          };
          var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
          window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            delete this._shimmedLocalStreams[stream.id];
            return origRemoveStream.apply(this, arguments);
          };
          var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;
          window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {
            var _this9 = this;
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            if (sender) {
              Object.keys(this._shimmedLocalStreams).forEach(function (streamId) {
                var idx = _this9._shimmedLocalStreams[streamId].indexOf(sender);
                if (idx !== -1) {
                  _this9._shimmedLocalStreams[streamId].splice(idx, 1);
                }
                if (_this9._shimmedLocalStreams[streamId].length === 1) {
                  delete _this9._shimmedLocalStreams[streamId];
                }
              });
            }
            return origRemoveTrack.apply(this, arguments);
          };
        }
        function shimAddTrackRemoveTrack(window, browserDetails) {
          if (!window.RTCPeerConnection) {
            return;
          }
          // shim addTrack and removeTrack.
          if (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {
            return shimAddTrackRemoveTrackWithNative(window);
          }

          // also shim pc.getLocalStreams when addTrack is shimmed
          // to return the original streams.
          var origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;
          window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {
            var _this10 = this;
            var nativeStreams = origGetLocalStreams.apply(this);
            this._reverseStreams = this._reverseStreams || {};
            return nativeStreams.map(function (stream) {
              return _this10._reverseStreams[stream.id];
            });
          };
          var origAddStream = window.RTCPeerConnection.prototype.addStream;
          window.RTCPeerConnection.prototype.addStream = function addStream(stream) {
            var _this11 = this;
            this._streams = this._streams || {};
            this._reverseStreams = this._reverseStreams || {};
            stream.getTracks().forEach(function (track) {
              var alreadyExists = _this11.getSenders().find(function (s) {
                return s.track === track;
              });
              if (alreadyExists) {
                throw new DOMException('Track already exists.', 'InvalidAccessError');
              }
            });
            // Add identity mapping for consistency with addTrack.
            // Unless this is being used with a stream from addTrack.
            if (!this._reverseStreams[stream.id]) {
              var newStream = new window.MediaStream(stream.getTracks());
              this._streams[stream.id] = newStream;
              this._reverseStreams[newStream.id] = stream;
              stream = newStream;
            }
            origAddStream.apply(this, [stream]);
          };
          var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
          window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {
            this._streams = this._streams || {};
            this._reverseStreams = this._reverseStreams || {};
            origRemoveStream.apply(this, [this._streams[stream.id] || stream]);
            delete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];
            delete this._streams[stream.id];
          };
          window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {
            var _this12 = this;
            if (this.signalingState === 'closed') {
              throw new DOMException('The RTCPeerConnection\'s signalingState is \'closed\'.', 'InvalidStateError');
            }
            var streams = [].slice.call(arguments, 1);
            if (streams.length !== 1 || !streams[0].getTracks().find(function (t) {
              return t === track;
            })) {
              // this is not fully correct but all we can manage without
              // [[associated MediaStreams]] internal slot.
              throw new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');
            }
            var alreadyExists = this.getSenders().find(function (s) {
              return s.track === track;
            });
            if (alreadyExists) {
              throw new DOMException('Track already exists.', 'InvalidAccessError');
            }
            this._streams = this._streams || {};
            this._reverseStreams = this._reverseStreams || {};
            var oldStream = this._streams[stream.id];
            if (oldStream) {
              // this is using odd Chrome behaviour, use with caution:
              // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815
              // Note: we rely on the high-level addTrack/dtmf shim to
              // create the sender with a dtmf sender.
              oldStream.addTrack(track);

              // Trigger ONN async.
              Promise.resolve().then(function () {
                _this12.dispatchEvent(new Event('negotiationneeded'));
              });
            } else {
              var newStream = new window.MediaStream([track]);
              this._streams[stream.id] = newStream;
              this._reverseStreams[newStream.id] = stream;
              this.addStream(newStream);
            }
            return this.getSenders().find(function (s) {
              return s.track === track;
            });
          };

          // replace the internal stream id with the external one and
          // vice versa.
          function replaceInternalStreamId(pc, description) {
            var sdp = description.sdp;
            Object.keys(pc._reverseStreams || []).forEach(function (internalId) {
              var externalStream = pc._reverseStreams[internalId];
              var internalStream = pc._streams[externalStream.id];
              sdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);
            });
            return new RTCSessionDescription({
              type: description.type,
              sdp: sdp
            });
          }
          function replaceExternalStreamId(pc, description) {
            var sdp = description.sdp;
            Object.keys(pc._reverseStreams || []).forEach(function (internalId) {
              var externalStream = pc._reverseStreams[internalId];
              var internalStream = pc._streams[externalStream.id];
              sdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);
            });
            return new RTCSessionDescription({
              type: description.type,
              sdp: sdp
            });
          }
          ['createOffer', 'createAnswer'].forEach(function (method) {
            var nativeMethod = window.RTCPeerConnection.prototype[method];
            var methodObj = _defineProperty({}, method, function () {
              var _this13 = this;
              var args = arguments;
              var isLegacyCall = arguments.length && typeof arguments[0] === 'function';
              if (isLegacyCall) {
                return nativeMethod.apply(this, [function (description) {
                  var desc = replaceInternalStreamId(_this13, description);
                  args[0].apply(null, [desc]);
                }, function (err) {
                  if (args[1]) {
                    args[1].apply(null, err);
                  }
                }, arguments[2]]);
              }
              return nativeMethod.apply(this, arguments).then(function (description) {
                return replaceInternalStreamId(_this13, description);
              });
            });
            window.RTCPeerConnection.prototype[method] = methodObj[method];
          });
          var origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;
          window.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {
            if (!arguments.length || !arguments[0].type) {
              return origSetLocalDescription.apply(this, arguments);
            }
            arguments[0] = replaceExternalStreamId(this, arguments[0]);
            return origSetLocalDescription.apply(this, arguments);
          };

          // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier

          var origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');
          Object.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {
            get: function get() {
              var description = origLocalDescription.get.apply(this);
              if (description.type === '') {
                return description;
              }
              return replaceInternalStreamId(this, description);
            }
          });
          window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {
            var _this14 = this;
            if (this.signalingState === 'closed') {
              throw new DOMException('The RTCPeerConnection\'s signalingState is \'closed\'.', 'InvalidStateError');
            }
            // We can not yet check for sender instanceof RTCRtpSender
            // since we shim RTPSender. So we check if sender._pc is set.
            if (!sender._pc) {
              throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');
            }
            var isLocal = sender._pc === this;
            if (!isLocal) {
              throw new DOMException('Sender was not created by this connection.', 'InvalidAccessError');
            }

            // Search for the native stream the senders track belongs to.
            this._streams = this._streams || {};
            var stream;
            Object.keys(this._streams).forEach(function (streamid) {
              var hasTrack = _this14._streams[streamid].getTracks().find(function (track) {
                return sender.track === track;
              });
              if (hasTrack) {
                stream = _this14._streams[streamid];
              }
            });
            if (stream) {
              if (stream.getTracks().length === 1) {
                // if this is the last track of the stream, remove the stream. This
                // takes care of any shimmed _senders.
                this.removeStream(this._reverseStreams[stream.id]);
              } else {
                // relying on the same odd chrome behaviour as above.
                stream.removeTrack(sender.track);
              }
              this.dispatchEvent(new Event('negotiationneeded'));
            }
          };
        }
        function shimPeerConnection(window, browserDetails) {
          if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {
            // very basic support for old versions.
            window.RTCPeerConnection = window.webkitRTCPeerConnection;
          }
          if (!window.RTCPeerConnection) {
            return;
          }

          // shim implicit creation of RTCSessionDescription/RTCIceCandidate
          if (browserDetails.version < 53) {
            ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {
              var nativeMethod = window.RTCPeerConnection.prototype[method];
              var methodObj = _defineProperty({}, method, function () {
                arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);
                return nativeMethod.apply(this, arguments);
              });
              window.RTCPeerConnection.prototype[method] = methodObj[method];
            });
          }
        }

        // Attempt to fix ONN in plan-b mode.
        function fixNegotiationNeeded(window, browserDetails) {
          utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {
            var pc = e.target;
            if (browserDetails.version < 72 || pc.getConfiguration && pc.getConfiguration().sdpSemantics === 'plan-b') {
              if (pc.signalingState !== 'stable') {
                return;
              }
            }
            return e;
          });
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.fixNegotiationNeeded;
        module.exports.shimAddTrackRemoveTrack;
        module.exports.shimAddTrackRemoveTrackWithNative;
        module.exports.shimGetSendersWithDtmf;
        module.exports.shimGetUserMedia;
        module.exports.shimMediaStream;
        module.exports.shimOnTrack;
        module.exports.shimPeerConnection;
        module.exports.shimSenderReceiverGetStats;
      }, function () {
        return {
          '../utils.js': __cjsMetaURL$1,
          './getusermedia': __cjsMetaURL$2
        };
      });
    }
  };
});

System.register("chunks:///_virtual/cjs-loader.mjs", [], function (exports) {
  return {
    execute: function () {
      var CjsLoader = /*#__PURE__*/function () {
        function CjsLoader() {
          this._registry = {};
          this._moduleCache = {};
        }

        /**
         * Defines a CommonJS module.
         * @param id Module ID.
         * @param factory The factory.
         * @param resolveMap An object or a function returning object which records the module specifier resolve result.
         * The later is called as "deferred resolve map" and would be invocated right before CommonJS code execution.
         */
        var _proto = CjsLoader.prototype;
        _proto.define = function define(id, factory, resolveMap) {
          this._registry[id] = {
            factory: factory,
            resolveMap: resolveMap
          };
        }

        /**
         * Requires a CommonJS module.
         * @param id Module ID.
         * @returns The module's `module.exports`.
         */;
        _proto.require = function require(id) {
          return this._require(id);
        };
        _proto.throwInvalidWrapper = function throwInvalidWrapper(requestTarget, from) {
          throw new Error("Module '" + requestTarget + "' imported from '" + from + "' is expected be an ESM-wrapped CommonJS module but it doesn't.");
        };
        _proto._require = function _require(id, parent) {
          var cachedModule = this._moduleCache[id];
          if (cachedModule) {
            return cachedModule.exports;
          }
          var module = {
            id: id,
            exports: {}
          };
          this._moduleCache[id] = module;
          this._tryModuleLoad(module, id);
          return module.exports;
        };
        _proto._resolve = function _resolve(specifier, parent) {
          return this._resolveFromInfos(specifier, parent) || this._throwUnresolved(specifier, parent);
        };
        _proto._resolveFromInfos = function _resolveFromInfos(specifier, parent) {
          var _cjsInfos$parent$reso, _cjsInfos$parent;
          if (specifier in cjsInfos) {
            return specifier;
          }
          if (!parent) {
            return;
          }
          return (_cjsInfos$parent$reso = (_cjsInfos$parent = cjsInfos[parent]) == null ? void 0 : _cjsInfos$parent.resolveCache[specifier]) != null ? _cjsInfos$parent$reso : undefined;
        };
        _proto._tryModuleLoad = function _tryModuleLoad(module, id) {
          var threw = true;
          try {
            this._load(module, id);
            threw = false;
          } finally {
            if (threw) {
              delete this._moduleCache[id];
            }
          }
        };
        _proto._load = function _load(module, id) {
          var _this$_loadWrapper = this._loadWrapper(id),
            factory = _this$_loadWrapper.factory,
            resolveMap = _this$_loadWrapper.resolveMap;
          var vendorRequire = this._createRequire(module);
          var require = resolveMap ? this._createRequireWithResolveMap(typeof resolveMap === 'function' ? resolveMap() : resolveMap, vendorRequire) : vendorRequire;
          factory(module.exports, require, module);
        };
        _proto._loadWrapper = function _loadWrapper(id) {
          if (id in this._registry) {
            return this._registry[id];
          } else {
            return this._loadHostProvidedModules(id);
          }
        };
        _proto._loadHostProvidedModules = function _loadHostProvidedModules(id) {
          return {
            factory: function factory(_exports, _require, module) {
              if (typeof require === 'undefined') {
                throw new Error("Current environment does not provide a require() for requiring '" + id + "'.");
              }
              try {
                module.exports = require(id);
              } catch (err) {
                throw new Error("Exception thrown when calling host defined require('" + id + "').", {
                  cause: err
                });
              }
            }
          };
        };
        _proto._createRequire = function _createRequire(module) {
          var _this = this;
          return function (specifier) {
            return _this._require(specifier, module);
          };
        };
        _proto._createRequireWithResolveMap = function _createRequireWithResolveMap(requireMap, originalRequire) {
          return function (specifier) {
            var resolved = requireMap[specifier];
            if (resolved) {
              return originalRequire(resolved);
            } else {
              throw new Error('Unresolved specifier ' + specifier);
            }
          };
        };
        _proto._throwUnresolved = function _throwUnresolved(specifier, parentUrl) {
          throw new Error("Unable to resolve " + specifier + " from " + parent + ".");
        };
        return CjsLoader;
      }();
      var loader = exports('default', new CjsLoader());
    }
  };
});

System.register("chunks:///_virtual/common_shim.js", ['./cjs-loader.mjs', './sdp.js', './utils.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.removeExtmapAllowMixed = removeExtmapAllowMixed;
        exports.shimAddIceCandidateNullOrEmpty = shimAddIceCandidateNullOrEmpty;
        exports.shimConnectionState = shimConnectionState;
        exports.shimMaxMessageSize = shimMaxMessageSize;
        exports.shimParameterlessSetLocalDescription = shimParameterlessSetLocalDescription;
        exports.shimRTCIceCandidate = shimRTCIceCandidate;
        exports.shimRTCIceCandidateRelayProtocol = shimRTCIceCandidateRelayProtocol;
        exports.shimSendThrowTypeError = shimSendThrowTypeError;
        var _sdp = _interopRequireDefault(require("sdp"));
        var utils = _interopRequireWildcard(require("./utils"));
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _interopRequireDefault(e) {
          return e && e.__esModule ? e : {
            "default": e
          };
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        function shimRTCIceCandidate(window) {
          // foundation is arbitrarily chosen as an indicator for full support for
          // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface
          if (!window.RTCIceCandidate || window.RTCIceCandidate && 'foundation' in window.RTCIceCandidate.prototype) {
            return;
          }
          var NativeRTCIceCandidate = window.RTCIceCandidate;
          window.RTCIceCandidate = function RTCIceCandidate(args) {
            // Remove the a= which shouldn't be part of the candidate string.
            if (_typeof(args) === 'object' && args.candidate && args.candidate.indexOf('a=') === 0) {
              args = JSON.parse(JSON.stringify(args));
              args.candidate = args.candidate.substring(2);
            }
            if (args.candidate && args.candidate.length) {
              // Augment the native candidate with the parsed fields.
              var nativeCandidate = new NativeRTCIceCandidate(args);
              var parsedCandidate = _sdp["default"].parseCandidate(args.candidate);
              for (var key in parsedCandidate) {
                if (!(key in nativeCandidate)) {
                  Object.defineProperty(nativeCandidate, key, {
                    value: parsedCandidate[key]
                  });
                }
              }

              // Override serializer to not serialize the extra attributes.
              nativeCandidate.toJSON = function toJSON() {
                return {
                  candidate: nativeCandidate.candidate,
                  sdpMid: nativeCandidate.sdpMid,
                  sdpMLineIndex: nativeCandidate.sdpMLineIndex,
                  usernameFragment: nativeCandidate.usernameFragment
                };
              };
              return nativeCandidate;
            }
            return new NativeRTCIceCandidate(args);
          };
          window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;

          // Hook up the augmented candidate in onicecandidate and
          // addEventListener('icecandidate', ...)
          utils.wrapPeerConnectionEvent(window, 'icecandidate', function (e) {
            if (e.candidate) {
              Object.defineProperty(e, 'candidate', {
                value: new window.RTCIceCandidate(e.candidate),
                writable: 'false'
              });
            }
            return e;
          });
        }
        function shimRTCIceCandidateRelayProtocol(window) {
          if (!window.RTCIceCandidate || window.RTCIceCandidate && 'relayProtocol' in window.RTCIceCandidate.prototype) {
            return;
          }

          // Hook up the augmented candidate in onicecandidate and
          // addEventListener('icecandidate', ...)
          utils.wrapPeerConnectionEvent(window, 'icecandidate', function (e) {
            if (e.candidate) {
              var parsedCandidate = _sdp["default"].parseCandidate(e.candidate.candidate);
              if (parsedCandidate.type === 'relay') {
                // This is a libwebrtc-specific mapping of local type preference
                // to relayProtocol.
                e.candidate.relayProtocol = {
                  0: 'tls',
                  1: 'tcp',
                  2: 'udp'
                }[parsedCandidate.priority >> 24];
              }
            }
            return e;
          });
        }
        function shimMaxMessageSize(window, browserDetails) {
          if (!window.RTCPeerConnection) {
            return;
          }
          if (!('sctp' in window.RTCPeerConnection.prototype)) {
            Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {
              get: function get() {
                return typeof this._sctp === 'undefined' ? null : this._sctp;
              }
            });
          }
          var sctpInDescription = function sctpInDescription(description) {
            if (!description || !description.sdp) {
              return false;
            }
            var sections = _sdp["default"].splitSections(description.sdp);
            sections.shift();
            return sections.some(function (mediaSection) {
              var mLine = _sdp["default"].parseMLine(mediaSection);
              return mLine && mLine.kind === 'application' && mLine.protocol.indexOf('SCTP') !== -1;
            });
          };
          var getRemoteFirefoxVersion = function getRemoteFirefoxVersion(description) {
            // TODO: Is there a better solution for detecting Firefox?
            var match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
            if (match === null || match.length < 2) {
              return -1;
            }
            var version = parseInt(match[1], 10);
            // Test for NaN (yes, this is ugly)
            return version !== version ? -1 : version;
          };
          var getCanSendMaxMessageSize = function getCanSendMaxMessageSize(remoteIsFirefox) {
            // Every implementation we know can send at least 64 KiB.
            // Note: Although Chrome is technically able to send up to 256 KiB, the
            //       data does not reach the other peer reliably.
            //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419
            var canSendMaxMessageSize = 65536;
            if (browserDetails.browser === 'firefox') {
              if (browserDetails.version < 57) {
                if (remoteIsFirefox === -1) {
                  // FF < 57 will send in 16 KiB chunks using the deprecated PPID
                  // fragmentation.
                  canSendMaxMessageSize = 16384;
                } else {
                  // However, other FF (and RAWRTC) can reassemble PPID-fragmented
                  // messages. Thus, supporting ~2 GiB when sending.
                  canSendMaxMessageSize = 2147483637;
                }
              } else if (browserDetails.version < 60) {
                // Currently, all FF >= 57 will reset the remote maximum message size
                // to the default value when a data channel is created at a later
                // stage. :(
                // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831
                canSendMaxMessageSize = browserDetails.version === 57 ? 65535 : 65536;
              } else {
                // FF >= 60 supports sending ~2 GiB
                canSendMaxMessageSize = 2147483637;
              }
            }
            return canSendMaxMessageSize;
          };
          var getMaxMessageSize = function getMaxMessageSize(description, remoteIsFirefox) {
            // Note: 65536 bytes is the default value from the SDP spec. Also,
            //       every implementation we know supports receiving 65536 bytes.
            var maxMessageSize = 65536;

            // FF 57 has a slightly incorrect default remote max message size, so
            // we need to adjust it here to avoid a failure when sending.
            // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697
            if (browserDetails.browser === 'firefox' && browserDetails.version === 57) {
              maxMessageSize = 65535;
            }
            var match = _sdp["default"].matchPrefix(description.sdp, 'a=max-message-size:');
            if (match.length > 0) {
              maxMessageSize = parseInt(match[0].substring(19), 10);
            } else if (browserDetails.browser === 'firefox' && remoteIsFirefox !== -1) {
              // If the maximum message size is not present in the remote SDP and
              // both local and remote are Firefox, the remote peer can receive
              // ~2 GiB.
              maxMessageSize = 2147483637;
            }
            return maxMessageSize;
          };
          var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;
          window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {
            this._sctp = null;
            // Chrome decided to not expose .sctp in plan-b mode.
            // As usual, adapter.js has to do an 'ugly worakaround'
            // to cover up the mess.
            if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {
              var _this$getConfiguratio = this.getConfiguration(),
                sdpSemantics = _this$getConfiguratio.sdpSemantics;
              if (sdpSemantics === 'plan-b') {
                Object.defineProperty(this, 'sctp', {
                  get: function get() {
                    return typeof this._sctp === 'undefined' ? null : this._sctp;
                  },
                  enumerable: true,
                  configurable: true
                });
              }
            }
            if (sctpInDescription(arguments[0])) {
              // Check if the remote is FF.
              var isFirefox = getRemoteFirefoxVersion(arguments[0]);

              // Get the maximum message size the local peer is capable of sending
              var canSendMMS = getCanSendMaxMessageSize(isFirefox);

              // Get the maximum message size of the remote peer.
              var remoteMMS = getMaxMessageSize(arguments[0], isFirefox);

              // Determine final maximum message size
              var maxMessageSize;
              if (canSendMMS === 0 && remoteMMS === 0) {
                maxMessageSize = Number.POSITIVE_INFINITY;
              } else if (canSendMMS === 0 || remoteMMS === 0) {
                maxMessageSize = Math.max(canSendMMS, remoteMMS);
              } else {
                maxMessageSize = Math.min(canSendMMS, remoteMMS);
              }

              // Create a dummy RTCSctpTransport object and the 'maxMessageSize'
              // attribute.
              var sctp = {};
              Object.defineProperty(sctp, 'maxMessageSize', {
                get: function get() {
                  return maxMessageSize;
                }
              });
              this._sctp = sctp;
            }
            return origSetRemoteDescription.apply(this, arguments);
          };
        }
        function shimSendThrowTypeError(window) {
          if (!(window.RTCPeerConnection && 'createDataChannel' in window.RTCPeerConnection.prototype)) {
            return;
          }

          // Note: Although Firefox >= 57 has a native implementation, the maximum
          //       message size can be reset for all data channels at a later stage.
          //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831

          function wrapDcSend(dc, pc) {
            var origDataChannelSend = dc.send;
            dc.send = function send() {
              var data = arguments[0];
              var length = data.length || data.size || data.byteLength;
              if (dc.readyState === 'open' && pc.sctp && length > pc.sctp.maxMessageSize) {
                throw new TypeError('Message too large (can send a maximum of ' + pc.sctp.maxMessageSize + ' bytes)');
              }
              return origDataChannelSend.apply(dc, arguments);
            };
          }
          var origCreateDataChannel = window.RTCPeerConnection.prototype.createDataChannel;
          window.RTCPeerConnection.prototype.createDataChannel = function createDataChannel() {
            var dataChannel = origCreateDataChannel.apply(this, arguments);
            wrapDcSend(dataChannel, this);
            return dataChannel;
          };
          utils.wrapPeerConnectionEvent(window, 'datachannel', function (e) {
            wrapDcSend(e.channel, e.target);
            return e;
          });
        }

        /* shims RTCConnectionState by pretending it is the same as iceConnectionState.
         * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12
         * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect
         * since DTLS failures would be hidden. See
         * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827
         * for the Firefox tracking bug.
         */
        function shimConnectionState(window) {
          if (!window.RTCPeerConnection || 'connectionState' in window.RTCPeerConnection.prototype) {
            return;
          }
          var proto = window.RTCPeerConnection.prototype;
          Object.defineProperty(proto, 'connectionState', {
            get: function get() {
              return {
                completed: 'connected',
                checking: 'connecting'
              }[this.iceConnectionState] || this.iceConnectionState;
            },
            enumerable: true,
            configurable: true
          });
          Object.defineProperty(proto, 'onconnectionstatechange', {
            get: function get() {
              return this._onconnectionstatechange || null;
            },
            set: function set(cb) {
              if (this._onconnectionstatechange) {
                this.removeEventListener('connectionstatechange', this._onconnectionstatechange);
                delete this._onconnectionstatechange;
              }
              if (cb) {
                this.addEventListener('connectionstatechange', this._onconnectionstatechange = cb);
              }
            },
            enumerable: true,
            configurable: true
          });
          ['setLocalDescription', 'setRemoteDescription'].forEach(function (method) {
            var origMethod = proto[method];
            proto[method] = function () {
              if (!this._connectionstatechangepoly) {
                this._connectionstatechangepoly = function (e) {
                  var pc = e.target;
                  if (pc._lastConnectionState !== pc.connectionState) {
                    pc._lastConnectionState = pc.connectionState;
                    var newEvent = new Event('connectionstatechange', e);
                    pc.dispatchEvent(newEvent);
                  }
                  return e;
                };
                this.addEventListener('iceconnectionstatechange', this._connectionstatechangepoly);
              }
              return origMethod.apply(this, arguments);
            };
          });
        }
        function removeExtmapAllowMixed(window, browserDetails) {
          /* remove a=extmap-allow-mixed for webrtc.org < M71 */
          if (!window.RTCPeerConnection) {
            return;
          }
          if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {
            return;
          }
          if (browserDetails.browser === 'safari' && browserDetails._safariVersion >= 13.1) {
            return;
          }
          var nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;
          window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription(desc) {
            if (desc && desc.sdp && desc.sdp.indexOf('\na=extmap-allow-mixed') !== -1) {
              var sdp = desc.sdp.split('\n').filter(function (line) {
                return line.trim() !== 'a=extmap-allow-mixed';
              }).join('\n');
              // Safari enforces read-only-ness of RTCSessionDescription fields.
              if (window.RTCSessionDescription && desc instanceof window.RTCSessionDescription) {
                arguments[0] = new window.RTCSessionDescription({
                  type: desc.type,
                  sdp: sdp
                });
              } else {
                desc.sdp = sdp;
              }
            }
            return nativeSRD.apply(this, arguments);
          };
        }
        function shimAddIceCandidateNullOrEmpty(window, browserDetails) {
          // Support for addIceCandidate(null or undefined)
          // as well as addIceCandidate({candidate: "", ...})
          // https://bugs.chromium.org/p/chromium/issues/detail?id=978582
          // Note: must be called before other polyfills which change the signature.
          if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {
            return;
          }
          var nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;
          if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {
            return;
          }
          window.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {
            if (!arguments[0]) {
              if (arguments[1]) {
                arguments[1].apply(null);
              }
              return Promise.resolve();
            }
            // Firefox 68+ emits and processes {candidate: "", ...}, ignore
            // in older versions.
            // Native support for ignoring exists for Chrome M77+.
            // Safari ignores as well, exact version unknown but works in the same
            // version that also ignores addIceCandidate(null).
            if ((browserDetails.browser === 'chrome' && browserDetails.version < 78 || browserDetails.browser === 'firefox' && browserDetails.version < 68 || browserDetails.browser === 'safari') && arguments[0] && arguments[0].candidate === '') {
              return Promise.resolve();
            }
            return nativeAddIceCandidate.apply(this, arguments);
          };
        }

        // Note: Make sure to call this ahead of APIs that modify
        // setLocalDescription.length
        function shimParameterlessSetLocalDescription(window, browserDetails) {
          if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {
            return;
          }
          var nativeSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;
          if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {
            return;
          }
          window.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {
            var _this = this;
            var desc = arguments[0] || {};
            if (_typeof(desc) !== 'object' || desc.type && desc.sdp) {
              return nativeSetLocalDescription.apply(this, arguments);
            }
            // The remaining steps should technically happen when SLD comes off the
            // RTCPeerConnection's operations chain (not ahead of going on it), but
            // this is too difficult to shim. Instead, this shim only covers the
            // common case where the operations chain is empty. This is imperfect, but
            // should cover many cases. Rationale: Even if we can't reduce the glare
            // window to zero on imperfect implementations, there's value in tapping
            // into the perfect negotiation pattern that several browsers support.
            desc = {
              type: desc.type,
              sdp: desc.sdp
            };
            if (!desc.type) {
              switch (this.signalingState) {
                case 'stable':
                case 'have-local-offer':
                case 'have-remote-pranswer':
                  desc.type = 'offer';
                  break;
                default:
                  desc.type = 'answer';
                  break;
              }
            }
            if (desc.sdp || desc.type !== 'offer' && desc.type !== 'answer') {
              return nativeSetLocalDescription.apply(this, [desc]);
            }
            var func = desc.type === 'offer' ? this.createOffer : this.createAnswer;
            return func.apply(this).then(function (d) {
              return nativeSetLocalDescription.apply(_this, [d]);
            });
          };
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.removeExtmapAllowMixed;
        module.exports.shimAddIceCandidateNullOrEmpty;
        module.exports.shimConnectionState;
        module.exports.shimMaxMessageSize;
        module.exports.shimParameterlessSetLocalDescription;
        module.exports.shimRTCIceCandidate;
        module.exports.shimRTCIceCandidateRelayProtocol;
        module.exports.shimSendThrowTypeError;
      }, function () {
        return {
          'sdp': __cjsMetaURL$1,
          './utils': __cjsMetaURL$2
        };
      });
    }
  };
});

System.register("chunks:///_virtual/decode.js", ['./cjs-loader.mjs', './Decoder.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.decodeMulti = exports.decode = exports.defaultDecodeOptions = void 0;
        var Decoder_1 = require("./Decoder");
        exports.defaultDecodeOptions = {};
        /**
         * It decodes a single MessagePack object in a buffer.
         *
         * This is a synchronous decoding function.
         * See other variants for asynchronous decoding: {@link decodeAsync()}, {@link decodeStream()}, or {@link decodeArrayStream()}.
         *
         * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.
         * @throws {@link DecodeError} if the buffer contains invalid data.
         */
        function decode(buffer, options) {
          if (options === void 0) {
            options = exports.defaultDecodeOptions;
          }
          var decoder = new Decoder_1.Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
          return decoder.decode(buffer);
        }
        exports.decode = decode;
        /**
         * It decodes multiple MessagePack objects in a buffer.
         * This is corresponding to {@link decodeMultiStream()}.
         *
         * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.
         * @throws {@link DecodeError} if the buffer contains invalid data.
         */
        function decodeMulti(buffer, options) {
          if (options === void 0) {
            options = exports.defaultDecodeOptions;
          }
          var decoder = new Decoder_1.Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
          return decoder.decodeMulti(buffer);
        }
        exports.decodeMulti = decodeMulti;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.decodeMulti;
        module.exports.decode;
        module.exports.defaultDecodeOptions;
      }, function () {
        return {
          './Decoder': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/decodeAsync.js", ['./cjs-loader.mjs', './Decoder.js', './stream.js', './decode.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }],
    execute: function () {
      function _regeneratorRuntime() {
        /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime = function _regeneratorRuntime() {
          return e;
        };
        var t,
          e = {},
          r = Object.prototype,
          n = r.hasOwnProperty,
          o = Object.defineProperty || function (t, e, r) {
            t[e] = r.value;
          },
          i = "function" == typeof Symbol ? Symbol : {},
          a = i.iterator || "@@iterator",
          c = i.asyncIterator || "@@asyncIterator",
          u = i.toStringTag || "@@toStringTag";
        function define(t, e, r) {
          return Object.defineProperty(t, e, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }), t[e];
        }
        try {
          define({}, "");
        } catch (t) {
          define = function define(t, e, r) {
            return t[e] = r;
          };
        }
        function wrap(t, e, r, n) {
          var i = e && e.prototype instanceof Generator ? e : Generator,
            a = Object.create(i.prototype),
            c = new Context(n || []);
          return o(a, "_invoke", {
            value: makeInvokeMethod(t, r, c)
          }), a;
        }
        function tryCatch(t, e, r) {
          try {
            return {
              type: "normal",
              arg: t.call(e, r)
            };
          } catch (t) {
            return {
              type: "throw",
              arg: t
            };
          }
        }
        e.wrap = wrap;
        var h = "suspendedStart",
          l = "suspendedYield",
          f = "executing",
          s = "completed",
          y = {};
        function Generator() {}
        function GeneratorFunction() {}
        function GeneratorFunctionPrototype() {}
        var p = {};
        define(p, a, function () {
          return this;
        });
        var d = Object.getPrototypeOf,
          v = d && d(d(values([])));
        v && v !== r && n.call(v, a) && (p = v);
        var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);
        function defineIteratorMethods(t) {
          ["next", "throw", "return"].forEach(function (e) {
            define(t, e, function (t) {
              return this._invoke(e, t);
            });
          });
        }
        function AsyncIterator(t, e) {
          function invoke(r, o, i, a) {
            var c = tryCatch(t[r], t, o);
            if ("throw" !== c.type) {
              var u = c.arg,
                h = u.value;
              return h && "object" == typeof h && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) {
                invoke("next", t, i, a);
              }, function (t) {
                invoke("throw", t, i, a);
              }) : e.resolve(h).then(function (t) {
                u.value = t, i(u);
              }, function (t) {
                return invoke("throw", t, i, a);
              });
            }
            a(c.arg);
          }
          var r;
          o(this, "_invoke", {
            value: function value(t, n) {
              function callInvokeWithMethodAndArg() {
                return new e(function (e, r) {
                  invoke(t, n, e, r);
                });
              }
              return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
          });
        }
        function makeInvokeMethod(e, r, n) {
          var o = h;
          return function (i, a) {
            if (o === f) throw new Error("Generator is already running");
            if (o === s) {
              if ("throw" === i) throw a;
              return {
                value: t,
                done: !0
              };
            }
            for (n.method = i, n.arg = a;;) {
              var c = n.delegate;
              if (c) {
                var u = maybeInvokeDelegate(c, n);
                if (u) {
                  if (u === y) continue;
                  return u;
                }
              }
              if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) {
                if (o === h) throw o = s, n.arg;
                n.dispatchException(n.arg);
              } else "return" === n.method && n.abrupt("return", n.arg);
              o = f;
              var p = tryCatch(e, r, n);
              if ("normal" === p.type) {
                if (o = n.done ? s : l, p.arg === y) continue;
                return {
                  value: p.arg,
                  done: n.done
                };
              }
              "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg);
            }
          };
        }
        function maybeInvokeDelegate(e, r) {
          var n = r.method,
            o = e.iterator[n];
          if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y;
          var i = tryCatch(o, e.iterator, r.arg);
          if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y;
          var a = i.arg;
          return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y);
        }
        function pushTryEntry(t) {
          var e = {
            tryLoc: t[0]
          };
          1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
        }
        function resetTryEntry(t) {
          var e = t.completion || {};
          e.type = "normal", delete e.arg, t.completion = e;
        }
        function Context(t) {
          this.tryEntries = [{
            tryLoc: "root"
          }], t.forEach(pushTryEntry, this), this.reset(!0);
        }
        function values(e) {
          if (e || "" === e) {
            var r = e[a];
            if (r) return r.call(e);
            if ("function" == typeof e.next) return e;
            if (!isNaN(e.length)) {
              var o = -1,
                i = function next() {
                  for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;
                  return next.value = t, next.done = !0, next;
                };
              return i.next = i;
            }
          }
          throw new TypeError(typeof e + " is not iterable");
        }
        return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", {
          value: GeneratorFunctionPrototype,
          configurable: !0
        }), o(GeneratorFunctionPrototype, "constructor", {
          value: GeneratorFunction,
          configurable: !0
        }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
          var e = "function" == typeof t && t.constructor;
          return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name));
        }, e.mark = function (t) {
          return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t;
        }, e.awrap = function (t) {
          return {
            __await: t
          };
        }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {
          return this;
        }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {
          void 0 === i && (i = Promise);
          var a = new AsyncIterator(wrap(t, r, n, o), i);
          return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {
            return t.done ? t.value : a.next();
          });
        }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () {
          return this;
        }), define(g, "toString", function () {
          return "[object Generator]";
        }), e.keys = function (t) {
          var e = Object(t),
            r = [];
          for (var n in e) r.push(n);
          return r.reverse(), function next() {
            for (; r.length;) {
              var t = r.pop();
              if (t in e) return next.value = t, next.done = !1, next;
            }
            return next.done = !0, next;
          };
        }, e.values = values, Context.prototype = {
          constructor: Context,
          reset: function reset(e) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);
          },
          stop: function stop() {
            this.done = !0;
            var t = this.tryEntries[0].completion;
            if ("throw" === t.type) throw t.arg;
            return this.rval;
          },
          dispatchException: function dispatchException(e) {
            if (this.done) throw e;
            var r = this;
            function handle(n, o) {
              return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o;
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var i = this.tryEntries[o],
                a = i.completion;
              if ("root" === i.tryLoc) return handle("end");
              if (i.tryLoc <= this.prev) {
                var c = n.call(i, "catchLoc"),
                  u = n.call(i, "finallyLoc");
                if (c && u) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                } else if (c) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                } else {
                  if (!u) throw new Error("try statement without catch or finally");
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                }
              }
            }
          },
          abrupt: function abrupt(t, e) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var o = this.tryEntries[r];
              if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                var i = o;
                break;
              }
            }
            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
            var a = i ? i.completion : {};
            return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a);
          },
          complete: function complete(t, e) {
            if ("throw" === t.type) throw t.arg;
            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y;
          },
          finish: function finish(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;
            }
          },
          "catch": function _catch(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.tryLoc === t) {
                var n = r.completion;
                if ("throw" === n.type) {
                  var o = n.arg;
                  resetTryEntry(r);
                }
                return o;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function delegateYield(e, r, n) {
            return this.delegate = {
              iterator: values(e),
              resultName: r,
              nextLoc: n
            }, "next" === this.method && (this.arg = t), y;
          }
        }, e;
      }
      function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }
        if (info.done) {
          resolve(value);
        } else {
          Promise.resolve(value).then(_next, _throw);
        }
      }
      function _asyncToGenerator(fn) {
        return function () {
          var self = this,
            args = arguments;
          return new Promise(function (resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
          });
        };
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.decodeStream = exports.decodeMultiStream = exports.decodeArrayStream = exports.decodeAsync = void 0;
        var Decoder_1 = require("./Decoder");
        var stream_1 = require("./utils/stream");
        var decode_1 = require("./decode");
        /**
         * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.
         * @throws {@link DecodeError} if the buffer contains invalid data.
         */
        function decodeAsync(_x, _x2) {
          return _decodeAsync2.apply(this, arguments);
        }
        function _decodeAsync2() {
          _decodeAsync2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(streamLike, options) {
            var stream, decoder;
            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  if (options === void 0) {
                    options = decode_1.defaultDecodeOptions;
                  }
                  stream = (0, stream_1.ensureAsyncIterable)(streamLike);
                  decoder = new Decoder_1.Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
                  return _context.abrupt("return", decoder.decodeAsync(stream));
                case 4:
                case "end":
                  return _context.stop();
              }
            }, _callee);
          }));
          return _decodeAsync2.apply(this, arguments);
        }
        exports.decodeAsync = decodeAsync;
        /**
         * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.
         * @throws {@link DecodeError} if the buffer contains invalid data.
         */
        function decodeArrayStream(streamLike, options) {
          if (options === void 0) {
            options = decode_1.defaultDecodeOptions;
          }
          var stream = (0, stream_1.ensureAsyncIterable)(streamLike);
          var decoder = new Decoder_1.Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
          return decoder.decodeArrayStream(stream);
        }
        exports.decodeArrayStream = decodeArrayStream;
        /**
         * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.
         * @throws {@link DecodeError} if the buffer contains invalid data.
         */
        function decodeMultiStream(streamLike, options) {
          if (options === void 0) {
            options = decode_1.defaultDecodeOptions;
          }
          var stream = (0, stream_1.ensureAsyncIterable)(streamLike);
          var decoder = new Decoder_1.Decoder(options.extensionCodec, options.context, options.maxStrLength, options.maxBinLength, options.maxArrayLength, options.maxMapLength, options.maxExtLength);
          return decoder.decodeStream(stream);
        }
        exports.decodeMultiStream = decodeMultiStream;
        /**
         * @deprecated Use {@link decodeMultiStream()} instead.
         */
        function decodeStream(streamLike, options) {
          if (options === void 0) {
            options = decode_1.defaultDecodeOptions;
          }
          return decodeMultiStream(streamLike, options);
        }
        exports.decodeStream = decodeStream;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.decodeStream;
        module.exports.decodeMultiStream;
        module.exports.decodeArrayStream;
        module.exports.decodeAsync;
      }, function () {
        return {
          './Decoder': __cjsMetaURL$1,
          './utils/stream': __cjsMetaURL$2,
          './decode': __cjsMetaURL$3
        };
      });
    }
  };
});

System.register("chunks:///_virtual/DecodeError.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      function _assertThisInitialized(self) {
        if (self === void 0) {
          throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        }
        return self;
      }
      function _inheritsLoose(subClass, superClass) {
        subClass.prototype = Object.create(superClass.prototype);
        subClass.prototype.constructor = subClass;
        _setPrototypeOf(subClass, superClass);
      }
      function _wrapNativeSuper(Class) {
        var _cache = typeof Map === "function" ? new Map() : undefined;
        _wrapNativeSuper = function _wrapNativeSuper(Class) {
          if (Class === null || !_isNativeFunction(Class)) return Class;
          if (typeof Class !== "function") {
            throw new TypeError("Super expression must either be null or a function");
          }
          if (typeof _cache !== "undefined") {
            if (_cache.has(Class)) return _cache.get(Class);
            _cache.set(Class, Wrapper);
          }
          function Wrapper() {
            return _construct(Class, arguments, _getPrototypeOf(this).constructor);
          }
          Wrapper.prototype = Object.create(Class.prototype, {
            constructor: {
              value: Wrapper,
              enumerable: false,
              writable: true,
              configurable: true
            }
          });
          return _setPrototypeOf(Wrapper, Class);
        };
        return _wrapNativeSuper(Class);
      }
      function _construct(Parent, args, Class) {
        if (_isNativeReflectConstruct()) {
          _construct = Reflect.construct.bind();
        } else {
          _construct = function _construct(Parent, args, Class) {
            var a = [null];
            a.push.apply(a, args);
            var Constructor = Function.bind.apply(Parent, a);
            var instance = new Constructor();
            if (Class) _setPrototypeOf(instance, Class.prototype);
            return instance;
          };
        }
        return _construct.apply(null, arguments);
      }
      function _isNativeReflectConstruct() {
        if (typeof Reflect === "undefined" || !Reflect.construct) return false;
        if (Reflect.construct.sham) return false;
        if (typeof Proxy === "function") return true;
        try {
          Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
          return true;
        } catch (e) {
          return false;
        }
      }
      function _isNativeFunction(fn) {
        return Function.toString.call(fn).indexOf("[native code]") !== -1;
      }
      function _setPrototypeOf(o, p) {
        _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {
          o.__proto__ = p;
          return o;
        };
        return _setPrototypeOf(o, p);
      }
      function _getPrototypeOf(o) {
        _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {
          return o.__proto__ || Object.getPrototypeOf(o);
        };
        return _getPrototypeOf(o);
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.DecodeError = void 0;
        var DecodeError = /*#__PURE__*/function (_Error) {
          _inheritsLoose(DecodeError, _Error);
          function DecodeError(message) {
            var _this;
            _this = _Error.call(this, message) || this;
            // fix the prototype chain in a cross-platform way
            var proto = Object.create(DecodeError.prototype);
            Object.setPrototypeOf(_assertThisInitialized(_this), proto);
            Object.defineProperty(_assertThisInitialized(_this), "name", {
              configurable: true,
              enumerable: false,
              value: DecodeError.name
            });
            return _this;
          }
          return DecodeError;
        }( /*#__PURE__*/_wrapNativeSuper(Error));
        exports.DecodeError = DecodeError;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.DecodeError;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/Decoder.js", ['./cjs-loader.mjs', './prettyByte.js', './ExtensionCodec.js', './int.js', './utf8.js', './typedArrays.js', './CachedKeyDecoder.js', './DecodeError.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3, __cjsMetaURL$4, __cjsMetaURL$5, __cjsMetaURL$6, __cjsMetaURL$7;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$4 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$5 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$6 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$7 = module.__cjsMetaURL;
    }],
    execute: function () {
      function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }
        if (info.done) {
          resolve(value);
        } else {
          Promise.resolve(value).then(_next, _throw);
        }
      }
      function _asyncToGenerator(fn) {
        return function () {
          var self = this,
            args = arguments;
          return new Promise(function (resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
          });
        };
      }
      function _regeneratorRuntime() {
        /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime = function _regeneratorRuntime() {
          return e;
        };
        var t,
          e = {},
          r = Object.prototype,
          n = r.hasOwnProperty,
          o = Object.defineProperty || function (t, e, r) {
            t[e] = r.value;
          },
          i = "function" == typeof Symbol ? Symbol : {},
          a = i.iterator || "@@iterator",
          c = i.asyncIterator || "@@asyncIterator",
          u = i.toStringTag || "@@toStringTag";
        function define(t, e, r) {
          return Object.defineProperty(t, e, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }), t[e];
        }
        try {
          define({}, "");
        } catch (t) {
          define = function define(t, e, r) {
            return t[e] = r;
          };
        }
        function wrap(t, e, r, n) {
          var i = e && e.prototype instanceof Generator ? e : Generator,
            a = Object.create(i.prototype),
            c = new Context(n || []);
          return o(a, "_invoke", {
            value: makeInvokeMethod(t, r, c)
          }), a;
        }
        function tryCatch(t, e, r) {
          try {
            return {
              type: "normal",
              arg: t.call(e, r)
            };
          } catch (t) {
            return {
              type: "throw",
              arg: t
            };
          }
        }
        e.wrap = wrap;
        var h = "suspendedStart",
          l = "suspendedYield",
          f = "executing",
          s = "completed",
          y = {};
        function Generator() {}
        function GeneratorFunction() {}
        function GeneratorFunctionPrototype() {}
        var p = {};
        define(p, a, function () {
          return this;
        });
        var d = Object.getPrototypeOf,
          v = d && d(d(values([])));
        v && v !== r && n.call(v, a) && (p = v);
        var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);
        function defineIteratorMethods(t) {
          ["next", "throw", "return"].forEach(function (e) {
            define(t, e, function (t) {
              return this._invoke(e, t);
            });
          });
        }
        function AsyncIterator(t, e) {
          function invoke(r, o, i, a) {
            var c = tryCatch(t[r], t, o);
            if ("throw" !== c.type) {
              var u = c.arg,
                h = u.value;
              return h && "object" == typeof h && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) {
                invoke("next", t, i, a);
              }, function (t) {
                invoke("throw", t, i, a);
              }) : e.resolve(h).then(function (t) {
                u.value = t, i(u);
              }, function (t) {
                return invoke("throw", t, i, a);
              });
            }
            a(c.arg);
          }
          var r;
          o(this, "_invoke", {
            value: function value(t, n) {
              function callInvokeWithMethodAndArg() {
                return new e(function (e, r) {
                  invoke(t, n, e, r);
                });
              }
              return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
          });
        }
        function makeInvokeMethod(e, r, n) {
          var o = h;
          return function (i, a) {
            if (o === f) throw new Error("Generator is already running");
            if (o === s) {
              if ("throw" === i) throw a;
              return {
                value: t,
                done: !0
              };
            }
            for (n.method = i, n.arg = a;;) {
              var c = n.delegate;
              if (c) {
                var u = maybeInvokeDelegate(c, n);
                if (u) {
                  if (u === y) continue;
                  return u;
                }
              }
              if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) {
                if (o === h) throw o = s, n.arg;
                n.dispatchException(n.arg);
              } else "return" === n.method && n.abrupt("return", n.arg);
              o = f;
              var p = tryCatch(e, r, n);
              if ("normal" === p.type) {
                if (o = n.done ? s : l, p.arg === y) continue;
                return {
                  value: p.arg,
                  done: n.done
                };
              }
              "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg);
            }
          };
        }
        function maybeInvokeDelegate(e, r) {
          var n = r.method,
            o = e.iterator[n];
          if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y;
          var i = tryCatch(o, e.iterator, r.arg);
          if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y;
          var a = i.arg;
          return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y);
        }
        function pushTryEntry(t) {
          var e = {
            tryLoc: t[0]
          };
          1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
        }
        function resetTryEntry(t) {
          var e = t.completion || {};
          e.type = "normal", delete e.arg, t.completion = e;
        }
        function Context(t) {
          this.tryEntries = [{
            tryLoc: "root"
          }], t.forEach(pushTryEntry, this), this.reset(!0);
        }
        function values(e) {
          if (e || "" === e) {
            var r = e[a];
            if (r) return r.call(e);
            if ("function" == typeof e.next) return e;
            if (!isNaN(e.length)) {
              var o = -1,
                i = function next() {
                  for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;
                  return next.value = t, next.done = !0, next;
                };
              return i.next = i;
            }
          }
          throw new TypeError(typeof e + " is not iterable");
        }
        return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", {
          value: GeneratorFunctionPrototype,
          configurable: !0
        }), o(GeneratorFunctionPrototype, "constructor", {
          value: GeneratorFunction,
          configurable: !0
        }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
          var e = "function" == typeof t && t.constructor;
          return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name));
        }, e.mark = function (t) {
          return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t;
        }, e.awrap = function (t) {
          return {
            __await: t
          };
        }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {
          return this;
        }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {
          void 0 === i && (i = Promise);
          var a = new AsyncIterator(wrap(t, r, n, o), i);
          return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {
            return t.done ? t.value : a.next();
          });
        }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () {
          return this;
        }), define(g, "toString", function () {
          return "[object Generator]";
        }), e.keys = function (t) {
          var e = Object(t),
            r = [];
          for (var n in e) r.push(n);
          return r.reverse(), function next() {
            for (; r.length;) {
              var t = r.pop();
              if (t in e) return next.value = t, next.done = !1, next;
            }
            return next.done = !0, next;
          };
        }, e.values = values, Context.prototype = {
          constructor: Context,
          reset: function reset(e) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);
          },
          stop: function stop() {
            this.done = !0;
            var t = this.tryEntries[0].completion;
            if ("throw" === t.type) throw t.arg;
            return this.rval;
          },
          dispatchException: function dispatchException(e) {
            if (this.done) throw e;
            var r = this;
            function handle(n, o) {
              return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o;
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var i = this.tryEntries[o],
                a = i.completion;
              if ("root" === i.tryLoc) return handle("end");
              if (i.tryLoc <= this.prev) {
                var c = n.call(i, "catchLoc"),
                  u = n.call(i, "finallyLoc");
                if (c && u) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                } else if (c) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                } else {
                  if (!u) throw new Error("try statement without catch or finally");
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                }
              }
            }
          },
          abrupt: function abrupt(t, e) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var o = this.tryEntries[r];
              if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                var i = o;
                break;
              }
            }
            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
            var a = i ? i.completion : {};
            return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a);
          },
          complete: function complete(t, e) {
            if ("throw" === t.type) throw t.arg;
            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y;
          },
          finish: function finish(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;
            }
          },
          "catch": function _catch(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.tryLoc === t) {
                var n = r.completion;
                if ("throw" === n.type) {
                  var o = n.arg;
                  resetTryEntry(r);
                }
                return o;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function delegateYield(e, r, n) {
            return this.delegate = {
              iterator: values(e),
              resultName: r,
              nextLoc: n
            }, "next" === this.method && (this.arg = t), y;
          }
        }, e;
      }
      function _awaitAsyncGenerator(e) {
        return new _OverloadYield(e, 0);
      }
      function _wrapAsyncGenerator(fn) {
        return function () {
          return new _AsyncGenerator(fn.apply(this, arguments));
        };
      }
      function _AsyncGenerator(e) {
        var r, t;
        function resume(r, t) {
          try {
            var n = e[r](t),
              o = n.value,
              u = o instanceof _OverloadYield;
            Promise.resolve(u ? o.v : o).then(function (t) {
              if (u) {
                var i = "return" === r ? "return" : "next";
                if (!o.k || t.done) return resume(i, t);
                t = e[i](t).value;
              }
              settle(n.done ? "return" : "normal", t);
            }, function (e) {
              resume("throw", e);
            });
          } catch (e) {
            settle("throw", e);
          }
        }
        function settle(e, n) {
          switch (e) {
            case "return":
              r.resolve({
                value: n,
                done: !0
              });
              break;
            case "throw":
              r.reject(n);
              break;
            default:
              r.resolve({
                value: n,
                done: !1
              });
          }
          (r = r.next) ? resume(r.key, r.arg) : t = null;
        }
        this._invoke = function (e, n) {
          return new Promise(function (o, u) {
            var i = {
              key: e,
              arg: n,
              resolve: o,
              reject: u,
              next: null
            };
            t ? t = t.next = i : (r = t = i, resume(e, n));
          });
        }, "function" != typeof e["return"] && (this["return"] = void 0);
      }
      _AsyncGenerator.prototype["function" == typeof Symbol && Symbol.asyncIterator || "@@asyncIterator"] = function () {
        return this;
      }, _AsyncGenerator.prototype.next = function (e) {
        return this._invoke("next", e);
      }, _AsyncGenerator.prototype["throw"] = function (e) {
        return this._invoke("throw", e);
      }, _AsyncGenerator.prototype["return"] = function (e) {
        return this._invoke("return", e);
      };
      function _OverloadYield(t, e) {
        this.v = t, this.k = e;
      }
      function _asyncIterator(r) {
        var n,
          t,
          o,
          e = 2;
        for ("undefined" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) {
          if (t && null != (n = r[t])) return n.call(r);
          if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));
          t = "@@asyncIterator", o = "@@iterator";
        }
        throw new TypeError("Object is not async iterable");
      }
      function AsyncFromSyncIterator(r) {
        function AsyncFromSyncIteratorContinuation(r) {
          if (Object(r) !== r) return Promise.reject(new TypeError(r + " is not an object."));
          var n = r.done;
          return Promise.resolve(r.value).then(function (r) {
            return {
              value: r,
              done: n
            };
          });
        }
        return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) {
          this.s = r, this.n = r.next;
        }, AsyncFromSyncIterator.prototype = {
          s: null,
          n: null,
          next: function next() {
            return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));
          },
          "return": function _return(r) {
            var n = this.s["return"];
            return void 0 === n ? Promise.resolve({
              value: r,
              done: !0
            }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));
          },
          "throw": function _throw(r) {
            var n = this.s["return"];
            return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));
          }
        }, new AsyncFromSyncIterator(r);
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.Decoder = exports.DataViewIndexOutOfBoundsError = void 0;
        var prettyByte_1 = require("./utils/prettyByte");
        var ExtensionCodec_1 = require("./ExtensionCodec");
        var int_1 = require("./utils/int");
        var utf8_1 = require("./utils/utf8");
        var typedArrays_1 = require("./utils/typedArrays");
        var CachedKeyDecoder_1 = require("./CachedKeyDecoder");
        var DecodeError_1 = require("./DecodeError");
        var isValidMapKeyType = function isValidMapKeyType(key) {
          var keyType = typeof key;
          return keyType === "string" || keyType === "number";
        };
        var HEAD_BYTE_REQUIRED = -1;
        var EMPTY_VIEW = new DataView(new ArrayBuffer(0));
        var EMPTY_BYTES = new Uint8Array(EMPTY_VIEW.buffer);
        // IE11: Hack to support IE11.
        // IE11: Drop this hack and just use RangeError when IE11 is obsolete.
        exports.DataViewIndexOutOfBoundsError = function () {
          try {
            // IE11: The spec says it should throw RangeError,
            // IE11: but in IE11 it throws TypeError.
            EMPTY_VIEW.getInt8(0);
          } catch (e) {
            return e.constructor;
          }
          throw new Error("never reached");
        }();
        var MORE_DATA = new exports.DataViewIndexOutOfBoundsError("Insufficient data");
        var sharedCachedKeyDecoder = new CachedKeyDecoder_1.CachedKeyDecoder();
        var Decoder = /*#__PURE__*/function () {
          function Decoder(extensionCodec, context, maxStrLength, maxBinLength, maxArrayLength, maxMapLength, maxExtLength, keyDecoder) {
            if (extensionCodec === void 0) {
              extensionCodec = ExtensionCodec_1.ExtensionCodec.defaultCodec;
            }
            if (context === void 0) {
              context = undefined;
            }
            if (maxStrLength === void 0) {
              maxStrLength = int_1.UINT32_MAX;
            }
            if (maxBinLength === void 0) {
              maxBinLength = int_1.UINT32_MAX;
            }
            if (maxArrayLength === void 0) {
              maxArrayLength = int_1.UINT32_MAX;
            }
            if (maxMapLength === void 0) {
              maxMapLength = int_1.UINT32_MAX;
            }
            if (maxExtLength === void 0) {
              maxExtLength = int_1.UINT32_MAX;
            }
            if (keyDecoder === void 0) {
              keyDecoder = sharedCachedKeyDecoder;
            }
            this.extensionCodec = extensionCodec;
            this.context = context;
            this.maxStrLength = maxStrLength;
            this.maxBinLength = maxBinLength;
            this.maxArrayLength = maxArrayLength;
            this.maxMapLength = maxMapLength;
            this.maxExtLength = maxExtLength;
            this.keyDecoder = keyDecoder;
            this.totalPos = 0;
            this.pos = 0;
            this.view = EMPTY_VIEW;
            this.bytes = EMPTY_BYTES;
            this.headByte = HEAD_BYTE_REQUIRED;
            this.stack = [];
          }
          var _proto = Decoder.prototype;
          _proto.reinitializeState = function reinitializeState() {
            this.totalPos = 0;
            this.headByte = HEAD_BYTE_REQUIRED;
            this.stack.length = 0;
            // view, bytes, and pos will be re-initialized in setBuffer()
          };

          _proto.setBuffer = function setBuffer(buffer) {
            this.bytes = (0, typedArrays_1.ensureUint8Array)(buffer);
            this.view = (0, typedArrays_1.createDataView)(this.bytes);
            this.pos = 0;
          };
          _proto.appendBuffer = function appendBuffer(buffer) {
            if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining(1)) {
              this.setBuffer(buffer);
            } else {
              var remainingData = this.bytes.subarray(this.pos);
              var newData = (0, typedArrays_1.ensureUint8Array)(buffer);
              // concat remainingData + newData
              var newBuffer = new Uint8Array(remainingData.length + newData.length);
              newBuffer.set(remainingData);
              newBuffer.set(newData, remainingData.length);
              this.setBuffer(newBuffer);
            }
          };
          _proto.hasRemaining = function hasRemaining(size) {
            return this.view.byteLength - this.pos >= size;
          };
          _proto.createExtraByteError = function createExtraByteError(posToShow) {
            var view = this.view,
              pos = this.pos;
            return new RangeError("Extra " + (view.byteLength - pos) + " of " + view.byteLength + " byte(s) found at buffer[" + posToShow + "]");
          }
          /**
           * @throws {@link DecodeError}
           * @throws {@link RangeError}
           */;
          _proto.decode = function decode(buffer) {
            this.reinitializeState();
            this.setBuffer(buffer);
            var object = this.doDecodeSync();
            if (this.hasRemaining(1)) {
              throw this.createExtraByteError(this.pos);
            }
            return object;
          };
          _proto.decodeMulti = /*#__PURE__*/_regeneratorRuntime().mark(function decodeMulti(buffer) {
            return _regeneratorRuntime().wrap(function decodeMulti$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  this.reinitializeState();
                  this.setBuffer(buffer);
                case 2:
                  if (!this.hasRemaining(1)) {
                    _context.next = 7;
                    break;
                  }
                  _context.next = 5;
                  return this.doDecodeSync();
                case 5:
                  _context.next = 2;
                  break;
                case 7:
                case "end":
                  return _context.stop();
              }
            }, decodeMulti, this);
          });
          _proto.decodeAsync = /*#__PURE__*/function () {
            var _decodeAsync = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(stream) {
              var decoded, object, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, buffer, headByte, pos, totalPos;
              return _regeneratorRuntime().wrap(function _callee$(_context2) {
                while (1) switch (_context2.prev = _context2.next) {
                  case 0:
                    decoded = false;
                    _iteratorAbruptCompletion = false;
                    _didIteratorError = false;
                    _context2.prev = 3;
                    _iterator = _asyncIterator(stream);
                  case 5:
                    _context2.next = 7;
                    return _iterator.next();
                  case 7:
                    if (!(_iteratorAbruptCompletion = !(_step = _context2.sent).done)) {
                      _context2.next = 25;
                      break;
                    }
                    buffer = _step.value;
                    if (!decoded) {
                      _context2.next = 11;
                      break;
                    }
                    throw this.createExtraByteError(this.totalPos);
                  case 11:
                    this.appendBuffer(buffer);
                    _context2.prev = 12;
                    object = this.doDecodeSync();
                    decoded = true;
                    _context2.next = 21;
                    break;
                  case 17:
                    _context2.prev = 17;
                    _context2.t0 = _context2["catch"](12);
                    if (_context2.t0 instanceof exports.DataViewIndexOutOfBoundsError) {
                      _context2.next = 21;
                      break;
                    }
                    throw _context2.t0;
                  case 21:
                    this.totalPos += this.pos;
                  case 22:
                    _iteratorAbruptCompletion = false;
                    _context2.next = 5;
                    break;
                  case 25:
                    _context2.next = 31;
                    break;
                  case 27:
                    _context2.prev = 27;
                    _context2.t1 = _context2["catch"](3);
                    _didIteratorError = true;
                    _iteratorError = _context2.t1;
                  case 31:
                    _context2.prev = 31;
                    _context2.prev = 32;
                    if (!(_iteratorAbruptCompletion && _iterator["return"] != null)) {
                      _context2.next = 36;
                      break;
                    }
                    _context2.next = 36;
                    return _iterator["return"]();
                  case 36:
                    _context2.prev = 36;
                    if (!_didIteratorError) {
                      _context2.next = 39;
                      break;
                    }
                    throw _iteratorError;
                  case 39:
                    return _context2.finish(36);
                  case 40:
                    return _context2.finish(31);
                  case 41:
                    if (!decoded) {
                      _context2.next = 45;
                      break;
                    }
                    if (!this.hasRemaining(1)) {
                      _context2.next = 44;
                      break;
                    }
                    throw this.createExtraByteError(this.totalPos);
                  case 44:
                    return _context2.abrupt("return", object);
                  case 45:
                    headByte = this.headByte, pos = this.pos, totalPos = this.totalPos;
                    throw new RangeError("Insufficient data in parsing " + (0, prettyByte_1.prettyByte)(headByte) + " at " + totalPos + " (" + pos + " in the current buffer)");
                  case 47:
                  case "end":
                    return _context2.stop();
                }
              }, _callee, this, [[3, 27, 31, 41], [12, 17], [32,, 36, 40]]);
            }));
            function decodeAsync(_x) {
              return _decodeAsync.apply(this, arguments);
            }
            return decodeAsync;
          }();
          _proto.decodeArrayStream = function decodeArrayStream(stream) {
            return this.decodeMultiAsync(stream, true);
          };
          _proto.decodeStream = function decodeStream(stream) {
            return this.decodeMultiAsync(stream, false);
          };
          _proto.decodeMultiAsync = function decodeMultiAsync(stream, isArray) {
            var _this = this;
            return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
              var isArrayHeaderRequired, arrayItemsLeft, _iteratorAbruptCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, buffer;
              return _regeneratorRuntime().wrap(function _callee2$(_context3) {
                while (1) switch (_context3.prev = _context3.next) {
                  case 0:
                    isArrayHeaderRequired = isArray;
                    arrayItemsLeft = -1;
                    _iteratorAbruptCompletion2 = false;
                    _didIteratorError2 = false;
                    _context3.prev = 4;
                    _iterator2 = _asyncIterator(stream);
                  case 6:
                    _context3.next = 8;
                    return _awaitAsyncGenerator(_iterator2.next());
                  case 8:
                    if (!(_iteratorAbruptCompletion2 = !(_step2 = _context3.sent).done)) {
                      _context3.next = 32;
                      break;
                    }
                    buffer = _step2.value;
                    if (!(isArray && arrayItemsLeft === 0)) {
                      _context3.next = 12;
                      break;
                    }
                    throw _this.createExtraByteError(_this.totalPos);
                  case 12:
                    _this.appendBuffer(buffer);
                    if (isArrayHeaderRequired) {
                      arrayItemsLeft = _this.readArraySize();
                      isArrayHeaderRequired = false;
                      _this.complete();
                    }
                    _context3.prev = 14;
                  case 15:
                    _context3.next = 18;
                    return _this.doDecodeSync();
                  case 18:
                    if (!(--arrayItemsLeft === 0)) {
                      _context3.next = 20;
                      break;
                    }
                    return _context3.abrupt("break", 22);
                  case 20:
                    _context3.next = 15;
                    break;
                  case 22:
                    _context3.next = 28;
                    break;
                  case 24:
                    _context3.prev = 24;
                    _context3.t0 = _context3["catch"](14);
                    if (_context3.t0 instanceof exports.DataViewIndexOutOfBoundsError) {
                      _context3.next = 28;
                      break;
                    }
                    throw _context3.t0;
                  case 28:
                    _this.totalPos += _this.pos;
                  case 29:
                    _iteratorAbruptCompletion2 = false;
                    _context3.next = 6;
                    break;
                  case 32:
                    _context3.next = 38;
                    break;
                  case 34:
                    _context3.prev = 34;
                    _context3.t1 = _context3["catch"](4);
                    _didIteratorError2 = true;
                    _iteratorError2 = _context3.t1;
                  case 38:
                    _context3.prev = 38;
                    _context3.prev = 39;
                    if (!(_iteratorAbruptCompletion2 && _iterator2["return"] != null)) {
                      _context3.next = 43;
                      break;
                    }
                    _context3.next = 43;
                    return _awaitAsyncGenerator(_iterator2["return"]());
                  case 43:
                    _context3.prev = 43;
                    if (!_didIteratorError2) {
                      _context3.next = 46;
                      break;
                    }
                    throw _iteratorError2;
                  case 46:
                    return _context3.finish(43);
                  case 47:
                    return _context3.finish(38);
                  case 48:
                  case "end":
                    return _context3.stop();
                }
              }, _callee2, null, [[4, 34, 38, 48], [14, 24], [39,, 43, 47]]);
            }))();
          };
          _proto.doDecodeSync = function doDecodeSync() {
            DECODE: while (true) {
              var headByte = this.readHeadByte();
              var object = void 0;
              if (headByte >= 0xe0) {
                // negative fixint (111x xxxx) 0xe0 - 0xff
                object = headByte - 0x100;
              } else if (headByte < 0xc0) {
                if (headByte < 0x80) {
                  // positive fixint (0xxx xxxx) 0x00 - 0x7f
                  object = headByte;
                } else if (headByte < 0x90) {
                  // fixmap (1000 xxxx) 0x80 - 0x8f
                  var size = headByte - 0x80;
                  if (size !== 0) {
                    this.pushMapState(size);
                    this.complete();
                    continue DECODE;
                  } else {
                    object = {};
                  }
                } else if (headByte < 0xa0) {
                  // fixarray (1001 xxxx) 0x90 - 0x9f
                  var _size = headByte - 0x90;
                  if (_size !== 0) {
                    this.pushArrayState(_size);
                    this.complete();
                    continue DECODE;
                  } else {
                    object = [];
                  }
                } else {
                  // fixstr (101x xxxx) 0xa0 - 0xbf
                  var byteLength = headByte - 0xa0;
                  object = this.decodeUtf8String(byteLength, 0);
                }
              } else if (headByte === 0xc0) {
                // nil
                object = null;
              } else if (headByte === 0xc2) {
                // false
                object = false;
              } else if (headByte === 0xc3) {
                // true
                object = true;
              } else if (headByte === 0xca) {
                // float 32
                object = this.readF32();
              } else if (headByte === 0xcb) {
                // float 64
                object = this.readF64();
              } else if (headByte === 0xcc) {
                // uint 8
                object = this.readU8();
              } else if (headByte === 0xcd) {
                // uint 16
                object = this.readU16();
              } else if (headByte === 0xce) {
                // uint 32
                object = this.readU32();
              } else if (headByte === 0xcf) {
                // uint 64
                object = this.readU64();
              } else if (headByte === 0xd0) {
                // int 8
                object = this.readI8();
              } else if (headByte === 0xd1) {
                // int 16
                object = this.readI16();
              } else if (headByte === 0xd2) {
                // int 32
                object = this.readI32();
              } else if (headByte === 0xd3) {
                // int 64
                object = this.readI64();
              } else if (headByte === 0xd9) {
                // str 8
                var _byteLength = this.lookU8();
                object = this.decodeUtf8String(_byteLength, 1);
              } else if (headByte === 0xda) {
                // str 16
                var _byteLength2 = this.lookU16();
                object = this.decodeUtf8String(_byteLength2, 2);
              } else if (headByte === 0xdb) {
                // str 32
                var _byteLength3 = this.lookU32();
                object = this.decodeUtf8String(_byteLength3, 4);
              } else if (headByte === 0xdc) {
                // array 16
                var _size2 = this.readU16();
                if (_size2 !== 0) {
                  this.pushArrayState(_size2);
                  this.complete();
                  continue DECODE;
                } else {
                  object = [];
                }
              } else if (headByte === 0xdd) {
                // array 32
                var _size3 = this.readU32();
                if (_size3 !== 0) {
                  this.pushArrayState(_size3);
                  this.complete();
                  continue DECODE;
                } else {
                  object = [];
                }
              } else if (headByte === 0xde) {
                // map 16
                var _size4 = this.readU16();
                if (_size4 !== 0) {
                  this.pushMapState(_size4);
                  this.complete();
                  continue DECODE;
                } else {
                  object = {};
                }
              } else if (headByte === 0xdf) {
                // map 32
                var _size5 = this.readU32();
                if (_size5 !== 0) {
                  this.pushMapState(_size5);
                  this.complete();
                  continue DECODE;
                } else {
                  object = {};
                }
              } else if (headByte === 0xc4) {
                // bin 8
                var _size6 = this.lookU8();
                object = this.decodeBinary(_size6, 1);
              } else if (headByte === 0xc5) {
                // bin 16
                var _size7 = this.lookU16();
                object = this.decodeBinary(_size7, 2);
              } else if (headByte === 0xc6) {
                // bin 32
                var _size8 = this.lookU32();
                object = this.decodeBinary(_size8, 4);
              } else if (headByte === 0xd4) {
                // fixext 1
                object = this.decodeExtension(1, 0);
              } else if (headByte === 0xd5) {
                // fixext 2
                object = this.decodeExtension(2, 0);
              } else if (headByte === 0xd6) {
                // fixext 4
                object = this.decodeExtension(4, 0);
              } else if (headByte === 0xd7) {
                // fixext 8
                object = this.decodeExtension(8, 0);
              } else if (headByte === 0xd8) {
                // fixext 16
                object = this.decodeExtension(16, 0);
              } else if (headByte === 0xc7) {
                // ext 8
                var _size9 = this.lookU8();
                object = this.decodeExtension(_size9, 1);
              } else if (headByte === 0xc8) {
                // ext 16
                var _size10 = this.lookU16();
                object = this.decodeExtension(_size10, 2);
              } else if (headByte === 0xc9) {
                // ext 32
                var _size11 = this.lookU32();
                object = this.decodeExtension(_size11, 4);
              } else {
                throw new DecodeError_1.DecodeError("Unrecognized type byte: " + (0, prettyByte_1.prettyByte)(headByte));
              }
              this.complete();
              var stack = this.stack;
              while (stack.length > 0) {
                // arrays and maps
                var state = stack[stack.length - 1];
                if (state.type === 0 /* State.ARRAY */) {
                  state.array[state.position] = object;
                  state.position++;
                  if (state.position === state.size) {
                    stack.pop();
                    object = state.array;
                  } else {
                    continue DECODE;
                  }
                } else if (state.type === 1 /* State.MAP_KEY */) {
                  if (!isValidMapKeyType(object)) {
                    throw new DecodeError_1.DecodeError("The type of key must be string or number but " + typeof object);
                  }
                  if (object === "__proto__") {
                    throw new DecodeError_1.DecodeError("The key __proto__ is not allowed");
                  }
                  state.key = object;
                  state.type = 2 /* State.MAP_VALUE */;
                  continue DECODE;
                } else {
                  // it must be `state.type === State.MAP_VALUE` here
                  state.map[state.key] = object;
                  state.readCount++;
                  if (state.readCount === state.size) {
                    stack.pop();
                    object = state.map;
                  } else {
                    state.key = null;
                    state.type = 1 /* State.MAP_KEY */;
                    continue DECODE;
                  }
                }
              }
              return object;
            }
          };
          _proto.readHeadByte = function readHeadByte() {
            if (this.headByte === HEAD_BYTE_REQUIRED) {
              this.headByte = this.readU8();
              // console.log("headByte", prettyByte(this.headByte));
            }

            return this.headByte;
          };
          _proto.complete = function complete() {
            this.headByte = HEAD_BYTE_REQUIRED;
          };
          _proto.readArraySize = function readArraySize() {
            var headByte = this.readHeadByte();
            switch (headByte) {
              case 0xdc:
                return this.readU16();
              case 0xdd:
                return this.readU32();
              default:
                {
                  if (headByte < 0xa0) {
                    return headByte - 0x90;
                  } else {
                    throw new DecodeError_1.DecodeError("Unrecognized array type byte: " + (0, prettyByte_1.prettyByte)(headByte));
                  }
                }
            }
          };
          _proto.pushMapState = function pushMapState(size) {
            if (size > this.maxMapLength) {
              throw new DecodeError_1.DecodeError("Max length exceeded: map length (" + size + ") > maxMapLengthLength (" + this.maxMapLength + ")");
            }
            this.stack.push({
              type: 1 /* State.MAP_KEY */,
              size: size,
              key: null,
              readCount: 0,
              map: {}
            });
          };
          _proto.pushArrayState = function pushArrayState(size) {
            if (size > this.maxArrayLength) {
              throw new DecodeError_1.DecodeError("Max length exceeded: array length (" + size + ") > maxArrayLength (" + this.maxArrayLength + ")");
            }
            this.stack.push({
              type: 0 /* State.ARRAY */,
              size: size,
              array: new Array(size),
              position: 0
            });
          };
          _proto.decodeUtf8String = function decodeUtf8String(byteLength, headerOffset) {
            var _a;
            if (byteLength > this.maxStrLength) {
              throw new DecodeError_1.DecodeError("Max length exceeded: UTF-8 byte length (" + byteLength + ") > maxStrLength (" + this.maxStrLength + ")");
            }
            if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {
              throw MORE_DATA;
            }
            var offset = this.pos + headerOffset;
            var object;
            if (this.stateIsMapKey() && ((_a = this.keyDecoder) === null || _a === void 0 ? void 0 : _a.canBeCached(byteLength))) {
              object = this.keyDecoder.decode(this.bytes, offset, byteLength);
            } else if (byteLength > utf8_1.TEXT_DECODER_THRESHOLD) {
              object = (0, utf8_1.utf8DecodeTD)(this.bytes, offset, byteLength);
            } else {
              object = (0, utf8_1.utf8DecodeJs)(this.bytes, offset, byteLength);
            }
            this.pos += headerOffset + byteLength;
            return object;
          };
          _proto.stateIsMapKey = function stateIsMapKey() {
            if (this.stack.length > 0) {
              var state = this.stack[this.stack.length - 1];
              return state.type === 1 /* State.MAP_KEY */;
            }

            return false;
          };
          _proto.decodeBinary = function decodeBinary(byteLength, headOffset) {
            if (byteLength > this.maxBinLength) {
              throw new DecodeError_1.DecodeError("Max length exceeded: bin length (" + byteLength + ") > maxBinLength (" + this.maxBinLength + ")");
            }
            if (!this.hasRemaining(byteLength + headOffset)) {
              throw MORE_DATA;
            }
            var offset = this.pos + headOffset;
            var object = this.bytes.subarray(offset, offset + byteLength);
            this.pos += headOffset + byteLength;
            return object;
          };
          _proto.decodeExtension = function decodeExtension(size, headOffset) {
            if (size > this.maxExtLength) {
              throw new DecodeError_1.DecodeError("Max length exceeded: ext length (" + size + ") > maxExtLength (" + this.maxExtLength + ")");
            }
            var extType = this.view.getInt8(this.pos + headOffset);
            var data = this.decodeBinary(size, headOffset + 1 /* extType */);
            return this.extensionCodec.decode(data, extType, this.context);
          };
          _proto.lookU8 = function lookU8() {
            return this.view.getUint8(this.pos);
          };
          _proto.lookU16 = function lookU16() {
            return this.view.getUint16(this.pos);
          };
          _proto.lookU32 = function lookU32() {
            return this.view.getUint32(this.pos);
          };
          _proto.readU8 = function readU8() {
            var value = this.view.getUint8(this.pos);
            this.pos++;
            return value;
          };
          _proto.readI8 = function readI8() {
            var value = this.view.getInt8(this.pos);
            this.pos++;
            return value;
          };
          _proto.readU16 = function readU16() {
            var value = this.view.getUint16(this.pos);
            this.pos += 2;
            return value;
          };
          _proto.readI16 = function readI16() {
            var value = this.view.getInt16(this.pos);
            this.pos += 2;
            return value;
          };
          _proto.readU32 = function readU32() {
            var value = this.view.getUint32(this.pos);
            this.pos += 4;
            return value;
          };
          _proto.readI32 = function readI32() {
            var value = this.view.getInt32(this.pos);
            this.pos += 4;
            return value;
          };
          _proto.readU64 = function readU64() {
            var value = (0, int_1.getUint64)(this.view, this.pos);
            this.pos += 8;
            return value;
          };
          _proto.readI64 = function readI64() {
            var value = (0, int_1.getInt64)(this.view, this.pos);
            this.pos += 8;
            return value;
          };
          _proto.readF32 = function readF32() {
            var value = this.view.getFloat32(this.pos);
            this.pos += 4;
            return value;
          };
          _proto.readF64 = function readF64() {
            var value = this.view.getFloat64(this.pos);
            this.pos += 8;
            return value;
          };
          return Decoder;
        }();
        exports.Decoder = Decoder;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.Decoder;
        module.exports.DataViewIndexOutOfBoundsError;
      }, function () {
        return {
          './utils/prettyByte': __cjsMetaURL$1,
          './ExtensionCodec': __cjsMetaURL$2,
          './utils/int': __cjsMetaURL$3,
          './utils/utf8': __cjsMetaURL$4,
          './utils/typedArrays': __cjsMetaURL$5,
          './CachedKeyDecoder': __cjsMetaURL$6,
          './DecodeError': __cjsMetaURL$7
        };
      });
    }
  };
});

System.register("chunks:///_virtual/drongo-cc.mjs", ['./rollupPluginModLoBabelHelpers.js', 'cc', './env'], function (exports) {
  var _inheritsLoose, _regeneratorRuntime, _createForOfIteratorHelperLoose, _construct, _assertThisInitialized, _createClass, _decorator, size, Layout, EventTarget, Node, Asset, sys, error$1, Scheduler, director, cc, debug, log$1, warn$1, game, js, Game, Director, assetManager, dragonBones, sp, Animation, TweenSystem, SpriteFrame, Texture2D, resources, dynamicAtlasManager, NodePool, EDITOR;
  return {
    setters: [function (module) {
      _inheritsLoose = module.inheritsLoose;
      _regeneratorRuntime = module.regeneratorRuntime;
      _createForOfIteratorHelperLoose = module.createForOfIteratorHelperLoose;
      _construct = module.construct;
      _assertThisInitialized = module.assertThisInitialized;
      _createClass = module.createClass;
    }, function (module) {
      _decorator = module._decorator;
      size = module.size;
      Layout = module.Layout;
      EventTarget = module.EventTarget;
      Node = module.Node;
      Asset = module.Asset;
      sys = module.sys;
      error$1 = module.error;
      Scheduler = module.Scheduler;
      director = module.director;
      cc = module;
      debug = module.debug;
      log$1 = module.log;
      warn$1 = module.warn;
      game = module.game;
      js = module.js;
      Game = module.Game;
      Director = module.Director;
      assetManager = module.assetManager;
      dragonBones = module.dragonBones;
      sp = module.sp;
      Animation = module.Animation;
      TweenSystem = module.TweenSystem;
      SpriteFrame = module.SpriteFrame;
      Texture2D = module.Texture2D;
      resources = module.resources;
      dynamicAtlasManager = module.dynamicAtlasManager;
      NodePool = module.NodePool;
    }, function (module) {
      EDITOR = module.EDITOR;
    }],
    execute: function () {
      exports({
        Key: Key,
        autoBindToWindow: autoBindToWindow
      });

      /**  */
      var mk_instance_base = exports('instance_base', /*#__PURE__*/function () {
        function mk_instance_base() {}
        /**  */
        mk_instance_base.instance = function instance() {
          var self = this;
          if (!self._instance) {
            for (var _len = arguments.length, args_as_ = new Array(_len), _key = 0; _key < _len; _key++) {
              args_as_[_key] = arguments[_key];
            }
            self._instance = _construct(self, args_as_);
          }
          return self._instance;
        };
        return mk_instance_base;
      }());
      /**
       * ticker
       */
      var TickerManagerImpl = /*#__PURE__*/function (_mk_instance_base) {
        _inheritsLoose(TickerManagerImpl, _mk_instance_base);
        function TickerManagerImpl() {
          var _this;
          _this = _mk_instance_base.call(this) || this;
          //
          _this.__tickerManager = new TickManagerComponent();
          Scheduler.enableForTarget(_this.__tickerManager);
          director.getScheduler().scheduleUpdate(_this.__tickerManager, 0, false);
          return _this;
        }
        /**
         * 
         * @param value
         */
        var _proto = TickerManagerImpl.prototype;
        _proto.addTicker = function addTicker(value) {
          this.__tickerManager.addTicker(value);
        }
        /**
         * 
         * @param value
         */;
        _proto.removeTicker = function removeTicker(value) {
          this.__tickerManager.removeTicker(value);
        }
        /**
         * 
         * @param value
         * @param caller
         */;
        _proto.callNextFrame = function callNextFrame(value, caller) {
          this.__tickerManager.callNextFrame(value, caller);
        }
        /**
         * ()
         * @param value
         * @param caller
         */;
        _proto.clearNextFrame = function clearNextFrame(value, caller) {
          this.__tickerManager.clearNextFrame(value, caller);
        };
        return TickerManagerImpl;
      }(mk_instance_base);
      var TickManagerComponent = /*#__PURE__*/function () {
        function TickManagerComponent() {
          this.__tickerList = [];
          this.__nextFrameCallBacks = [];
        }
        var _proto2 = TickManagerComponent.prototype;
        _proto2.update = function update(dt) {
          var handler;
          while (this.__nextFrameCallBacks.length) {
            handler = this.__nextFrameCallBacks.shift();
            handler.callBack.apply(handler.caller);
          }
          for (var index = 0; index < this.__tickerList.length; index++) {
            var element = this.__tickerList[index];
            element.tick(dt);
          }
        };
        _proto2.addTicker = function addTicker(value) {
          var index = this.__tickerList.indexOf(value);
          if (index >= 0) {
            throw new Error("Ticker ");
          }
          this.__tickerList.push(value);
        };
        _proto2.removeTicker = function removeTicker(value) {
          var index = this.__tickerList.indexOf(value);
          if (index < 0) {
            throw new Error("Tick");
          }
          this.__tickerList.splice(index, 1);
        };
        _proto2.callNextFrame = function callNextFrame(value, caller) {
          for (var index = 0; index < this.__nextFrameCallBacks.length; index++) {
            var element = this.__nextFrameCallBacks[index];
            //
            if (element.equal(value, caller)) {
              return;
            }
          }
          this.__nextFrameCallBacks.push(new NextFrameHandler(value, caller));
        };
        _proto2.clearNextFrame = function clearNextFrame(value, caller) {
          for (var index = 0; index < this.__nextFrameCallBacks.length; index++) {
            var element = this.__nextFrameCallBacks[index];
            //
            if (element.equal(value, caller)) {
              this.__nextFrameCallBacks.splice(index, 1);
            }
          }
        };
        return TickManagerComponent;
      }();
      var NextFrameHandler = /*#__PURE__*/function () {
        function NextFrameHandler(callBack, caller) {
          this.callBack = callBack;
          this.caller = caller;
        }
        var _proto3 = NextFrameHandler.prototype;
        _proto3.equal = function equal(callBack, caller) {
          if (this.caller !== caller) {
            return false;
          }
          if (this.callBack !== callBack) {
            return false;
          }
          return true;
        };
        return NextFrameHandler;
      }();
      var TickerManager = exports('TickerManager', TickerManagerImpl.instance());
      var TimerImpl = /*#__PURE__*/function (_mk_instance_base2) {
        _inheritsLoose(TimerImpl, _mk_instance_base2);
        function TimerImpl() {
          var _this2;
          _this2 = _mk_instance_base2.call(this) || this;
          _this2.__lastTime = 0;
          _this2.reset();
          TickerManager.addTicker(_assertThisInitialized(_this2));
          return _this2;
        }
        /**
         * 
         * @param time  
         */
        var _proto4 = TimerImpl.prototype;
        _proto4.reset = function reset() {
          //
          this.__lastTime = Date.now() / 1000;
        };
        _proto4.tick = function tick(dt) {
          this.__lastTime += dt;
        }
        /**
         * ()
         */;
        _createClass(TimerImpl, [{
          key: "currentTime",
          get: function get() {
            return this.__lastTime;
          }
          /**
           * ()
           */
        }, {
          key: "absTime",
          get: function get() {
            this.reset();
            return this.currentTime;
          }
        }]);
        return TimerImpl;
      }(mk_instance_base);
      var Timer = exports('Timer', TimerImpl.instance());

      /**window  */
      function autoBindToWindow(constructor) {
        var className = constructor.name;
        self[className] = constructor;
      }
      var __decorate = function (decorators, target, key, desc) {
        var c = arguments.length,
          r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
          d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
      };
      var ccclass = _decorator.ccclass,
        property = _decorator.property;
      var util = exports('util', /*#__PURE__*/function () {
        function util() {}
        /**
         * 
         * @param {any} sObj 
         * @returns
         */
        util.clone = function clone(sObj) {
          if (sObj === null || typeof sObj !== "object") {
            return sObj;
          }
          var s = {};
          if (sObj.constructor === Array) {
            s = [];
          }
          for (var i in sObj) {
            if (sObj.hasOwnProperty(i)) {
              s[i] = this.clone(sObj[i]);
            }
          }
          return s;
        }
        /**
         * object
         * @param { any} srcObj
         * @returns
         */;
        util.objectToArray = function objectToArray(srcObj) {
          var resultArr = [];
          // to array
          for (var _key2 in srcObj) {
            if (!srcObj.hasOwnProperty(_key2)) {
              continue;
            }
            resultArr.push(srcObj[_key2]);
          }
          return resultArr;
        }
        /**
         * !#zh object
         */
        /**
         * object
         * @param { any} srcObj
         * @param { string} objectKey
         * @returns
         */;
        util.arrayToObject = function arrayToObject(srcObj, objectKey) {
          var resultObj = {};
          // to object
          for (var _key3 in srcObj) {
            if (!srcObj.hasOwnProperty(_key3) || !srcObj[_key3][objectKey]) {
              continue;
            }
            resultObj[srcObj[_key3][objectKey]] = srcObj[_key3];
          }
          return resultObj;
        }
        /**
         * ,
         * @param {arrany} weightArr
         * @param {number} totalWeight 
         * @returns
         */;
        util.getWeightRandIndex = function getWeightRandIndex(weightArr, totalWeight) {
          var randWeight = Math.floor(Math.random() * totalWeight);
          var sum = 0;
          var weightIndex = 0;
          for (weightIndex = 0; weightIndex < weightArr.length; weightIndex++) {
            sum += weightArr[weightIndex];
            if (randWeight < sum) {
              break;
            }
          }
          return weightIndex;
        }
        /**
         * nm
         * @param {Number} n   
         * @param {Number} m    
         * @returns {Array} array   
         */;
        util.getRandomNFromM = function getRandomNFromM(n, m) {
          var array = [];
          var intRd = 0;
          var count = 0;
          while (count < m) {
            if (count >= n + 1) {
              break;
            }
            intRd = this.getRandomInt(0, n);
            var flag = 0;
            for (var i = 0; i < count; i++) {
              if (array[i] === intRd) {
                flag = 1;
                break;
              }
            }
            if (flag === 0) {
              array[count] = intRd;
              count++;
            }
          }
          return array;
        }
        /**
         * 
         * @param {Number} min 
         * @param {Number} max 
         * @returns
         */;
        util.getRandomInt = function getRandomInt(min, max) {
          var r = Math.random();
          var rr = r * (max - min + 1) + min;
          return Math.floor(rr);
        }
        /**
         * 
         * @param {Number} min 
         * @param {Number} max 
         * @returns
         */;
        util.getRandom = function getRandom(min, max) {
          return Math.random() * (max - min) + min;
        }
        /**
         * Objectundefinedfalse
         * @param obj
         */;
        util.isEmptyObject = function isEmptyObject(obj) {
          var result = true;
          if (obj && obj.constructor === Object) {
            for (var _key4 in obj) {
              if (obj.hasOwnProperty(_key4)) {
                result = false;
                break;
              }
            }
          } else {
            result = false;
          }
          return result;
        }
        /**
         * 
         * @param {Object|Number} dateValue  todo MessageCenter  pve  Date 
         * @returns {boolean}
         */;
        util.isNewDay = function isNewDay(dateValue) {
          // todo
          var oldDate = new Date(dateValue);
          var curDate = new Date();
          //@ts-ignore
          var oldYear = oldDate.getYear();
          var oldMonth = oldDate.getMonth();
          var oldDay = oldDate.getDate();
          //@ts-ignore
          var curYear = curDate.getYear();
          var curMonth = curDate.getMonth();
          var curDay = curDate.getDate();
          if (curYear > oldYear) {
            return true;
          } else {
            if (curMonth > oldMonth) {
              return true;
            } else {
              if (curDay > oldDay) {
                return true;
              }
            }
          }
          return false;
        }
        /**
         * 
         * @param {object}o 
         * @returns
         */;
        util.getPropertyCount = function getPropertyCount(o) {
          var n,
            count = 0;
          for (n in o) {
            if (o.hasOwnProperty(n)) {
              count++;
            }
          }
          return count;
        }
        /**
         * arraydiff
         * @param array
         * @param diff
         */;
        util.difference = function difference(array, diff) {
          var result = [];
          if (array.constructor !== Array || diff.constructor !== Array) {
            return result;
          }
          var length = array.length;
          for (var i = 0; i < length; i++) {
            if (diff.indexOf(array[i]) === -1) {
              result.push(array[i]);
            }
          }
          return result;
        }
        // msguuid
        ;

        util.simulationUUID = function simulationUUID() {
          function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
          }
          return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
        };
        util.trim = function trim(str) {
          return str.replace(/(^\s*)|(\s*$)/g, "");
        }
        /**
         * 
         * @param {String|Number} start 
         * @param {String|Number} end 
         */;
        util.isNowValid = function isNowValid(start, end) {
          var startTime = new Date(start);
          var endTime = new Date(end);
          var result = false;
          if (startTime.getDate() + '' !== 'NaN' && endTime.getDate() + '' !== 'NaN') {
            var curDate = new Date();
            result = curDate < endTime && curDate > startTime;
          }
          return result;
        }
        /**
         * 
         * @param start
         * @param end
         * @returns
         */;
        util.getDeltaDays = function getDeltaDays(start, end) {
          start = new Date(start);
          end = new Date(end);
          var startYear = start.getFullYear();
          var startMonth = start.getMonth() + 1;
          var startDate = start.getDate();
          var endYear = end.getFullYear();
          var endMonth = end.getMonth() + 1;
          var endDate = end.getDate();
          start = new Date(startYear + '/' + startMonth + '/' + startDate + ' GMT+0800').getTime();
          end = new Date(endYear + '/' + endMonth + '/' + endDate + ' GMT+0800').getTime();
          var deltaTime = end - start;
          return Math.floor(deltaTime / (24 * 60 * 60 * 1000));
        }
        /**
         * 
         * @param array 
         * @returns
         */;
        util.getMin = function getMin(array) {
          var result = null;
          if (array.constructor === Array) {
            var length = array.length;
            for (var i = 0; i < length; i++) {
              if (i === 0) {
                result = Number(array[0]);
              } else {
                result = result > Number(array[i]) ? Number(array[i]) : result;
              }
            }
          }
          return result;
        }
        /**
         * 
         * @param time
         * @returns
         */;
        util.formatTwoDigits = function formatTwoDigits(time) {
          //@ts-ignore
          return (Array(2).join(0) + time).slice(-2);
        }
        /**
         * 
         * @param date  
         * @param fmt 
         * @returns
         */;
        util.formatDate = function formatDate(date, fmt) {
          var o = {
            "M+": date.getMonth() + 1,
            //
            "d+": date.getDate(),
            //
            "h+": date.getHours(),
            //
            "m+": date.getMinutes(),
            //
            "s+": date.getSeconds(),
            //
            "q+": Math.floor((date.getMonth() + 3) / 3),
            //
            "S": date.getMilliseconds() //
          };

          if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
          for (var k in o)
          //@ts-ignore
          if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, RegExp.$1.length === 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
          return fmt;
        }
        /**
         * 
         */;
        util.getDay = function getDay() {
          var date = new Date();
          return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
        }
        /**
         *   HH:MM:SS
         * @param {Number} leftSec
         */;
        util.formatTimeForSecond = function formatTimeForSecond(leftSec, withoutSeconds) {
          if (withoutSeconds === void 0) {
            withoutSeconds = false;
          }
          var timeStr = '';
          var sec = leftSec % 60;
          var leftMin = Math.floor(leftSec / 60);
          leftMin = leftMin < 0 ? 0 : leftMin;
          var hour = Math.floor(leftMin / 60);
          var min = leftMin % 60;
          if (hour > 0) {
            timeStr += hour > 9 ? hour.toString() : '0' + hour;
            timeStr += ':';
          } else {
            timeStr += '00:';
          }
          timeStr += min > 9 ? min.toString() : '0' + min;
          if (!withoutSeconds) {
            timeStr += ':';
            timeStr += sec > 9 ? sec.toString() : '0' + sec;
          }
          return timeStr;
        }
        /**
         *    HH:MM:SS
         *
         * @param {Number} ms
         */;
        util.formatTimeForMillisecond = function formatTimeForMillisecond(ms) {
          var second = Math.floor(ms / 1000 % 60);
          var minute = Math.floor(ms / 1000 / 60 % 60);
          var hour = Math.floor(ms / 1000 / 60 / 60);
          return {
            'hour': hour,
            'minute': minute,
            'second': second
          };
        }
        /**
         * 
         * @param {Array}arr 
         * @returns
         */;
        util.rand = function rand(arr) {
          var arrClone = this.clone(arr);
          // 
          for (var i = arrClone.length - 1; i >= 0; i--) {
            // randomIndex0-arrClone.length
            var randomIndex = Math.floor(Math.random() * (i + 1));
            // 
            var itemIndex = arrClone[randomIndex];
            arrClone[randomIndex] = arrClone[i];
            arrClone[i] = itemIndex;
          }
          // len-1,len-2,len-3......0
          return arrClone;
        }
        /**
         * 
         * @param {number} num
         * @param {number} idx
         */;
        util.formatNumToFixed = function formatNumToFixed(num, idx) {
          if (idx === void 0) {
            idx = 0;
          }
          return Number(num.toFixed(idx));
        }
        /**
         * 
         * @param {number} targetValue 
         * @param {number} curValue 
         * @param {number} ratio    
         * @returns
         */;
        util.lerp = function lerp(targetValue, curValue, ratio) {
          if (ratio === void 0) {
            ratio = 0.25;
          }
          var v = curValue;
          if (targetValue > curValue) {
            v = curValue + (targetValue - curValue) * ratio;
          } else if (targetValue < curValue) {
            v = curValue - (curValue - targetValue) * ratio;
          }
          return v;
        }
        /**
         * 
         *
         * @static
         * @param {*} arr
         * @returns
         * @memberof util
         */;
        util.shuffle = function shuffle(arr) {
          if (Array.isArray(arr)) {
            var newArr = arr.concat();
            newArr.sort(function () {
              return 0.5 - Math.random();
            });
            return newArr;
          }
        }
        /**
         * 
         * @param arr
         * @returns
         */;
        util.getRandomItemFromArray = function getRandomItemFromArray(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        };
        return util;
      }());
      util = exports('util', __decorate([ccclass("util")], util));
      var key = new Proxy({}, {
        get: function get(target, key) {
          return key;
        }
      });
      function Key() {
        return key;
      }
      var __awaiter$7 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * http 
       * @noInheritDoc
       * @remarks
       *
       * - post/get 
       *
       * - 
       *
       * - 
       */
      var mk_http = /*#__PURE__*/function (_mk_instance_base3) {
        _inheritsLoose(mk_http, _mk_instance_base3);
        function mk_http() {
          return _mk_instance_base3.apply(this, arguments) || this;
        }
        var _proto5 = mk_http.prototype;
        /* -------------------------------  ------------------------------- */
        /**
         * GET 
         * @param url_s_ 
         * @param config_ 
         * @returns 
         */
        _proto5.get = function get(url_s_, config_) {
          return __awaiter$7(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  _context.next = 2;
                  return this._open("GET", url_s_, undefined, config_);
                case 2:
                  return _context.abrupt("return", _context.sent);
                case 3:
                case "end":
                  return _context.stop();
              }
            }, _callee, this);
          }));
        }
        /**
         * POST 
         * @param url_s_ 
         * @param body_ 
         * @param config_ 
         * @returns 
         */;
        _proto5.post = function post(url_s_, body_, config_) {
          return __awaiter$7(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
            return _regeneratorRuntime().wrap(function _callee2$(_context2) {
              while (1) switch (_context2.prev = _context2.next) {
                case 0:
                  _context2.next = 2;
                  return this._open("POST", url_s_, body_, config_);
                case 2:
                  return _context2.abrupt("return", _context2.sent);
                case 3:
                case "end":
                  return _context2.stop();
              }
            }, _callee2, this);
          }));
        }
        /**  */;
        _proto5._open = function _open(method, url, body, config_) {
          return __awaiter$7(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {
            var _a, config, controller, signal, timeout_id, init, is_special, response, result, type, str, buffer, binary, bytes, len, chunk_size, i;
            return _regeneratorRuntime().wrap(function _callee3$(_context3) {
              while (1) switch (_context3.prev = _context3.next) {
                case 0:
                  config = new mk_http_.config(config_);
                  controller = new AbortController();
                  signal = controller.signal; // 
                  timeout_id = setTimeout(function () {
                    return controller.abort();
                  }, config.timeout);
                  _context3.prev = 4;
                  //  Fetch 
                  init = {
                    method: method,
                    headers: config.header,
                    body: body,
                    signal: signal
                  }; //  body  ( Content-Type JSON)
                  if (body && typeof body === 'object' && !init.body) {
                    //  body  Blob/FormData/BufferSource fetch 
                    //  JSON 
                    is_special = body instanceof Blob || body instanceof FormData || body instanceof URLSearchParams || ArrayBuffer.isView(body) || body instanceof ArrayBuffer;
                    if (!is_special) {
                      init.body = JSON.stringify(body);
                      if (!init.headers) init.headers = {};
                      if (!init.headers['Content-Type']) {
                        init.headers['Content-Type'] = 'application/json';
                      }
                    }
                  }
                  // Native 
                  if (sys.isNative && !init.headers) {
                    init.headers = {
                      "Accept-Encoding": "gzip,deflate"
                    };
                  } else if (sys.isNative && init.headers) {
                    init.headers["Accept-Encoding"] = "gzip,deflate";
                  }
                  _context3.next = 10;
                  return fetch(url, init);
                case 10:
                  response = _context3.sent;
                  clearTimeout(timeout_id);
                  if (response.ok) {
                    _context3.next = 14;
                    break;
                  }
                  return _context3.abrupt("return", null);
                case 14:
                  type = (_a = config.response_type) !== null && _a !== void 0 ? _a : "json";
                  _context3.t0 = type;
                  _context3.next = _context3.t0 === "json" ? 18 : _context3.t0 === "document" ? 22 : _context3.t0 === "arraybuffer" ? 27 : _context3.t0 === "blob" ? 27 : _context3.t0 === "text" ? 37 : 37;
                  break;
                case 18:
                  _context3.next = 20;
                  return response.json();
                case 20:
                  result = _context3.sent;
                  return _context3.abrupt("break", 41);
                case 22:
                  _context3.next = 24;
                  return response.text();
                case 24:
                  str = _context3.sent;
                  result = new DOMParser().parseFromString(str, "text/xml");
                  return _context3.abrupt("break", 41);
                case 27:
                  _context3.next = 29;
                  return response.arrayBuffer();
                case 29:
                  buffer = _context3.sent;
                  binary = '';
                  bytes = new Uint8Array(buffer);
                  len = bytes.byteLength;
                  chunk_size = 8192;
                  for (i = 0; i < len; i += chunk_size) {
                    binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk_size));
                  }
                  result = "data:image/png;base64," + btoa(binary);
                  return _context3.abrupt("break", 41);
                case 37:
                  _context3.next = 39;
                  return response.text();
                case 39:
                  result = _context3.sent;
                  return _context3.abrupt("break", 41);
                case 41:
                  if (!(config.codec && result !== undefined)) {
                    _context3.next = 45;
                    break;
                  }
                  _context3.next = 44;
                  return config.codec.decode(result);
                case 44:
                  result = _context3.sent;
                case 45:
                  return _context3.abrupt("return", result);
                case 48:
                  _context3.prev = 48;
                  _context3.t1 = _context3["catch"](4);
                  clearTimeout(timeout_id);
                  return _context3.abrupt("return", null);
                case 52:
                case "end":
                  return _context3.stop();
              }
            }, _callee3, null, [[4, 48]]);
          }));
        };
        return mk_http;
      }(mk_instance_base);
      var mk_http_;
      (function (mk_http_) {
        /**  */
        var config = function config(init_) {
          /** (ms) */
          this.timeout = 5000;
          /**  */
          this.response_type = "text";
          Object.assign(this, init_);
        };
        mk_http_.config = config;
      })(mk_http_ || (mk_http_ = {}));
      var mk_http$1 = mk_http.instance();

      // import mk_config from "./mk_config";
      var _mk_logger;
      (function (_mk_logger) {
        /**  */
        var level;
        (function (level) {
          /**  */
          level[level["none"] = 0] = "none";
          /**  */
          level[level["debug"] = 1] = "debug";
          /**  */
          level[level["log"] = 2] = "log";
          /**  */
          level[level["warn"] = 4] = "warn";
          /**  */
          level[level["error"] = 8] = "error";
          /** debug  */
          level[level["debug_up"] = 15] = "debug_up";
          /** log  */
          level[level["log_up"] = 14] = "log_up";
          /** warn  */
          level[level["warn_up"] = 12] = "warn_up";
        })(level = _mk_logger.level || (_mk_logger.level = {}));
        /**  */
        var log_object_type;
        (function (log_object_type) {
          /**  */
          log_object_type[log_object_type["mk"] = 0] = "mk";
          /**  */
          log_object_type[log_object_type["console"] = 1] = "console";
          /** cocos */
          log_object_type[log_object_type["cc"] = 2] = "cc";
        })(log_object_type = _mk_logger.log_object_type || (_mk_logger.log_object_type = {}));
        /**  */
        _mk_logger.config = new ( /*#__PURE__*/function () {
          function _class() {
            /**  */
            this.cache_row_n = 100;
            /**  */
            this.error_upload_addr_s = "";
            /** ( console ) */
            this.output_position_b = true;
            /**  */
            this.level_n = level.debug_up;
            /**  */
            this.log_object_type = log_object_type.console;
          }
          return _class;
        }())();
      })(_mk_logger || (_mk_logger = {}));
      /**
       * 
       * @noInheritDoc
       * @remarks
       *  default
       *
       * - 
       *
       * - 
       *
       * - 
       *
       * -  http 
       */
      var mk_logger = exports('logger', /*#__PURE__*/function (_mk_instance_base4) {
        _inheritsLoose(mk_logger, _mk_instance_base4);
        function mk_logger(name_s_) {
          var _this3$_log_func_tab;
          var _this3;
          _this3 = _mk_instance_base4.call(this) || this;
          /**  */
          _this3._log_func_tab = (_this3$_log_func_tab = {}, _this3$_log_func_tab[_mk_logger.log_object_type.mk] = {
            target: _assertThisInitialized(_this3),
            debug: _this3.debug,
            log: _this3.log,
            warn: _this3.warn,
            error: _this3.error
          }, _this3$_log_func_tab[_mk_logger.log_object_type.console] = {
            target: console,
            debug: console.debug,
            log: console.log,
            warn: console.warn,
            error: console.error
          }, _this3$_log_func_tab[_mk_logger.log_object_type.cc] = {
            target: cc,
            debug: debug,
            log: log$1,
            warn: warn$1,
            error: error$1
          }, _this3$_log_func_tab);
          /**  */
          _this3._time_map = new Map();
          // 
          _this3._name_s = name_s_;
          mk_logger._log_map.set(name_s_, _assertThisInitialized(_this3));
          // 
          if (!mk_logger._init_b) {
            mk_logger._init_b = true;
            var upload_f = function upload_f() {
              var _b2;
              var _a, _b;
              // 
              for (var _len2 = arguments.length, args_as = new Array(_len2), _key5 = 0; _key5 < _len2; _key5++) {
                args_as[_key5] = arguments[_key5];
              }
              mk_logger._add_log_cache(_mk_logger.level.error, mk_log._get_log_head(_mk_logger.level.error, true), args_as);
              // 
              if (mk_logger._config.error_upload_addr_s) {
                mk_http$1.post(mk_logger._config.error_upload_addr_s, {
                  body: JSON.stringify(mk_logger._cache_ss)
                });
                // 
                mk_logger._cache_ss.splice(0, mk_logger._cache_ss.length);
              }
              // 
              (_b = (_a = mk_logger._config).error_handling_f) === null || _b === void 0 ? void 0 : (_b2 = _b).call.apply(_b2, [_a].concat(args_as));
            };
            if (sys.isBrowser) {
              var old_handler;
              if (window.onerror) {
                old_handler = window.onerror;
              }
              window.onerror = function () {
                upload_f.apply(void 0, arguments);
                if (old_handler) {
                  old_handler.apply(void 0, arguments);
                }
              };
            } else if (sys.isNative) {
              var _old_handler;
              if (window["jsb"]) {
                jsb["onError"](function () {
                  upload_f.apply(void 0, arguments);
                });
              } else {
                if (window["__errorHandler"]) {
                  _old_handler = window["__errorHandler"];
                }
                window["__errorHandler"] = function () {
                  upload_f.apply(void 0, arguments);
                  if (_old_handler) {
                    _old_handler.apply(void 0, arguments);
                  }
                };
              }
            }
          }
          return _this3;
        }
        /* ------------------------------- static ------------------------------- */
        /**
         * 
         * @param module_ss_ 
         * @remarks
         *  {@link mk_logger.limit} 
         */
        mk_logger.only = function only(module_ss_) {
          mk_logger._log_only_module_ss = module_ss_;
          mk_logger._limit_log_module_ss = [];
        }
        /**
         * 
         * @param module_ss_ 
         * @remarks
         *  {@link mk_logger.only} 
         */;
        mk_logger.limit = function limit(module_ss_) {
          mk_logger._log_only_module_ss = [];
          mk_logger._limit_log_module_ss = module_ss_;
        }
        /**
         * 
         * @param level_ 
         * @param head_s_ 
         * @param args_as_ 
         * @returns
         */;
        mk_logger._add_log_cache = function _add_log_cache(level_, head_s_) {
          for (var _len3 = arguments.length, args_as_ = new Array(_len3 > 2 ? _len3 - 2 : 0), _key6 = 2; _key6 < _len3; _key6++) {
            args_as_[_key6 - 2] = arguments[_key6];
          }
          if (!(args_as_ === null || args_as_ === void 0 ? void 0 : args_as_.length) || mk_logger._config.cache_row_n <= 0) {
            return;
          }
          /**  */
          var content_s = head_s_;
          // 
          {
            if (level_ === _mk_logger.level.error) {
              args_as_.forEach(function (v) {
                var json_s = "";
                try {
                  json_s = JSON.stringify(v);
                } catch (e) {
                  // ...
                }
                content_s += ", " + json_s;
              });
            }
            // 
            else {
              args_as_.forEach(function (v) {
                if (!["object", "function"].includes(typeof v)) {
                  content_s += ", " + v;
                }
              });
            }
          }
          // 
          mk_logger._cache_ss.push(content_s);
          // 
          if (mk_logger._cache_ss.length > mk_logger._config.cache_row_n) {
            mk_logger._cache_ss.splice(0, 1);
          }
        }
        /* -------------------------------  ------------------------------- */;
        var _proto6 = mk_logger.prototype;
        _proto6.debug = function debug() {
          for (var _len4 = arguments.length, args_as_ = new Array(_len4), _key7 = 0; _key7 < _len4; _key7++) {
            args_as_[_key7] = arguments[_key7];
          }
          this._log.apply(this, [_mk_logger.level.debug].concat(args_as_));
        };
        _proto6.log = function log() {
          for (var _len5 = arguments.length, args_as_ = new Array(_len5), _key8 = 0; _key8 < _len5; _key8++) {
            args_as_[_key8] = arguments[_key8];
          }
          this._log.apply(this, [_mk_logger.level.log].concat(args_as_));
        };
        _proto6.warn = function warn() {
          for (var _len6 = arguments.length, args_as_ = new Array(_len6), _key9 = 0; _key9 < _len6; _key9++) {
            args_as_[_key9] = arguments[_key9];
          }
          this._log.apply(this, [_mk_logger.level.warn].concat(args_as_));
        };
        _proto6.error = function error() {
          for (var _len7 = arguments.length, args_as_ = new Array(_len7), _key10 = 0; _key10 < _len7; _key10++) {
            args_as_[_key10] = arguments[_key10];
          }
          this._log.apply(this, [_mk_logger.level.error].concat(args_as_));
        }
        /**  */;
        _proto6.time_start = function time_start(name_s_) {
          if (!name_s_) {
            this.error("");
            return;
          }
          var time_log = Object.create(null);
          time_log.start_time_ms_n = time_log.last_time_ms_n = Date.now();
          this._time_map.set(name_s_, time_log);
          for (var _len8 = arguments.length, args_as_ = new Array(_len8 > 1 ? _len8 - 1 : 0), _key11 = 1; _key11 < _len8; _key11++) {
            args_as_[_key11 - 1] = arguments[_key11];
          }
          if (args_as_ === null || args_as_ === void 0 ? void 0 : args_as_.length) {
            this._log.apply(this, [_mk_logger.level.log, name_s_].concat(args_as_));
          }
        }
        /**  */;
        _proto6.time_log = function time_log(name_s_) {
          var time_log = this._time_map.get(name_s_);
          if (!time_log) {
            this.error("");
            return;
          }
          var curr_time_ms_n = Date.now();
          for (var _len9 = arguments.length, args_as_ = new Array(_len9 > 1 ? _len9 - 1 : 0), _key12 = 1; _key12 < _len9; _key12++) {
            args_as_[_key12 - 1] = arguments[_key12];
          }
          if (args_as_ === null || args_as_ === void 0 ? void 0 : args_as_.length) {
            this._log.apply(this, [_mk_logger.level.log, name_s_].concat(args_as_, ["\u8017\u65F6\uFF1A" + (curr_time_ms_n - time_log.last_time_ms_n) / 1000 + "s"]));
          }
          time_log.last_time_ms_n = curr_time_ms_n;
        }
        /**  */;
        _proto6.time_end = function time_end(name_s_) {
          var time_log = this._time_map.get(name_s_);
          if (!time_log) {
            this.error("");
            return;
          }
          for (var _len10 = arguments.length, args_as_ = new Array(_len10 > 1 ? _len10 - 1 : 0), _key13 = 1; _key13 < _len10; _key13++) {
            args_as_[_key13 - 1] = arguments[_key13];
          }
          this._log.apply(this, [_mk_logger.level.log, name_s_].concat(args_as_, ["\u603B\u8017\u65F6\uFF1A" + (Date.now() - time_log.start_time_ms_n) / 1000 + "s"]));
          this._time_map["delete"](name_s_);
        }
        /**  */;
        _proto6._get_log_head = function _get_log_head(level_, time_b_) {
          if (time_b_ === void 0) {
            time_b_ = true;
          }
          var date = new Date();
          if (time_b_) {
            /**  */
            var time_s = date.getFullYear() + "-" + date.getMonth() + "-" + date.getDate() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds() + "." + date.getMilliseconds();
            return this._name_s + " <" + _mk_logger.level[level_] + "> [" + time_s + "]\uFF1A";
          } else {
            return this._name_s + " <" + _mk_logger.level[level_] + ">\uFF1A";
          }
        };
        _proto6._log = function _log(level_) {
          var _this$_log_func_tab$m;
          // 
          if (!(mk_logger._config.level_n & level_)) {
            return;
          }
          // 
          if (mk_logger._log_only_module_ss.length) {
            if (!mk_logger._log_only_module_ss.includes(this._name_s)) {
              return;
            }
          } else {
            if (mk_logger._limit_log_module_ss.includes(this._name_s)) {
              return;
            }
          }
          /**  */
          var head_s = this._get_log_head(level_);
          // 
          for (var _len11 = arguments.length, args_as_ = new Array(_len11 > 1 ? _len11 - 1 : 0), _key14 = 1; _key14 < _len11; _key14++) {
            args_as_[_key14 - 1] = arguments[_key14];
          }
          mk_logger._add_log_cache.apply(mk_logger, [level_, head_s].concat(args_as_));
          // 
          (_this$_log_func_tab$m = this._log_func_tab[mk_logger._config.log_object_type])[_mk_logger.level[level_]].apply(_this$_log_func_tab$m, [head_s].concat(args_as_));
        };
        return mk_logger;
      }(mk_instance_base));
      /* --------------- static --------------- */
      /**  */
      mk_logger._config = _mk_logger.config;
      /**  */
      mk_logger._init_b = false;
      /**  log  */
      mk_logger._log_map = new Map();
      /**  */
      mk_logger._cache_ss = [];
      /**  */
      mk_logger._log_only_module_ss = [];
      /**  */
      mk_logger._limit_log_module_ss = [];
      var mk_log = mk_logger.instance("default");
      // 
      var LogLevel = exports('LogLevel', _mk_logger.level);
      var LogObjectType = exports('LogObjectType', _mk_logger.log_object_type);
      var logConfig = exports('logConfig', _mk_logger.config);
      // 
      var log = exports('log', mk_log.log.bind(mk_log));
      var warn = exports('warn', mk_log.warn.bind(mk_log));
      var error = exports('error', mk_log.error.bind(mk_log));

      /**
       * 
       * @internal
       */
      var global_config;
      (function (global_config) {
        (function (constant) {
          /**  */
          constant.version_s = "1.0.0";
          /**  */
          constant.show_debug_info_b = false;
        })(global_config.constant || (global_config.constant = {}));
        (function (audio) {
          (function (type) {
            /**  */
            type[type["effect"] = -99] = "effect";
            /**  */
            type[type["music"] = -98] = "music";
          })(audio.type || (audio.type = {}));
        })(global_config.audio || (global_config.audio = {}));
        (function (asset) {
          /** bundle  */
          asset.bundle = new Proxy(Object.create(null), {
            get: function get(target, key) {
              return key;
            }
          });
          asset.config = new ( /*#__PURE__*/function () {
            function _class2() {
              /**  */
              this.cache_lifetime_ms_n = 1000;
            }
            return _class2;
          }())();
        })(global_config.asset || (global_config.asset = {}));
        (function (view) {
          (function (layer_type) {
            layer_type[layer_type["\u5185\u5BB9"] = 0] = "\u5185\u5BB9";
            layer_type[layer_type["\u7A97\u53E3"] = 1] = "\u7A97\u53E3";
            layer_type[layer_type["\u63D0\u793A"] = 2] = "\u63D0\u793A";
            layer_type[layer_type["\u5F15\u5BFC"] = 3] = "\u5F15\u5BFC";
            layer_type[layer_type["\u8B66\u544A"] = 4] = "\u8B66\u544A";
            layer_type[layer_type["\u52A0\u8F7D"] = 5] = "\u52A0\u8F7D";
            layer_type[layer_type["\u9519\u8BEF"] = 6] = "\u9519\u8BEF";
          })(view.layer_type || (view.layer_type = {}));
          /**  */
          var adaptation_mode;
          (function (adaptation_mode) {
            /**  */
            adaptation_mode[adaptation_mode["none"] = 0] = "none";
            /**  */
            adaptation_mode[adaptation_mode["adaptive"] = 1] = "adaptive";
            /**  */
            adaptation_mode[adaptation_mode["fixed_size"] = 2] = "fixed_size";
          })(adaptation_mode = view.adaptation_mode || (view.adaptation_mode = {}));
          /**  */
          view.adaptation_type = adaptation_mode.adaptive;
          /**  */
          view.original_design_size = size();
          /**  */
          view.blocking_warning_time_ms_n = 5000;
          /**  */
          view.mask_data_tab = {
            node_name_s: "",
            prefab_path_s: "db://assets/resources/module/@common/mask/resources_common_mask.prefab"
          };
          view.config = new ( /*#__PURE__*/function () {
            function _class3() {
              /**  */
              this.layer_spacing_n = 100;
              /**  */
              this.layer_refresh_interval_ms_n = game.frameTime;
              /**  */
              this.window_animation_tab = {
                open: {
                  : null
                },
                close: {
                  : null
                }
              };
            }
            return _class3;
          }())();
        })(global_config.view || (global_config.view = {}));
        (function (language) {
          /**  */
          var private_type_tab = {
            /** () */
            zh_cn: {
              dire: Layout.HorizontalDirection.LEFT_TO_RIGHT
            },
            /** () */
            en_us: {
              dire: Layout.HorizontalDirection.LEFT_TO_RIGHT
            }
          };
          /**  */
          language.type_tab = private_type_tab;
          /**  */
          language.type = new Proxy({}, {
            get: function get(target, key) {
              return key;
            }
          });
          /**  */
          language.default_type_s = language.type.zh_cn;
          /**  */
          language.args_head_s = "{";
          /**  */
          language.args_tail_s = "}";
        })(global_config.language || (global_config.language = {}));
        (function (log) {
          var level;
          (function (level) {
            /**  */
            level[level["none"] = 0] = "none";
            /**  */
            level[level["debug"] = 1] = "debug";
            /**  */
            level[level["log"] = 2] = "log";
            /**  */
            level[level["warn"] = 4] = "warn";
            /**  */
            level[level["error"] = 8] = "error";
            /** debug  */
            level[level["debug_up"] = 15] = "debug_up";
            /** log  */
            level[level["log_up"] = 14] = "log_up";
            /** warn  */
            level[level["warn_up"] = 12] = "warn_up";
          })(level = log.level || (log.level = {}));
          /**  */
          var log_object_type;
          (function (log_object_type) {
            /**  */
            log_object_type[log_object_type["mk"] = 0] = "mk";
            /**  */
            log_object_type[log_object_type["console"] = 1] = "console";
            /** cocos */
            log_object_type[log_object_type["cc"] = 2] = "cc";
          })(log_object_type = log.log_object_type || (log.log_object_type = {}));
          log.config = new ( /*#__PURE__*/function () {
            function _class4() {
              /**  */
              this.cache_row_n = 100;
              /**  */
              this.error_upload_addr_s = "";
              /** ( console ) */
              this.output_position_b = true;
              /**  */
              this.level_n = level.debug_up;
              /**  */
              this.log_object_type = log_object_type.console;
            }
            return _class4;
          }())();
        })(global_config.log || (global_config.log = {}));
        (function (network) {
          /**  */
          network.proto_head_key_tab = new Proxy(Object.create(null), {
            get: function get(target, key) {
              return key;
            }
          });
        })(global_config.network || (global_config.network = {}));
      })(global_config || (global_config = {}));
      {
        window["global_config"] = global_config;
      }
      var global_config$1 = global_config;

      /**
       * 
       * @noInheritDoc
       * @remarks
       *  event_target.key.xxx
       */
      var mk_event_target = exports('event_target', /*#__PURE__*/function (_cc$EventTarget) {
        _inheritsLoose(mk_event_target, _cc$EventTarget);
        function mk_event_target() {
          var _this4;
          _this4 = _cc$EventTarget.apply(this, arguments) || this;
          /**  */
          _this4.key = new Proxy(Object.create(null), {
            get: function get(target, key) {
              return key;
            }
          });
          return _this4;
        }
        /* -------------------------------  ------------------------------- */
        /**
         * 
         * @param type_ 
         * @param callback_ 
         * @param target_ 
         * @param once_b_ 
         * @returns 
         */
        // @ts-ignore
        var _proto7 = mk_event_target.prototype;
        _proto7.on = function on(type_, callback_, target_, once_b_) {
          var _this5 = this;
          var _a;
          if (Array.isArray(type_)) {
            type_.forEach(function (v) {
              _cc$EventTarget.prototype.on.call(_this5, v, callback_, target_, once_b_);
            });
            return null;
          } else {
            // 
            (_a = target_ === null || target_ === void 0 ? void 0 : target_.event_target_as) === null || _a === void 0 ? void 0 : _a.add(this);
            return _cc$EventTarget.prototype.on.call(this, type_, callback_, target_, once_b_);
          }
        }
        /**
         * 
         * @param type_ 
         * @param callback_ 
         * @param target_ 
         * @returns 
         */
        // @ts-ignore
        ;

        _proto7.once = function once(type_, callback_, target_) {
          var _this6 = this;
          var _a;
          if (Array.isArray(type_)) {
            type_.forEach(function (v) {
              _cc$EventTarget.prototype.once.call(_this6, v, callback_, target_);
            });
            return null;
          } else {
            // 
            (_a = target_ === null || target_ === void 0 ? void 0 : target_.event_target_as) === null || _a === void 0 ? void 0 : _a.add(this);
            return _cc$EventTarget.prototype.once.call(this, type_, callback_, target_);
          }
        }
        /**
         * 
         * @param type_ 
         * @param callback_ 
         * @param target_ 
         * @returns 
         */
        // @ts-ignore
        ;

        _proto7.off = function off(type_, callback_, target_) {
          var _this7 = this;
          if (Array.isArray(type_)) {
            type_.forEach(function (v) {
              _cc$EventTarget.prototype.off.call(_this7, v, callback_, target_);
            });
          } else {
            _cc$EventTarget.prototype.off.call(this, type_, callback_, target_);
          }
        }
        /**
         * 
         * @param type_ 
         * @param args_ 
         */
        // @ts-ignore
        ;

        _proto7.emit = function emit(type_) {
          var _this8 = this;
          for (var _len12 = arguments.length, args_ = new Array(_len12 > 1 ? _len12 - 1 : 0), _key15 = 1; _key15 < _len12; _key15++) {
            args_[_key15 - 1] = arguments[_key15];
          }
          if (Array.isArray(type_)) {
            type_.forEach(function (v) {
              var _cc$EventTarget$proto;
              (_cc$EventTarget$proto = _cc$EventTarget.prototype.emit).call.apply(_cc$EventTarget$proto, [_this8, v].concat(args_));
            });
          } else {
            var _cc$EventTarget$proto2;
            (_cc$EventTarget$proto2 = _cc$EventTarget.prototype.emit).call.apply(_cc$EventTarget$proto2, [this, type_].concat(args_));
          }
        }
        /**
         * 
         * @param type_ 
         * @param callback_ 
         * @param target_ 
         * @returns
         */
        // @ts-ignore
        ;

        _proto7.has = function has(type_, callback_, target_) {
          return _cc$EventTarget.prototype.hasEventListener.call(this, type_, callback_, target_);
        }
        /**  */;
        _proto7.clear = function clear() {
          return _cc$EventTarget.prototype["clear"].call(this);
        }
        /**
         * 
         * @param type_ 
         * @param args_ 
         * @remarks
         * 
         */
        // @ts-ignore
        ;

        _proto7.request = function request(type_) {
          var _this9 = this;
          for (var _len13 = arguments.length, args_ = new Array(_len13 > 1 ? _len13 - 1 : 0), _key16 = 1; _key16 < _len13; _key16++) {
            args_[_key16 - 1] = arguments[_key16];
          }
          if (Array.isArray(type_)) {
            var result_as = [];
            type_.forEach(function (v) {
              result_as.push.apply(result_as, _this9._request_single.apply(_this9, [v].concat(args_)));
            });
            return result_as;
          } else {
            return this._request_single.apply(this, [type_].concat(args_));
          }
        }
        /**
         * 
         * @param type_ 
         * @param args_ 
         * @returns
         */
        // @ts-ignore
        ;

        _proto7._request_single = function _request_single(type_) {
          var _a;
          /**  */
          var result_as = [];
          /**  */
          var callback_as = (_a = this["_callbackTable"][type_]) === null || _a === void 0 ? void 0 : _a.callbackInfos;
          if (!callback_as) {
            return result_as;
          }
          callback_as.forEach(function (v) {
            var old_callback_f = v.callback;
            var target = v.target;
            v.callback = function () {
              for (var _len15 = arguments.length, args = new Array(_len15), _key18 = 0; _key18 < _len15; _key18++) {
                args[_key18] = arguments[_key18];
              }
              result_as.push(old_callback_f.call.apply(old_callback_f, [target].concat(args)));
              v.callback = old_callback_f;
            };
          });
          for (var _len14 = arguments.length, args_ = new Array(_len14 > 1 ? _len14 - 1 : 0), _key17 = 1; _key17 < _len14; _key17++) {
            args_[_key17 - 1] = arguments[_key17];
          }
          this.emit.apply(this, [type_].concat(args_));
          return result_as;
        };
        return mk_event_target;
      }(EventTarget));
      var global_event = exports('global_event', new mk_event_target());
      {
        window["global_event"] = global_event;
      }

      /**
       * 
       * @remarks
       *  promise resolve 
       */
      // eslint-disable-next-line @typescript-eslint/no-invalid-void-type
      var mk_status_task = /*#__PURE__*/function () {
        /**
         * @param finish_b_ 
         * @param init_config_ 
         */
        function mk_status_task(finish_b_, init_config_) {
          /* --------------- private --------------- */
          /**  */
          this._finish_b = false;
          /**  */
          this._finish_f = null;
          this._finish_b = finish_b_;
          this._init_config = init_config_;
          if (this._finish_b) {
            this.task = new Promise(function (resolve_f) {
              resolve_f();
            });
          } else {
            this._reset();
          }
        }
        /**
         * 
         * @remarks
         *
         * - true
         *
         * - false
         */
        var _proto8 = mk_status_task.prototype;
        _proto8.finish = function finish(finish_b_, data_) {
          var _a;
          if (this._finish_b === finish_b_) {
            return;
          }
          if (finish_b_) {
            (_a = this._finish_f) === null || _a === void 0 ? void 0 : _a.call(this, data_);
          } else {
            this._reset();
          }
        }
        /**  */;
        _proto8._reset = function _reset() {
          var _this10 = this;
          var _a;
          this._finish_b = false;
          this.task = new Promise(function (resolve_f) {
            _this10._finish_f = function (data) {
              resolve_f(data);
              _this10._finish_b = true;
              _this10._finish_f = null;
              // 
              if (_this10._timeout_timer) {
                clearTimeout(_this10._timeout_timer);
                _this10._timeout_timer = null;
              }
            };
          });
          // 
          if (((_a = this._init_config) === null || _a === void 0 ? void 0 : _a.timeout_ms_n) !== undefined) {
            this._timeout_timer = setTimeout(function () {
              _this10._timeout_timer = null;
              _this10.finish(true, _this10._init_config.timeout_return);
            }, this._init_config.timeout_ms_n);
          }
        };
        _createClass(mk_status_task, [{
          key: "finish_b",
          get: function get() {
            return this._finish_b;
          }
        }]);
        return mk_status_task;
      }();
      var __awaiter$6 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      var _mk_network_base;
      (function (_mk_network_base) {
        /**  */
        var message_event = /*#__PURE__*/function (_cc$EventTarget2) {
          _inheritsLoose(message_event, _cc$EventTarget2);
          function message_event(network_) {
            var _this11;
            _this11 = _cc$EventTarget2.call(this) || this;
            /**  */
            _this11._log = new mk_logger(js.getClassName(_assertThisInitialized(_this11)));
            _this11._network = network_;
            return _this11;
          }
          /* -------------------------------  ------------------------------- */
          // @ts-ignore
          var _proto9 = message_event.prototype;
          _proto9.on = function on(type_, callback_, this_, once_b_) {
            if (typeof type_ === "function") {
              var message_id = this._network.config.parse_message_id_f(type_.prototype);
              if (message_id !== undefined) {
                return _cc$EventTarget2.prototype.on.call(this, message_id, callback_, this_, once_b_);
              }
            } else {
              return _cc$EventTarget2.prototype.on.call(this, type_, callback_, this_, once_b_);
            }
            this._log.error(" id ");
            return null;
          }
          // @ts-ignore
          ;

          _proto9.once = function once(type_, callback_, this_) {
            return this.on(type_, callback_, this_, true);
          }
          // @ts-ignore
          ;

          _proto9.off = function off(type_, callback_, this_) {
            if (typeof type_ === "function") {
              var message_id = this._network.config.parse_message_id_f(type_.prototype);
              if (message_id !== undefined) {
                _cc$EventTarget2.prototype.off.call(this, message_id, callback_, this_);
                return;
              }
            } else {
              _cc$EventTarget2.prototype.off.call(this, type_, callback_, this_);
            }
            this._log.error(" id ");
          };
          _proto9.emit = function emit(args_, data_) {
            var type_;
            // 
            if (typeof args_ === "object") {
              data_ = args_;
            } else {
              type_ = args_;
            }
            if (type_ !== undefined) {
              _cc$EventTarget2.prototype.emit.call(this, type_, data_);
            } else {
              var message_id = this._network.config.parse_message_id_f(args_);
              if (message_id === undefined) {
                this._log.error(" id ");
                return;
              }
              _cc$EventTarget2.prototype.emit.call(this, message_id, args_);
            }
          }
          /**
           * 
           * @param data_ 
           * @returns
           */;
          _proto9.send = function send(data_) {
            this._network._send(data_);
          }
          /**
           * 
           * @param data_ 
           * @param timeout_ms_n_ 
           * @returns
           * @remarks
           * 
           */;
          _proto9.request = function request(data_, timeout_ms_n_) {
            this._network._send(data_);
            return this._network._wait(data_, timeout_ms_n_);
          }
          // @ts-ignore
          ;

          _proto9.has = function has(type_, callback_, target_) {
            if (typeof type_ === "function") {
              var message_id = this._network.config.parse_message_id_f(type_.prototype);
              if (message_id !== undefined) {
                return _cc$EventTarget2.prototype.hasEventListener.call(this, message_id, callback_, target_);
              }
            } else {
              return _cc$EventTarget2.prototype.hasEventListener.call(this, type_, callback_, target_);
            }
            this._log.error(" id ");
            return false;
          };
          _proto9.clear = function clear() {
            return _cc$EventTarget2.prototype["clear"].call(this);
          };
          return message_event;
        }(EventTarget);
        _mk_network_base.message_event = message_event;
      })(_mk_network_base || (_mk_network_base = {}));
      /**
       * 
       * @noInheritDoc
       * @remarks
       *
       * - 
       *
       * - (/)
       *
       * - 
       *
       * - 
       *
       * - 
       */
      var mk_network_base = /*#__PURE__*/function (_mk_instance_base5) {
        _inheritsLoose(mk_network_base, _mk_instance_base5);
        function mk_network_base(init_) {
          var _this12;
          _this12 = _mk_instance_base5.call(this) || this;
          /* --------------- public --------------- */
          /**  */
          _this12.event = new mk_event_target();
          /**  */
          _this12.message = new _mk_network_base.message_event(_assertThisInitialized(_this12));
          /**  */
          _this12._log = new mk_logger(js.getClassName(_assertThisInitialized(_this12)));
          /** socket  */
          _this12._state = mk_network_base_.status.closed;
          /**
           * 
           * @internal
           */
          _this12._write_sleep2_b = true;
          /**  */
          _this12._write_as = [];
          /* --------------- private --------------- */
          /**  */
          _this12._reconnect_count_n = 0;
          /**  */
          _this12._reconnect_timer = null;
          /**  */
          _this12._send_timer = null;
          /**  */
          _this12._wait_task_map = new Map();
          _this12.config = new mk_network_base_.init_config(init_);
          // 
          _this12._start_heartbeat();
          // 
          global_event.on(global_event.key.restart, _this12._event_restart, _assertThisInitialized(_this12));
          return _this12;
        }
        /** socket  */
        var _proto10 = mk_network_base.prototype;
        /**  */
        _proto10.connect = function connect(addr_s_) {
          this._state = mk_network_base_.status.connecting;
          this._addr_s = addr_s_;
          this._reset_socket();
        }
        /**  */;
        _proto10.close = function close() {
          var _a;
          this._state = mk_network_base_.status.closing;
          (_a = this._socket) === null || _a === void 0 ? void 0 : _a.close();
        }
        /**
         * 
         * @param data_ 
         * @returns
         * @internal
         */;
        _proto10._send = function _send(data_) {
          this._write_as.push(data_);
          // 
          if (this._write_sleep_b) {
            this._write_sleep_b = false;
          }
        }
        /**
         * 
         * @param key_ 
         * @param timeout_ms_n_ 
         * @returns
         * @internal
         */
        // @ts-ignore
        ;

        _proto10._wait = function _wait(key_, timeout_ms_n_
        // @ts-ignore
        ) {
          if (timeout_ms_n_ === void 0) {
            timeout_ms_n_ = this.config.wait_timeout_ms_n;
          }
          /**  */
          var message_sequence = this.config.parse_message_sequence_f(key_);
          if (message_sequence === undefined) {
            this._log.error("");
            return null;
          }
          /**  */
          var wait_task = this._wait_task_map.get(message_sequence);
          if (wait_task) {
            return wait_task.task;
          } else {
            this._wait_task_map.set(message_sequence, wait_task = new mk_status_task(false, {
              timeout_ms_n: timeout_ms_n_
            }));
          }
          return wait_task.task;
        }
        /** socket  */;
        _proto10._open = function _open(event_) {
          this._state = mk_network_base_.status.open;
          this._log.debug("socket ", event_);
          if (this._write_as.length) {
            this._write_sleep_b = false;
          }
          // 
          this._cancel_reconnect(true);
          // 
          this.event.emit(this.event.key.open);
        }
        /** socket  */;
        _proto10._message = function _message(event_) {
          return __awaiter$6(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {
            var data, message_id;
            return _regeneratorRuntime().wrap(function _callee4$(_context4) {
              while (1) switch (_context4.prev = _context4.next) {
                case 0:
                  if (!this.config.codec) {
                    _context4.next = 6;
                    break;
                  }
                  _context4.next = 3;
                  return this.config.codec.decode(event_.data);
                case 3:
                  _context4.t0 = _context4.sent;
                  _context4.next = 7;
                  break;
                case 6:
                  _context4.t0 = event_.data;
                case 7:
                  data = _context4.t0;
                  if (!(data === undefined)) {
                    _context4.next = 10;
                    break;
                  }
                  return _context4.abrupt("return");
                case 10:
                  this._log.debug("", data);
                  // 
                  this.event.emit(this.event.key.recv, data);
                  /**  id */
                  message_id = this.config.parse_message_id_f(data);
                  if (message_id !== undefined) {
                    // 
                    this.message.emit(message_id, data);
                    // 
                    this._trigger_wait_task(data);
                  }
                case 14:
                case "end":
                  return _context4.stop();
              }
            }, _callee4, this);
          }));
        }
        /** socket  */;
        _proto10._error = function _error(event_) {
          if (this._state === mk_network_base_.status.open) {
            this._log.error("socket ", event_);
          }
        }
        /** socket  */;
        _proto10._close = function _close(event_) {
          var last_status = this._state;
          this._state = mk_network_base_.status.closed;
          if (last_status !== mk_network_base_.status.closed) {
            this._log.warn("socket ", event_);
            this.event.emit(this.event.key.close, event_);
          }
          // 
          if (this._reconnect_timer !== null) {
            if (++this._reconnect_count_n > this.config.max_reconnect_n) {
              this._cancel_reconnect(false);
              return;
            }
            this._log.warn("socket ", this._reconnect_count_n);
          }
          // 
          if (last_status === mk_network_base_.status.open && this._reconnect_timer === null) {
            this._log.warn("socket ");
            this._write_sleep_b = true;
            this._reconnect_timer = setInterval(this._timer_reconnect.bind(this), this.config.reconnect_interval_ms_n);
          }
        }
        /**  */;
        _proto10._timer_send = function _timer_send() {
          return __awaiter$6(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {
            var _this13 = this;
            var _a, data_as, _iterator, _step, v;
            return _regeneratorRuntime().wrap(function _callee5$(_context5) {
              while (1) switch (_context5.prev = _context5.next) {
                case 0:
                  if (!(((_a = this._socket) === null || _a === void 0 ? void 0 : _a.readyState) !== WebSocket.OPEN)) {
                    _context5.next = 2;
                    break;
                  }
                  return _context5.abrupt("return");
                case 2:
                  if (!(this._write_as.length === 0)) {
                    _context5.next = 5;
                    break;
                  }
                  this._write_sleep_b = true;
                  return _context5.abrupt("return");
                case 5:
                  data_as = this._write_as.splice(0, this._write_as.length);
                  if (!this.config.codec) {
                    _context5.next = 10;
                    break;
                  }
                  _context5.next = 9;
                  return Promise.all(data_as.map(function (v) {
                    return _this13.config.codec.encode(v);
                  }));
                case 9:
                  data_as = _context5.sent;
                case 10:
                  for (_iterator = _createForOfIteratorHelperLoose(data_as); !(_step = _iterator()).done;) {
                    v = _step.value;
                    if ((v !== null && v !== void 0 ? v : null) !== null) {
                      this._socket.send(v);
                    }
                  }
                case 11:
                case "end":
                  return _context5.stop();
              }
            }, _callee5, this);
          }));
        }
        /**  */;
        _proto10._timer_reconnect = function _timer_reconnect() {
          if (this._socket.readyState !== WebSocket.OPEN) {
            this._reset_socket();
          }
          // 
          else if (this._reconnect_timer !== null) {
            this._cancel_reconnect(true);
          }
        }
        /**
         * 
         * @param status_b_  | 
         * @returns
         */;
        _proto10._cancel_reconnect = function _cancel_reconnect(status_b_) {
          if (this._reconnect_timer === null) {
            return;
          }
          this._log.warn("socket " + (status_b_ ? "" : ""));
          // 
          this.event.emit(status_b_ ? this.event.key.reconnect_success : this.event.key.reconnect_fail);
          // 
          {
            clearInterval(this._reconnect_timer);
            this._reconnect_timer = null;
            this._reconnect_count_n = 0;
          }
        }
        /**
         * 
         * @param data_ 
         * @returns
         */;
        _proto10._trigger_wait_task = function _trigger_wait_task(data_) {
          /**  id */
          var message_id = this.config.parse_message_id_f(data_);
          /**  */
          var message_sequence = this.config.parse_message_sequence_f(data_);
          if (message_id === undefined) {
            this._log.error(" id ");
            return;
          }
          // 
          if (message_sequence !== undefined) {
            var wait_tak = this._wait_task_map.get(message_sequence);
            if (!wait_tak) {
              return;
            }
            this._wait_task_map["delete"](message_sequence);
            wait_tak.finish(true, data_);
          }
        }
        /**  */;
        _proto10._start_heartbeat = function _start_heartbeat() {
          var _this14 = this;
          if (!this.config.heartbeat_config) {
            return;
          }
          /**  */
          var timeout_timer;
          /**  */
          var recv_f = function recv_f() {
            if (timeout_timer) {
              clearTimeout(timeout_timer);
            }
            // 
            timeout_timer = setTimeout(function () {
              // 
              if (_this14.state !== mk_network_base_.status.open) {
                _this14.event.emit(_this14.event.key.heartbeat_timeout);
              }
            }, _this14.config.heartbeat_config.timeout_ms_n);
          };
          /**  */
          var get_send_data_f = this.config.heartbeat_config.init_f(recv_f);
          // 
          this.event.on(this.event.key.close, function () {
            clearTimeout(timeout_timer);
            timeout_timer = null;
          }, this);
          // 
          if (get_send_data_f) {
            /**  */
            var timer;
            // 
            this.event.on(this.event.key.open, function () {
              timer = setInterval(function () {
                _this14._socket.send(get_send_data_f());
              }, _this14.config.heartbeat_config.interval_ms_n);
            }, this);
            // 
            this.event.on(this.event.key.close, function () {
              clearInterval(timer);
              timer = null;
            }, this);
          }
        }
        /* ------------------------------- get/set ------------------------------- */;
        _proto10._set_write_sleep_b = function _set_write_sleep_b(value_b_) {
          if (this._write_sleep2_b === value_b_) {
            return;
          }
          if (value_b_) {
            if (this._send_timer !== null) {
              clearInterval(this._send_timer);
              this._send_timer = null;
            }
          } else {
            this._send_timer = setInterval(this._timer_send.bind(this), this.config.send_interval_ms_n);
          }
          this._write_sleep2_b = value_b_;
        }
        /* -------------------------------  ------------------------------- */;
        _proto10._event_restart = function _event_restart() {
          // 
          this._write_sleep_b = true;
          // 
          this.event.emit(this.event.key.close, null);
          // 
          this.event.clear();
          this.message.clear();
          // 
          this._write_as.splice(0, this._write_as.length);
          // 
          {
            this._wait_task_map.forEach(function (v) {
              v.finish(true, null);
            });
            this._wait_task_map.clear();
          }
          // 
          this._cancel_reconnect(false);
          // 
          this.close();
        };
        _createClass(mk_network_base, [{
          key: "state",
          get: function get() {
            return this._state;
          }
          /**  */
        }, {
          key: "codec",
          get: function get() {
            return this.config.codec;
          },
          set: function set(value_) {
            this.config.codec = value_;
          }
          /**  */
        }, {
          key: "_write_sleep_b",
          get: function get() {
            return this._write_sleep2_b;
          },
          set: function set(value_b_) {
            this._set_write_sleep_b(value_b_);
          }
        }]);
        return mk_network_base;
      }(mk_instance_base);
      var mk_network_base_;
      (function (mk_network_base_) {
        (function (status) {
          /**  */
          status[status["connecting"] = 0] = "connecting";
          /**  */
          status[status["open"] = 1] = "open";
          /**  */
          status[status["closing"] = 2] = "closing";
          /**  */
          status[status["closed"] = 3] = "closed";
        })(mk_network_base_.status || (mk_network_base_.status = {}));
        /**  */
        var init_config = /*#__PURE__*/function () {
          function init_config(init_) {
            /**
             * 
             * @remarks
             * 
             */
            this.send_interval_ms_n = 0;
            /**
             * 
             * @remarks
             * 
             */
            this.reconnect_interval_ms_n = 1000;
            /**  */
            this.max_reconnect_n = 5;
            /**
             * 
             * @remarks
             * 
             */
            this.wait_timeout_ms_n = 5000;
            Object.assign(this, init_);
          }
          /**
           *  id
           * @param data 
           * @returns 
           */
          var _proto11 = init_config.prototype;
          _proto11.parse_message_id_f = function parse_message_id_f(data) {
            return data === null || data === void 0 ? void 0 : data[global_config$1.network.proto_head_key_tab.__id];
          }
          /**
           * 
           * @param data 
           * @returns 
           */;
          _proto11.parse_message_sequence_f = function parse_message_sequence_f(data) {
            if (global_config$1.network.proto_head_key_tab.__sequence !== undefined) {
              return data === null || data === void 0 ? void 0 : data[global_config$1.network.proto_head_key_tab.__sequence];
            }
          };
          return init_config;
        }();
        mk_network_base_.init_config = init_config;
        /**  */
        var send_tide = /*#__PURE__*/function () {
          /**
           * @param network_ 
           * @param interval_ms_n_ 
           *
           * - -1
           *
           * - 0-n
           */
          function send_tide(network_, interval_ms_n_) {
            /**  */
            this._mess_as = [];
            /**  */
            this._send_timer = null;
            this._network = network_;
            this._send_interval_ms_n = interval_ms_n_;
            // 
            global_event.on(global_event.key.restart, this._event_restart, this);
          }
          /* -------------------------------  ------------------------------- */
          /**  */
          var _proto12 = send_tide.prototype;
          _proto12.send = function send(data_) {
            var _this15 = this;
            if (this._send_interval_ms_n === 0) {
              this._network._send(data_);
              return;
            } else {
              this._mess_as.push(data_);
            }
            // 
            if (this._send_interval_ms_n > 0 && !this._send_timer) {
              this._send_timer = setInterval(function () {
                // 
                if (!_this15._mess_as.length) {
                  clearInterval(_this15._send_timer);
                  _this15._send_timer = null;
                  return;
                }
                while (_this15._mess_as.length) {
                  _this15._network._send(_this15._mess_as.shift());
                }
              }, this._send_interval_ms_n);
            }
          }
          /**  */;
          _proto12.trigger = function trigger() {
            if (this._send_interval_ms_n !== -1) {
              return;
            }
            while (this._mess_as.length) {
              this._network._send(this._mess_as.shift());
            }
          }
          /**  */;
          _proto12.clear = function clear() {
            this._mess_as.splice(0, this._mess_as.length);
          }
          /* -------------------------------  ------------------------------- */;
          _proto12._event_restart = function _event_restart() {
            clearInterval(this._send_timer);
            this._send_timer = null;
          };
          return send_tide;
        }();
        mk_network_base_.send_tide = send_tide;
      })(mk_network_base_ || (mk_network_base_ = {}));

      /**
       *  websocket
       * @noInheritDoc
       */
      var mk_websocket = /*#__PURE__*/function (_mk_network_base2) {
        _inheritsLoose(mk_websocket, _mk_network_base2);
        function mk_websocket(config_) {
          var _this16;
          _this16 = _mk_network_base2.call(this, config_) || this;
          _this16.config = new mk_websocket_.init_config(config_);
          return _this16;
        }
        /* -------------------------------  ------------------------------- */
        /** socket */
        var _proto13 = mk_websocket.prototype;
        _proto13._reset_socket = function _reset_socket() {
          var _this17 = this;
          if (this._socket) {
            ["onopen", "onmessage", "onerror", "onclose"].forEach(function (v_s, k_n) {
              _this17._socket[v_s] = null;
            });
            this._socket.close();
          }
          this._socket = new WebSocket(this._addr_s, this.config.protocol_ss);
          this._socket.binaryType = this.config.binary_type;
          var func_name_ss = ["_open", "_message", "_error", "_close"];
          ["onopen", "onmessage", "onerror", "onclose"].forEach(function (v_s, k_n) {
            _this17._socket[v_s] = _this17[func_name_ss[k_n]].bind(_this17);
          });
        };
        return mk_websocket;
      }(mk_network_base);
      var mk_websocket_;
      (function (mk_websocket_) {
        var init_config = /*#__PURE__*/function (_mk_network_base_$ini) {
          _inheritsLoose(init_config, _mk_network_base_$ini);
          function init_config(init_) {
            var _this18;
            _this18 = _mk_network_base_$ini.call(this, init_) || this;
            /**  */
            _this18.binary_type = "arraybuffer";
            /**  */
            _this18.protocol_ss = [];
            Object.assign(_assertThisInitialized(_this18), init_);
            return _this18;
          }
          return init_config;
        }(mk_network_base_.init_config);
        mk_websocket_.init_config = init_config;
      })(mk_websocket_ || (mk_websocket_ = {}));

      /**
       *  websocket
       * @noInheritDoc
       */
      var mk_websocket_wx = /*#__PURE__*/function (_mk_network_base3) {
        _inheritsLoose(mk_websocket_wx, _mk_network_base3);
        function mk_websocket_wx(config_) {
          var _this19;
          _this19 = _mk_network_base3.call(this, config_) || this;
          _this19.config = new mk_websocket_wx_.init_config(config_);
          return _this19;
        }
        /* -------------------------------  ------------------------------- */
        /** socket */
        var _proto14 = mk_websocket_wx.prototype;
        _proto14._reset_socket = function _reset_socket() {
          var _this20 = this;
          if (this._socket) {
            ["onOpen", "onMessage", "onError", "onClose"].forEach(function (v_s, k_n) {
              _this20._socket[v_s] = null;
            });
            this._socket.close({});
          }
          this._socket = wx.connectSocket({
            url: this._addr_s,
            protocols: this.config.protocol_ss
          });
          var func_name_ss = ["_open", "_message", "_error", "_close"];
          ["onOpen", "onMessage", "onError", "onClose"].forEach(function (v_s, k_n) {
            _this20._socket[v_s] = _this20[func_name_ss[k_n]].bind(_this20);
          });
        };
        return mk_websocket_wx;
      }(mk_network_base);
      var mk_websocket_wx_;
      (function (mk_websocket_wx_) {
        var init_config = /*#__PURE__*/function (_mk_network_base_$ini2) {
          _inheritsLoose(init_config, _mk_network_base_$ini2);
          function init_config(init_) {
            var _this21;
            _this21 = _mk_network_base_$ini2.call(this, init_) || this;
            /**  */
            _this21.protocol_ss = [];
            Object.assign(_assertThisInitialized(_this21), init_);
            return _this21;
          }
          return init_config;
        }(mk_network_base_.init_config);
        mk_websocket_wx_.init_config = init_config;
      })(mk_websocket_wx_ || (mk_websocket_wx_ = {}));
      var mk_network = exports('network', /*#__PURE__*/Object.freeze({
        __proto__: null,
        base: mk_network_base,
        get base_() {
          return mk_network_base_;
        },
        http: mk_http$1,
        get http_() {
          return mk_http_;
        },
        websocket: mk_websocket,
        get websocket_() {
          return mk_websocket_;
        },
        websocket_wx: mk_websocket_wx
      }));
      var __awaiter$5 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**  */
      var mk_tool_func = /*#__PURE__*/function (_mk_instance_base6) {
        _inheritsLoose(mk_tool_func, _mk_instance_base6);
        function mk_tool_func() {
          var _this22;
          _this22 = _mk_instance_base6.apply(this, arguments) || this;
          _this22._run_parent_func_mark_map = new Map();
          _this22._timeout_warning_mark_map = new Map();
          return _this22;
        }
        /* -------------------------------  ------------------------------- */
        /**  */
        var _proto15 = mk_tool_func.prototype;
        _proto15.run_parent_func = function run_parent_func(target_, key_) {
          var _this23 = this;
          var key_as = [];
          // 
          {
            if (Array.isArray(key_)) {
              var _key_as;
              (_key_as = key_as).push.apply(_key_as, key_);
            } else {
              key_as.push(key_);
            }
            key_as = key_as.filter(function (v) {
              return target_[v] && typeof target_[v] === "function";
            });
          }
          /**  */
          var mark_tab = this._run_parent_func_mark_map.get(target_);
          if (!mark_tab) {
            this._run_parent_func_mark_map.set(target_, mark_tab = Object.create(null));
          }
          key_as.forEach(function (v) {
            // 
            if (mark_tab[v]) {
              return;
            }
            /**  */
            var func_fs = _this23._get_parent_func(target_.constructor, v);
            // 
            mark_tab[v] = true;
            // 
            target_[v] = function () {
              for (var _len16 = arguments.length, args_as = new Array(_len16), _key19 = 0; _key19 < _len16; _key19++) {
                args_as[_key19] = arguments[_key19];
              }
              return __awaiter$5(_this23, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {
                var _a, result, k2_n, _a2, _func_fs;
                return _regeneratorRuntime().wrap(function _callee6$(_context6) {
                  while (1) switch (_context6.prev = _context6.next) {
                    case 0:
                      _context6.prev = 0;
                      k2_n = 0;
                    case 2:
                      if (!(k2_n < func_fs.length - 1)) {
                        _context6.next = 10;
                        break;
                      }
                      result = (_a = func_fs[k2_n]) === null || _a === void 0 ? void 0 : (_a2 = _a).call.apply(_a2, [target_].concat(args_as));
                      if (!(result instanceof Promise)) {
                        _context6.next = 7;
                        break;
                      }
                      _context6.next = 7;
                      return result;
                    case 7:
                      k2_n++;
                      _context6.next = 2;
                      break;
                    case 10:
                      if (!func_fs.length) {
                        _context6.next = 16;
                        break;
                      }
                      result = (_func_fs = func_fs[func_fs.length - 1]).call.apply(_func_fs, [target_].concat(args_as));
                      if (!(result instanceof Promise)) {
                        _context6.next = 16;
                        break;
                      }
                      _context6.next = 15;
                      return result;
                    case 15:
                      result = _context6.sent;
                    case 16:
                      _context6.next = 23;
                      break;
                    case 18:
                      _context6.prev = 18;
                      _context6.t0 = _context6["catch"](0);
                      if (!(_context6.t0 === "")) {
                        _context6.next = 22;
                        break;
                      }
                      return _context6.abrupt("return");
                    case 22:
                      mk_log.error(_context6.t0);
                    case 23:
                      return _context6.abrupt("return", result);
                    case 24:
                    case "end":
                      return _context6.stop();
                  }
                }, _callee6, null, [[0, 18]]);
              }));
            };
          });
        }
        /**
         * 
         * @param time_ms_n_ 
         */;
        _proto15.timeout_warning = function timeout_warning(time_ms_n_, target_, key_) {
          if (!time_ms_n_) {
            return;
          }
          var key_as = [];
          // 
          {
            if (Array.isArray(key_)) {
              var _key_as2;
              (_key_as2 = key_as).push.apply(_key_as2, key_);
            } else {
              key_as.push(key_);
            }
            key_as = key_as.filter(function (v) {
              return target_[v] && typeof target_[v] === "function";
            });
          }
          /**  */
          var mark_tab = this._timeout_warning_mark_map.get(target_);
          if (!mark_tab) {
            this._timeout_warning_mark_map.set(target_, mark_tab = Object.create(null));
          }
          key_as.forEach(function (key_s_) {
            // 
            if (!target_[key_s_] || mark_tab[key_s_]) {
              return;
            }
            mark_tab[key_s_] = true;
            var old_f = target_[key_s_];
            target_[key_s_] = function () {
              /**  */
              var timer = setTimeout(function () {
                mk_log.error(js.getClassName(target_) + ":" + key_s_ + " \u6267\u884C\u8D85\u65F6", target_);
              }, time_ms_n_);
              for (var _len17 = arguments.length, args_as = new Array(_len17), _key20 = 0; _key20 < _len17; _key20++) {
                args_as[_key20] = arguments[_key20];
              }
              var result = old_f.call.apply(old_f, [target_].concat(args_as));
              // 
              if (result instanceof Promise) {
                result.then(function () {
                  clearTimeout(timer);
                });
              } else {
                clearTimeout(timer);
              }
              return result;
            };
          });
        }
        /**  */;
        _proto15._get_parent_func = function _get_parent_func(target_, key_, old_target_, func_fs_) {
          if (func_fs_ === void 0) {
            func_fs_ = [];
          }
          if (!target_ || target_ === Object) {
            return func_fs_;
          }
          this._get_parent_func(js.getSuper(target_), key_, target_, func_fs_);
          if (target_.prototype[key_] && (old_target_ ? target_.prototype[key_] !== old_target_.prototype[key_] : true)) {
            func_fs_.push(target_.prototype[key_]);
          }
          return func_fs_;
        };
        return mk_tool_func;
      }(mk_instance_base);
      var mk_tool_func$1 = mk_tool_func.instance();
      var __awaiter$4 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * 
       * @remarks
       *
       * -  (cc.Node/cc.Asset) 
       *
       * -  function 
       */
      var mk_release = exports('release', /*#__PURE__*/function () {
        function mk_release() {
          /**  */
          this._node_set = new Set();
          /**  */
          this._asset_set = new Set();
          /**  */
          this._object_set = new Set();
          /**  */
          this._callback_set = new Set();
        }
        /* -------------------------------  ------------------------------- */
        /**
         * 
         * @param object_ 
         */
        var _proto16 = mk_release.prototype;
        _proto16.add = function add(object_) {
          if (!object_) {
            mk_log.error("", object_);
            return object_;
          }
          // 
          if (object_ instanceof Node) {
            if (object_.isValid) {
              this._node_set.add(object_);
            }
          } else if (object_ instanceof Asset) {
            if (object_.isValid) {
              this._asset_set.add(object_);
            }
          } else if (typeof object_ === "function") {
            this._callback_set.add(object_);
          } else {
            this._object_set.add(object_);
          }
          return object_;
        }
        /**
         * 
         * @param object_ 
         */;
        _proto16.release = function release(object_) {
          return __awaiter$4(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {
            return _regeneratorRuntime().wrap(function _callee7$(_context7) {
              while (1) switch (_context7.prev = _context7.next) {
                case 0:
                  if (!(object_ instanceof Node)) {
                    _context7.next = 4;
                    break;
                  }
                  if (this._node_set["delete"](object_) && object_.isValid) {
                    object_.removeFromParent();
                    object_.destroy();
                  }
                  _context7.next = 17;
                  break;
                case 4:
                  if (!(object_ instanceof Asset)) {
                    _context7.next = 8;
                    break;
                  }
                  if (this._asset_set["delete"](object_) && object_.isValid) {
                    object_.decRef();
                  }
                  _context7.next = 17;
                  break;
                case 8:
                  if (!(typeof object_ === "function")) {
                    _context7.next = 14;
                    break;
                  }
                  if (!this._callback_set["delete"](object_)) {
                    _context7.next = 12;
                    break;
                  }
                  _context7.next = 12;
                  return object_();
                case 12:
                  _context7.next = 17;
                  break;
                case 14:
                  if (!this._object_set["delete"](object_)) {
                    _context7.next = 17;
                    break;
                  }
                  _context7.next = 17;
                  return object_.release();
                case 17:
                case "end":
                  return _context7.stop();
              }
            }, _callee7, this);
          }));
        }
        /**  */;
        _proto16.release_all = function release_all() {
          return __awaiter$4(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {
            var _iterator2, _step2, v, _iterator3, _step3, v_f;
            return _regeneratorRuntime().wrap(function _callee8$(_context8) {
              while (1) switch (_context8.prev = _context8.next) {
                case 0:
                  this._asset_set.forEach(function (v) {
                    if (v.isValid) {
                      v.decRef();
                    }
                  });
                  this._node_set.forEach(function (v) {
                    if (v.isValid) {
                      v.removeFromParent();
                      v.destroy();
                    }
                  });
                  _iterator2 = _createForOfIteratorHelperLoose(this._object_set);
                case 3:
                  if ((_step2 = _iterator2()).done) {
                    _context8.next = 9;
                    break;
                  }
                  v = _step2.value;
                  _context8.next = 7;
                  return v.release();
                case 7:
                  _context8.next = 3;
                  break;
                case 9:
                  _iterator3 = _createForOfIteratorHelperLoose(this._callback_set);
                case 10:
                  if ((_step3 = _iterator3()).done) {
                    _context8.next = 16;
                    break;
                  }
                  v_f = _step3.value;
                  _context8.next = 14;
                  return v_f();
                case 14:
                  _context8.next = 10;
                  break;
                case 16:
                  this._asset_set.clear();
                  this._node_set.clear();
                  this._object_set.clear();
                  this._callback_set.clear();
                case 20:
                case "end":
                  return _context8.stop();
              }
            }, _callee8, this);
          }));
        };
        return mk_release;
      }());
      var __awaiter$3 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * bundle 
       * @noInheritDoc
       * @remarks
       *
       * - (/) load_scene
       *
       * - (/) bundle
       *
       * -  bundle 
       *
       * - (bundle/scene)
       *
       * -  bundle 
       */
      var mk_bundle = /*#__PURE__*/function (_mk_instance_base7) {
        _inheritsLoose(mk_bundle, _mk_instance_base7);
        function mk_bundle() {
          var _this24;
          _this24 = _mk_instance_base7.call(this) || this;
          /* --------------- public --------------- */
          /**  */
          _this24.event = new mk_event_target();
          /** bundle */
          _this24.bundle_map = new Map();
          /**  */
          _this24.switch_scene_b = false;
          /* --------------- private --------------- */
          /**  */
          _this24._init_task = new mk_status_task(false);
          /**  */
          _this24._engine_init_task = new mk_status_task(false);
          /**  */
          _this24._log = new mk_logger("bundle");
          // 
          game.once(Game.EVENT_GAME_INITED, function () {
            _this24._engine_init_task.finish(true);
          });
          // 
          director.once(Director.EVENT_BEFORE_SCENE_LAUNCH, function (scene) {
            if (!scene.name) {
              _this24._log.warn("");
              return;
            }
            _this24.bundle_s = "main";
            _this24._scene_s = scene.name;
            _this24._init_task.finish(true);
          }, _assertThisInitialized(_this24));
          return _this24;
        }
        /** bundle */
        var _proto17 = mk_bundle.prototype;
        /* -------------------------------  ------------------------------- */
        /**
         *  bundle 
         * @param bundle_ bundle 
         */
        _proto17.set = function set(bundle_) {
          var bundle_data = this.bundle_map.get(bundle_.bundle_s);
          // 
          if (bundle_data) {
            Object.assign(bundle_data, bundle_);
          }
          // 
          else {
            this.bundle_map.set(bundle_.bundle_s, bundle_data = new mk_bundle_.bundle_data(bundle_));
          }
        }
        /**
         *  bundle
         * @param args_ bundle  | 
         * @returns
         */;
        _proto17.load = function load(args_) {
          return __awaiter$3(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {
            var _this25 = this;
            var _a, load_config, bundle_info, bundle;
            return _regeneratorRuntime().wrap(function _callee9$(_context9) {
              while (1) switch (_context9.prev = _context9.next) {
                case 0:
                  /**  */
                  load_config = typeof args_ === "string" ? new mk_bundle_.load_config({
                    bundle_s: args_
                  }) : args_;
                  /** bundle  */
                  bundle_info = (_a = this.bundle_map.get(load_config.bundle_s)) !== null && _a !== void 0 ? _a : new mk_bundle_.bundle_info({
                    bundle_s: load_config.bundle_s
                  });
                  _context9.next = 4;
                  return this._engine_init_task.task;
                case 4:
                  /** bundle  */
                  bundle = assetManager.getBundle(bundle_info.bundle_s);
                  if (!bundle) {
                    _context9.next = 7;
                    break;
                  }
                  return _context9.abrupt("return", bundle);
                case 7:
                  return _context9.abrupt("return", new Promise(function (resolve_f) {
                    var _a;
                    if (!bundle_info) {
                      return;
                    }
                    assetManager.loadBundle((_a = bundle_info.origin_s) !== null && _a !== void 0 ? _a : bundle_info.bundle_s, {
                      version: bundle_info.version_s,
                      // eslint-disable-next-line @typescript-eslint/naming-convention
                      onFileProgress: load_config.progress_callback_f
                    }, function (error, bundle) {
                      if (error) {
                        _this25._log.error("bundle", error);
                        resolve_f(null);
                        return;
                      }
                      // bundle
                      if (!_this25.bundle_map.has(bundle_info.bundle_s)) {
                        _this25.bundle_map.set(bundle_info.bundle_s, bundle_info);
                      }
                      resolve_f(bundle);
                    });
                  }));
                case 8:
                case "end":
                  return _context9.stop();
              }
            }, _callee9, this);
          }));
        }
        /**
         * 
         * @param scene_s_ 
         * @param config_ 
         * @returns
         */;
        _proto17.load_scene = function load_scene(scene_s_, config_) {
          return __awaiter$3(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {
            var _this26 = this;
            var _a, config, bundle_info, bundle, preload_b, progress_callback_f;
            return _regeneratorRuntime().wrap(function _callee11$(_context11) {
              while (1) switch (_context11.prev = _context11.next) {
                case 0:
                  if (scene_s_) {
                    _context11.next = 3;
                    break;
                  }
                  this._log.error("", scene_s_);
                  return _context11.abrupt("return", false);
                case 3:
                  _context11.next = 5;
                  return this._init_task.task;
                case 5:
                  config = new mk_bundle_.switch_scene_config(config_);
                  bundle_info = (_a = this.bundle_map.get(config.bundle_s)) !== null && _a !== void 0 ? _a : new mk_bundle_.bundle_info({
                    bundle_s: config.bundle_s
                  });
                  _context11.next = 9;
                  return this.load(bundle_info);
                case 9:
                  bundle = _context11.sent;
                  if (bundle) {
                    _context11.next = 12;
                    break;
                  }
                  return _context11.abrupt("return", false);
                case 12:
                  /**  */
                  preload_b = false; // 
                  if (!config.progress_callback_f) {
                    _context11.next = 20;
                    break;
                  }
                  progress_callback_f = config.progress_callback_f;
                  _context11.next = 17;
                  return new Promise(function (resolve_f) {
                    bundle === null || bundle === void 0 ? void 0 : bundle.preloadScene(scene_s_, progress_callback_f, function (error) {
                      if (error) {
                        _this26._log.error(error);
                      }
                      resolve_f(!error);
                    });
                  });
                case 17:
                  preload_b = _context11.sent;
                  _context11.next = 23;
                  break;
                case 20:
                  _context11.next = 22;
                  return new Promise(function (resolve_f) {
                    bundle === null || bundle === void 0 ? void 0 : bundle.preloadScene(scene_s_, function (error) {
                      if (error) {
                        _this26._log.error(error);
                      }
                      resolve_f(!error);
                    });
                  });
                case 22:
                  preload_b = _context11.sent;
                case 23:
                  if (!(config.preload_b || !preload_b)) {
                    _context11.next = 25;
                    break;
                  }
                  return _context11.abrupt("return", preload_b);
                case 25:
                  if (config.preload_b) {
                    _context11.next = 33;
                    break;
                  }
                  this.switch_scene_b = true;
                  //  bundle 
                  if (!(bundle.name !== this._bundle_s)) {
                    _context11.next = 30;
                    break;
                  }
                  _context11.next = 30;
                  return this.event.request(this.event.key.before_bundle_switch, {
                    curr_bundle_s: this._bundle_s,
                    next_bundle_s: config.bundle_s
                  });
                case 30:
                  _context11.next = 32;
                  return Promise.all(this.event.request(this.event.key.before_scene_switch, {
                    curr_scene_s: this._scene_s,
                    next_scene_s: scene_s_
                  }));
                case 32:
                  return _context11.abrupt("return", new Promise(function (resolve_f) {
                    bundle === null || bundle === void 0 ? void 0 : bundle.loadScene(scene_s_, function (error, scene_asset) {
                      return __awaiter$3(_this26, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {
                        var _this27 = this;
                        var _a, _b, manage;
                        return _regeneratorRuntime().wrap(function _callee10$(_context10) {
                          while (1) switch (_context10.prev = _context10.next) {
                            case 0:
                              if (!error) {
                                _context10.next = 4;
                                break;
                              }
                              resolve_f(false);
                              this._log.error(error);
                              return _context10.abrupt("return");
                            case 4:
                              /**  */
                              manage = (_a = this.bundle_map.get(bundle.name)) === null || _a === void 0 ? void 0 : _a.manage; // 
                              if (!manage) {
                                _context10.next = 9;
                                break;
                              }
                              _context10.next = 8;
                              return (_b = manage.init) === null || _b === void 0 ? void 0 : _b.call(manage);
                            case 8:
                              manage.valid_b = true;
                            case 9:
                              // 
                              director.runScene(scene_asset, config === null || config === void 0 ? void 0 : config.before_load_callback_f, function (error, scene) {
                                var _a, _b;
                                // 
                                if (!error) {
                                  _this27.bundle_s = bundle.name;
                                  _this27.pre_scene_s = _this27.scene_s;
                                  _this27.scene_s = scene_s_;
                                } else if (manage) {
                                  manage.valid_b = false;
                                }
                                (_a = config.unloaded_callback_f) === null || _a === void 0 ? void 0 : _a.call(config);
                                (_b = config.launched_callback_f) === null || _b === void 0 ? void 0 : _b.call(config, error, scene);
                                resolve_f(!scene);
                              });
                            case 10:
                            case "end":
                              return _context10.stop();
                          }
                        }, _callee10, this);
                      }));
                    });
                  }).then(function (result_b) {
                    _this26.switch_scene_b = false;
                    return result_b;
                  }));
                case 33:
                  return _context11.abrupt("return", false);
                case 34:
                case "end":
                  return _context11.stop();
              }
            }, _callee11, this);
          }));
        }
        /**  bundle */;
        _proto17.reload = function reload(bundle_) {
          return __awaiter$3(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {
            var _a, bundle_script_tab, system_js, script_cache_tab, bundle_root, reg, bundle;
            return _regeneratorRuntime().wrap(function _callee12$(_context12) {
              while (1) switch (_context12.prev = _context12.next) {
                case 0:
                  {
                    _context12.next = 3;
                    break;
                  }
                case 3:
                  _context12.next = 5;
                  return this._engine_init_task.task;
                case 5:
                  if (!(this.bundle_s === bundle_.bundle_s)) {
                    _context12.next = 8;
                    break;
                  }
                  this._log.error(" bundle ");
                  return _context12.abrupt("return", null);
                case 8:
                  /** bundle  */
                  bundle_script_tab = {};
                  /** js  */
                  system_js = window["System"];
                  /**  */
                  script_cache_tab = system_js[Reflect.ownKeys(system_js).find(function (v) {
                    return typeof v === "symbol";
                  })]; //  bundle 
                  this.set(bundle_);
                  //  bundle 
                  Object.keys(script_cache_tab).forEach(function (v_s) {
                    var current = script_cache_tab[v_s];
                    var parent = script_cache_tab[v_s].p;
                    if (!(parent === null || parent === void 0 ? void 0 : parent.d) || current.id !== parent.id) {
                      return;
                    }
                    var name_s = parent.id.slice(parent.id.lastIndexOf("/") + 1);
                    bundle_script_tab[name_s] = parent;
                  });
                  // 
                  bundle_root = (_a = bundle_script_tab[bundle_.bundle_s]) === null || _a === void 0 ? void 0 : _a.d[0];
                  if (bundle_root) {
                    bundle_root.d.forEach(function (v) {
                      system_js["delete"](v.id);
                    });
                    system_js["delete"](bundle_root.id);
                    system_js["delete"](bundle_root.p.id);
                  }
                  reg = new RegExp(bundle_.bundle_s + "(_|/)");
                  Object.keys(js._nameToClass).filter(function (v_s) {
                    return v_s.match(reg) !== null;
                  }).forEach(function (v_s) {
                    js.unregisterClass(js.getClassByName(v_s));
                  });
                  bundle = assetManager.getBundle(bundle_.bundle_s);
                  if (bundle) {
                    bundle.releaseAll();
                    assetManager.removeBundle(bundle);
                  }
                  return _context12.abrupt("return", this.load(bundle_));
                case 20:
                case "end":
                  return _context12.stop();
              }
            }, _callee12, this);
          }));
        }
        /* ------------------------------- get/set ------------------------------- */;
        _proto17._set_bundle_s = function _set_bundle_s(value_s_) {
          return __awaiter$3(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {
            var _a, pre_bundle_info, bundle_info;
            return _regeneratorRuntime().wrap(function _callee13$(_context13) {
              while (1) switch (_context13.prev = _context13.next) {
                case 0:
                  this.pre_bundle_s = this._bundle_s;
                  this._bundle_s = value_s_;
                  // bundle 
                  if (!(this._bundle_s !== this.pre_bundle_s)) {
                    _context13.next = 10;
                    break;
                  }
                  /**  bundle */
                  pre_bundle_info = this.bundle_map.get(this.pre_bundle_s);
                  /**  bundle */
                  bundle_info = this.bundle_map.get(this._bundle_s); //  bundle
                  (_a = pre_bundle_info === null || pre_bundle_info === void 0 ? void 0 : pre_bundle_info.manage) === null || _a === void 0 ? void 0 : _a.close();
                  //  bundle
                  if (!(bundle_info === null || bundle_info === void 0 ? void 0 : bundle_info.manage)) {
                    _context13.next = 9;
                    break;
                  }
                  _context13.next = 9;
                  return bundle_info.manage.open();
                case 9:
                  this.event.emit(this.event.key.after_bundle_switch, {
                    curr_bundle_s: this._bundle_s,
                    pre_bundle_s: this.pre_bundle_s
                  });
                case 10:
                case "end":
                  return _context13.stop();
              }
            }, _callee13, this);
          }));
        };
        _proto17._set_scene_s = function _set_scene_s(value_s) {
          this.pre_scene_s = this._scene_s;
          this._scene_s = value_s;
          // 
          if (this._scene_s !== this.pre_scene_s) {
            this.event.emit(this.event.key.after_scene_switch, {
              curr_scene_s: this._scene_s,
              pre_scene_s: this.pre_scene_s
            });
          }
        };
        _createClass(mk_bundle, [{
          key: "bundle_s",
          get: function get() {
            return this._bundle_s;
          },
          set: function set(value_s_) {
            this._set_bundle_s(value_s_);
          }
          /**  */
        }, {
          key: "scene_s",
          get: function get() {
            return this._scene_s;
          },
          set: function set(value_s) {
            this._set_scene_s(value_s);
          }
        }]);
        return mk_bundle;
      }(mk_instance_base);
      var mk_bundle_;
      (function (mk_bundle_) {
        /** bundle  */
        var bundle_info = function bundle_info(init_) {
          Object.assign(this, init_);
        };
        mk_bundle_.bundle_info = bundle_info;
        /**
         * bundle 
         * @noInheritDoc
         */
        var bundle_data = /*#__PURE__*/function (_bundle_info) {
          _inheritsLoose(bundle_data, _bundle_info);
          function bundle_data(init_) {
            var _this28;
            _this28 = _bundle_info.call(this, init_) || this;
            Object.assign(_assertThisInitialized(_this28), init_);
            return _this28;
          }
          return bundle_data;
        }(bundle_info);
        mk_bundle_.bundle_data = bundle_data;
        /** load  */
        var load_config = function load_config(init_) {
          Object.assign(this, init_);
        };
        mk_bundle_.load_config = load_config;
        /** switch_scene  */
        var switch_scene_config = function switch_scene_config(init_) {
          Object.assign(this, init_);
        };
        mk_bundle_.switch_scene_config = switch_scene_config;
        /**
         * bundle 
         * @noInheritDoc
         * @remarks
         *  initopenclose  super.xxx 
         */
        var bundle_manage_base = /*#__PURE__*/function () {
          function bundle_manage_base() {
            var _this29 = this;
            /**  */
            this.valid_b = false;
            /* --------------- protected --------------- */
            /**  */
            this._release_manage = new mk_release();
            //  bundle 
            setTimeout(function () {
              return __awaiter$3(_this29, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {
                return _regeneratorRuntime().wrap(function _callee14$(_context14) {
                  while (1) switch (_context14.prev = _context14.next) {
                    case 0:
                      {
                        _context14.next = 4;
                        break;
                      }
                    case 3:
                      this.open();
                    case 4:
                      mk_bundle.instance().set({
                        bundle_s: this.name_s,
                        manage: this
                      });
                    case 5:
                    case "end":
                      return _context14.stop();
                  }
                }, _callee14, this);
              }));
            }, 0);
            // 
            this.node_pool_tab = new Proxy(js.createMap(true), {
              get: function get(target_, key_) {
                if (!target_[key_]) {
                  target_[key_] = new NodePool(key_);
                }
                return target_[key_];
              }
            });
            // 
            mk_tool_func$1.run_parent_func(this, ["init", "open", "close"]);
          }
          /**
           * 
           * @remarks
           *  bundle  bundle 
           */
          var _proto18 = bundle_manage_base.prototype;
          _proto18.open = function open() {
            if (this.valid_b) {
              mk_log.error("bundle ");
              throw "";
            }
            this.valid_b = true;
          }
          /**
           * 
           * @remarks
           *  bundle  bundle 
           */;
          _proto18.close = function close() {
            var _a, _b;
            if (!this.valid_b) {
              mk_log.error("bundle ");
              throw "";
            }
            this.valid_b = false;
            // 
            this.event.clear();
            // 
            (_a = this.network) === null || _a === void 0 ? void 0 : _a.event.clear();
            // 
            (_b = this.data) === null || _b === void 0 ? void 0 : _b.reset();
            // 
            for (var k_s in this.node_pool_tab) {
              if (Object.prototype.hasOwnProperty.call(this.node_pool_tab, k_s)) {
                this.node_pool_tab[k_s].clear();
                delete this.node_pool_tab[k_s];
              }
            }
            // 
            this._release_manage.release_all();
          }
          /* -------------------------------  ------------------------------- */;
          _proto18.follow_release = function follow_release(object_) {
            if (!object_) {
              return object_;
            }
            // 
            this._release_manage.add(object_);
            // 
            if (!this.valid_b) {
              this._release_manage.release_all();
            }
            return object_;
          };
          _proto18.cancel_release = function cancel_release(object_) {
            if (!object_) {
              return object_;
            }
            // 
            this._release_manage.release(object_);
            return object_;
          };
          return bundle_manage_base;
        }();
        mk_bundle_.bundle_manage_base = bundle_manage_base;
      })(mk_bundle_ || (mk_bundle_ = {}));
      var mk_bundle$1 = mk_bundle.instance();
      var __awaiter$2 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * 
       * @noInheritDoc
       */
      var mk_game = /*#__PURE__*/function (_mk_instance_base8) {
        _inheritsLoose(mk_game, _mk_instance_base8);
        function mk_game() {
          var _this30;
          _this30 = _mk_instance_base8.apply(this, arguments) || this;
          /* --------------- private --------------- */
          /**  */
          _this30._restarting_b = false;
          /**  */
          _this30._pause_data_map = new Map();
          return _this30;
        }
        /* --------------- public --------------- */
        /**  */
        var _proto19 = mk_game.prototype;
        /* -------------------------------  ------------------------------- */
        /**
         * 
         * @remarks
         *  cc.game.restart()
         */
        _proto19.restart = function restart() {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {
            return _regeneratorRuntime().wrap(function _callee15$(_context15) {
              while (1) switch (_context15.prev = _context15.next) {
                case 0:
                  this._restarting_b = true;
                  _context15.next = 3;
                  return Promise.all(global_event.request(global_event.key.wait_close_scene));
                case 3:
                  _context15.next = 5;
                  return Promise.all(global_event.request(global_event.key.restart));
                case 5:
                  game.restart();
                  this._restarting_b = false;
                case 7:
                case "end":
                  return _context15.stop();
              }
            }, _callee15, this);
          }));
        }
        /**
         * 
         * @param node_ 
         * @param recursion_b_ 
         */;
        _proto19.pause = function pause(node_, recursion_b_) {
          var _this31 = this;
          if (recursion_b_ === void 0) {
            recursion_b_ = false;
          }
          var _a;
          /**  */
          var dragon_bones = !dragonBones ? null : node_.getComponent(dragonBones.ArmatureDisplay);
          /** spine */
          var spine = !sp ? null : node_.getComponent(sp.Skeleton);
          /**  */
          var pause_data = this._pause_data_map.get(node_);
          if (!pause_data) {
            this._pause_data_map.set(node_, pause_data = {});
          }
          // 
          director.getScheduler().pauseTarget(node_);
          // 
          (_a = node_.getComponent(Animation)) === null || _a === void 0 ? void 0 : _a.pause();
          // 
          TweenSystem.instance.ActionManager.pauseTarget(node_);
          // 
          if (dragon_bones) {
            pause_data.dragon_bones_time_scale_n = dragon_bones.timeScale;
            dragon_bones.timeScale = 0;
          }
          // spine
          if (spine) {
            pause_data.spine_time_scale_n = spine.timeScale;
            spine.timeScale = 0;
          }
          // 
          if (recursion_b_) {
            node_.children.forEach(function (v) {
              _this31.pause(v, recursion_b_);
            });
          }
        }
        /**
         * 
         * @param node_ 
         * @param recursion_b_ 
         */;
        _proto19.resume = function resume(node_, recursion_b_) {
          var _this32 = this;
          if (recursion_b_ === void 0) {
            recursion_b_ = false;
          }
          var _a, _b, _c;
          /**  */
          var dragon_bones = !dragonBones ? null : node_.getComponent(dragonBones.ArmatureDisplay);
          /** spine */
          var spine = !sp ? null : node_.getComponent(sp.Skeleton);
          /**  */
          var pause_data = this._pause_data_map.get(node_);
          // 
          director.getScheduler().resumeTarget(node_);
          // 
          (_a = node_.getComponent(Animation)) === null || _a === void 0 ? void 0 : _a.resume();
          // 
          TweenSystem.instance.ActionManager.resumeTarget(node_);
          // 
          if (dragon_bones) {
            dragon_bones.timeScale = (_b = pause_data === null || pause_data === void 0 ? void 0 : pause_data.dragon_bones_time_scale_n) !== null && _b !== void 0 ? _b : 1;
          }
          // spine
          if (spine) {
            spine.timeScale = (_c = pause_data === null || pause_data === void 0 ? void 0 : pause_data.spine_time_scale_n) !== null && _c !== void 0 ? _c : 1;
          }
          // 
          if (recursion_b_) {
            node_.children.forEach(function (v) {
              _this32.resume(v, recursion_b_);
            });
          }
        };
        _createClass(mk_game, [{
          key: "restarting_b",
          get: function get() {
            return this._restarting_b;
          }
        }]);
        return mk_game;
      }(mk_instance_base);
      var mk_game$1 = exports('game', mk_game.instance());
      var __awaiter$1 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      var _mk_asset;
      (function (_mk_asset) {
        /**  */
        var release_info = function release_info(init_) {
          /**  */
          this.join_time_ms_n = Date.now();
          Object.assign(this, init_);
        };
        _mk_asset.release_info = release_info;
      })(_mk_asset || (_mk_asset = {}));
      /**
       * 
       * @noInheritDoc
       * @remarks
       *
       * -  getget_dir
       *
       * -  EDITOR 
       *
       * - 
       *
       * - db://xxx.prefab
       *
       * -  2 1  global_config.resources.cache_lifetime_ms_n 
       *
       * -  cache_lifetime_ms_n (/)
       *
       * - 
       *
       * - 
       */
      var mk_asset = /*#__PURE__*/function (_mk_instance_base9) {
        _inheritsLoose(mk_asset, _mk_instance_base9);
        function mk_asset() {
          var _this33;
          _this33 = _mk_instance_base9.call(this) || this;
          /* --------------- private --------------- */
          /**  */
          _this33._log = new mk_logger("asset");
          /**  */
          _this33._asset_manage_map = new Map();
          /**  */
          _this33._asset_release_map = new Map();
          //  decRef 
          {
            /**  */
            // eslint-disable-next-line @typescript-eslint/no-this-alias
            var _self = _assertThisInitialized(_this33);
            /** decRef  */
            var origin_f = Asset.prototype.decRef;
            Asset.prototype.decRef = function () {
              var _this34 = this;
              for (var _len18 = arguments.length, args_as = new Array(_len18), _key21 = 0; _key21 < _len18; _key21++) {
                args_as[_key21] = arguments[_key21];
              }
              var result = origin_f.call.apply(origin_f, [this].concat(args_as));
              // 
              if (!_self._asset_manage_map.has(this.nativeUrl || this._uuid)) {
                return result;
              }
              // 
              if (mk_game$1.restarting_b) {
                // 
                Promise.all(global_event.request(global_event.key.wait_close_scene)).then(function (v) {
                  mk_asset.instance().release(_this34);
                });
                return result;
              }
              //  2 
              if (this.refCount === 1) {
                _self._asset_release_map.set(this.nativeUrl || this._uuid, new _mk_asset.release_info({
                  asset: this
                }));
              }
              return result;
            };
          }
          // 
          _this33._release_timer = setInterval(_this33._auto_release_asset.bind(_assertThisInitialized(_this33)), mk_asset._config.cache_lifetime_ms_n);
          // 
          setTimeout(function () {
            global_event.once(global_event.key.restart, _this33._event_restart, mk_asset.instance());
          }, 0);
          return _this33;
        }
        /* -------------------------------  ------------------------------- */
        /**
         * 
         * @param path_s_ 
         * @param type_ 
         * @param target_ 
         * @param config_ 
         * @returns
         */
        var _proto20 = mk_asset.prototype;
        _proto20.get = function get(path_s_, type_, target_, config_) {
          var _this35 = this;
          /**  */
          var get_config = config_ !== null && config_ !== void 0 ? config_ : {};
          /**  */
          var remote_b = Boolean(get_config.remote_option);
          // 
          {
            // 
            if (path_s_.startsWith("db://assets/")) {
              path_s_ = path_s_.slice(12);
              //  bundle
              {
                var dir_s = path_s_.slice(0, path_s_.indexOf("/"));
                path_s_ = path_s_.slice(dir_s.length + 1);
                //  bundle 
                if (!get_config.bundle_s) {
                  get_config.bundle_s = dir_s;
                }
              }
            }
            // 
            if (!remote_b) {
              var index_n = path_s_.lastIndexOf(".");
              if (index_n !== -1) {
                path_s_ = path_s_.slice(0, index_n);
              }
            }
            // 
            if (!remote_b) {
              var asset_type = type_;
              if (asset_type === SpriteFrame && !path_s_.endsWith("/spriteFrame")) {
                path_s_ += "/spriteFrame";
              } else if (asset_type === Texture2D && !path_s_.endsWith("/texture")) {
                path_s_ += "/texture";
              }
            }
          }
          return new Promise(function (resolve_f) {
            return __awaiter$1(_this35, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee16() {
              var _this36 = this;
              var _a, _c, _d, _e, completed_f, asset_config, uuid_s, bundle_asset, asset;
              return _regeneratorRuntime().wrap(function _callee16$(_context16) {
                while (1) switch (_context16.prev = _context16.next) {
                  case 0:
                    /**  */
                    completed_f = function completed_f(error, asset) {
                      var _a, _b;
                      if (error) {
                        _this36._log.error("get " + path_s_ + " \u9519\u8BEF", error);
                      } else {
                        _this36._log.debug("get " + path_s_ + " \u5B8C\u6210");
                      }
                      if (error || EDITOR) {
                        (_a = get_config.completed_f) === null || _a === void 0 ? void 0 : _a.call(get_config, error, asset);
                        resolve_f(asset);
                        return;
                      }
                      // 
                      asset = _this36._asset_init(asset);
                      // 
                      (_b = get_config.completed_f) === null || _b === void 0 ? void 0 : _b.call(get_config, error, asset);
                      // 
                      target_ === null || target_ === void 0 ? void 0 : target_.follow_release(asset);
                      resolve_f(asset);
                    }; // 
                    if (!remote_b) {
                      _context16.next = 5;
                      break;
                    }
                    // eslint-disable-next-line @typescript-eslint/naming-convention
                    assetManager.loadRemote(path_s_, Object.assign({
                      onFileProgress: get_config.progress_f
                    }, (_a = get_config.remote_option) !== null && _a !== void 0 ? _a : {}), completed_f);
                    _context16.next = 39;
                    break;
                  case 5:
                    {
                      _context16.next = 24;
                      break;
                    }
                  case 13:
                    uuid_s = _context16.sent;
                    if (uuid_s) {
                      _context16.next = 19;
                      break;
                    }
                    this._log.error(" uuid ", path_s_);
                    (_c = get_config.completed_f) === null || _c === void 0 ? void 0 : _c.call(get_config, new Error(" uuid " + path_s_), null);
                    resolve_f(null);
                    return _context16.abrupt("return");
                  case 19:
                    //  spriteFrame 
                    if (type_ === SpriteFrame) {
                      uuid_s += "@f9941";
                    }
                    asset_config.uuid = uuid_s;
                    if (get_config.progress_f) {
                      assetManager.loadAny(asset_config, get_config.progress_f, completed_f);
                    } else {
                      assetManager.loadAny(asset_config, completed_f);
                    }
                    _context16.next = 39;
                    break;
                  case 24:
                    if (!get_config.bundle_s) {
                      _context16.next = 30;
                      break;
                    }
                    _context16.next = 27;
                    return mk_bundle$1.load(get_config.bundle_s);
                  case 27:
                    _context16.t0 = _context16.sent;
                    _context16.next = 31;
                    break;
                  case 30:
                    _context16.t0 = resources;
                  case 31:
                    bundle_asset = _context16.t0;
                    if (bundle_asset) {
                      _context16.next = 37;
                      break;
                    }
                    this._log.error(" bundle ");
                    (_d = get_config.completed_f) === null || _d === void 0 ? void 0 : _d.call(get_config, new Error(" bundle " + get_config.bundle_s), null);
                    resolve_f(null);
                    return _context16.abrupt("return");
                  case 37:
                    // 
                    asset = bundle_asset.get(path_s_, type_); // 
                    if (asset) {
                      // 
                      (_e = get_config.progress_f) === null || _e === void 0 ? void 0 : _e.call(get_config, 1, 1);
                      completed_f(null, asset);
                    }
                    // 
                    else {
                      if (get_config.progress_f) {
                        bundle_asset.load(path_s_, type_, get_config.progress_f, completed_f);
                      } else {
                        bundle_asset.load(path_s_, type_, completed_f);
                      }
                    }
                  case 39:
                  case "end":
                    return _context16.stop();
                }
              }, _callee16, this);
            }));
          });
        }
        /**
         * 
         * @param path_s_ 
         * @param type_ 
         * @param target_ 
         * @param config_ 
         * @returns
         */;
        _proto20.get_dir = function get_dir(path_s_, type_, target_, config_) {
          var _this37 = this;
          var _a;
          /**  */
          var get_config = config_ !== null && config_ !== void 0 ? config_ : {};
          /**  */
          var asset_config;
          // 
          {
            // 
            if (path_s_.startsWith("db://assets/")) {
              path_s_ = path_s_.slice(12);
              //  bundle
              {
                var dir_s = path_s_.slice(0, path_s_.indexOf("/"));
                path_s_ = path_s_.slice(dir_s.length + 1);
                //  bundle 
                if (!get_config.bundle_s) {
                  get_config.bundle_s = dir_s;
                }
              }
            }
            // 
            {
              if (!get_config.remote_option) {
                get_config.remote_option = {};
              }
              asset_config = get_config.remote_option;
              asset_config.bundle = (_a = get_config.bundle_s) !== null && _a !== void 0 ? _a : "resources";
              asset_config.type = type_;
              asset_config.dir = path_s_;
            }
          }
          return new Promise(function (resolve_f) {
            return __awaiter$1(_this37, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {
              var _this38 = this;
              var _b, _c, dir_asset_as, completed_f, bundle_asset, asset_info_as, _loop, _ret, _iterator4, _step4;
              return _regeneratorRuntime().wrap(function _callee17$(_context18) {
                while (1) switch (_context18.prev = _context18.next) {
                  case 0:
                    /**  */
                    dir_asset_as = [];
                    /**  */
                    completed_f = function completed_f(error) {
                      var _a, _b;
                      if (error) {
                        _this38._log.error("get_dir " + path_s_ + " \u9519\u8BEF", error);
                        // 
                        (_a = get_config.completed_f) === null || _a === void 0 ? void 0 : _a.call(get_config, error, []);
                        resolve_f(null);
                      } else {
                        _this38._log.debug("get_dir " + path_s_ + " \u5B8C\u6210");
                      }
                      // 
                      dir_asset_as.forEach(function (v, k_n) {
                        dir_asset_as[k_n] = _this38._asset_init(v);
                      });
                      // 
                      (_b = get_config.completed_f) === null || _b === void 0 ? void 0 : _b.call(get_config, error, dir_asset_as);
                      // 
                      if (target_ === null || target_ === void 0 ? void 0 : target_.follow_release) {
                        dir_asset_as.forEach(function (v) {
                          target_.follow_release(v);
                        });
                      }
                      resolve_f(dir_asset_as);
                    }; // 
                    {
                      _context18.next = 8;
                      break;
                    }
                  case 8:
                    _context18.next = 10;
                    return mk_bundle$1.load(asset_config.bundle);
                  case 10:
                    bundle_asset = _context18.sent;
                    if (bundle_asset) {
                      _context18.next = 16;
                      break;
                    }
                    this._log.error(" bundle ");
                    (_b = get_config.completed_f) === null || _b === void 0 ? void 0 : _b.call(get_config, new Error(" bundle " + asset_config.bundle), null);
                    resolve_f(null);
                    return _context18.abrupt("return");
                  case 16:
                    /**  */
                    asset_info_as = bundle_asset.getDirWithPath(path_s_, type_); // 
                    _loop = /*#__PURE__*/_regeneratorRuntime().mark(function _loop() {
                      var _step4$value, k_n, v, asset, success_b;
                      return _regeneratorRuntime().wrap(function _loop$(_context17) {
                        while (1) switch (_context17.prev = _context17.next) {
                          case 0:
                            _step4$value = _step4.value, k_n = _step4$value[0], v = _step4$value[1];
                            asset = bundle_asset.get(v.path, type_); // 
                            if (!asset) {
                              _context17.next = 6;
                              break;
                            }
                            dir_asset_as.push(asset);
                            _context17.next = 11;
                            break;
                          case 6:
                            _context17.next = 8;
                            return new Promise(function (resolve_f) {
                              bundle_asset.load(v.path, type_, function (error, asset) {
                                if (error) {
                                  completed_f(error);
                                  return;
                                }
                                dir_asset_as.push(asset);
                                resolve_f(!error);
                              });
                            });
                          case 8:
                            success_b = _context17.sent;
                            if (success_b) {
                              _context17.next = 11;
                              break;
                            }
                            return _context17.abrupt("return", {
                              v: void 0
                            });
                          case 11:
                            // 
                            (_c = get_config.progress_f) === null || _c === void 0 ? void 0 : _c.call(get_config, k_n + 1, asset_info_as.length);
                          case 12:
                          case "end":
                            return _context17.stop();
                        }
                      }, _loop);
                    });
                    _iterator4 = _createForOfIteratorHelperLoose(asset_info_as.entries());
                  case 19:
                    if ((_step4 = _iterator4()).done) {
                      _context18.next = 26;
                      break;
                    }
                    return _context18.delegateYield(_loop(), "t0", 21);
                  case 21:
                    _ret = _context18.t0;
                    if (!_ret) {
                      _context18.next = 24;
                      break;
                    }
                    return _context18.abrupt("return", _ret.v);
                  case 24:
                    _context18.next = 19;
                    break;
                  case 26:
                    completed_f(null);
                  case 27:
                  case "end":
                    return _context18.stop();
                }
              }, _callee17, this);
            }));
          });
        }
        /**
         * 
         * @param asset_ 
         */;
        _proto20.release = function release(asset_) {
          var _this39 = this;
          var asset_as = Array.isArray(asset_) ? asset_ : [asset_];
          asset_as.forEach(function (v) {
            var _a;
            if (!v.isValid) {
              return;
            }
            // 
            if ((_a = dynamicAtlasManager) === null || _a === void 0 ? void 0 : _a.enabled) {
              if (v instanceof SpriteFrame) {
                dynamicAtlasManager.deleteAtlasSpriteFrame(v);
              } else if (v instanceof Texture2D) {
                dynamicAtlasManager.deleteAtlasTexture(v);
              }
            }
            // 
            for (var k_n = 0; k_n < v.refCount; k_n++) {
              v.decRef(false);
            }
            // 
            assetManager.releaseAsset(v);
            // 
            _this39._asset_manage_map["delete"](v.nativeUrl || v._uuid);
            _this39._log.debug("", v.name, v.nativeUrl, v._uuid);
          });
        }
        /**  */;
        _proto20._asset_init = function _asset_init(asset_) {
          /**  */
          var loaded_asset = this._asset_manage_map.get(asset_.nativeUrl || asset_._uuid);
          // 
          if (loaded_asset) {
            // 
            loaded_asset.addRef();
            return loaded_asset;
          } else {
            // 
            asset_.addRef();
            asset_.addRef();
            this._asset_manage_map.set(asset_.nativeUrl || asset_._uuid, asset_);
            return asset_;
          }
        }
        /**
         * 
         * @param force_b_ 
         * @returns
         */;
        _proto20._auto_release_asset = function _auto_release_asset(force_b_) {
          if (force_b_ === void 0) {
            force_b_ = false;
          }
          /**  */
          var current_time_ms_n = Date.now();
          if (force_b_) {
            var assets_as = [];
            this._asset_release_map.forEach(function (v) {
              // 
              if (!v.asset.isValid || v.asset.refCount !== 1) {
                return;
              }
              assets_as.push(v.asset);
            });
            // 
            this._asset_release_map.clear();
            // 
            this.release(assets_as);
          } else {
            for (var _iterator5 = _createForOfIteratorHelperLoose(this._asset_release_map.entries()), _step5; !(_step5 = _iterator5()).done;) {
              var _step5$value = _step5.value,
                k_s = _step5$value[0],
                v = _step5$value[1];
              // 
              if (current_time_ms_n - v.join_time_ms_n < mk_asset._config.cache_lifetime_ms_n) {
                break;
              }
              this._asset_release_map["delete"](k_s);
              // 
              if (!v.asset.isValid || v.asset.refCount !== 1) {
                return;
              }
              // 
              this.release(v.asset);
            }
          }
        }
        /* -------------------------------  ------------------------------- */;
        _proto20._event_restart = function _event_restart() {
          return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {
            return _regeneratorRuntime().wrap(function _callee18$(_context19) {
              while (1) switch (_context19.prev = _context19.next) {
                case 0:
                  _context19.next = 2;
                  return Promise.all(global_event.request(global_event.key.wait_close_scene));
                case 2:
                  // 
                  this._auto_release_asset(true);
                  // 
                  clearInterval(this._release_timer);
                  //  bundle 
                  assetManager.bundles.forEach(function (v) {
                    if (v["releaseUnusedAssets"]) {
                      v["releaseUnusedAssets"]();
                    } else {
                      v.releaseAll();
                    }
                  });
                case 5:
                case "end":
                  return _context19.stop();
              }
            }, _callee18, this);
          }));
        };
        return mk_asset;
      }(mk_instance_base);
      /* --------------- static --------------- */
      /**  */
      mk_asset._config = global_config$1.asset.config;
      var mk_asset$1 = exports('asset', mk_asset.instance());

      /**  */
      var mk_tool_byte = /*#__PURE__*/function (_mk_instance_base10) {
        _inheritsLoose(mk_tool_byte, _mk_instance_base10);
        function mk_tool_byte() {
          return _mk_instance_base10.apply(this, arguments) || this;
        }
        var _proto21 = mk_tool_byte.prototype;
        /** 1 */
        _proto21.set_bit = function set_bit(value_n_, index_n_) {
          return value_n_ |= index_n_;
        }
        /** 0 */;
        _proto21.clr_bit = function clr_bit(value_n_, index_n_) {
          return value_n_ &= ~index_n_;
        }
        /**  */;
        _proto21.get_bit = function get_bit(value_n_, index_n_) {
          return value_n_ & index_n_;
        };
        return mk_tool_byte;
      }(mk_instance_base);
      var mk_tool_byte$1 = mk_tool_byte.instance();

      /**  */
      var mk_tool_enum = /*#__PURE__*/function (_mk_instance_base11) {
        _inheritsLoose(mk_tool_enum, _mk_instance_base11);
        function mk_tool_enum() {
          return _mk_instance_base11.apply(this, arguments) || this;
        }
        var _proto22 = mk_tool_enum.prototype;
        /**  */
        _proto22.obj_to_enum = function obj_to_enum(value_) {
          var result = {};
          if (!value_) {
            return result;
          }
          if (typeof value_ === "object") {
            Object.keys(value_).forEach(function (v_s, k_n) {
              result[k_n] = v_s;
              result[v_s] = k_n;
            });
          }
          return result;
        };
        _proto22.getEnumKeyByValue = function getEnumKeyByValue(enumObj, value) {
          return Object.keys(enumObj).find(function (key) {
            return enumObj[key] === value;
          });
        };
        return mk_tool_enum;
      }(mk_instance_base);
      var mk_tool_enum$1 = mk_tool_enum.instance();
      var mk_tool_object = /*#__PURE__*/function (_mk_instance_base12) {
        _inheritsLoose(mk_tool_object, _mk_instance_base12);
        function mk_tool_object() {
          return _mk_instance_base12.apply(this, arguments) || this;
        }
        var _proto23 = mk_tool_object.prototype;
        /**  */
        _proto23.clone = function clone(target_, record_set) {
          if (record_set === void 0) {
            record_set = new Set();
          }
          var result;
          switch (typeof target_) {
            case "object":
              {
                // 
                if (Array.isArray(target_)) {
                  if (record_set.has(target_)) {
                    return target_;
                  }
                  record_set.add(target_);
                  result = [];
                  for (var k_n = 0; k_n < target_.length; ++k_n) {
                    // 
                    result.push(this.clone(target_[k_n], record_set));
                  }
                }
                // null
                else if (target_ === null) {
                  result = null;
                }
                // RegExp
                else if (target_.constructor === RegExp) {
                  result = target_;
                }
                // 
                else {
                  if (record_set.has(target_)) {
                    return target_;
                  }
                  record_set.add(target_);
                  result = {};
                  for (var k_s in target_) {
                    result[k_s] = this.clone(target_[k_s], record_set);
                  }
                }
                break;
              }
            case "function":
              {
                result = target_.bind({});
                break;
              }
            default:
              {
                result = target_;
              }
          }
          return result;
        }
        /**
         * 
         * @param data_ class 
         * @param assign_b_ 
         * @returns
         * @remarks
         *  this  data_
         */;
        _proto23.reset = function reset(data_, assign_b_) {
          if (!(data_ === null || data_ === void 0 ? void 0 : data_.constructor)) {
            mk_log.error("");
            return null;
          }
          if (assign_b_) {
            Object.assign(data_, new data_.constructor());
            return null;
          } else {
            return new data_.constructor();
          }
        }
        /**
         * 
         * @param target_ 
         * @param callback_f_ 
         * @returns
         */;
        _proto23.traverse = function traverse(target_, callback_f_) {
          return this._traverse(target_, callback_f_);
        }
        /**  */;
        _proto23._traverse = function _traverse(target_, callback_f_, path_s_, record_set) {
          var _this40 = this;
          if (path_s_ === void 0) {
            path_s_ = "";
          }
          if (record_set === void 0) {
            record_set = new Set();
          }
          switch (typeof target_) {
            case "object":
              {
                // 
                if (Array.isArray(target_)) {
                  if (record_set.has(target_)) {
                    return;
                  }
                  record_set.add(target_);
                  target_.forEach(function (v, k_n) {
                    // 
                    callback_f_(target_[k_n], k_n + "", path_s_);
                    _this40._traverse(target_[k_n], callback_f_, path_s_ ? path_s_ + "/" + k_n : k_n + "", record_set);
                  });
                }
                // 
                else {
                  if (record_set.has(target_)) {
                    return;
                  }
                  record_set.add(target_);
                  for (var k_s in target_) {
                    callback_f_(target_[k_s], k_s, path_s_);
                    this._traverse(target_[k_s], callback_f_, path_s_ ? path_s_ + "/" + k_s : k_s, record_set);
                  }
                }
                break;
              }
          }
        };
        return mk_tool_object;
      }(mk_instance_base);
      var mk_tool_object$1 = mk_tool_object.instance();
      var mk_tool_string = /*#__PURE__*/function (_mk_instance_base13) {
        _inheritsLoose(mk_tool_string, _mk_instance_base13);
        function mk_tool_string() {
          return _mk_instance_base13.apply(this, arguments) || this;
        }
        var _proto24 = mk_tool_string.prototype;
        /**
         * 
         * @param v_s_ 
         * @param v2_s_ 
         * @returns 0-1
         * @remarks
         * 
         */
        _proto24.similarity_edit_dist = function similarity_edit_dist(v_s_, v2_s_) {
          var v_len_n = v_s_.length;
          var v2_len_n = v2_s_.length;
          // 
          {
            if (v_len_n == 0) {
              return v2_len_n;
            }
            if (v2_len_n == 0) {
              return v_len_n;
            }
          }
          var dist_nss = [];
          // 
          {
            for (var k_n = 0; k_n <= v_len_n; k_n++) {
              dist_nss[k_n] = [];
              dist_nss[k_n][0] = k_n;
            }
            for (var _k_n = 0; _k_n <= v2_len_n; _k_n++) {
              dist_nss[0][_k_n] = _k_n;
            }
          }
          // 
          {
            var v_curr_s;
            var v2_curr_s;
            for (var _k_n2 = 1; _k_n2 <= v_len_n; _k_n2++) {
              v_curr_s = v_s_.charAt(_k_n2 - 1);
              for (var k2_n = 1; k2_n <= v2_len_n; k2_n++) {
                v2_curr_s = v2_s_.charAt(k2_n - 1);
                dist_nss[_k_n2][k2_n] = Math.min(dist_nss[_k_n2 - 1][k2_n] + 1, dist_nss[_k_n2][k2_n - 1] + 1, dist_nss[_k_n2 - 1][k2_n - 1] + (v_curr_s == v2_curr_s ? 0 : 1));
              }
            }
          }
          // 
          return Number((1 - dist_nss[v_len_n][v2_len_n] / Math.max(v_s_.length, v2_s_.length)).toFixed(4));
        }
        /**
         * 
         * @param args_ 
         * @param key_s_ 
         * @param min_simile_n_ 
         * @returns
         * @remarks
         * 
         */;
        _proto24.fuzzy_match = function fuzzy_match(args_, key_s_, min_simile_n_) {
          var _this41 = this;
          if (min_simile_n_ === void 0) {
            min_simile_n_ = 0;
          }
          if (!key_s_) {
            return null;
          }
          var source_ss;
          if (typeof args_ === "string") {
            source_ss = [args_];
          } else {
            source_ss = args_;
          }
          var match_result_ss = [];
          var key_ss = key_s_.split("");
          var index_n;
          source_ss.forEach(function (v_s) {
            index_n = -1;
            for (var k2_n = 0; k2_n < key_ss.length; ++k2_n) {
              // 
              if (v_s.indexOf(key_ss[k2_n]) < 0) {
                break;
              } else {
                var reg = RegExp("" + key_ss[k2_n], "g");
                var exec_result = void 0;
                while ((exec_result = reg.exec(v_s)) !== null) {
                  if (exec_result.index > index_n) {
                    index_n = exec_result.index;
                    if (k2_n === key_ss.length - 1) {
                      match_result_ss.push(v_s);
                      return;
                    }
                    break;
                  }
                }
              }
            }
          });
          if (!match_result_ss.length) {
            return null;
          }
          // 
          else {
            match_result_ss.sort(function (v_a_s, v_b_s) {
              return _this41.similarity_edit_dist(v_b_s, key_s_) - _this41.similarity_edit_dist(v_a_s, key_s_);
            });
            return this.similarity_edit_dist(match_result_ss[0], key_s_) >= min_simile_n_ ? match_result_ss[0] : key_s_;
          }
        };
        return mk_tool_string;
      }(mk_instance_base);
      var mk_tool_string$1 = mk_tool_string.instance();
      var mk_tool = exports('tool', /*#__PURE__*/Object.freeze({
        __proto__: null,
        "byte": mk_tool_byte$1,
        "enum": mk_tool_enum$1,
        func: mk_tool_func$1,
        object: mk_tool_object$1,
        string: mk_tool_string$1
      }));
      var __awaiter = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * 
       * @noInheritDoc
       * @remarks
       *  mvvm 
       */
      var mk_monitor = /*#__PURE__*/function (_mk_instance_base14) {
        _inheritsLoose(mk_monitor, _mk_instance_base14);
        function mk_monitor() {
          var _this42;
          _this42 = _mk_instance_base14.apply(this, arguments) || this;
          /**  */
          _this42._log = new mk_logger("monitor");
          /**  */
          _this42._bind_data_map = new Map();
          /**  */
          _this42._target_bind_data = new Map();
          return _this42;
        }
        /* -------------------------------  ------------------------------- */
        /**
         *  value_  value2_
         * @param value_ 
         * @param key_ 
         * @param value2_ 2
         * @param key2_ 2
         * @param target_ 
         * @returns 
         */
        var _proto25 = mk_monitor.prototype;
        _proto25.sync = function sync(value_, key_, value2_, key2_, target_) {
          var callback_f = function callback_f(value) {
            value2_[key2_] = value;
          };
          value2_[key2_] = value_[key_];
          return this.on(value_, key_, callback_f, target_);
        }
        /**
         * 
         * @param value_ 
         * @param key_ 
         * @returns
         */;
        _proto25.wait = function wait(value_, key_) {
          return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee19() {
            var bind_data;
            return _regeneratorRuntime().wrap(function _callee19$(_context20) {
              while (1) switch (_context20.prev = _context20.next) {
                case 0:
                  bind_data = this._get_bind_data(value_, key_, false);
                  if (bind_data === null || bind_data === void 0 ? void 0 : bind_data.task) {
                    _context20.next = 3;
                    break;
                  }
                  return _context20.abrupt("return");
                case 3:
                  if (!(bind_data.recursive_count_n > 1)) {
                    _context20.next = 6;
                    break;
                  }
                  this._log.error("");
                  return _context20.abrupt("return");
                case 6:
                  _context20.next = 8;
                  return bind_data.task.task;
                case 8:
                case "end":
                  return _context20.stop();
              }
            }, _callee19, this);
          }));
        };
        _proto25.on_recursion = function on_recursion(value_, on_callback_f_, args3_, target_) {
          var _this43 = this;
          var target = target_ !== null && target_ !== void 0 ? target_ : typeof args3_ === "object" ? args3_ : undefined;
          var off_callback_f = typeof args3_ === "function" ? args3_ : undefined;
          mk_tool.object.traverse(value_, function (value, key_s, path_s) {
            if (!["string", "number", "boolean", "symbol"].includes(typeof value)) {
              return;
            }
            var parent = value_;
            // 
            if (path_s.length !== 0) {
              path_s.split("/").forEach(function (v_s) {
                parent = parent[v_s];
              });
            }
            _this43._on(parent, key_s, {
              path_s: "" + (path_s ? "/" : "") + key_s,
              on_callback_f: on_callback_f_,
              off_callback_f: off_callback_f,
              target: target
            });
          });
        };
        _proto25.on = function on(value_, key_, on_callback_f_, args4_, target_) {
          var off_callback_f = typeof args4_ === "function" ? args4_ : undefined;
          var target = target_ !== null && target_ !== void 0 ? target_ : typeof args4_ === "object" ? args4_ : undefined;
          return this._on(value_, key_, {
            on_callback_f: on_callback_f_,
            off_callback_f: off_callback_f,
            target: target
          });
        };
        _proto25.once = function once(value_, key_, on_callback_f_, off_callback_f_, target_) {
          var off_callback_f = typeof off_callback_f_ === "function" ? off_callback_f_ : undefined;
          var target = target_ || (off_callback_f ? null : off_callback_f_);
          return this._on(value_, key_, {
            on_callback_f: on_callback_f_,
            off_callback_f: off_callback_f,
            target: target,
            once_b: true
          });
        };
        _proto25.off_recursion = function off_recursion(value_, args2_, target_) {
          var _this44 = this;
          var on_callback_f = typeof args2_ === "function" ? args2_ : undefined;
          var target = target_ !== null && target_ !== void 0 ? target_ : typeof args2_ === "object" ? args2_ : undefined;
          var task_as = [];
          mk_tool.object.traverse(value_, function (value, key_s, path_s) {
            var type_s = typeof value;
            if (!["string", "number", "boolean", "symbol"].includes(type_s)) {
              return;
            }
            var parent = value_;
            // 
            if (path_s.length !== 0) {
              path_s.split("/").forEach(function (v_s) {
                parent = parent[v_s];
              });
            }
            task_as.push.apply(task_as, _this44._off(parent, key_s, {
              path_s_: "" + (path_s ? "/" : "") + key_s,
              on_callback_f_: on_callback_f,
              target_: target
            }));
          });
          return Promise.all(task_as);
        };
        _proto25.off = function off(value_, key_, args3_, target_) {
          var on_callback_f = typeof args3_ === "function" ? args3_ : undefined;
          var target = target_ !== null && target_ !== void 0 ? target_ : typeof args3_ === "object" ? args3_ : undefined;
          return Promise.all(this._off(value_, key_, {
            on_callback_f_: on_callback_f,
            target_: target
          }));
        }
        /**
         * 
         * @param target_ 
         * @returns
         */;
        _proto25.clear = function clear(target_) {
          /**  */
          var target_bind_data = this._target_bind_data.get(target_);
          // 
          if (!target_ || !target_bind_data) {
            return null;
          }
          var task_as = [];
          // 
          if (target_bind_data.monitor_as) {
            /**  */
            var monitor_as = target_bind_data.monitor_as.slice(0);
            for (var _iterator6 = _createForOfIteratorHelperLoose(monitor_as), _step6; !(_step6 = _iterator6()).done;) {
              var v = _step6.value;
              task_as.push.apply(task_as, this._off(v.target, v.key, {
                on_callback_f_: v.monitor.on_callback_f,
                target_: v.monitor.target,
                path_s_: v.monitor.path_s
              }));
            }
          }
          return Promise.all(task_as);
        };
        _proto25.enable = function enable(args_, key_, args3_, target_) {
          this._set_listener_state(true, args_, key_, args3_, target_);
        };
        _proto25.disable = function disable(args_, key_, args3_, target_) {
          this._set_listener_state(false, args_, key_, args3_, target_);
        }
        /**
         * 
         * @param value_ 
         * @param key_ 
         * @param create_b_ 
         * @returns
         */;
        _proto25._get_bind_data = function _get_bind_data(value_, key_, create_b_) {
          var _this45 = this;
          /**  */
          var bind_data_map = this._bind_data_map.get(value_);
          if (!bind_data_map) {
            this._bind_data_map.set(value_, bind_data_map = new Map());
          }
          /**  */
          var bind_data = bind_data_map.get(key_);
          if (bind_data) {
            return bind_data;
          }
          if (!create_b_) {
            return null;
          }
          // 
          {
            var descriptor = Object.getOwnPropertyDescriptor(value_, key_);
            if (!descriptor) {
              return null;
            }
            bind_data_map.set(key_, bind_data = Object.create({
              descriptor: descriptor,
              recursive_count_n: 0
            }));
          }
          /**  */
          var value = value_[key_];
          /**  */
          var can_update_b = false;
          /**  */
          var update_timer;
          /**  */
          var value_before_update;
          // 
          Object.defineProperty(value_, key_, {
            get: function get() {
              return bind_data.descriptor.get ? bind_data.descriptor.get.call(value_) : value;
            },
            set: function set(new_value) {
              var _a;
              // 
              {
                if (!bind_data) {
                  return;
                }
                // 
                if (bind_data.descriptor.get) {
                  value = bind_data.descriptor.get.call(value_);
                }
                // 
                if (!can_update_b && value === new_value && typeof value !== "object" && typeof value !== "function") {
                  _this45._log.debug("", key_, new_value, value_);
                  return;
                }
              }
              /**  */
              var old_value = value;
              // 
              {
                _this45._log.debug("", key_, new_value, value_);
                (_a = bind_data.descriptor.set) === null || _a === void 0 ? void 0 : _a.call(value_, new_value);
                value = new_value;
              }
              // 
              if (bind_data.disabled_b || !bind_data.monitor_as) {
                // 
                if (bind_data.disabled_b) {
                  can_update_b = true;
                }
                return;
              }
              if (update_timer) {
                // 
                if (typeof value !== "object" && typeof value !== "function" && value === value_before_update) {
                  // 
                  clearTimeout(update_timer);
                  update_timer = null;
                  //  set 
                  --bind_data.recursive_count_n;
                  // 
                  bind_data.task.finish(true);
                }
                return;
              }
              if (!bind_data.task) {
                bind_data.task = new mk_status_task(false);
              }
              // 
              else if (bind_data.recursive_count_n === 0) {
                bind_data.task.finish(false);
              }
              //  set 
              ++bind_data.recursive_count_n;
              // 
              value_before_update = old_value;
              // 
              update_timer = setTimeout(function () {
                update_timer = null;
                if (!(bind_data === null || bind_data === void 0 ? void 0 : bind_data.monitor_as)) {
                  return;
                }
                /**  */
                var on_result_as = [];
                // 
                can_update_b = false;
                // 
                for (var k_n = 0, v; k_n < bind_data.monitor_as.length; ++k_n) {
                  v = bind_data.monitor_as[k_n];
                  var target_bind_data = !v.target ? undefined : _this45._target_bind_data.get(v.target);
                  // 
                  if (v.disabled_b || (target_bind_data === null || target_bind_data === void 0 ? void 0 : target_bind_data.disabled_b)) {
                    continue;
                  }
                  v.last_update_value = value;
                  on_result_as.push(v.on_callback_f.call(v.target, value, old_value, v.path_s));
                  // 
                  if (v.once_b) {
                    bind_data.monitor_as.splice(k_n--, 1);
                    // 
                    if (v.target) {
                      _this45._del_target_bind_data(v.target, {
                        monitor: v,
                        target: value_,
                        key: key_
                      });
                    }
                  }
                }
                // 
                Promise.all(on_result_as).then(function () {
                  //  set 
                  if (--bind_data.recursive_count_n === 0) {
                    bind_data.task.finish(true);
                  }
                });
              }, 0);
            }
          });
          return bind_data;
        };
        _proto25._off = function _off(value_, key_, _ref) {
          var on_callback_f_ = _ref.on_callback_f_,
            target_ = _ref.target_,
            path_s_ = _ref.path_s_;
          /**  */
          var bind_data = this._get_bind_data(value_, key_, false);
          /**  */
          var task_as = [];
          if (!(bind_data === null || bind_data === void 0 ? void 0 : bind_data.monitor_as)) {
            return task_as;
          }
          // 
          {
            var index_n;
            var del_as;
            var find_f;
            if (target_ && on_callback_f_) {
              find_f = function find_f(v) {
                return v.on_callback_f === on_callback_f_ && v.target === target_ && v.path_s === path_s_;
              };
            } else if (target_) {
              find_f = function find_f(v) {
                return v.target === target_ && v.path_s === path_s_;
              };
            } else if (on_callback_f_) {
              find_f = function find_f(v) {
                return v.on_callback_f === on_callback_f_ && v.path_s === path_s_;
              };
            } else {
              find_f = function find_f(v) {
                return v.path_s === path_s_;
              };
            }
            if (find_f) {
              var _bind_data$monitor_as;
              /**  */
              var monitor_as = bind_data.monitor_as.splice(0, bind_data.monitor_as.length);
              // eslint-disable-next-line no-constant-condition
              while (true) {
                index_n = monitor_as.findIndex(find_f);
                if (index_n === -1) {
                  break;
                }
                del_as = monitor_as.splice(index_n, 1);
                // 
                var call_back_f = this._del_target_bind_data(target_, {
                  monitor: del_as[0],
                  target: value_,
                  key: key_
                });
                if (call_back_f) {
                  task_as.push(call_back_f);
                }
              }
              (_bind_data$monitor_as = bind_data.monitor_as).unshift.apply(_bind_data$monitor_as, monitor_as);
            }
          }
          // 
          if (!bind_data.monitor_as.length) {
            task_as.push.apply(task_as, this._del_bind_data(value_, key_));
          }
          return task_as;
        }
        /**  */;
        _proto25._del_bind_data = function _del_bind_data(value_, key_) {
          /**  */
          var bind_data_map = this._bind_data_map.get(value_);
          /**  */
          var task_as = [];
          if (!bind_data_map) {
            return task_as;
          }
          /**  */
          var bind_data = bind_data_map.get(key_);
          if (bind_data) {
            // 
            if (bind_data.monitor_as) {
              while (bind_data.monitor_as.length) {
                var monitor = bind_data.monitor_as.pop();
                // 
                var call_back_f = this._del_target_bind_data(monitor.target, {
                  monitor: monitor,
                  target: value_,
                  key: key_
                });
                if (call_back_f) {
                  task_as.push(call_back_f);
                }
              }
            }
            // 
            if (!bind_data.descriptor.set) {
              bind_data.descriptor.value = value_[key_];
            }
            // 
            Object.defineProperty(value_, key_, bind_data.descriptor);
            //  bind_data
            bind_data_map["delete"](key_);
          }
          //  bind_data_map
          if (!bind_data_map.size) {
            this._bind_data_map["delete"](value_);
          }
          return task_as;
        }
        /**  */;
        _proto25._add_target_bind_data = function _add_target_bind_data(target_, bind_data_) {
          // 
          if (!target_ || !bind_data_) {
            return;
          }
          /**  */
          var target_bind_data = this._target_bind_data.get(target_);
          if (!target_bind_data) {
            this._target_bind_data.set(target_, target_bind_data = Object.create(null));
          }
          // 
          if (bind_data_.monitor) {
            if (!target_bind_data.monitor_as) {
              target_bind_data.monitor_as = [bind_data_];
            } else {
              target_bind_data.monitor_as.push(bind_data_);
            }
          }
        }
        /**  */;
        _proto25._del_target_bind_data = function _del_target_bind_data(target_, bind_data_) {
          var _a, _b;
          // 
          if (!target_ || !bind_data_) {
            return null;
          }
          /**  */
          var target_bind_data = this._target_bind_data.get(target_);
          if (!target_bind_data) {
            return null;
          }
          // 
          if (bind_data_.monitor && target_bind_data.monitor_as) {
            var index_n = target_bind_data.monitor_as.findIndex(function (v) {
              return v.target === bind_data_.target && v.key === bind_data_.key && v.monitor === bind_data_.monitor;
            });
            if (index_n !== -1) {
              return (_b = (_a = target_bind_data.monitor_as.splice(index_n, 1)[0].monitor) === null || _a === void 0 ? void 0 : _a.off_callback_f) === null || _b === void 0 ? void 0 : _b.call(_a);
            }
          }
          return null;
        }
        /**  */;
        _proto25._on = function _on(value_, key_, data_) {
          var _a;
          /**  */
          var bind_data = this._get_bind_data(value_, key_, true);
          if (!bind_data) {
            this._log.error("");
            return null;
          }
          // 
          {
            if (!bind_data.monitor_as) {
              bind_data.monitor_as = [];
            }
            (_a = bind_data.monitor_as) === null || _a === void 0 ? void 0 : _a.push(data_);
          }
          // 
          if (data_.target) {
            this._add_target_bind_data(data_.target, {
              monitor: data_,
              target: value_,
              key: key_
            });
          }
          return data_.on_callback_f;
        };
        _proto25._set_listener_state = function _set_listener_state(state_b_, args_, key_, args3_, target_) {
          var target = target_;
          var value;
          var callback_f;
          // 
          {
            // target
            if (target === undefined) {
              if (key_ === undefined) {
                target = args_;
              } else if (typeof args3_ !== "function") {
                target = args3_;
              }
            }
            // value
            if (key_ !== undefined) {
              value = args_;
            }
            // callback_f_
            if (typeof args3_ === "function") {
              callback_f = args3_;
            }
          }
          if (value) {
            var bind_data = this._get_bind_data(value, key_, false);
            if (!bind_data) {
              return;
            }
            // 
            if (callback_f) {
              if (!bind_data.monitor_as) {
                return;
              }
              var index_n;
              if (target) {
                index_n = bind_data.monitor_as.findIndex(function (v) {
                  return v.target === target && v.on_callback_f === callback_f;
                });
              } else {
                index_n = bind_data.monitor_as.findIndex(function (v) {
                  return v.on_callback_f === callback_f;
                });
              }
              if (index_n !== -1) {
                bind_data.monitor_as[index_n].disabled_b = !state_b_;
              }
            }
            // 
            else if (target) {
              if (!bind_data.monitor_as) {
                return;
              }
              bind_data.monitor_as.forEach(function (v) {
                if (v.target === target) {
                  v.disabled_b = !state_b_;
                }
              });
            }
            // 
            else {
              bind_data.disabled_b = !state_b_;
            }
          } else if (target_) {
            var target_bind_data = this._target_bind_data.get(target_);
            if (!target_bind_data) {
              return;
            }
            target_bind_data.disabled_b = !state_b_;
          }
        }
        /**
         * @param target_ 
         * @returns
         */;
        _proto25.trigger = function trigger(target_) {
          /**  */
          var target_bind_data = this._target_bind_data.get(target_);
          // 
          if (!target_ || !target_bind_data) {
            return null;
          }
          var task_as = [];
          if (target_bind_data.monitor_as) {
            var monitor_as = target_bind_data.monitor_as.slice(0);
            for (var _iterator7 = _createForOfIteratorHelperLoose(monitor_as), _step7; !(_step7 = _iterator7()).done;) {
              var data = _step7.value;
              var v = data.monitor;
              var listenData = data.target;
              if (v.last_update_value === listenData[data.key]) continue;
              var oldValue = v.last_update_value;
              v.last_update_value = listenData[data.key];
              task_as.push(v.on_callback_f.call(v.target, listenData[data.key], oldValue, data.key));
            }
          }
          return Promise.all(task_as);
        };
        return mk_monitor;
      }(mk_instance_base);
      var mk_monitor$1 = exports('monitor', mk_monitor.instance());
      var localStorage = sys.localStorage;
      var GlobalData = exports('GlobalData', Object.create(null));
      var IDataModel = exports('IDataModel', /*#__PURE__*/function () {
        function IDataModel(initData, initRunData) {
          this.modelName = 'default';
          this.lastLocalData = ''; // 
          /**  */
          this.isDirty = false;
          /**  */
          this.saveTimeout = null;
          /** () */
          this.delaySaveInterval = 1000;
          /**  */
          this._autoMonitorEnabled = false;
          /**
           * 
           */
          this.dLocalData = Object.create(null);
          /**
           * 
           */
          this.dRunData = Object.create(null);
          // super();
          this.modelName = this.constructor.name;
          this.dLocalData = initData;
          if (initRunData) this.dRunData = initRunData;
          this.event = new mk_event_target();
          {
            this.init();
            // 
            this.enableAutoChangeDetection();
          }
        }
        var _proto26 = IDataModel.prototype;
        _proto26.init = function init() {
          //
          GlobalData[this.modelName] = this;
          // this.registerListeners();
          var data = this.loadStorage();
          if (data) this.initLocalData(this.dLocalData, data);
          this.markDirty();
          this.save();
        }
        /**
         * 
         */;
        _proto26.loadStorage = function loadStorage() {
          //return;
          var data;
          try {
            this.lastLocalData = localStorage.getItem("model_" + this.modelName);
            data = JSON.parse(this.lastLocalData);
            if (data) {
              data = this.deCodeData(data);
              return data;
            }
          } catch (e) {
            error$1('LoadStorage ', e);
          }
        }
        /**
         * 
         */;
        _proto26.markDirty = function markDirty() {
          this.isDirty = true;
          this.scheduleSave();
        }
        /**
         * 
         * dLocalData
         */;
        _proto26.markDataDirty = function markDataDirty() {
          this.markDirty();
        }
        /**
         * 
         */;
        _proto26.scheduleSave = function scheduleSave() {
          var _this46 = this;
          if (this.saveTimeout) {
            clearTimeout(this.saveTimeout);
          }
          this.saveTimeout = setTimeout(function () {
            _this46.save();
            _this46.saveTimeout = null;
          }, this.delaySaveInterval);
        }
        /**
         * 
         */;
        _proto26.save = function save() {
          if (!this.isDirty) {
            return; // 
          }

          var dataNow = JSON.stringify(this.enCodeData(this.dLocalData));
          if (dataNow != this.lastLocalData) {
            this.lastLocalData = dataNow;
            sys.localStorage.setItem("model_" + this.modelName, dataNow);
            this.onSaved();
          }
          this.isDirty = false; // 
        }
        /**
         * 
         */;
        _proto26.saveImmediate = function saveImmediate() {
          if (this.saveTimeout) {
            clearTimeout(this.saveTimeout);
            this.saveTimeout = null;
          }
          this.save();
        }
        /**
         * mk_monitor
         * dLocalData
         */;
        _proto26.enableAutoChangeDetection = function enableAutoChangeDetection() {
          var _this47 = this;
          if (this._autoMonitorEnabled) {
            return;
          }
          this._autoMonitorEnabled = true;
          // mk_monitor
          mk_monitor$1.on_recursion(this.dLocalData, function (value, oldValue, path) {
            // 
            if (value != oldValue) _this47.markDirty();
          }, this // 
          );
        }
        /**
         * 
         */;
        _proto26.disableAutoChangeDetection = function disableAutoChangeDetection() {
          if (!this._autoMonitorEnabled) {
            return;
          }
          this._autoMonitorEnabled = false;
          // target
          mk_monitor$1.clear(this);
        }
        /**
         * 
         * @param data
         * @returns
         */;
        _proto26.enCodeData = function enCodeData(data) {
          return data;
        }
        /**
         * 
         * @param data
         * @returns
         */;
        _proto26.deCodeData = function deCodeData(data) {
          return data;
        };
        _proto26.onSaved = function onSaved() {}
        /**
         *
         * @param data   
         */;
        _proto26.initLocalData = function initLocalData(defaultlocalData, localData) {
          if (defaultlocalData && localData) {
            for (var _key22 in defaultlocalData) {
              if (Object.prototype.hasOwnProperty.call(defaultlocalData, _key22)) {
                if (!(_key22 in localData)) ;else if (typeof defaultlocalData[_key22] === 'object' && Array.isArray(defaultlocalData[_key22]) === false) {
                  // 
                  this.initLocalData(defaultlocalData[_key22], localData[_key22]);
                } else {
                  defaultlocalData[_key22] = localData[_key22];
                }
              }
            }
          }
          return localData;
        }
        /**
         * 
         */;
        _proto26.clear = function clear() {
          // 
          if (this.saveTimeout) {
            clearTimeout(this.saveTimeout);
            this.saveTimeout = null;
          }
          // 
          if (this.isDirty) {
            this.save();
          }
          // 
          this.disableAutoChangeDetection();
          // 
          if (GlobalData[this.modelName] === this) {
            delete GlobalData[this.modelName];
          }
        };
        _proto26.getModelName = function getModelName() {
          return this.modelName;
        };
        return IDataModel;
      }());
    }
  };
});

System.register("chunks:///_virtual/drongo-gui.mjs", ['./rollupPluginModLoBabelHelpers.js', 'cc', './drongo-cc.mjs', './fairygui.mjs'], function (exports) {
  var _inheritsLoose, _createClass, _createForOfIteratorHelperLoose, _assertThisInitialized, _regeneratorRuntime, Color, director, Director, UITransform, gfx, clamp, UI, StencilManager, math, view, tween, Vec3, js, Component, AudioSource, Node, Prefab, Vec2, instantiate, mk_monitor$1, TickerManager, mk_release, mk_tool, mk_logger, error, mk_asset$1, mk_instance_base, Key, mk_event_target, Timer, log, GRoot, GComponent, GTextField, Window, UIPackage, AutoSizeType, GProgressBar, GSlider, GRichTextField, GButton, GTextInput, GLabel, Controller, EaseType, GTween, UIObjectFactory;
  return {
    setters: [function (module) {
      _inheritsLoose = module.inheritsLoose;
      _createClass = module.createClass;
      _createForOfIteratorHelperLoose = module.createForOfIteratorHelperLoose;
      _assertThisInitialized = module.assertThisInitialized;
      _regeneratorRuntime = module.regeneratorRuntime;
    }, function (module) {
      Color = module.Color;
      director = module.director;
      Director = module.Director;
      UITransform = module.UITransform;
      gfx = module.gfx;
      clamp = module.clamp;
      UI = module.UI;
      StencilManager = module.StencilManager;
      math = module.math;
      view = module.view;
      tween = module.tween;
      Vec3 = module.Vec3;
      js = module.js;
      Component = module.Component;
      AudioSource = module.AudioSource;
      Node = module.Node;
      Prefab = module.Prefab;
      Vec2 = module.Vec2;
      instantiate = module.instantiate;
    }, function (module) {
      mk_monitor$1 = module.monitor;
      TickerManager = module.TickerManager;
      mk_release = module.release;
      mk_tool = module.tool;
      mk_logger = module.logger;
      error = module.error;
      mk_asset$1 = module.asset;
      mk_instance_base = module.instance_base;
      Key = module.Key;
      mk_event_target = module.event_target;
      Timer = module.Timer;
      log = module.log;
    }, function (module) {
      GRoot = module.GRoot;
      GComponent = module.GComponent;
      GTextField = module.GTextField;
      Window = module.Window;
      UIPackage = module.UIPackage;
      AutoSizeType = module.AutoSizeType;
      GProgressBar = module.GProgressBar;
      GSlider = module.GSlider;
      GRichTextField = module.GRichTextField;
      GButton = module.GButton;
      GTextInput = module.GTextInput;
      GLabel = module.GLabel;
      Controller = module.Controller;
      EaseType = module.EaseType;
      GTween = module.GTween;
      UIObjectFactory = module.UIObjectFactory;
    }],
    execute: function () {
      exports({
        GBind: GBind,
        GUIState: void 0,
        SortingLayer: void 0,
        ToastType: void 0,
        UILayer: void 0,
        _cocos_2d_renderer_stencil_manager__Stage: void 0,
        addLogic: addLogic,
        registerBinder: registerBinder,
        updateOpacity: updateOpacity,
        vm: vm
      });
      var _DEFAULT_COLORS;

      /**
       * gui
       */
      var GUISettings = exports('GUISettings', function GUISettings() {});
      /**UI */
      GUISettings.mask_color = new Color(0, 0, 0, 255 * 0.5);
      var GUIState;
      (function (GUIState) {
        /**
         * 
         */
        GUIState[GUIState["Null"] = 0] = "Null";
        /**
         * 
         */
        GUIState[GUIState["Loading"] = 1] = "Loading";
        /**
         * 
         */
        GUIState[GUIState["Showing"] = 2] = "Showing";
        /**
         * 
         */
        GUIState[GUIState["Showed"] = 3] = "Showed";
        /**
         * 
         */
        GUIState[GUIState["Closeing"] = 4] = "Closeing";
        /**
         * 
         */
        GUIState[GUIState["Closed"] = 5] = "Closed";
        /**
         * 
         */
        GUIState[GUIState["Destroyed"] = 6] = "Destroyed";
      })(GUIState || (GUIState = exports('GUIState', {})));
      var FullScreenWindow = exports('FullScreenWindow', /*#__PURE__*/function (_fgui$Window) {
        _inheritsLoose(FullScreenWindow, _fgui$Window);
        function FullScreenWindow() {
          return _fgui$Window.apply(this, arguments) || this;
        }
        var _proto = FullScreenWindow.prototype;
        _proto.onInit = function onInit() {
          this.makeFullScreen();
        };
        return FullScreenWindow;
      }(Window));
      var GUIStage = exports('GUIStage', /*#__PURE__*/function (_fgui$Window2) {
        _inheritsLoose(GUIStage, _fgui$Window2);
        function GUIStage() {
          return _fgui$Window2.apply(this, arguments) || this;
        }
        var _proto2 = GUIStage.prototype;
        _proto2.onInit = function onInit() {
          this.makeFullScreen();
          this.contentPane.makeFullScreen();
        };
        _proto2.onShown = function onShown() {
          //stage windtow
          var root = GRoot.inst;
          var toClose = [];
          for (var i = 0; i < root.numChildren; i++) {
            var child = root.getChildAt(i);
            if (child instanceof GUIStage && child !== this || child instanceof FullScreenWindow) {
              toClose.push(child);
            }
          }
          toClose.forEach(function (child) {
            GUIManager.close(child);
          });
        };
        return GUIStage;
      }(Window));
      var CenteredWindow = exports('CenteredWindow', /*#__PURE__*/function (_fgui$Window3) {
        _inheritsLoose(CenteredWindow, _fgui$Window3);
        function CenteredWindow() {
          return _fgui$Window3.apply(this, arguments) || this;
        }
        var _proto3 = CenteredWindow.prototype;
        _proto3.onInit = function onInit() {
          //  GRoot 
          this.center();
        };
        return CenteredWindow;
      }(Window));
      var AnimatedWindow = exports('AnimatedWindow', /*#__PURE__*/function (_fgui$Window4) {
        _inheritsLoose(AnimatedWindow, _fgui$Window4);
        function AnimatedWindow() {
          return _fgui$Window4.apply(this, arguments) || this;
        }
        var _proto4 = AnimatedWindow.prototype;
        _proto4.onInit = function onInit() {
          //  GRoot 
          this.center();
        }
        /**
         * 
         */;
        _proto4.doShowAnimation = function doShowAnimation() {
          var _this = this;
          UIAnimationHelper.popup(this.contentPane, 0.3, function () {
            _this.onShown();
          });
        }
        /**
         * 
         */;
        _proto4.doHideAnimation = function doHideAnimation() {
          var _this2 = this;
          UIAnimationHelper.shrink(this.contentPane, 0.3, function () {
            _this2.hideImmediately();
          });
        };
        return AnimatedWindow;
      }(Window));
      var UILayer;
      (function (UILayer) {
        /** */
        UILayer[UILayer["STAGE"] = 1] = "STAGE";
        /** */
        UILayer[UILayer["WINDOW"] = 2] = "WINDOW";
        /** */
        UILayer[UILayer["TIP"] = 3] = "TIP";
        /** */
        UILayer[UILayer["GUIDE"] = 4] = "GUIDE";
      })(UILayer || (UILayer = exports('UILayer', {})));
      /**
       * UI
       * UI
       */
      var UIAnimationHelper = exports('UIAnimationHelper', /*#__PURE__*/function () {
        function UIAnimationHelper() {}
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */
        UIAnimationHelper.popup = function popup(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          if (node.setScale) {
            node.setScale(0.1, 0.1);
          }
          tween(node.node || node).to(duration, {
            scale: new Vec3(1, 1, 1)
          }, {
            easing: 'backOut'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        }
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */;
        UIAnimationHelper.shrink = function shrink(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          tween(node.node || node).to(duration, {
            scale: new Vec3(0.1, 0.1, 1)
          }, {
            easing: 'backIn'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        }
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */;
        UIAnimationHelper.fadeIn = function fadeIn(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          if (node.node) {
            node.node.opacity = 0;
          } else {
            node.opacity = 0;
          }
          tween(node.node || node).to(duration, {
            opacity: 255
          }, {
            easing: 'quadOut'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        }
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */;
        UIAnimationHelper.fadeOut = function fadeOut(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          tween(node.node || node).to(duration, {
            opacity: 0
          }, {
            easing: 'quadOut'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        }
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */;
        UIAnimationHelper.slideInLeft = function slideInLeft(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          var targetNode = node.node || node;
          var originalPosition = targetNode.position.clone();
          var parent = targetNode.parent;
          var uiTransform = parent === null || parent === void 0 ? void 0 : parent.getComponent(UITransform);
          if (!parent || !uiTransform) {
            console.warn('UIAnimationHelper.slideInLeft  UITransform');
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
            return;
          }
          targetNode.setPosition(new Vec3(-uiTransform.width, originalPosition.y, originalPosition.z));
          tween(targetNode).to(duration, {
            position: originalPosition
          }, {
            easing: 'quadOut'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        }
        /**
         * 
         * @param node 
         * @param duration 0.3
         * @param onComplete 
         */;
        UIAnimationHelper.slideOutRight = function slideOutRight(node, duration, onComplete) {
          if (duration === void 0) {
            duration = 0.3;
          }
          var targetNode = node.node || node;
          var originalPosition = targetNode.position.clone();
          var parent = targetNode.parent;
          var uiTransform = parent === null || parent === void 0 ? void 0 : parent.getComponent(UITransform);
          if (!parent || !uiTransform) {
            console.warn('UIAnimationHelper.slideOutRight  UITransform');
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
            return;
          }
          var targetPosition = new Vec3(uiTransform.width, originalPosition.y, originalPosition.z);
          tween(targetNode).to(duration, {
            position: targetPosition
          }, {
            easing: 'quadOut'
          }).call(function () {
            onComplete === null || onComplete === void 0 ? void 0 : onComplete();
          }).start();
        };
        return UIAnimationHelper;
      }());
      var GUILogicBase = exports('GUILogicBase', /*#__PURE__*/function (_Component) {
        _inheritsLoose(GUILogicBase, _Component);
        //******************* ***************/
        /**
         * UI  list
         * @param node
         * @param enable
         * @returns
         */
        GUILogicBase.setSortRoot = function setSortRoot(node, enable) {
          if (enable === void 0) {
            enable = true;
          }
          if (!node) return;
          node.sortRoot = enable;
        };
        GUILogicBase.setUISorting = function setUISorting(node) {
          var _a;
          if (((_a = node === null || node === void 0 ? void 0 : node._uiProps) === null || _a === void 0 ? void 0 : _a.uiTransformComp) == null) return;
          if (typeof (arguments.length <= 1 ? undefined : arguments[1]) === 'boolean') {
            // 
            var enable = arguments.length <= 1 ? undefined : arguments[1];
            node._uiProps.uiTransformComp.sortingEnabled = enable;
          } else if (typeof (arguments.length <= 1 ? undefined : arguments[1]) === 'number' && typeof (arguments.length <= 2 ? undefined : arguments[2]) === 'number') {
            // 
            var layer = arguments.length <= 1 ? undefined : arguments[1];
            var priority = arguments.length <= 2 ? undefined : arguments[2];
            node._uiProps.uiTransformComp.sortingPriority = layer * 1e3 + priority;
            node._uiProps.uiTransformComp.sortingEnabled = true;
          } else {
            throw new Error('Invalid arguments');
          }
        };
        function GUILogicBase() {
          var _this3;
          _this3 = _Component.call(this) || this;
          /**
           * 
           * @readonly
           * @remarks
           * 
           */
          _this3.event_target_as = new Set();
          /**  */
          _this3._release_manage = new mk_release();
          var hockFuncs = ["onLoad", "start", "onEnable", "onDisable", "onDestroy"];
          // 
          mk_tool.func.run_parent_func(_assertThisInitialized(_this3), hockFuncs);
          // 
          // tool.func.timeout_warning<Component>(global_config.view.blocking_warning_time_ms_n, this, hockFuncs)
          return _this3;
        }
        /**  */
        var _proto5 = GUILogicBase.prototype;
        /* -------------------------------  ------------------------------- */
        /** */
        _proto5.onDestroy = function onDestroy() {
          var _this4 = this;
          // 
          this.unscheduleAllCallbacks();
          // 
          mk_monitor$1.clear(this);
          // 
          this.event_target_as.forEach(function (v) {
            if (v.targetOff) {
              v.targetOff(_this4);
            } else if (v.target_off) {
              v.target_off(_this4);
            }
          });
          // 
          this._release_manage.release();
        }
        /* -------------------------------  ------------------------------- */
        /**
         * 
         * @param asset_ 
         */;
        _proto5.follow_release = function follow_release(object_) {
          if (!object_) {
            return object_;
          }
          // 
          this._release_manage.add(object_);
          // 
          if (!this.isValid) {
            // this._log.debug("");
            this._release_manage.release_all();
          }
          return object_;
        };
        _proto5.cancel_release = function cancel_release(object_) {
          if (!object_) {
            return object_;
          }
          // 
          this._release_manage.release(object_);
          return object_;
        };
        _createClass(GUILogicBase, [{
          key: "UI",
          get: function get() {
            if (this._ui == null) {
              this._ui = this.node["$gobj"];
            }
            return this._ui;
          }
        }, {
          key: "Data",
          get: function get() {
            var _a;
            return (_a = this.UI) === null || _a === void 0 ? void 0 : _a.data;
          }
        }, {
          key: "_log",
          get: function get() {
            var _a;
            return (_a = this._log2) !== null && _a !== void 0 ? _a : this._log2 = new mk_logger(js.getClassName(this));
          }
        }]);
        return GUILogicBase;
      }(Component));
      var __awaiter$2 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**UI */
      var PackagePrefix = "UI/";
      /** */
      var DestoryTime = 30;
      /**UI */
      var MaxWaitDestoryNum = 10;
      /**
       * GUI
       */
      var GUIManagerImpl = /*#__PURE__*/function () {
        function GUIManagerImpl() {
          this.__uiMap = new Map();
          this._uiOpenNumMap = new Map();
          /**
           * 
           */
          this.__destoryList = [];
          /**
           *  Map
           */
          this.__packageRefCount = new Map();
          this.EventTarget = new mk_event_target();
          TickerManager.addTicker(this);
        }
        /**
        * 
        * @param dt
        */
        /**
         * UI
         * @param dt 
         */
        var _proto6 = GUIManagerImpl.prototype;
        _proto6.tick = function tick(dt) {
          for (var i = 0; i < this.__destoryList.length; i++) {
            var uiinfo = this.__destoryList[i];
            if (uiinfo.State === GUIState.Closed) {
              // 
              if (uiinfo.CloseTime + DestoryTime < Timer.currentTime) {
                this.disposeWindow(uiinfo);
                i--;
              } else {
                break;
              }
            } else {
              // 
              this.__destoryList.splice(i, 1);
              i--;
            }
          }
        }
        /**
         * 
         * @param uiinfo UI
         */;
        _proto6.disposeWindow = function disposeWindow(uiinfo) {
          if (uiinfo.UI) {
            // 
            var index = this.__destoryList.indexOf(uiinfo);
            if (index !== -1) {
              this.__destoryList.splice(index, 1);
            }
            if (uiinfo.State !== GUIState.Closed) {
              return;
            }
            // 
            this.removeModalClickListener(uiinfo);
            // UI
            this.__uiMap["delete"](uiinfo.URL);
            // UI
            if (!uiinfo.UI.isDisposed) {
              uiinfo.UI.dispose();
            }
            uiinfo.UI = null;
            uiinfo.State = GUIState.Destroyed;
            // 
            this.unloadPackagesIfNeeded(uiinfo);
          }
        };
        _proto6.unloadPackagesIfNeeded = function unloadPackagesIfNeeded(uiinfo) {
          var _this5 = this;
          var cls = this.getUICls(uiinfo.URL);
          cls.Dependencies.forEach(function (pkgName) {
            _this5.setPackageRefCount(pkgName, -1);
          });
        };
        _proto6.setPackageRefCount = function setPackageRefCount(pkgName, num) {
          if (num === void 0) {
            num = 1;
          }
          var count = (this.__packageRefCount.get(pkgName) || 0) + num;
          if (count > 0) {
            this.__packageRefCount.set(pkgName, count);
          } else {
            this.__packageRefCount["delete"](pkgName);
            UIPackage.removePackage(pkgName); // 
            log("unload package", pkgName);
          }
        };
        _proto6.open = function open(arg, data) {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
            var cls;
            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  if (typeof arg === "string") {
                    cls = this.getUICls(arg);
                  } else {
                    cls = arg;
                  }
                  if (cls) {
                    _context.next = 4;
                    break;
                  }
                  error("UI", arg);
                  return _context.abrupt("return", null);
                case 4:
                  if (!this.__uiMap.has(cls.URL)) {
                    _context.next = 8;
                    break;
                  }
                  return _context.abrupt("return", this.openExisting(cls, data));
                case 8:
                  return _context.abrupt("return", this.openNew(cls, data));
                case 9:
                case "end":
                  return _context.stop();
              }
            }, _callee, this);
          }));
        };
        _proto6._setUISortIndex = function _setUISortIndex(uiInfo, cls) {
          var _a;
          var layer = ((_a = cls.uiOptions) === null || _a === void 0 ? void 0 : _a.layer) || UILayer.WINDOW;
          if (layer == UILayer.STAGE) {
            // 
            this._uiOpenNumMap.set(layer, 0);
          }
          var num = this._uiOpenNumMap.get(layer) || 0;
          num++;
          this._uiOpenNumMap.set(layer, num);
          uiInfo.sortIndex = layer * 1e6 + num;
        }
        /**
         * UI
         * @param cls UI
         * @param data UI
         * @returns UI
         */;
        _proto6.openExisting = function openExisting(cls, data) {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
            var uiInfo, ui, _ui;
            return _regeneratorRuntime().wrap(function _callee2$(_context2) {
              while (1) switch (_context2.prev = _context2.next) {
                case 0:
                  // UI
                  uiInfo = this.__uiMap.get(cls.URL);
                  this._setUISortIndex(uiInfo, cls);
                  if (!(uiInfo.State === GUIState.Loading && uiInfo.loadingPromise)) {
                    _context2.next = 15;
                    break;
                  }
                  _context2.prev = 3;
                  _context2.next = 6;
                  return uiInfo.loadingPromise;
                case 6:
                  ui = _context2.sent;
                  if (ui) {
                    _context2.next = 9;
                    break;
                  }
                  return _context2.abrupt("return", null);
                case 9:
                  if (data) ui.contentPane.data = data;
                  if (!ui.isDisposed) {
                    ui.sortingOrder = uiInfo.sortIndex;
                    if (!ui.isShowing) {
                      ui.show();
                      uiInfo.State = GUIState.Showed;
                    }
                  }
                  return _context2.abrupt("return", ui);
                case 12:
                  _context2.prev = 12;
                  // Promise
                  uiInfo.loadingPromise = undefined;
                  return _context2.finish(12);
                case 15:
                  if (!uiInfo.UI) {
                    _context2.next = 30;
                    break;
                  }
                  if (!uiInfo.UI.isDisposed) {
                    _context2.next = 19;
                    break;
                  }
                  this.disposeWindow(uiInfo);
                  return _context2.abrupt("return", this.openNew(cls, data));
                case 19:
                  // UI
                  if (uiInfo.State === GUIState.Closed) {
                    // UI
                    this.removeFromDestroyList(uiInfo);
                  }
                  // UIUI
                  if (data) uiInfo.UI.contentPane.data = data;
                  uiInfo.UI.sortingOrder = uiInfo.sortIndex;
                  uiInfo.UI.show();
                  uiInfo.State = GUIState.Showed;
                  // 
                  this.addModalClickListener(uiInfo, cls);
                  // GUILogicBasestartUI
                  this.triggerStartForGUILogic(uiInfo.UI.contentPane);
                  this.EventTarget.emit(this.EventTarget.key.OPEN, uiInfo);
                  return _context2.abrupt("return", uiInfo.UI);
                case 30:
                  if (uiInfo.loadingPromise) {
                    _context2.next = 32;
                    break;
                  }
                  return _context2.abrupt("return", this.openNew(cls, data));
                case 32:
                  log("", cls.URL, "");
                  _context2.next = 35;
                  return uiInfo.loadingPromise;
                case 35:
                  _ui = _context2.sent;
                  if (data && _ui && !_ui.isDisposed) {
                    _ui.contentPane.data = data;
                  }
                  return _context2.abrupt("return", _ui);
                case 38:
                case "end":
                  return _context2.stop();
              }
            }, _callee2, this, [[3,, 12, 15]]);
          }));
        }
        /**
         * UI
         * @param cls UI
         * @param data UI
         * @returns UI
         */;
        _proto6.openNew = function openNew(cls, data) {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {
            var _this6 = this;
            var uiInfo, loadingPromise;
            return _regeneratorRuntime().wrap(function _callee4$(_context4) {
              while (1) switch (_context4.prev = _context4.next) {
                case 0:
                  // UI
                  uiInfo = {
                    State: GUIState.Loading,
                    URL: cls.URL
                  };
                  this._setUISortIndex(uiInfo, cls);
                  this.__uiMap.set(cls.URL, uiInfo);
                  loadingPromise = function () {
                    return __awaiter$2(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {
                      var _this7 = this;
                      var _a, _b, _c, _d, gCom, clsWindow, guiWindow;
                      return _regeneratorRuntime().wrap(function _callee3$(_context3) {
                        while (1) switch (_context3.prev = _context3.next) {
                          case 0:
                            _context3.prev = 0;
                            _context3.next = 3;
                            return this.loadUI(cls);
                          case 3:
                            gCom = _context3.sent;
                            if (gCom) {
                              _context3.next = 8;
                              break;
                            }
                            // UInull
                            this.__uiMap["delete"](cls.URL);
                            uiInfo.State = GUIState.Destroyed;
                            return _context3.abrupt("return", null);
                          case 8:
                            // GUIWindow
                            ((_a = cls.uiOptions) === null || _a === void 0 ? void 0 : _a.layer) || UILayer.WINDOW;
                            clsWindow = ((_b = cls.uiOptions) === null || _b === void 0 ? void 0 : _b.windowCls) || CenteredWindow;
                            guiWindow = new clsWindow();
                            if ((_c = cls.uiOptions) === null || _c === void 0 ? void 0 : _c.modal) guiWindow.modal = true;
                            if (data) gCom.data = data;
                            guiWindow.contentPane = gCom;
                            uiInfo.UI = guiWindow;
                            // root
                            gCom.node.sortRoot = true;
                            if (!((_d = cls.uiOptions) === null || _d === void 0 ? void 0 : _d.closeAutoTextBatch)) gCom.node.autoBatchTxt = true;
                            // 
                            this.addModalClickListener(uiInfo, cls);
                            // UI
                            this.showIfNotClosed(uiInfo);
                            // 
                            cls.Dependencies.forEach(function (pkgName) {
                              _this7.setPackageRefCount(pkgName);
                            });
                            return _context3.abrupt("return", guiWindow);
                          case 23:
                            _context3.prev = 23;
                            _context3.t0 = _context3["catch"](0);
                            this.__uiMap["delete"](cls.URL);
                            uiInfo.State = GUIState.Destroyed;
                            throw _context3.t0;
                          case 28:
                          case "end":
                            return _context3.stop();
                        }
                      }, _callee3, this, [[0, 23]]);
                    }));
                  }();
                  uiInfo.loadingPromise = loadingPromise;
                  _context4.prev = 5;
                  _context4.next = 8;
                  return loadingPromise;
                case 8:
                  return _context4.abrupt("return", _context4.sent);
                case 9:
                  _context4.prev = 9;
                  uiInfo.loadingPromise = undefined;
                  return _context4.finish(9);
                case 12:
                case "end":
                  return _context4.stop();
              }
            }, _callee4, this, [[5,, 9, 12]]);
          }));
        }
        // UI
        ;

        _proto6.removeFromDestroyList = function removeFromDestroyList(uiInfo) {
          var index = this.__destoryList.indexOf(uiInfo);
          if (index !== -1) {
            this.__destoryList.splice(index, 1);
          }
        }
        // UIUI
        ;

        _proto6.showIfNotClosed = function showIfNotClosed(uiInfo) {
          if (uiInfo.State !== GUIState.Closed) {
            uiInfo.UI.sortingOrder = uiInfo.sortIndex;
            uiInfo.UI.show();
            uiInfo.State = GUIState.Showed;
            this.EventTarget.emit(this.EventTarget.key.OPEN, uiInfo);
          }
        }
        // UI
        ;

        _proto6.loadUI = function loadUI(cls) {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {
            var _this8 = this;
            var _a, hideLoadModal, needLoadPackages, ui;
            return _regeneratorRuntime().wrap(function _callee5$(_context5) {
              while (1) switch (_context5.prev = _context5.next) {
                case 0:
                  hideLoadModal = (_a = cls.uiOptions) === null || _a === void 0 ? void 0 : _a.hideLoadModal;
                  _context5.prev = 1;
                  // 
                  needLoadPackages = [];
                  cls.Dependencies.forEach(function (pkgName) {
                    if (!UIPackage.getByName(pkgName)) {
                      needLoadPackages.push(pkgName);
                    }
                  });
                  // 
                  if (!(needLoadPackages.length > 0)) {
                    _context5.next = 9;
                    break;
                  }
                  if (!hideLoadModal) GRoot.inst.showModalWait();
                  _context5.next = 8;
                  return Promise.all(needLoadPackages.map(function (pkgName) {
                    return _this8.loadPackage(pkgName);
                  }));
                case 8:
                  if (!hideLoadModal) GRoot.inst.closeModalWait();
                case 9:
                  // UI
                  ui = cls.createInstance();
                  return _context5.abrupt("return", ui);
                case 13:
                  _context5.prev = 13;
                  _context5.t0 = _context5["catch"](1);
                  error(_context5.t0);
                  if (!hideLoadModal) GRoot.inst.closeModalWait();
                case 17:
                case "end":
                  return _context5.stop();
              }
            }, _callee5, null, [[1, 13]]);
          }));
        }
        /**
         * UI
         */;
        _proto6.loadPackage = function loadPackage(pkgName, onProgress) {
          return __awaiter$2(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {
            return _regeneratorRuntime().wrap(function _callee6$(_context6) {
              while (1) switch (_context6.prev = _context6.next) {
                case 0:
                  return _context6.abrupt("return", new Promise(function (resolve, reject) {
                    var resourcePath = PackagePrefix + pkgName;
                    if (onProgress) {
                      // resources
                      UIPackage.loadPackage(resourcePath, onProgress, function (error, pkg) {
                        if (error) {
                          reject(error);
                        } else {
                          log("load package success", pkgName);
                          resolve(pkg);
                        }
                      });
                    } else {
                      // resources
                      UIPackage.loadPackage(resourcePath, function (error, pkg) {
                        if (error) {
                          reject(error);
                        } else {
                          log("load package success", pkgName);
                          resolve(pkg);
                        }
                      });
                    }
                  }));
                case 1:
                case "end":
                  return _context6.stop();
              }
            }, _callee6);
          }));
        };
        _proto6.close = function close(arg) {
          var cls = arg;
          if (arg instanceof Window) {
            cls = this.getUICls(arg.contentPane.resourceURL);
          } else if (arg instanceof GComponent) {
            cls = this.getUICls(arg.resourceURL);
          }
          // UI
          var info = this.__uiMap.get(cls.URL);
          // UIUI
          if (info && info.State !== GUIState.Closed) {
            // 
            this.removeModalClickListener(info);
            // UIUI
            if (info.UI) {
              info.UI.hide();
            }
            // UI
            info.State = GUIState.Closed;
            this.EventTarget.emit(this.EventTarget.key.CLOSE, info);
            // UI
            info.CloseTime = Timer.currentTime;
            // UIUI
            if (this.__destoryList.length >= MaxWaitDestoryNum) {
              var destoryInfo = this.__destoryList.shift();
              this.disposeWindow(destoryInfo);
            }
            // UI
            this.__destoryList.push(info);
          }
        }
        /**
         * UI
         */;
        _proto6.closeAll = function closeAll() {
          var _this9 = this;
          // UI
          this.__uiMap.forEach(function (info, key) {
            // UI
            var cls = _this9.getUICls(key);
            // UIUI
            if (cls) {
              _this9.close(cls);
            }
          });
        }
        /**
         * UI
         * @param cls UI
         * @returns UI
         */;
        _proto6.getGUIState = function getGUIState(cls) {
          // UI
          var info = this.__uiMap.get(cls.URL);
          if (info) {
            // UI
            if (info.UI) {
              return info.UI.isShowing ? GUIState.Showed : GUIState.Closed;
            }
            // UI
            return info.State;
          } else {
            // UI
            return GUIState.Destroyed;
          }
        }
        /**
         * UI
         * @param url UI
         * @returns UI
         */;
        _proto6.getUICls = function getUICls(url) {
          // UI
          var cls = UIObjectFactory.extensions[url];
          return cls;
        }
        /**
         * GUILogicBasestart
         * @param contentPane UI
         * @remarks UIstart
         */;
        _proto6.triggerStartForGUILogic = function triggerStartForGUILogic(contentPane) {
          if (contentPane && contentPane.node) {
            // 
            var components = contentPane.node.getComponents('cc.Component');
            components.forEach(function (component) {
              // GUILogicBase
              if (component instanceof GUILogicBase) {
                try {
                  // startstart
                  if (typeof component.start === 'function') {
                    component.start();
                  }
                } catch (error) {
                  console.warn('start:', error);
                }
              }
            });
          }
        }
        /**
         * UI
        */;
        _proto6.getUI = function getUI(cls) {
          var uiInfo = this.__uiMap.get(cls.URL);
          if (uiInfo && uiInfo.State === GUIState.Showed) {
            return uiInfo.UI.contentPane;
          }
        }
        /**
         * 
         * @param uiinfo UI
         * @param cls UI
         */;
        _proto6.addModalClickListener = function addModalClickListener(uiinfo, cls) {
          var _this10 = this;
          var _a, _b;
          if (((_a = cls.uiOptions) === null || _a === void 0 ? void 0 : _a.modal) && ((_b = cls.uiOptions) === null || _b === void 0 ? void 0 : _b.clickModalToClose) && uiinfo.UI) {
            // 
            this.removeModalClickListener(uiinfo);
            var modalLayer = GRoot.inst.modalLayer;
            if (modalLayer) {
              // 
              var clickListener = function clickListener() {
                // UI
                if (uiinfo.State === GUIState.Showed && uiinfo.UI && !uiinfo.UI.isDisposed) {
                  // UI
                  _this10.close(cls);
                }
              };
              // 
              uiinfo.modalClickListener = clickListener;
              // 
              modalLayer.onClick(clickListener, this);
              log("", cls.URL);
            }
          }
        }
        /**
         * 
         * @param uiinfo UI
         */;
        _proto6.removeModalClickListener = function removeModalClickListener(uiinfo) {
          if (uiinfo.modalClickListener) {
            var modalLayer = GRoot.inst.modalLayer;
            if (modalLayer) {
              modalLayer.offClick(uiinfo.modalClickListener, this);
              log("", uiinfo.URL);
            }
            uiinfo.modalClickListener = null;
          }
        };
        return GUIManagerImpl;
      }(); // GUIManager
      var GUIManager = exports('GUIManager', new GUIManagerImpl());
      function registerBinder(constructor) {
        AllBinder.Binders.push(new constructor());
      }
      var AllBinder = exports('AllBinder', /*#__PURE__*/function () {
        function AllBinder() {}
        AllBinder.bindAll = function bindAll() {
          this.Binders.forEach(function (binder) {
            binder.bindAll();
          });
        };
        return AllBinder;
      }());
      AllBinder.Binders = [];
      //  TODO 
      {
        director.on(Director.EVENT_BEFORE_SCENE_LAUNCH, function () {
          AllBinder.bindAll();
          director.targetOff(AllBinder);
        }, AllBinder);
        director.on(Director.EVENT_AFTER_SCENE_LAUNCH, function () {
          GRoot.create();
        }, GRoot);
      }

      /**
       * 
       *  FairyGUI  UI  Cocos Node 
       */
      var BackgroundAdapter = exports('BackgroundAdapter', /*#__PURE__*/function () {
        function BackgroundAdapter() {}
        /**
         *  FairyGUI  UI 
         * @param bgNode 
         * @param config 
         */
        BackgroundAdapter.adaptBackground = function adaptBackground(bgNode, config) {
          var _a;
          if (!bgNode) {
            console.warn("[BackgroundAdapter] ");
            return;
          }
          var enableLog = (_a = config === null || config === void 0 ? void 0 : config.enableLog) !== null && _a !== void 0 ? _a : false;
          try {
            //  FairyGUI 
            var fguiRoot = GRoot.inst;
            var rootWidth = fguiRoot.width;
            var rootHeight = fguiRoot.height;
            // 
            var designSize = view.getDesignResolutionSize();
            // 
            var screenSize = view.getVisibleSize();
            if (enableLog) {
              console.log("[BackgroundAdapter] FairyGUI \u9002\u914D\u4FE1\u606F:\n                    FGUI \u6839\u8282\u70B9\u5C3A\u5BF8: " + rootWidth + " x " + rootHeight + "\n                    \u8BBE\u8BA1\u5206\u8FA8\u7387: " + designSize.width + " x " + designSize.height + "\n                    \u5C4F\u5E55\u5C3A\u5BF8: " + screenSize.width + " x " + screenSize.height);
            }
            //  FairyGUI 
            var widthScale = rootWidth / designSize.width;
            var heightScale = rootHeight / designSize.height;
            //  FGUI 
            bgNode.setScale(widthScale, heightScale);
            if (enableLog) {
              console.log("[BackgroundAdapter] \u80CC\u666F\u9002\u914D\u5B8C\u6210:\n                    \u5BBD\u5EA6\u7F29\u653E: " + widthScale.toFixed(3) + "\n                    \u9AD8\u5EA6\u7F29\u653E: " + heightScale.toFixed(3) + "\n                    \u6700\u7EC8\u80CC\u666F\u5C3A\u5BF8: " + (designSize.width * widthScale).toFixed(1) + " x " + (designSize.height * heightScale).toFixed(1));
            }
          } catch (error) {
            console.error("[BackgroundAdapter] :", error);
            // 
            var visibleSize = view.getVisibleSize();
            var _designSize = view.getDesignResolutionSize();
            var _widthScale = visibleSize.width / _designSize.width;
            var _heightScale = visibleSize.height / _designSize.height;
            bgNode.setScale(_widthScale, _heightScale);
            if (enableLog) {
              console.log("[BackgroundAdapter] \u4F7F\u7528\u56DE\u9000\u65B9\u6848\u9002\u914D\u5B8C\u6210: " + _widthScale.toFixed(3) + " x " + _heightScale.toFixed(3));
            }
          }
        };
        return BackgroundAdapter;
      }());
      /**
       * 
       *  BGM 
       */
      var AudioUtil = exports('AudioUtil', /*#__PURE__*/function () {
        function AudioUtil() {}
        // ==================== BGM  ====================
        /**
         * 
         * @param node  AudioSource 
         * @param packageName UI 
         * @param soundName 
         * @param config 
         * @returns AudioSource 
         */
        AudioUtil.playBGM = function playBGM(node, packageName, soundName, config) {
          var _a, _b;
          try {
            //  UIPackage 
            var uiPackage = UIPackage.getByName(packageName);
            if (!uiPackage) {
              console.error("[AudioUtil] UIPackage \"" + packageName + "\" \u672A\u627E\u5230");
              return null;
            }
            var audioClip = uiPackage.getItemAssetByName(soundName);
            if (!audioClip) {
              console.error("[AudioUtil] \u97F3\u9891\u8D44\u6E90 \"" + soundName + "\" \u5728\u5305 \"" + packageName + "\" \u4E2D\u672A\u627E\u5230");
              return null;
            }
            //  AudioSource 
            var audioSource = node.addComponent(AudioSource);
            if (!audioSource.isValid) {
              console.error("[AudioUtil] AudioSource \u7EC4\u4EF6\u521B\u5EFA\u5931\u8D25");
              return null;
            }
            //  AudioSource
            audioSource.clip = audioClip;
            audioSource.volume = (_a = config === null || config === void 0 ? void 0 : config.volume) !== null && _a !== void 0 ? _a : 0.7;
            audioSource.loop = (_b = config === null || config === void 0 ? void 0 : config.loop) !== null && _b !== void 0 ? _b : true;
            audioSource.playOnAwake = false;
            // 
            audioSource.play();
            return audioSource;
          } catch (error) {
            console.error("[AudioUtil] \u64AD\u653E BGM \u5931\u8D25:", error);
            return null;
          }
        }
        // ====================  ====================
        /**
         * 
         * @param config 
         */;
        AudioUtil.configureSoundPool = function configureSoundPool(config) {
          if (this.poolInitialized) {
            console.warn("[AudioUtil] ");
          }
          if (config.maxInstances !== undefined) {
            this.config.maxInstances = config.maxInstances;
          }
          if (config.defaultVolume !== undefined) {
            this.config.defaultVolume = config.defaultVolume;
          }
          if (config.enableLog !== undefined) {
            this.config.enableLog = config.enableLog;
          }
          if (this.config.enableLog) {
            console.log("[AudioUtil] \u97F3\u6548\u6C60\u914D\u7F6E\u5DF2\u66F4\u65B0:", this.config);
          }
        }
        /**
         *  playSound 
         */;
        AudioUtil.initSoundPool = function initSoundPool() {
          if (this.poolInitialized) {
            return;
          }
          try {
            // 
            this.audioContainer = new Node('AudioSourcePool');
            // 
            // TODO:  DontDestroyOnLoad
            // director.addPersistRootNode(this.audioContainer);
            //  AudioSource 
            for (var i = 0; i < this.config.maxInstances; i++) {
              var audioSource = this.audioContainer.addComponent(AudioSource);
              audioSource.loop = false;
              audioSource.playOnAwake = false;
              audioSource.volume = this.config.defaultVolume;
              this.audioSourcePool.push(audioSource);
            }
            this.poolInitialized = true;
            if (this.config.enableLog) {
              console.log("[AudioUtil] \u97F3\u6548\u6C60\u521D\u59CB\u5316\u6210\u529F\uFF0C\u521B\u5EFA\u4E86 " + this.config.maxInstances + " \u4E2A\u97F3\u6548\u5B9E\u4F8B");
            }
          } catch (error) {
            console.error("[AudioUtil] \u97F3\u6548\u6C60\u521D\u59CB\u5316\u5931\u8D25:", error);
          }
        }
        /**
         * 
         * @param packageName UI 
         * @param soundName 
         */;
        AudioUtil.playSound = function playSound(packageName, soundName) {
          // 
          if (!this.poolInitialized) {
            this.initSoundPool();
          }
          if (this.audioSourcePool.length === 0) {
            console.warn("[AudioUtil] ");
            return;
          }
          try {
            //  key
            var cacheKey = packageName + "_" + soundName;
            // 
            var audioClip = this.soundCache.get(cacheKey);
            // 
            if (!audioClip) {
              var uiPackage = UIPackage.getByName(packageName);
              if (!uiPackage) {
                console.error("[AudioUtil] UIPackage \"" + packageName + "\" \u672A\u627E\u5230");
                return;
              }
              audioClip = uiPackage.getItemAssetByName(soundName);
              if (!audioClip) {
                console.error("[AudioUtil] \u97F3\u9891\u8D44\u6E90 \"" + soundName + "\" \u5728\u5305 \"" + packageName + "\" \u4E2D\u672A\u627E\u5230");
                return;
              }
              // 
              this.soundCache.set(cacheKey, audioClip);
              if (this.config.enableLog) {
                console.log("[AudioUtil] \u97F3\u9891\u8D44\u6E90\u5DF2\u7F13\u5B58: " + cacheKey);
              }
            }
            // 
            var audioSource = this.audioSourcePool[this.audioSourceIndex];
            // 
            if (audioSource.playing) {
              audioSource.stop();
            }
            // 
            audioSource.clip = audioClip;
            audioSource.play();
            // 
            this.audioSourceIndex = (this.audioSourceIndex + 1) % this.audioSourcePool.length;
          } catch (error) {
            console.error("[AudioUtil] \u64AD\u653E\u97F3\u6548\u5931\u8D25:", error);
          }
        }
        /**
         * 
         */;
        AudioUtil.stopAllSounds = function stopAllSounds() {
          if (!this.poolInitialized) {
            return;
          }
          try {
            this.audioSourcePool.forEach(function (audioSource) {
              if (audioSource.playing) {
                audioSource.stop();
              }
            });
            if (this.config.enableLog) {
              console.log("[AudioUtil] \u5DF2\u505C\u6B62\u6240\u6709\u97F3\u6548");
            }
          } catch (error) {
            console.error("[AudioUtil] \u505C\u6B62\u97F3\u6548\u5931\u8D25:", error);
          }
        }
        /**
         * 
         */;
        AudioUtil.dispose = function dispose() {
          if (!this.poolInitialized) {
            return;
          }
          try {
            // 
            this.stopAllSounds();
            // 
            this.audioSourcePool = [];
            this.audioSourceIndex = 0;
            // 
            if (this.audioContainer && this.audioContainer.isValid) {
              this.audioContainer.destroy();
            }
            this.audioContainer = null;
            // 
            this.soundCache.clear();
            // 
            this.poolInitialized = false;
            if (this.config.enableLog) {
              console.log("[AudioUtil] \u97F3\u6548\u6C60\u5DF2\u9500\u6BC1");
            }
          } catch (error) {
            console.error("[AudioUtil] \u9500\u6BC1\u97F3\u6548\u6C60\u5931\u8D25:", error);
          }
        }
        /**
         * 
         */;
        AudioUtil.getPoolStatus = function getPoolStatus() {
          return {
            initialized: this.poolInitialized,
            poolSize: this.audioSourcePool.length,
            currentIndex: this.audioSourceIndex,
            cachedSounds: this.soundCache.size,
            playingSounds: this.audioSourcePool.filter(function (src) {
              return src.playing;
            }).length
          };
        };
        return AudioUtil;
      }()); // ====================  ====================
      /**  */
      AudioUtil.audioSourcePool = [];
      /**  */
      AudioUtil.audioSourceIndex = 0;
      /**  */
      AudioUtil.audioContainer = null;
      /**  Map<packageName_soundName, AudioClip> */
      AudioUtil.soundCache = new Map();
      /**  */
      AudioUtil.config = {
        maxInstances: 8,
        defaultVolume: 1.0,
        enableLog: false
      };
      /**  */
      AudioUtil.poolInitialized = false;
      var __awaiter$1 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * 
       * Design by Linus Philosophy: Simple, Fast, No Magic.
       */
      var Pool = exports('Pool', /*#__PURE__*/function () {
        function Pool(creator, destroyer) {
          this._pool = [];
          this._creator = creator;
          this._destroyer = destroyer;
        }
        var _proto7 = Pool.prototype;
        _proto7.get = function get() {
          var item;
          if (this._pool.length > 0) {
            item = this._pool.pop();
          } else {
            item = this._creator();
          }
          if (this.onGet) {
            this.onGet(item);
          }
          return item;
        };
        _proto7.put = function put(item) {
          if (!item) return;
          if (this.onPut) {
            this.onPut(item);
          }
          this._pool.push(item);
        };
        _proto7.putAll = function putAll(items) {
          for (var i = 0, l = items.length; i < l; i++) {
            this.put(items[i]);
          }
          items.length = 0;
        };
        _proto7.clear = function clear() {
          if (this._destroyer) {
            this._pool.forEach(this._destroyer);
          }
          this._pool.length = 0;
        };
        _proto7.fill = function fill(count) {
          while (this._pool.length < count) {
            this._pool.push(this._creator());
          }
        };
        _createClass(Pool, [{
          key: "count",
          get: function get() {
            return this._pool.length;
          }
        }]);
        return Pool;
      }());
      var ObjPoolMgr = /*#__PURE__*/function (_instance_base) {
        _inheritsLoose(ObjPoolMgr, _instance_base);
        function ObjPoolMgr() {
          var _this11;
          _this11 = _instance_base.apply(this, arguments) || this;
          _this11._prefabpools = new Map();
          _this11._gobjpools = new Map();
          _this11._txtPool = null;
          return _this11;
        }
        var _proto8 = ObjPoolMgr.prototype;
        _proto8.getPrefabPool = function getPrefabPool(path, bundle) {
          return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {
            var key, prefab, pool;
            return _regeneratorRuntime().wrap(function _callee7$(_context7) {
              while (1) switch (_context7.prev = _context7.next) {
                case 0:
                  key = "" + bundle + path;
                  if (this._prefabpools.has(key)) {
                    _context7.next = 12;
                    break;
                  }
                  _context7.next = 4;
                  return mk_asset$1.get(path, Prefab, null, {
                    bundle_s: bundle
                  });
                case 4:
                  prefab = _context7.sent;
                  if (prefab) {
                    _context7.next = 8;
                    break;
                  }
                  error("getPrefabPool failed: " + path);
                  throw new Error("Prefab not found: " + path);
                case 8:
                  pool = new Pool(function () {
                    return instantiate(prefab);
                  }, function (node) {
                    return node.destroy();
                  });
                  pool.onGet = function (node) {
                    node.parent = null;
                    node.active = true;
                  };
                  pool.fill(5);
                  this._prefabpools.set(key, pool);
                case 12:
                  return _context7.abrupt("return", this._prefabpools.get(key));
                case 13:
                case "end":
                  return _context7.stop();
              }
            }, _callee7, this);
          }));
        };
        _proto8.getGobjPool = function getGobjPool(arg1, arg2) {
          return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {
            var key, pool, packageName, itemName, uiPackage, cls;
            return _regeneratorRuntime().wrap(function _callee8$(_context8) {
              while (1) switch (_context8.prev = _context8.next) {
                case 0:
                  // Determine key
                  if (typeof arg1 === "string") {
                    key = "" + arg1 + arg2;
                  } else {
                    key = arg1.URL;
                  }
                  if (this._gobjpools.has(key)) {
                    _context8.next = 24;
                    break;
                  }
                  if (!(typeof arg1 === "string")) {
                    _context8.next = 16;
                    break;
                  }
                  packageName = arg1;
                  itemName = arg2;
                  uiPackage = UIPackage.getByName(packageName);
                  if (uiPackage) {
                    _context8.next = 10;
                    break;
                  }
                  _context8.next = 9;
                  return GUIManager.loadPackage(packageName);
                case 9:
                  uiPackage = _context8.sent;
                case 10:
                  if (uiPackage) {
                    _context8.next = 13;
                    break;
                  }
                  error("create gobj pool " + packageName + "/" + itemName + " failed, package not found");
                  throw new Error("Package not found: " + packageName);
                case 13:
                  pool = new Pool(function () {
                    var gobj = UIPackage.createObject(packageName, itemName);
                    if (!gobj) {
                      error("create gobj " + packageName + "/" + itemName + " failed, item not found");
                      throw new Error("GObject item not found: " + itemName);
                    }
                    return gobj;
                  }, function (gobj) {
                    return gobj.dispose();
                  });
                  _context8.next = 21;
                  break;
                case 16:
                  cls = arg1; // Ensure dependencies are loaded
                  if (!(cls.Dependencies && cls.Dependencies.length > 0)) {
                    _context8.next = 20;
                    break;
                  }
                  _context8.next = 20;
                  return Promise.all(cls.Dependencies.map(function (pkg) {
                    if (!UIPackage.getByName(pkg)) return GUIManager.loadPackage(pkg);
                    return Promise.resolve(null);
                  }));
                case 20:
                  pool = new Pool(function () {
                    return cls.createInstance();
                  }, function (gobj) {
                    return gobj.dispose();
                  });
                case 21:
                  // Common Configuration
                  pool.onGet = function (obj) {
                    if (obj.parent) {
                      obj.removeFromParent();
                    } else {
                      obj.node.parent = null;
                    }
                    obj.visible = true;
                  };
                  pool.fill(5);
                  this._gobjpools.set(key, pool);
                case 24:
                  return _context8.abrupt("return", this._gobjpools.get(key));
                case 25:
                case "end":
                  return _context8.stop();
              }
            }, _callee8, this);
          }));
        };
        _proto8.getTxtPool = function getTxtPool() {
          if (!this._txtPool) {
            this._txtPool = new Pool(function () {
              return new GTextField();
            }, function (label) {
              return label.dispose();
            });
            this._txtPool.onGet = function (obj) {
              if (obj.parent) {
                obj.removeFromParent();
              } else {
                obj.node.parent = null;
              }
              obj.fontSize = 20;
              obj.text = "";
              obj.bold = false;
              obj.sortingOrder = 0;
              obj.alpha = 1;
              obj.setPivot(0.5, 1, true);
              obj.autoSize = AutoSizeType.Both;
              obj.visible = true;
              // Reset stroke properties to avoid style pollution
              obj.stroke = 0;
              obj.strokeColor = null;
            };
            this._txtPool.fill(5);
          }
          return this._txtPool;
        };
        _proto8.clear = function clear() {
          this._prefabpools.forEach(function (pool) {
            return pool.clear();
          });
          this._prefabpools.clear();
          this._gobjpools.forEach(function (pool) {
            return pool.clear();
          });
          this._gobjpools.clear();
          if (this._txtPool) {
            this._txtPool.clear();
            this._txtPool = null;
          }
        };
        return ObjPoolMgr;
      }(mk_instance_base);
      var objPoolMgr = exports('objPoolMgr', ObjPoolMgr.instance());
      var __awaiter = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      /**
       * Toast 
       */
      var ToastType;
      (function (ToastType) {
        ToastType["Info"] = "info";
        ToastType["Success"] = "success";
        ToastType["Warning"] = "warning";
        ToastType["Error"] = "error";
      })(ToastType || (ToastType = exports('ToastType', {})));
      /**  */
      var DEFAULT_COLORS = (_DEFAULT_COLORS = {}, _DEFAULT_COLORS[ToastType.Info] = new Color(255, 255, 255, 255), _DEFAULT_COLORS[ToastType.Success] = new Color(76, 217, 100, 255), _DEFAULT_COLORS[ToastType.Warning] = new Color(255, 204, 0, 255), _DEFAULT_COLORS[ToastType.Error] = new Color(255, 59, 48, 255), _DEFAULT_COLORS);
      var ToastManager = /*#__PURE__*/function (_instance_base2) {
        _inheritsLoose(ToastManager, _instance_base2);
        function ToastManager() {
          var _this12;
          _this12 = _instance_base2.apply(this, arguments) || this;
          _this12._config = {
            duration: 1.5,
            floatDistance: 100
          };
          return _this12;
        }
        /**
         * 
         */
        var _proto9 = ToastManager.prototype;
        _proto9.init = function init(config) {
          this._config = Object.assign(Object.assign({}, this._config), config);
        }
        /**
         *  Toast
         */;
        _proto9.show = function show(message_1) {
          return __awaiter(this, arguments, void 0, function (message, type) {
            var _this13 = this;
            if (type === void 0) {
              type = ToastType.Info;
            }
            return /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {
              var pool, item;
              return _regeneratorRuntime().wrap(function _callee9$(_context9) {
                while (1) switch (_context9.prev = _context9.next) {
                  case 0:
                    if (!(!_this13._config.packageName || !_this13._config.comName)) {
                      _context9.next = 3;
                      break;
                    }
                    _this13._showDefault(message, type);
                    return _context9.abrupt("return");
                  case 3:
                    _context9.prev = 3;
                    _context9.next = 6;
                    return objPoolMgr.getGobjPool(_this13._config.packageName, _this13._config.comName);
                  case 6:
                    pool = _context9.sent;
                    item = pool.get(); // 2. 
                    if (_this13._config.onShow) {
                      _this13._config.onShow(item, message, type);
                    } else {
                      //  item  GLabel title
                      item.title = message;
                      //  (GLabel  titleColor)
                      item.titleColor = DEFAULT_COLORS[type];
                    }
                    // 3. 
                    _this13._animate(item, function () {
                      return pool.put(item);
                    });
                    _context9.next = 16;
                    break;
                  case 12:
                    _context9.prev = 12;
                    _context9.t0 = _context9["catch"](3);
                    console.error("[Toast] Show failed: " + _context9.t0);
                    // 
                    _this13._showDefault(message, type);
                  case 16:
                  case "end":
                    return _context9.stop();
                }
              }, _callee9, null, [[3, 12]]);
            })();
          });
        }
        /**
         *  ()
         */;
        _proto9._showDefault = function _showDefault(message, type) {
          var pool = objPoolMgr.getTxtPool();
          var tf = pool.get();
          tf.text = message;
          tf.color = DEFAULT_COLORS[type];
          tf.fontSize = 24;
          // 
          tf.stroke = 1;
          tf.strokeColor = new Color(0, 0, 0, 255);
          this._animate(tf, function () {
            return pool.put(tf);
          });
        }
        /**
         * 
         */;
        _proto9._animate = function _animate(item, onComplete) {
          var root = GRoot.inst;
          root.addChild(item);
          // 
          item.x = root.width * 0.5;
          item.y = root.height * 0.5;
          // 
          item.sortingOrder = Number.MAX_SAFE_INTEGER;
          item.alpha = 1;
          var startPos = new Vec2(item.x, item.y);
          //  +  + 
          tween(item).to(0.2, {
            alpha: 1
          }) // 
          .delay(this._config.duration).parallel(tween(item).to(0.5, {
            y: startPos.y - this._config.floatDistance
          }, {
            easing: 'sineOut'
          }), tween(item).to(0.5, {
            alpha: 0
          })).call(function () {
            item.removeFromParent();
            onComplete();
          }).start();
        };
        return ToastManager;
      }(mk_instance_base);
      var Toast = exports('Toast', ToastManager.instance());
      // 
      {
        window['Toast'] = Toast;
      }
      function GBind(conmponent, obj, key, prop) {
        return new GUIBindNew(conmponent, obj, key, prop);
      }
      var AutoTriggerMap = new Map();
      var proxy = new Proxy(Object.create(null), {
        get: function get(target, key) {
          return key;
        }
      });
      var GUIBindNew = /*#__PURE__*/function () {
        function GUIBindNew(component, obj, key, prop) {
          this.keyObj = proxy;
          this.keyCom = proxy;
          this.component = component;
          this.obj = obj;
          this.key = key(this.keyObj);
          if (prop) this.prop = prop(this.keyCom);
        }
        var _proto10 = GUIBindNew.prototype;
        _proto10.setOptions = function setOptions(options) {
          this.options = options;
          return this;
        };
        _proto10.setProp = function setProp(prop) {
          this.prop = prop;
          return this;
        };
        _proto10.setFormatFunc = function setFormatFunc(func) {
          this.formatFunc = func;
          return this;
        };
        _proto10.setReformatFunc = function setReformatFunc(func) {
          this.reformatFunc = func;
          return this;
        };
        _proto10.bindTarget = function bindTarget(target) {
          this.target = target;
          bind(this);
          if (AutoTriggerMap.has(target)) {
            return;
          }
          // 
          var id = setTimeout(function () {
            mk_monitor$1.trigger(target);
            AutoTriggerMap["delete"](target);
          }, 0);
          AutoTriggerMap.set(target, id);
        };
        return GUIBindNew;
      }();
      function bind(bindInstance) {
        var component = bindInstance.component,
          obj = bindInstance.obj,
          key = bindInstance.key,
          target = bindInstance.target,
          prop = bindInstance.prop,
          options = bindInstance.options,
          formatFunc = bindInstance.formatFunc,
          reformatFunc = bindInstance.reformatFunc;
        var twoWayBindKey;
        if (!prop) {
          // prop
          if (component instanceof GProgressBar || component instanceof GSlider) {
            prop = Key().value;
            if (component instanceof GSlider) {
              twoWayBindKey = "_" + Key().value;
            }
          } else if (component instanceof GTextField || component instanceof GRichTextField || component instanceof GButton || component instanceof GTextInput || component instanceof GLabel) {
            prop = Key().text;
            if (component instanceof GTextInput) {
              twoWayBindKey = "_" + Key().text;
            }
          } else if (component instanceof Controller) {
            prop = Key().selectedIndex;
            twoWayBindKey = "_" + Key().selectedIndex;
          }
        }
        // formatFunc  reformatFunc 
        if (!formatFunc) {
          if (typeof component[prop] != typeof obj[key]) {
            if (typeof obj[key] == "number") {
              formatFunc = default2Num;
            } else if (typeof obj[key] == "string") {
              formatFunc = default2Str;
            } else if (typeof obj[key] == "boolean") {
              formatFunc = default2Bool;
            }
          } else {
            formatFunc = defaultNoThing;
          }
        }
        if (!reformatFunc) {
          if (typeof component[prop] != typeof obj[key]) {
            if (typeof component[prop] == "number") {
              reformatFunc = default2Num;
            } else if (typeof component[prop] == "string") {
              reformatFunc = default2Str;
            } else if (typeof component[prop] == "boolean") {
              reformatFunc = default2Bool;
            }
          } else {
            reformatFunc = defaultNoThing;
          }
        }
        // 
        if (component instanceof GProgressBar || component instanceof GSlider) {
          if (options) {
            // tween
            bindTweenValue(component, obj, key, target, options, formatFunc);
            return;
          }
        } else if (component instanceof GTextField || component instanceof GRichTextField) {
          if (options) {
            // tween
            bindTemplateLabel(component, obj, key, target, options, formatFunc);
            return;
          }
        }
        if (!prop) {
          throw new Error("Unsupported component type for binding.");
        }
        mk_monitor$1.on(obj, key, function (value) {
          component[prop] = formatFunc(value);
        }, target);
        if (twoWayBindKey) {
          mk_monitor$1.on(component, twoWayBindKey, function (value) {
            obj[key] = reformatFunc(value);
          }, target);
        }
      }
      function default2Num(value) {
        var num = Number(value);
        if (isNaN(num)) {
          return 0;
        }
        return num;
      }
      function default2Str(value) {
        if (value.toString) {
          return value.toString();
        }
        return "";
      }
      function default2Bool(value) {
        return !!value;
      }
      function defaultNoThing(value) {
        return value;
      }
      function bindTweenValue(component, obj, key, target, options, formatFunc) {
        var _options$duration = options.duration,
          duration = _options$duration === void 0 ? 3 : _options$duration,
          _options$ease = options.ease,
          ease = _options$ease === void 0 ? EaseType.QuartOut : _options$ease,
          _options$oneWay = options.oneWay,
          oneWay = _options$oneWay === void 0 ? false : _options$oneWay;
        var tweenValue;
        var perDuration = duration / 100;
        mk_monitor$1.on(obj, key, function (value) {
          if (component.value === value) return;
          var num = formatFunc(value);
          var dif = Math.abs(num - component.value);
          if (dif > component.max) {
            component.value = num;
            return;
          }
          var actualDuration = dif / component.max * 100 * perDuration;
          if (oneWay && num < component.value) {
            var toMaxDuration = (component.max - component.value) / component.max * perDuration;
            var toZeroDuration = num / component.max * perDuration;
            if (tweenValue && !tweenValue.completed) {
              tweenValue.kill(false);
            }
            tweenValue = GTween.to(component.value, component.max, toMaxDuration).setEase(ease).setTarget(component).onUpdate(function (tweener) {
              component.value = tweener.value.x;
            }).onComplete(function () {
              tweenValue = GTween.to(0, num, toZeroDuration).setEase(ease).setTarget(component).onUpdate(function (tweener) {
                component.value = tweener.value.x;
              });
            });
          } else {
            if (!tweenValue || tweenValue.completed) {
              if (dif * 100 < component.max) {
                component.value = num;
                return;
              }
              tweenValue = GTween.to(component.value, num, actualDuration).setEase(ease).setTarget(component).onUpdate(function (tweener) {
                component.value = tweener.value.x;
              });
            } else {
              tweenValue.setDuration(actualDuration);
              tweenValue.startValue.x = tweenValue.value.x;
              tweenValue.endValue.x = num;
            }
          }
        }, target);
      }
      /**  GTextFieldGRichTextField  GTextInput  */
      function bindTemplateLabel(component, obj, key, target, options, formatFunc) {
        if (!(component.setVar && component.flushVars)) {
          throw new Error("Component lacks necessary methods for template binding.");
        }
        var templateVars = component.templateVars || {};
        component.templateVars = templateVars;
        var templateKey = options.templateKey;
        var refresh = function refresh() {
          return component.flushVars();
        };
        mk_monitor$1.on(obj, key, function (value) {
          var str = formatFunc(value);
          if (templateVars[templateKey] !== str) {
            templateVars[templateKey] = str;
            TickerManager.clearNextFrame(refresh, component);
            TickerManager.callNextFrame(refresh, component);
          }
        }, target);
      }
      /**
       * vm
       *  vmtargetdata
       */
      function vm(target) {
        //@ts-ignore
        var onConstruct = target.prototype.onConstruct;
        //@ts-ignore
        var onDestroy = target.prototype.onDestroy;
        //@ts-ignore
        var onEnable = target.prototype.onEnable;
        //@ts-ignore
        var onDisable = target.prototype.onDisable;
        if (!target.prototype["afterConstruct"]) target.prototype["afterConstruct"] = [];
        //@ts-ignore
        target.prototype.onConstruct = function () {
          onConstruct.call(this);
          var afterConstruct = target.prototype["afterConstruct"];
          if (!afterConstruct) return;
          for (var index = 0; index < afterConstruct.length; index++) {
            var func = afterConstruct[index];
            func(this);
          }
        };
        //@ts-ignore
        target.prototype.onDestroy = function () {
          mk_monitor$1.clear(this);
          onDestroy.call(this);
        };
        //@ts-ignore
        target.prototype.onEnable = function () {
          var _this14 = this;
          onEnable.call(this);
          mk_monitor$1.enable(this);
          TickerManager.callNextFrame(function () {
            mk_monitor$1.trigger(_this14);
          }, this);
        };
        //@ts-ignore
        target.prototype.onDisable = function () {
          onDisable.call(this);
          mk_monitor$1.disable(this);
        };
      }
      /**
       *  
       */
      function addLogic(uiCls) {
        return function (target) {
          if (!uiCls.prototype["afterConstruct"]) uiCls.prototype["afterConstruct"] = [];
          uiCls.prototype["afterConstruct"].push(function (self) {
            self.node.addComponent(target);
          });
          // UI
          uiCls["uiOptions"] = target["uiOptions"];
        };
      }

      /**
       * 
       */
      var SortingLayer;
      (function (SortingLayer) {
        //--  DEFAULT 
        /**
         * UI **
         */
        SortingLayer[SortingLayer["DEFAULT"] = 0] = "DEFAULT";
        //--  DEFAULT 
        SortingLayer[SortingLayer["UI"] = 1] = "UI";
        SortingLayer[SortingLayer["OTHER"] = 2] = "OTHER";
        SortingLayer[SortingLayer["LOADER"] = 3] = "LOADER";
        SortingLayer[SortingLayer["TEXT"] = 4] = "TEXT";
      })(SortingLayer || (SortingLayer = exports('SortingLayer', {})));
      if (!('sortingPriority' in UITransform.prototype)) {
        Object.defineProperty(UITransform.prototype, 'sortingPriority', {
          get: function get() {
            return this._sortingPriority;
          },
          set: function set(value) {
            this._sortingPriority = value;
          },
          enumerable: true
        });
        Object.defineProperty(UITransform.prototype, 'sortingEnabled', {
          get: function get() {
            return this._sortingEnabled;
          },
          set: function set(value) {
            this._sortingEnabled = value;
          },
          enumerable: true
        });
      }

      //@ts-nocheck
      var _cocos_2d_renderer_stencil_manager__Stage;
      (function (_cocos_2d_renderer_stencil_manager__Stage) {
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["DISABLED"] = 0] = "DISABLED";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["CLEAR"] = 1] = "CLEAR";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["ENTER_LEVEL"] = 2] = "ENTER_LEVEL";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["ENABLED"] = 3] = "ENABLED";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["EXIT_LEVEL"] = 4] = "EXIT_LEVEL";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["CLEAR_INVERTED"] = 5] = "CLEAR_INVERTED";
        _cocos_2d_renderer_stencil_manager__Stage[_cocos_2d_renderer_stencil_manager__Stage["ENTER_LEVEL_INVERTED"] = 6] = "ENTER_LEVEL_INVERTED";
      })(_cocos_2d_renderer_stencil_manager__Stage || (_cocos_2d_renderer_stencil_manager__Stage = exports('_cocos_2d_renderer_stencil_manager__Stage', {})));
      function updateOpacity(renderData, opacity) {
        var vfmt = renderData.vertexFormat;
        var vb = renderData.chunk.vb;
        var attr;
        var format;
        var stride;
        // Color component offset
        var offset = 0;
        for (var i = 0; i < vfmt.length; ++i) {
          attr = vfmt[i];
          format = gfx.FormatInfos[attr.format];
          if (format.hasAlpha) {
            stride = renderData.floatStride;
            if (format.size / format.count === 1) {
              var alpha = ~~clamp(Math.round(opacity * 255), 0, 255);
              // Uint color RGBA8
              for (var color = offset; color < vb.length; color += stride) {
                vb[color] = (vb[color] & 0xffffff00 | alpha) >>> 0;
              }
            } else if (format.size / format.count === 4) {
              // RGBA32 color, alpha at position 3
              for (var _alpha = offset + 3; _alpha < vb.length; _alpha += stride) {
                vb[_alpha] = opacity;
              }
            }
          }
          offset += format.size >> 2;
        }
      }
      UI.prototype.update = function () {
        var _a;
        this.rendererCache = (_a = this.rendererCache) !== null && _a !== void 0 ? _a : [];
        this.rendererOrder = false;
        var screens = this._screens;
        var offset = 0;
        for (var i = 0; i < screens.length; ++i) {
          var screen = screens[i];
          var scene = screen._getRenderScene();
          if (!screen.enabledInHierarchy || !scene) {
            continue;
          }
          // Reset state and walk
          this._opacityDirty = 0;
          this._pOpacity = 1;
          this.walk(screen.node);
          this.autoMergeBatches(this._currComponent);
          this.resetRenderStates();
          var batchPriority = 0;
          if (this._batches.length > offset) {
            for (; offset < this._batches.length; ++offset) {
              var batch = this._batches.array[offset];
              if (batch.model) {
                var subModels = batch.model.subModels;
                for (var j = 0; j < subModels.length; j++) {
                  subModels[j].priority = batchPriority++;
                }
              } else {
                batch.descriptorSet = this._descriptorSetCache.getDescriptorSet(batch);
              }
              scene.addBatch(batch);
            }
          }
        }
      };
      UI.prototype.walk = function (node, level, sortingPriority, localRendererCache, autoBatchTxt) {
        if (level === void 0) {
          level = 0;
        }
        if (sortingPriority === void 0) {
          sortingPriority = 0;
        }
        if (localRendererCache === void 0) {
          localRendererCache = null;
        }
        if (autoBatchTxt === void 0) {
          autoBatchTxt = false;
        }
        var _a, _b;
        if (!node.activeInHierarchy) {
          return;
        }
        var children = node.children;
        var uiProps = node._uiProps;
        var render = uiProps.uiComp;
        var stencilEnterLevel = render && (render.stencilStage === _cocos_2d_renderer_stencil_manager__Stage.ENTER_LEVEL || render.stencilStage === _cocos_2d_renderer_stencil_manager__Stage.ENTER_LEVEL_INVERTED);
        var transform = uiProps.uiTransformComp;
        sortingPriority = transform && transform._sortingEnabled ? transform._sortingPriority : sortingPriority;
        var sortIndex = node.sortIndex ? node.sortIndex : (_b = (_a = node.parent) === null || _a === void 0 ? void 0 : _a._sortIndex) !== null && _b !== void 0 ? _b : 0;
        node._sortIndex = sortIndex;
        //  FairyGUI Mask 
        if (node.$gobj && node.$gobj instanceof GComponent) {
          var gcomp = node.$gobj;
          //  - _customMask  maskNode 
          if (gcomp._customMask && !gcomp._customMask.node.sortRoot) {
            gcomp._customMask.node.sortRoot = true;
            // console.warn(`Node "${gcomp._customMask.node.name}" (customMask) set sortRoot=true for proper clipping`);
          }
          //  - _rectMask  _container 
          if (gcomp._rectMask && !gcomp._container.sortRoot) {
            gcomp._container.sortRoot = true;
            // console.warn(`Node "${gcomp._container.name}" (rectMask) set sortRoot=true for proper clipping`);
          }
        }
        // autoBatchTxt    
        if (autoBatchTxt && node.$gobj && transform && transform._sortingEnabled == null) {
          // 
          if (node.$gobj instanceof GTextField) {
            transform.sortingEnabled = true;
            transform.sortingPriority = SortingLayer.TEXT * 1e3;
            sortingPriority = transform.sortingPriority;
          }
        }
        if (transform && node.autoCulling && isOutsideScreen(node, transform)) {
          // 
          return;
        }
        // Save opacity
        var parentOpacity = this._pOpacity;
        var opacity = parentOpacity;
        var selfOpacity = render && render.color ? render.color.a / 255 : 1;
        this._pOpacity = opacity *= selfOpacity * uiProps.localOpacity;
        uiProps._opacity = opacity;
        if (uiProps.colorDirty) {
          // Cascade color dirty state
          this._opacityDirty++;
        }
        if (render && render.enabledInHierarchy) {
          if (stencilEnterLevel) {
            render.fillBuffers(this);
            if (this._opacityDirty && render && !render.useVertexOpacity && render.renderData && render.renderData.vertexCount > 0) {
              // HARD COUPLING
              updateOpacity(render.renderData, opacity);
              var buffer = render.renderData.getMeshBuffer();
              if (buffer) {
                buffer.setDirty();
              }
            }
          } else {
            var cache = localRendererCache || this.rendererCache;
            cache.push(render);
            render.renderPriority = sortingPriority;
            if (sortingPriority != 0) {
              this.rendererOrder = true;
            }
            if (this._opacityDirty && render && !render.useVertexOpacity && render.renderData && render.renderData.vertexCount > 0) {
              render.renderOpacity = opacity;
            } else {
              render.renderOpacity = -1;
            }
          }
        }
        var isSortRoot = node.sortRoot;
        if (isSortRoot) {
          if (node.autoBatchTxt) autoBatchTxt = true;
          //  sort root;
          if (localRendererCache) {
            var _cache = localRendererCache;
            _cache.sort(function (a, b) {
              var valueA = a.renderPriority + a.node._sortIndex;
              var valueB = b.renderPriority + b.node._sortIndex;
              return valueA - valueB;
            });
            for (var _iterator = _createForOfIteratorHelperLoose(_cache), _step; !(_step = _iterator()).done;) {
              var renderUI = _step.value;
              renderUI.fillBuffers(this);
              if (renderUI.renderOpacity >= 0) {
                updateOpacity(renderUI.renderData, renderUI.renderOpacity);
                var _buffer = renderUI.renderData.getMeshBuffer();
                if (_buffer) {
                  _buffer.setDirty();
                }
              }
            }
            _cache.length = 0;
          }
          var newRendererCache = [];
          for (var i = 0; i < children.length; i++) {
            this.walk(children[i], level, sortingPriority, newRendererCache, autoBatchTxt);
          }
          newRendererCache.sort(function (a, b) {
            var valueA = a.renderPriority + a.node._sortIndex;
            var valueB = b.renderPriority + b.node._sortIndex;
            return valueA - valueB;
          });
          for (var _i = 0, _newRendererCache = newRendererCache; _i < _newRendererCache.length; _i++) {
            var _render = _newRendererCache[_i];
            _render.fillBuffers(this);
            if (_render.renderOpacity >= 0) {
              updateOpacity(_render.renderData, _render.renderOpacity);
              var _buffer2 = _render.renderData.getMeshBuffer();
              if (_buffer2) {
                _buffer2.setDirty();
              }
            }
          }
        } else {
          //  sortRoot
          var hasSortRootChild = false;
          for (var _i2 = 0; _i2 < children.length; _i2++) {
            if (children[_i2].sortRoot) {
              hasSortRootChild = true;
              break;
            }
          }
          if (hasSortRootChild) {
            // sortRootsortRootsortRoot
            for (var _i3 = 0; _i3 < children.length; _i3++) {
              var child = children[_i3];
              if (child.sortRoot) {
                // 1. sortRoot
                if (localRendererCache) {
                  var _cache2 = localRendererCache;
                  _cache2.sort(function (a, b) {
                    var valueA = a.renderPriority + a.node._sortIndex;
                    var valueB = b.renderPriority + b.node._sortIndex;
                    return valueA - valueB;
                  });
                  for (var _iterator2 = _createForOfIteratorHelperLoose(_cache2), _step2; !(_step2 = _iterator2()).done;) {
                    var _renderUI = _step2.value;
                    _renderUI.fillBuffers(this);
                    if (_renderUI.renderOpacity >= 0) {
                      updateOpacity(_renderUI.renderData, _renderUI.renderOpacity);
                      var _buffer3 = _renderUI.renderData.getMeshBuffer();
                      if (_buffer3) {
                        _buffer3.setDirty();
                      }
                    }
                  }
                  _cache2.length = 0;
                } else {
                  // 
                  var _cache3 = this.rendererCache;
                  for (var _iterator3 = _createForOfIteratorHelperLoose(_cache3), _step3; !(_step3 = _iterator3()).done;) {
                    var _render2 = _step3.value;
                    _render2.fillBuffers(this);
                    if (_render2.renderOpacity >= 0) {
                      updateOpacity(_render2.renderData, _render2.renderOpacity);
                      var _buffer4 = _render2.renderData.getMeshBuffer();
                      if (_buffer4) {
                        _buffer4.setDirty();
                      }
                    }
                  }
                  _cache3.length = 0;
                }
                // 2.  sortRoot 
                this.walk(child, level, sortingPriority, null, autoBatchTxt);
              } else {
                // 3. 
                this.walk(child, level, sortingPriority, localRendererCache, autoBatchTxt);
              }
            }
            // 4. sortRoot
            if (localRendererCache) {
              var _cache4 = localRendererCache;
              _cache4.sort(function (a, b) {
                var valueA = a.renderPriority + a.node._sortIndex;
                var valueB = b.renderPriority + b.node._sortIndex;
                return valueA - valueB;
              });
              for (var _iterator4 = _createForOfIteratorHelperLoose(_cache4), _step4; !(_step4 = _iterator4()).done;) {
                var _renderUI2 = _step4.value;
                _renderUI2.fillBuffers(this);
                if (_renderUI2.renderOpacity >= 0) {
                  updateOpacity(_renderUI2.renderData, _renderUI2.renderOpacity);
                  var _buffer5 = _renderUI2.renderData.getMeshBuffer();
                  if (_buffer5) {
                    _buffer5.setDirty();
                  }
                }
              }
              _cache4.length = 0;
            } else {
              // 
              var _cache5 = this.rendererCache;
              for (var _iterator5 = _createForOfIteratorHelperLoose(_cache5), _step5; !(_step5 = _iterator5()).done;) {
                var _render3 = _step5.value;
                _render3.fillBuffers(this);
                if (_render3.renderOpacity >= 0) {
                  updateOpacity(_render3.renderData, _render3.renderOpacity);
                  var _buffer6 = _render3.renderData.getMeshBuffer();
                  if (_buffer6) {
                    _buffer6.setDirty();
                  }
                }
              }
              _cache5.length = 0;
            }
          } else {
            //  sortRoot 
            for (var _i4 = 0; _i4 < children.length; _i4++) {
              this.walk(children[_i4], level, sortingPriority, localRendererCache, autoBatchTxt);
            }
            // Ensure normal nodes are rendered in tree order if they don't have sortRoot
            if (!localRendererCache) {
              var _cache6 = this.rendererCache;
              for (var _iterator6 = _createForOfIteratorHelperLoose(_cache6), _step6; !(_step6 = _iterator6()).done;) {
                var _render4 = _step6.value;
                _render4.fillBuffers(this);
                if (_render4.renderOpacity >= 0) {
                  updateOpacity(_render4.renderData, _render4.renderOpacity);
                  var _buffer7 = _render4.renderData.getMeshBuffer();
                  if (_buffer7) {
                    _buffer7.setDirty();
                  }
                }
              }
              _cache6.length = 0;
            }
          }
        }
        if (uiProps.colorDirty) {
          // Reduce cascaded color dirty state
          this._opacityDirty--;
          // Reset color dirty
          uiProps.colorDirty = false;
        }
        // Restore opacity
        this._pOpacity = parentOpacity;
        // Post render assembler update logic
        // ATTENTION: Will also reset colorDirty inside postUpdateAssembler
        if (render && render.enabledInHierarchy) {
          render.postUpdateAssembler(this);
          if (stencilEnterLevel && StencilManager.sharedManager.getMaskStackSize() > 0) {
            this.autoMergeBatches(this._currComponent);
            this.resetRenderStates();
            StencilManager.sharedManager.exitMask();
          }
        }
        level += 1;
      };
      var tempVect3 = new math.Vec3();
      function isOutsideScreen(node, uiTransform) {
        // 
        var visibleSize = view._visibleRect;
        var camera = UI.Camera;
        // 
        if (!camera || !camera.isValid) return false;
        //  UITransform 
        if (!uiTransform || uiTransform.width <= 0 || uiTransform.height <= 0) return false;
        var worldPos = node.worldPosition;
        camera.worldToScreen(worldPos, tempVect3);
        // 
        var margin = 50;
        var flag = tempVect3.x + uiTransform.width / 2 < -margin || tempVect3.x - uiTransform.width / 2 > visibleSize.width + margin || tempVect3.y + uiTransform.height / 2 < -margin || tempVect3.y - uiTransform.height / 2 > visibleSize.height + margin;
        return flag;
      }
    }
  };
});

System.register("chunks:///_virtual/encode.js", ['./cjs-loader.mjs', './Encoder.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.encode = void 0;
        var Encoder_1 = require("./Encoder");
        var defaultEncodeOptions = {};
        /**
         * It encodes `value` in the MessagePack format and
         * returns a byte buffer.
         *
         * The returned buffer is a slice of a larger `ArrayBuffer`, so you have to use its `#byteOffset` and `#byteLength` in order to convert it to another typed arrays including NodeJS `Buffer`.
         */
        function encode(value, options) {
          if (options === void 0) {
            options = defaultEncodeOptions;
          }
          var encoder = new Encoder_1.Encoder(options.extensionCodec, options.context, options.maxDepth, options.initialBufferSize, options.sortKeys, options.forceFloat32, options.ignoreUndefined, options.forceIntegerToFloat);
          return encoder.encodeSharedRef(value);
        }
        exports.encode = encode;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.encode;
      }, function () {
        return {
          './Encoder': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/Encoder.js", ['./cjs-loader.mjs', './utf8.js', './ExtensionCodec.js', './int.js', './typedArrays.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3, __cjsMetaURL$4;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$4 = module.__cjsMetaURL;
    }],
    execute: function () {
      function _createForOfIteratorHelperLoose(o, allowArrayLike) {
        var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
        if (it) return (it = it.call(o)).next.bind(it);
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          return function () {
            if (i >= o.length) return {
              done: true
            };
            return {
              done: false,
              value: o[i++]
            };
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }
      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;
        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
        return arr2;
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.Encoder = exports.DEFAULT_INITIAL_BUFFER_SIZE = exports.DEFAULT_MAX_DEPTH = void 0;
        var utf8_1 = require("./utils/utf8");
        var ExtensionCodec_1 = require("./ExtensionCodec");
        var int_1 = require("./utils/int");
        var typedArrays_1 = require("./utils/typedArrays");
        exports.DEFAULT_MAX_DEPTH = 100;
        exports.DEFAULT_INITIAL_BUFFER_SIZE = 2048;
        var Encoder = /*#__PURE__*/function () {
          function Encoder(extensionCodec, context, maxDepth, initialBufferSize, sortKeys, forceFloat32, ignoreUndefined, forceIntegerToFloat) {
            if (extensionCodec === void 0) {
              extensionCodec = ExtensionCodec_1.ExtensionCodec.defaultCodec;
            }
            if (context === void 0) {
              context = undefined;
            }
            if (maxDepth === void 0) {
              maxDepth = exports.DEFAULT_MAX_DEPTH;
            }
            if (initialBufferSize === void 0) {
              initialBufferSize = exports.DEFAULT_INITIAL_BUFFER_SIZE;
            }
            if (sortKeys === void 0) {
              sortKeys = false;
            }
            if (forceFloat32 === void 0) {
              forceFloat32 = false;
            }
            if (ignoreUndefined === void 0) {
              ignoreUndefined = false;
            }
            if (forceIntegerToFloat === void 0) {
              forceIntegerToFloat = false;
            }
            this.extensionCodec = extensionCodec;
            this.context = context;
            this.maxDepth = maxDepth;
            this.initialBufferSize = initialBufferSize;
            this.sortKeys = sortKeys;
            this.forceFloat32 = forceFloat32;
            this.ignoreUndefined = ignoreUndefined;
            this.forceIntegerToFloat = forceIntegerToFloat;
            this.pos = 0;
            this.view = new DataView(new ArrayBuffer(this.initialBufferSize));
            this.bytes = new Uint8Array(this.view.buffer);
          }
          var _proto = Encoder.prototype;
          _proto.reinitializeState = function reinitializeState() {
            this.pos = 0;
          }
          /**
           * This is almost equivalent to {@link Encoder#encode}, but it returns an reference of the encoder's internal buffer and thus much faster than {@link Encoder#encode}.
           *
           * @returns Encodes the object and returns a shared reference the encoder's internal buffer.
           */;
          _proto.encodeSharedRef = function encodeSharedRef(object) {
            this.reinitializeState();
            this.doEncode(object, 1);
            return this.bytes.subarray(0, this.pos);
          }
          /**
           * @returns Encodes the object and returns a copy of the encoder's internal buffer.
           */;
          _proto.encode = function encode(object) {
            this.reinitializeState();
            this.doEncode(object, 1);
            return this.bytes.slice(0, this.pos);
          };
          _proto.doEncode = function doEncode(object, depth) {
            if (depth > this.maxDepth) {
              throw new Error("Too deep objects in depth " + depth);
            }
            if (object == null) {
              this.encodeNil();
            } else if (typeof object === "boolean") {
              this.encodeBoolean(object);
            } else if (typeof object === "number") {
              this.encodeNumber(object);
            } else if (typeof object === "string") {
              this.encodeString(object);
            } else {
              this.encodeObject(object, depth);
            }
          };
          _proto.ensureBufferSizeToWrite = function ensureBufferSizeToWrite(sizeToWrite) {
            var requiredSize = this.pos + sizeToWrite;
            if (this.view.byteLength < requiredSize) {
              this.resizeBuffer(requiredSize * 2);
            }
          };
          _proto.resizeBuffer = function resizeBuffer(newSize) {
            var newBuffer = new ArrayBuffer(newSize);
            var newBytes = new Uint8Array(newBuffer);
            var newView = new DataView(newBuffer);
            newBytes.set(this.bytes);
            this.view = newView;
            this.bytes = newBytes;
          };
          _proto.encodeNil = function encodeNil() {
            this.writeU8(0xc0);
          };
          _proto.encodeBoolean = function encodeBoolean(object) {
            if (object === false) {
              this.writeU8(0xc2);
            } else {
              this.writeU8(0xc3);
            }
          };
          _proto.encodeNumber = function encodeNumber(object) {
            if (Number.isSafeInteger(object) && !this.forceIntegerToFloat) {
              if (object >= 0) {
                if (object < 0x80) {
                  // positive fixint
                  this.writeU8(object);
                } else if (object < 0x100) {
                  // uint 8
                  this.writeU8(0xcc);
                  this.writeU8(object);
                } else if (object < 0x10000) {
                  // uint 16
                  this.writeU8(0xcd);
                  this.writeU16(object);
                } else if (object < 0x100000000) {
                  // uint 32
                  this.writeU8(0xce);
                  this.writeU32(object);
                } else {
                  // uint 64
                  this.writeU8(0xcf);
                  this.writeU64(object);
                }
              } else {
                if (object >= -0x20) {
                  // negative fixint
                  this.writeU8(0xe0 | object + 0x20);
                } else if (object >= -0x80) {
                  // int 8
                  this.writeU8(0xd0);
                  this.writeI8(object);
                } else if (object >= -0x8000) {
                  // int 16
                  this.writeU8(0xd1);
                  this.writeI16(object);
                } else if (object >= -0x80000000) {
                  // int 32
                  this.writeU8(0xd2);
                  this.writeI32(object);
                } else {
                  // int 64
                  this.writeU8(0xd3);
                  this.writeI64(object);
                }
              }
            } else {
              // non-integer numbers
              if (this.forceFloat32) {
                // float 32
                this.writeU8(0xca);
                this.writeF32(object);
              } else {
                // float 64
                this.writeU8(0xcb);
                this.writeF64(object);
              }
            }
          };
          _proto.writeStringHeader = function writeStringHeader(byteLength) {
            if (byteLength < 32) {
              // fixstr
              this.writeU8(0xa0 + byteLength);
            } else if (byteLength < 0x100) {
              // str 8
              this.writeU8(0xd9);
              this.writeU8(byteLength);
            } else if (byteLength < 0x10000) {
              // str 16
              this.writeU8(0xda);
              this.writeU16(byteLength);
            } else if (byteLength < 0x100000000) {
              // str 32
              this.writeU8(0xdb);
              this.writeU32(byteLength);
            } else {
              throw new Error("Too long string: " + byteLength + " bytes in UTF-8");
            }
          };
          _proto.encodeString = function encodeString(object) {
            var maxHeaderSize = 1 + 4;
            var strLength = object.length;
            if (strLength > utf8_1.TEXT_ENCODER_THRESHOLD) {
              var byteLength = (0, utf8_1.utf8Count)(object);
              this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);
              this.writeStringHeader(byteLength);
              (0, utf8_1.utf8EncodeTE)(object, this.bytes, this.pos);
              this.pos += byteLength;
            } else {
              var _byteLength = (0, utf8_1.utf8Count)(object);
              this.ensureBufferSizeToWrite(maxHeaderSize + _byteLength);
              this.writeStringHeader(_byteLength);
              (0, utf8_1.utf8EncodeJs)(object, this.bytes, this.pos);
              this.pos += _byteLength;
            }
          };
          _proto.encodeObject = function encodeObject(object, depth) {
            // try to encode objects with custom codec first of non-primitives
            var ext = this.extensionCodec.tryToEncode(object, this.context);
            if (ext != null) {
              this.encodeExtension(ext);
            } else if (Array.isArray(object)) {
              this.encodeArray(object, depth);
            } else if (ArrayBuffer.isView(object)) {
              this.encodeBinary(object);
            } else if (typeof object === "object") {
              this.encodeMap(object, depth);
            } else {
              // symbol, function and other special object come here unless extensionCodec handles them.
              throw new Error("Unrecognized object: " + Object.prototype.toString.apply(object));
            }
          };
          _proto.encodeBinary = function encodeBinary(object) {
            var size = object.byteLength;
            if (size < 0x100) {
              // bin 8
              this.writeU8(0xc4);
              this.writeU8(size);
            } else if (size < 0x10000) {
              // bin 16
              this.writeU8(0xc5);
              this.writeU16(size);
            } else if (size < 0x100000000) {
              // bin 32
              this.writeU8(0xc6);
              this.writeU32(size);
            } else {
              throw new Error("Too large binary: " + size);
            }
            var bytes = (0, typedArrays_1.ensureUint8Array)(object);
            this.writeU8a(bytes);
          };
          _proto.encodeArray = function encodeArray(object, depth) {
            var size = object.length;
            if (size < 16) {
              // fixarray
              this.writeU8(0x90 + size);
            } else if (size < 0x10000) {
              // array 16
              this.writeU8(0xdc);
              this.writeU16(size);
            } else if (size < 0x100000000) {
              // array 32
              this.writeU8(0xdd);
              this.writeU32(size);
            } else {
              throw new Error("Too large array: " + size);
            }
            for (var _iterator = _createForOfIteratorHelperLoose(object), _step; !(_step = _iterator()).done;) {
              var item = _step.value;
              this.doEncode(item, depth + 1);
            }
          };
          _proto.countWithoutUndefined = function countWithoutUndefined(object, keys) {
            var count = 0;
            for (var _iterator2 = _createForOfIteratorHelperLoose(keys), _step2; !(_step2 = _iterator2()).done;) {
              var key = _step2.value;
              if (object[key] !== undefined) {
                count++;
              }
            }
            return count;
          };
          _proto.encodeMap = function encodeMap(object, depth) {
            var keys = Object.keys(object);
            if (this.sortKeys) {
              keys.sort();
            }
            var size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;
            if (size < 16) {
              // fixmap
              this.writeU8(0x80 + size);
            } else if (size < 0x10000) {
              // map 16
              this.writeU8(0xde);
              this.writeU16(size);
            } else if (size < 0x100000000) {
              // map 32
              this.writeU8(0xdf);
              this.writeU32(size);
            } else {
              throw new Error("Too large map object: " + size);
            }
            for (var _i = 0, _keys = keys; _i < _keys.length; _i++) {
              var key = _keys[_i];
              var value = object[key];
              if (!(this.ignoreUndefined && value === undefined)) {
                this.encodeString(key);
                this.doEncode(value, depth + 1);
              }
            }
          };
          _proto.encodeExtension = function encodeExtension(ext) {
            var size = ext.data.length;
            if (size === 1) {
              // fixext 1
              this.writeU8(0xd4);
            } else if (size === 2) {
              // fixext 2
              this.writeU8(0xd5);
            } else if (size === 4) {
              // fixext 4
              this.writeU8(0xd6);
            } else if (size === 8) {
              // fixext 8
              this.writeU8(0xd7);
            } else if (size === 16) {
              // fixext 16
              this.writeU8(0xd8);
            } else if (size < 0x100) {
              // ext 8
              this.writeU8(0xc7);
              this.writeU8(size);
            } else if (size < 0x10000) {
              // ext 16
              this.writeU8(0xc8);
              this.writeU16(size);
            } else if (size < 0x100000000) {
              // ext 32
              this.writeU8(0xc9);
              this.writeU32(size);
            } else {
              throw new Error("Too large extension object: " + size);
            }
            this.writeI8(ext.type);
            this.writeU8a(ext.data);
          };
          _proto.writeU8 = function writeU8(value) {
            this.ensureBufferSizeToWrite(1);
            this.view.setUint8(this.pos, value);
            this.pos++;
          };
          _proto.writeU8a = function writeU8a(values) {
            var size = values.length;
            this.ensureBufferSizeToWrite(size);
            this.bytes.set(values, this.pos);
            this.pos += size;
          };
          _proto.writeI8 = function writeI8(value) {
            this.ensureBufferSizeToWrite(1);
            this.view.setInt8(this.pos, value);
            this.pos++;
          };
          _proto.writeU16 = function writeU16(value) {
            this.ensureBufferSizeToWrite(2);
            this.view.setUint16(this.pos, value);
            this.pos += 2;
          };
          _proto.writeI16 = function writeI16(value) {
            this.ensureBufferSizeToWrite(2);
            this.view.setInt16(this.pos, value);
            this.pos += 2;
          };
          _proto.writeU32 = function writeU32(value) {
            this.ensureBufferSizeToWrite(4);
            this.view.setUint32(this.pos, value);
            this.pos += 4;
          };
          _proto.writeI32 = function writeI32(value) {
            this.ensureBufferSizeToWrite(4);
            this.view.setInt32(this.pos, value);
            this.pos += 4;
          };
          _proto.writeF32 = function writeF32(value) {
            this.ensureBufferSizeToWrite(4);
            this.view.setFloat32(this.pos, value);
            this.pos += 4;
          };
          _proto.writeF64 = function writeF64(value) {
            this.ensureBufferSizeToWrite(8);
            this.view.setFloat64(this.pos, value);
            this.pos += 8;
          };
          _proto.writeU64 = function writeU64(value) {
            this.ensureBufferSizeToWrite(8);
            (0, int_1.setUint64)(this.view, this.pos, value);
            this.pos += 8;
          };
          _proto.writeI64 = function writeI64(value) {
            this.ensureBufferSizeToWrite(8);
            (0, int_1.setInt64)(this.view, this.pos, value);
            this.pos += 8;
          };
          return Encoder;
        }();
        exports.Encoder = Encoder;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.Encoder;
        module.exports.DEFAULT_INITIAL_BUFFER_SIZE;
        module.exports.DEFAULT_MAX_DEPTH;
      }, function () {
        return {
          './utils/utf8': __cjsMetaURL$1,
          './ExtensionCodec': __cjsMetaURL$2,
          './utils/int': __cjsMetaURL$3,
          './utils/typedArrays': __cjsMetaURL$4
        };
      });
    }
  };
});

System.register("chunks:///_virtual/env", [], function (exports) {
  return {
    execute: function () {
      var EDITOR = exports('EDITOR', false);
    }
  };
});

System.register("chunks:///_virtual/ExtData.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.ExtData = void 0;
        /**
         * ExtData is used to handle Extension Types that are not registered to ExtensionCodec.
         */
        var ExtData = function ExtData(type, data) {
          this.type = type;
          this.data = data;
        };
        exports.ExtData = ExtData;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.ExtData;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/ExtensionCodec.js", ['./cjs-loader.mjs', './ExtData.js', './timestamp.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // ExtensionCodec to handle MessagePack extensions
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.ExtensionCodec = void 0;
        var ExtData_1 = require("./ExtData");
        var timestamp_1 = require("./timestamp");
        var ExtensionCodec = /*#__PURE__*/function () {
          function ExtensionCodec() {
            // built-in extensions
            this.builtInEncoders = [];
            this.builtInDecoders = [];
            // custom extensions
            this.encoders = [];
            this.decoders = [];
            this.register(timestamp_1.timestampExtension);
          }
          var _proto = ExtensionCodec.prototype;
          _proto.register = function register(_ref) {
            var type = _ref.type,
              encode = _ref.encode,
              decode = _ref.decode;
            if (type >= 0) {
              // custom extensions
              this.encoders[type] = encode;
              this.decoders[type] = decode;
            } else {
              // built-in extensions
              var index = 1 + type;
              this.builtInEncoders[index] = encode;
              this.builtInDecoders[index] = decode;
            }
          };
          _proto.tryToEncode = function tryToEncode(object, context) {
            // built-in extensions
            for (var i = 0; i < this.builtInEncoders.length; i++) {
              var encodeExt = this.builtInEncoders[i];
              if (encodeExt != null) {
                var data = encodeExt(object, context);
                if (data != null) {
                  var type = -1 - i;
                  return new ExtData_1.ExtData(type, data);
                }
              }
            }
            // custom extensions
            for (var _i = 0; _i < this.encoders.length; _i++) {
              var _encodeExt = this.encoders[_i];
              if (_encodeExt != null) {
                var _data = _encodeExt(object, context);
                if (_data != null) {
                  var _type = _i;
                  return new ExtData_1.ExtData(_type, _data);
                }
              }
            }
            if (object instanceof ExtData_1.ExtData) {
              // to keep ExtData as is
              return object;
            }
            return null;
          };
          _proto.decode = function decode(data, type, context) {
            var decodeExt = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];
            if (decodeExt) {
              return decodeExt(data, type, context);
            } else {
              // decode() does not fail, returns ExtData instead.
              return new ExtData_1.ExtData(type, data);
            }
          };
          return ExtensionCodec;
        }();
        exports.ExtensionCodec = ExtensionCodec;
        ExtensionCodec.defaultCodec = new ExtensionCodec();

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.ExtensionCodec;
      }, function () {
        return {
          './ExtData': __cjsMetaURL$1,
          './timestamp': __cjsMetaURL$2
        };
      });
    }
  };
});

System.register("chunks:///_virtual/fairygui.mjs", ['./rollupPluginModLoBabelHelpers.js', 'cc', './drongo-cc.mjs'], function (exports) {
  var _inheritsLoose, _createClass, _regeneratorRuntime, _assertThisInitialized, gfx, Vec2, Color, Layers, Font, resources, Rect, Vec3, misc, Sprite, Size, assetManager, Texture2D, SpriteFrame, BitmapFont, sp, dragonBones, ImageAsset, AudioClip, Label, RichText, Node, UITransform, Mask, math, director, game, isValid, sys, screen, View, AudioSourceComponent, EditBox, Overflow, VerticalTextAlignment, instantiate, Prefab, Asset, EventMouse, Event$1, UIOpacity, Component, Graphics, view, path, BufferAsset, AssetManager, SpriteAtlas, EventTarget, UIRenderer, macro, mk_asset$1, mk_release;
  return {
    setters: [function (module) {
      _inheritsLoose = module.inheritsLoose;
      _createClass = module.createClass;
      _regeneratorRuntime = module.regeneratorRuntime;
      _assertThisInitialized = module.assertThisInitialized;
    }, function (module) {
      gfx = module.gfx;
      Vec2 = module.Vec2;
      Color = module.Color;
      Layers = module.Layers;
      Font = module.Font;
      resources = module.resources;
      Rect = module.Rect;
      Vec3 = module.Vec3;
      misc = module.misc;
      Sprite = module.Sprite;
      Size = module.Size;
      assetManager = module.assetManager;
      Texture2D = module.Texture2D;
      SpriteFrame = module.SpriteFrame;
      BitmapFont = module.BitmapFont;
      sp = module.sp;
      dragonBones = module.dragonBones;
      ImageAsset = module.ImageAsset;
      AudioClip = module.AudioClip;
      Label = module.Label;
      RichText = module.RichText;
      Node = module.Node;
      UITransform = module.UITransform;
      Mask = module.Mask;
      math = module.math;
      director = module.director;
      game = module.game;
      isValid = module.isValid;
      sys = module.sys;
      screen = module.screen;
      View = module.View;
      AudioSourceComponent = module.AudioSourceComponent;
      EditBox = module.EditBox;
      Overflow = module.Overflow;
      VerticalTextAlignment = module.VerticalTextAlignment;
      instantiate = module.instantiate;
      Prefab = module.Prefab;
      Asset = module.Asset;
      EventMouse = module.EventMouse;
      Event$1 = module.Event;
      UIOpacity = module.UIOpacity;
      Component = module.Component;
      Graphics = module.Graphics;
      view = module.view;
      path = module.path;
      BufferAsset = module.BufferAsset;
      AssetManager = module.AssetManager;
      SpriteAtlas = module.SpriteAtlas;
      EventTarget = module.EventTarget;
      UIRenderer = module.UIRenderer;
      macro = module.macro;
    }, function (module) {
      mk_asset$1 = module.asset;
      mk_release = module.release;
    }],
    execute: function () {
      exports({
        AlignType: void 0,
        AutoSizeType: void 0,
        BlendMode: void 0,
        ButtonMode: void 0,
        ChildrenRenderOrder: void 0,
        EaseType: void 0,
        FillMethod: void 0,
        FillOrigin: void 0,
        FlipType: void 0,
        GroupLayoutType: void 0,
        ListLayoutType: void 0,
        ListSelectionMode: void 0,
        LoaderFillType: void 0,
        ObjectPropID: void 0,
        ObjectType: void 0,
        OverflowType: void 0,
        PackageItemType: void 0,
        PopupDirection: void 0,
        ProgressTitleType: void 0,
        RelationType: void 0,
        ScrollBarDisplayType: void 0,
        ScrollType: void 0,
        VertAlignType: void 0,
        registerFont: registerFont
      });
      var _ItemTypeToAssetType;
      var ButtonMode;
      (function (ButtonMode) {
        ButtonMode[ButtonMode["Common"] = 0] = "Common";
        ButtonMode[ButtonMode["Check"] = 1] = "Check";
        ButtonMode[ButtonMode["Radio"] = 2] = "Radio";
      })(ButtonMode || (ButtonMode = exports('ButtonMode', {})));
      var AutoSizeType;
      (function (AutoSizeType) {
        AutoSizeType[AutoSizeType["None"] = 0] = "None";
        AutoSizeType[AutoSizeType["Both"] = 1] = "Both";
        AutoSizeType[AutoSizeType["Height"] = 2] = "Height";
        AutoSizeType[AutoSizeType["Shrink"] = 3] = "Shrink";
      })(AutoSizeType || (AutoSizeType = exports('AutoSizeType', {})));
      var AlignType;
      (function (AlignType) {
        AlignType[AlignType["Left"] = 0] = "Left";
        AlignType[AlignType["Center"] = 1] = "Center";
        AlignType[AlignType["Right"] = 2] = "Right";
      })(AlignType || (AlignType = exports('AlignType', {})));
      var VertAlignType;
      (function (VertAlignType) {
        VertAlignType[VertAlignType["Top"] = 0] = "Top";
        VertAlignType[VertAlignType["Middle"] = 1] = "Middle";
        VertAlignType[VertAlignType["Bottom"] = 2] = "Bottom";
      })(VertAlignType || (VertAlignType = exports('VertAlignType', {})));
      var LoaderFillType;
      (function (LoaderFillType) {
        LoaderFillType[LoaderFillType["None"] = 0] = "None";
        LoaderFillType[LoaderFillType["Scale"] = 1] = "Scale";
        LoaderFillType[LoaderFillType["ScaleMatchHeight"] = 2] = "ScaleMatchHeight";
        LoaderFillType[LoaderFillType["ScaleMatchWidth"] = 3] = "ScaleMatchWidth";
        LoaderFillType[LoaderFillType["ScaleFree"] = 4] = "ScaleFree";
        LoaderFillType[LoaderFillType["ScaleNoBorder"] = 5] = "ScaleNoBorder";
      })(LoaderFillType || (LoaderFillType = exports('LoaderFillType', {})));
      var ListLayoutType;
      (function (ListLayoutType) {
        ListLayoutType[ListLayoutType["SingleColumn"] = 0] = "SingleColumn";
        ListLayoutType[ListLayoutType["SingleRow"] = 1] = "SingleRow";
        ListLayoutType[ListLayoutType["FlowHorizontal"] = 2] = "FlowHorizontal";
        ListLayoutType[ListLayoutType["FlowVertical"] = 3] = "FlowVertical";
        ListLayoutType[ListLayoutType["Pagination"] = 4] = "Pagination";
      })(ListLayoutType || (ListLayoutType = exports('ListLayoutType', {})));
      var ListSelectionMode;
      (function (ListSelectionMode) {
        ListSelectionMode[ListSelectionMode["Single"] = 0] = "Single";
        ListSelectionMode[ListSelectionMode["Multiple"] = 1] = "Multiple";
        ListSelectionMode[ListSelectionMode["Multiple_SingleClick"] = 2] = "Multiple_SingleClick";
        ListSelectionMode[ListSelectionMode["None"] = 3] = "None";
      })(ListSelectionMode || (ListSelectionMode = exports('ListSelectionMode', {})));
      var OverflowType;
      (function (OverflowType) {
        OverflowType[OverflowType["Visible"] = 0] = "Visible";
        OverflowType[OverflowType["Hidden"] = 1] = "Hidden";
        OverflowType[OverflowType["Scroll"] = 2] = "Scroll";
      })(OverflowType || (OverflowType = exports('OverflowType', {})));
      var PackageItemType;
      (function (PackageItemType) {
        PackageItemType[PackageItemType["Image"] = 0] = "Image";
        PackageItemType[PackageItemType["MovieClip"] = 1] = "MovieClip";
        PackageItemType[PackageItemType["Sound"] = 2] = "Sound";
        PackageItemType[PackageItemType["Component"] = 3] = "Component";
        PackageItemType[PackageItemType["Atlas"] = 4] = "Atlas";
        PackageItemType[PackageItemType["Font"] = 5] = "Font";
        PackageItemType[PackageItemType["Swf"] = 6] = "Swf";
        PackageItemType[PackageItemType["Misc"] = 7] = "Misc";
        PackageItemType[PackageItemType["Unknown"] = 8] = "Unknown";
        PackageItemType[PackageItemType["Spine"] = 9] = "Spine";
        PackageItemType[PackageItemType["DragonBones"] = 10] = "DragonBones";
      })(PackageItemType || (PackageItemType = exports('PackageItemType', {})));
      var ObjectType;
      (function (ObjectType) {
        ObjectType[ObjectType["Image"] = 0] = "Image";
        ObjectType[ObjectType["MovieClip"] = 1] = "MovieClip";
        ObjectType[ObjectType["Swf"] = 2] = "Swf";
        ObjectType[ObjectType["Graph"] = 3] = "Graph";
        ObjectType[ObjectType["Loader"] = 4] = "Loader";
        ObjectType[ObjectType["Group"] = 5] = "Group";
        ObjectType[ObjectType["Text"] = 6] = "Text";
        ObjectType[ObjectType["RichText"] = 7] = "RichText";
        ObjectType[ObjectType["InputText"] = 8] = "InputText";
        ObjectType[ObjectType["Component"] = 9] = "Component";
        ObjectType[ObjectType["List"] = 10] = "List";
        ObjectType[ObjectType["Label"] = 11] = "Label";
        ObjectType[ObjectType["Button"] = 12] = "Button";
        ObjectType[ObjectType["ComboBox"] = 13] = "ComboBox";
        ObjectType[ObjectType["ProgressBar"] = 14] = "ProgressBar";
        ObjectType[ObjectType["Slider"] = 15] = "Slider";
        ObjectType[ObjectType["ScrollBar"] = 16] = "ScrollBar";
        ObjectType[ObjectType["Tree"] = 17] = "Tree";
        ObjectType[ObjectType["Loader3D"] = 18] = "Loader3D";
      })(ObjectType || (ObjectType = exports('ObjectType', {})));
      var ProgressTitleType;
      (function (ProgressTitleType) {
        ProgressTitleType[ProgressTitleType["Percent"] = 0] = "Percent";
        ProgressTitleType[ProgressTitleType["ValueAndMax"] = 1] = "ValueAndMax";
        ProgressTitleType[ProgressTitleType["Value"] = 2] = "Value";
        ProgressTitleType[ProgressTitleType["Max"] = 3] = "Max";
      })(ProgressTitleType || (ProgressTitleType = exports('ProgressTitleType', {})));
      var ScrollBarDisplayType;
      (function (ScrollBarDisplayType) {
        ScrollBarDisplayType[ScrollBarDisplayType["Default"] = 0] = "Default";
        ScrollBarDisplayType[ScrollBarDisplayType["Visible"] = 1] = "Visible";
        ScrollBarDisplayType[ScrollBarDisplayType["Auto"] = 2] = "Auto";
        ScrollBarDisplayType[ScrollBarDisplayType["Hidden"] = 3] = "Hidden";
      })(ScrollBarDisplayType || (ScrollBarDisplayType = exports('ScrollBarDisplayType', {})));
      var ScrollType;
      (function (ScrollType) {
        ScrollType[ScrollType["Horizontal"] = 0] = "Horizontal";
        ScrollType[ScrollType["Vertical"] = 1] = "Vertical";
        ScrollType[ScrollType["Both"] = 2] = "Both";
      })(ScrollType || (ScrollType = exports('ScrollType', {})));
      var FlipType;
      (function (FlipType) {
        FlipType[FlipType["None"] = 0] = "None";
        FlipType[FlipType["Horizontal"] = 1] = "Horizontal";
        FlipType[FlipType["Vertical"] = 2] = "Vertical";
        FlipType[FlipType["Both"] = 3] = "Both";
      })(FlipType || (FlipType = exports('FlipType', {})));
      var ChildrenRenderOrder;
      (function (ChildrenRenderOrder) {
        ChildrenRenderOrder[ChildrenRenderOrder["Ascent"] = 0] = "Ascent";
        ChildrenRenderOrder[ChildrenRenderOrder["Descent"] = 1] = "Descent";
        ChildrenRenderOrder[ChildrenRenderOrder["Arch"] = 2] = "Arch";
      })(ChildrenRenderOrder || (ChildrenRenderOrder = exports('ChildrenRenderOrder', {})));
      var GroupLayoutType;
      (function (GroupLayoutType) {
        GroupLayoutType[GroupLayoutType["None"] = 0] = "None";
        GroupLayoutType[GroupLayoutType["Horizontal"] = 1] = "Horizontal";
        GroupLayoutType[GroupLayoutType["Vertical"] = 2] = "Vertical";
      })(GroupLayoutType || (GroupLayoutType = exports('GroupLayoutType', {})));
      var PopupDirection;
      (function (PopupDirection) {
        PopupDirection[PopupDirection["Auto"] = 0] = "Auto";
        PopupDirection[PopupDirection["Up"] = 1] = "Up";
        PopupDirection[PopupDirection["Down"] = 2] = "Down";
      })(PopupDirection || (PopupDirection = exports('PopupDirection', {})));
      var RelationType;
      (function (RelationType) {
        RelationType[RelationType["Left_Left"] = 0] = "Left_Left";
        RelationType[RelationType["Left_Center"] = 1] = "Left_Center";
        RelationType[RelationType["Left_Right"] = 2] = "Left_Right";
        RelationType[RelationType["Center_Center"] = 3] = "Center_Center";
        RelationType[RelationType["Right_Left"] = 4] = "Right_Left";
        RelationType[RelationType["Right_Center"] = 5] = "Right_Center";
        RelationType[RelationType["Right_Right"] = 6] = "Right_Right";
        RelationType[RelationType["Top_Top"] = 7] = "Top_Top";
        RelationType[RelationType["Top_Middle"] = 8] = "Top_Middle";
        RelationType[RelationType["Top_Bottom"] = 9] = "Top_Bottom";
        RelationType[RelationType["Middle_Middle"] = 10] = "Middle_Middle";
        RelationType[RelationType["Bottom_Top"] = 11] = "Bottom_Top";
        RelationType[RelationType["Bottom_Middle"] = 12] = "Bottom_Middle";
        RelationType[RelationType["Bottom_Bottom"] = 13] = "Bottom_Bottom";
        RelationType[RelationType["Width"] = 14] = "Width";
        RelationType[RelationType["Height"] = 15] = "Height";
        RelationType[RelationType["LeftExt_Left"] = 16] = "LeftExt_Left";
        RelationType[RelationType["LeftExt_Right"] = 17] = "LeftExt_Right";
        RelationType[RelationType["RightExt_Left"] = 18] = "RightExt_Left";
        RelationType[RelationType["RightExt_Right"] = 19] = "RightExt_Right";
        RelationType[RelationType["TopExt_Top"] = 20] = "TopExt_Top";
        RelationType[RelationType["TopExt_Bottom"] = 21] = "TopExt_Bottom";
        RelationType[RelationType["BottomExt_Top"] = 22] = "BottomExt_Top";
        RelationType[RelationType["BottomExt_Bottom"] = 23] = "BottomExt_Bottom";
        RelationType[RelationType["Size"] = 24] = "Size";
      })(RelationType || (RelationType = exports('RelationType', {})));
      var FillMethod;
      (function (FillMethod) {
        FillMethod[FillMethod["None"] = 0] = "None";
        FillMethod[FillMethod["Horizontal"] = 1] = "Horizontal";
        FillMethod[FillMethod["Vertical"] = 2] = "Vertical";
        FillMethod[FillMethod["Radial90"] = 3] = "Radial90";
        FillMethod[FillMethod["Radial180"] = 4] = "Radial180";
        FillMethod[FillMethod["Radial360"] = 5] = "Radial360";
      })(FillMethod || (FillMethod = exports('FillMethod', {})));
      var FillOrigin;
      (function (FillOrigin) {
        FillOrigin[FillOrigin["Top"] = 0] = "Top";
        FillOrigin[FillOrigin["Bottom"] = 1] = "Bottom";
        FillOrigin[FillOrigin["Left"] = 2] = "Left";
        FillOrigin[FillOrigin["Right"] = 3] = "Right";
      })(FillOrigin || (FillOrigin = exports('FillOrigin', {})));
      var ObjectPropID;
      (function (ObjectPropID) {
        ObjectPropID[ObjectPropID["Text"] = 0] = "Text";
        ObjectPropID[ObjectPropID["Icon"] = 1] = "Icon";
        ObjectPropID[ObjectPropID["Color"] = 2] = "Color";
        ObjectPropID[ObjectPropID["OutlineColor"] = 3] = "OutlineColor";
        ObjectPropID[ObjectPropID["Playing"] = 4] = "Playing";
        ObjectPropID[ObjectPropID["Frame"] = 5] = "Frame";
        ObjectPropID[ObjectPropID["DeltaTime"] = 6] = "DeltaTime";
        ObjectPropID[ObjectPropID["TimeScale"] = 7] = "TimeScale";
        ObjectPropID[ObjectPropID["FontSize"] = 8] = "FontSize";
        ObjectPropID[ObjectPropID["Selected"] = 9] = "Selected";
      })(ObjectPropID || (ObjectPropID = exports('ObjectPropID', {})));
      var BlendMode;
      (function (BlendMode) {
        BlendMode[BlendMode["Normal"] = 0] = "Normal";
        BlendMode[BlendMode["None"] = 1] = "None";
        BlendMode[BlendMode["Add"] = 2] = "Add";
        BlendMode[BlendMode["Multiply"] = 3] = "Multiply";
        BlendMode[BlendMode["Screen"] = 4] = "Screen";
        BlendMode[BlendMode["Erase"] = 5] = "Erase";
        BlendMode[BlendMode["Mask"] = 6] = "Mask";
        BlendMode[BlendMode["Below"] = 7] = "Below";
        BlendMode[BlendMode["Off"] = 8] = "Off";
        BlendMode[BlendMode["Custom1"] = 9] = "Custom1";
        BlendMode[BlendMode["Custom2"] = 10] = "Custom2";
        BlendMode[BlendMode["Custom3"] = 11] = "Custom3";
      })(BlendMode || (BlendMode = exports('BlendMode', {})));
      var BlendModeUtils = /*#__PURE__*/function () {
        function BlendModeUtils() {}
        BlendModeUtils.apply = function apply(node, blendMode) {
          var f = factors[blendMode];
          var renderers = node.getComponentsInChildren(UIRenderer);
          renderers.forEach(function (element) {
            element.srcBlendFactor = f[0];
            element.dstBlendFactor = f[1];
          });
        };
        BlendModeUtils.override = function override(blendMode, srcFactor, dstFactor) {
          factors[blendMode][0] = srcFactor;
          factors[blendMode][1] = dstFactor;
        };
        return BlendModeUtils;
      }();
      var factors = [[gfx.BlendFactor.SRC_ALPHA, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],
      //normal
      [gfx.BlendFactor.ONE, gfx.BlendFactor.ONE],
      //none
      [gfx.BlendFactor.SRC_ALPHA, gfx.BlendFactor.ONE],
      //add
      [gfx.BlendFactor.DST_COLOR, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],
      //mul
      [gfx.BlendFactor.ONE, gfx.BlendFactor.ONE_MINUS_SRC_COLOR],
      //screen
      [gfx.BlendFactor.ZERO, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],
      //erase
      [gfx.BlendFactor.ZERO, gfx.BlendFactor.SRC_ALPHA],
      //mask
      [gfx.BlendFactor.ONE_MINUS_DST_ALPHA, gfx.BlendFactor.DST_ALPHA],
      //below
      [gfx.BlendFactor.ONE, gfx.BlendFactor.ZERO],
      //off
      [gfx.BlendFactor.SRC_ALPHA, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],
      //custom1
      [gfx.BlendFactor.SRC_ALPHA, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],
      //custom2
      [gfx.BlendFactor.SRC_ALPHA, gfx.BlendFactor.ONE_MINUS_SRC_ALPHA] //custom2
      ];
      var Event = exports('Event', /*#__PURE__*/function (_Event$) {
        _inheritsLoose(Event, _Event$);
        function Event(type, bubbles) {
          var _this;
          _this = _Event$.call(this, type, bubbles) || this;
          _this.pos = new Vec2();
          _this.touchId = 0;
          _this.clickCount = 0;
          _this.button = 0;
          _this.keyModifiers = 0;
          _this.mouseWheelDelta = 0;
          return _this;
        }
        var _proto = Event.prototype;
        _proto.captureTouch = function captureTouch() {
          var obj = GObject.cast(this.currentTarget);
          if (obj) this._processor.addTouchMonitor(this.touchId, obj);
        };
        _createClass(Event, [{
          key: "sender",
          get: function get() {
            return GObject.cast(this.currentTarget);
          }
        }, {
          key: "isShiftDown",
          get: function get() {
            return false;
          }
        }, {
          key: "isCtrlDown",
          get: function get() {
            return false;
          }
        }]);
        return Event;
      }(Event$1));
      Event.TOUCH_BEGIN = "fui_touch_begin";
      Event.TOUCH_MOVE = "fui_touch_move";
      Event.TOUCH_END = "fui_touch_end";
      Event.CLICK = "fui_click";
      Event.ROLL_OVER = "fui_roll_over";
      Event.ROLL_OUT = "fui_roll_out";
      Event.MOUSE_WHEEL = "fui_mouse_wheel";
      Event.DISPLAY = "fui_display";
      Event.UNDISPLAY = "fui_undisplay";
      Event.GEAR_STOP = "fui_gear_stop";
      Event.LINK = "fui_text_link";
      Event.Submit = "editing-return";
      Event.TEXT_CHANGE = "text-changed";
      Event.STATUS_CHANGED = "fui_status_changed";
      Event.XY_CHANGED = "fui_xy_changed";
      Event.SIZE_CHANGED = "fui_size_changed";
      Event.SIZE_DELAY_CHANGE = "fui_size_delay_change";
      Event.DRAG_START = "fui_drag_start";
      Event.DRAG_MOVE = "fui_drag_move";
      Event.DRAG_END = "fui_drag_end";
      Event.DROP = "fui_drop";
      Event.SCROLL = "fui_scroll";
      Event.SCROLL_END = "fui_scroll_end";
      Event.PULL_DOWN_RELEASE = "fui_pull_down_release";
      Event.PULL_UP_RELEASE = "fui_pull_up_release";
      Event.CLICK_ITEM = "fui_click_item";
      var eventPool = new Array();
      function borrowEvent(type, bubbles) {
        var evt;
        if (eventPool.length) {
          evt = eventPool.pop();
          evt.type = type;
          evt.bubbles = bubbles;
        } else {
          evt = new Event(type, bubbles);
        }
        return evt;
      }
      function returnEvent(evt) {
        evt.initiator = null;
        evt.unuse();
        eventPool.push(evt);
      }
      var EaseType;
      (function (EaseType) {
        EaseType[EaseType["Linear"] = 0] = "Linear";
        EaseType[EaseType["SineIn"] = 1] = "SineIn";
        EaseType[EaseType["SineOut"] = 2] = "SineOut";
        EaseType[EaseType["SineInOut"] = 3] = "SineInOut";
        EaseType[EaseType["QuadIn"] = 4] = "QuadIn";
        EaseType[EaseType["QuadOut"] = 5] = "QuadOut";
        EaseType[EaseType["QuadInOut"] = 6] = "QuadInOut";
        EaseType[EaseType["CubicIn"] = 7] = "CubicIn";
        EaseType[EaseType["CubicOut"] = 8] = "CubicOut";
        EaseType[EaseType["CubicInOut"] = 9] = "CubicInOut";
        EaseType[EaseType["QuartIn"] = 10] = "QuartIn";
        EaseType[EaseType["QuartOut"] = 11] = "QuartOut";
        EaseType[EaseType["QuartInOut"] = 12] = "QuartInOut";
        EaseType[EaseType["QuintIn"] = 13] = "QuintIn";
        EaseType[EaseType["QuintOut"] = 14] = "QuintOut";
        EaseType[EaseType["QuintInOut"] = 15] = "QuintInOut";
        EaseType[EaseType["ExpoIn"] = 16] = "ExpoIn";
        EaseType[EaseType["ExpoOut"] = 17] = "ExpoOut";
        EaseType[EaseType["ExpoInOut"] = 18] = "ExpoInOut";
        EaseType[EaseType["CircIn"] = 19] = "CircIn";
        EaseType[EaseType["CircOut"] = 20] = "CircOut";
        EaseType[EaseType["CircInOut"] = 21] = "CircInOut";
        EaseType[EaseType["ElasticIn"] = 22] = "ElasticIn";
        EaseType[EaseType["ElasticOut"] = 23] = "ElasticOut";
        EaseType[EaseType["ElasticInOut"] = 24] = "ElasticInOut";
        EaseType[EaseType["BackIn"] = 25] = "BackIn";
        EaseType[EaseType["BackOut"] = 26] = "BackOut";
        EaseType[EaseType["BackInOut"] = 27] = "BackInOut";
        EaseType[EaseType["BounceIn"] = 28] = "BounceIn";
        EaseType[EaseType["BounceOut"] = 29] = "BounceOut";
        EaseType[EaseType["BounceInOut"] = 30] = "BounceInOut";
        EaseType[EaseType["Custom"] = 31] = "Custom";
      })(EaseType || (EaseType = exports('EaseType', {})));
      var GearBase = exports('GearBase', /*#__PURE__*/function () {
        function GearBase() {}
        var _proto2 = GearBase.prototype;
        _proto2.dispose = function dispose() {
          if (this._tweenConfig && this._tweenConfig._tweener) {
            this._tweenConfig._tweener.kill();
            this._tweenConfig._tweener = null;
          }
        };
        _proto2.setup = function setup(buffer) {
          this._controller = this._owner.parent.getControllerAt(buffer.readShort());
          this.init();
          var i;
          var page;
          var cnt = buffer.readShort();
          if ("pages" in this) {
            this.pages = buffer.readSArray(cnt);
          } else {
            for (i = 0; i < cnt; i++) {
              page = buffer.readS();
              if (page == null) continue;
              this.addStatus(page, buffer);
            }
            if (buffer.readBool()) this.addStatus(null, buffer);
          }
          if (buffer.readBool()) {
            this._tweenConfig = new GearTweenConfig();
            this._tweenConfig.easeType = buffer.readByte();
            this._tweenConfig.duration = buffer.readFloat();
            this._tweenConfig.delay = buffer.readFloat();
          }
          if (buffer.version >= 2) {
            if ("positionsInPercent" in this) {
              if (buffer.readBool()) {
                this.positionsInPercent = true;
                for (i = 0; i < cnt; i++) {
                  page = buffer.readS();
                  if (page == null) continue;
                  this.addExtStatus(page, buffer);
                }
                if (buffer.readBool()) this.addExtStatus(null, buffer);
              }
            } else if ("condition" in this) this.condition = buffer.readByte();
          }
        };
        _proto2.updateFromRelations = function updateFromRelations(dx, dy) {};
        _proto2.addStatus = function addStatus(pageId, buffer) {};
        _proto2.init = function init() {};
        _proto2.apply = function apply() {};
        _proto2.updateState = function updateState() {};
        _createClass(GearBase, [{
          key: "controller",
          get: function get() {
            return this._controller;
          },
          set: function set(val) {
            if (val != this._controller) {
              this._controller = val;
              if (this._controller) this.init();
            }
          }
        }, {
          key: "tweenConfig",
          get: function get() {
            if (!this._tweenConfig) this._tweenConfig = new GearTweenConfig();
            return this._tweenConfig;
          }
        }, {
          key: "allowTween",
          get: function get() {
            return this._tweenConfig && this._tweenConfig.tween && constructingDepth.n == 0 && !GearBase.disableAllTweenEffect;
          }
        }]);
        return GearBase;
      }());
      var GearTweenConfig = function GearTweenConfig() {
        this.tween = true;
        this.easeType = EaseType.QuadOut;
        this.duration = 0.3;
        this.delay = 0;
      };
      var GearAnimation = exports('GearAnimation', /*#__PURE__*/function (_GearBase) {
        _inheritsLoose(GearAnimation, _GearBase);
        function GearAnimation() {
          return _GearBase.apply(this, arguments) || this;
        }
        var _proto3 = GearAnimation.prototype;
        _proto3.init = function init() {
          this._default = {
            playing: this._owner.getProp(ObjectPropID.Playing),
            frame: this._owner.getProp(ObjectPropID.Frame)
          };
          this._storage = {};
        };
        _proto3.addStatus = function addStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else {
            gv = {};
            this._storage[pageId] = gv;
          }
          gv.playing = buffer.readBool();
          gv.frame = buffer.readInt();
        };
        _proto3.apply = function apply() {
          this._owner._gearLocked = true;
          var gv = this._storage[this._controller.selectedPageId] || this._default;
          this._owner.setProp(ObjectPropID.Playing, gv.playing);
          this._owner.setProp(ObjectPropID.Frame, gv.frame);
          this._owner._gearLocked = false;
        };
        _proto3.updateState = function updateState() {
          var gv = this._storage[this._controller.selectedPageId];
          if (!gv) {
            gv = {};
            this._storage[this._controller.selectedPageId] = gv;
          }
          gv.playing = this._owner.getProp(ObjectPropID.Playing);
          gv.frame = this._owner.getProp(ObjectPropID.Frame);
        };
        return GearAnimation;
      }(GearBase));
      var GearColor = exports('GearColor', /*#__PURE__*/function (_GearBase2) {
        _inheritsLoose(GearColor, _GearBase2);
        function GearColor() {
          return _GearBase2.apply(this, arguments) || this;
        }
        var _proto4 = GearColor.prototype;
        _proto4.init = function init() {
          this._default = {
            color: this._owner.getProp(ObjectPropID.Color),
            strokeColor: this._owner.getProp(ObjectPropID.OutlineColor)
          };
          this._storage = {};
        };
        _proto4.addStatus = function addStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else {
            gv = {};
            this._storage[pageId] = gv;
          }
          gv.color = buffer.readColor();
          gv.strokeColor = buffer.readColor();
        };
        _proto4.apply = function apply() {
          this._owner._gearLocked = true;
          var gv = this._storage[this._controller.selectedPageId] || this._default;
          this._owner.setProp(ObjectPropID.Color, gv.color);
          this._owner.setProp(ObjectPropID.OutlineColor, gv.strokeColor);
          this._owner._gearLocked = false;
        };
        _proto4.updateState = function updateState() {
          var gv = this._storage[this._controller.selectedPageId];
          if (!gv) {
            gv = {};
            this._storage[this._controller.selectedPageId] = gv;
          }
          gv.color = this._owner.getProp(ObjectPropID.Color);
          gv.strokeColor = this._owner.getProp(ObjectPropID.OutlineColor);
        };
        return GearColor;
      }(GearBase));
      var GearDisplay = exports('GearDisplay', /*#__PURE__*/function (_GearBase3) {
        _inheritsLoose(GearDisplay, _GearBase3);
        function GearDisplay() {
          var _this2;
          _this2 = _GearBase3.apply(this, arguments) || this;
          _this2.pages = null;
          _this2._visible = 0;
          _this2._displayLockToken = 1;
          return _this2;
        }
        var _proto5 = GearDisplay.prototype;
        _proto5.init = function init() {
          this.pages = null;
        };
        _proto5.addLock = function addLock() {
          this._visible++;
          return this._displayLockToken;
        };
        _proto5.releaseLock = function releaseLock(token) {
          if (token == this._displayLockToken) this._visible--;
        };
        _proto5.apply = function apply() {
          this._displayLockToken++;
          if (this._displayLockToken <= 0) this._displayLockToken = 1;
          if (this.pages == null || this.pages.length == 0 || this.pages.indexOf(this._controller.selectedPageId) != -1) this._visible = 1;else this._visible = 0;
        };
        _createClass(GearDisplay, [{
          key: "connected",
          get: function get() {
            return this._controller == null || this._visible > 0;
          }
        }]);
        return GearDisplay;
      }(GearBase));
      var GearDisplay2 = exports('GearDisplay2', /*#__PURE__*/function (_GearBase4) {
        _inheritsLoose(GearDisplay2, _GearBase4);
        function GearDisplay2() {
          var _this3;
          _this3 = _GearBase4.apply(this, arguments) || this;
          _this3.pages = null;
          _this3.condition = 0;
          _this3._visible = 0;
          return _this3;
        }
        var _proto6 = GearDisplay2.prototype;
        _proto6.init = function init() {
          this.pages = null;
        };
        _proto6.apply = function apply() {
          if (this.pages == null || this.pages.length == 0 || this.pages.indexOf(this._controller.selectedPageId) != -1) this._visible = 1;else this._visible = 0;
        };
        _proto6.evaluate = function evaluate(connected) {
          var v = this._controller == null || this._visible > 0;
          if (this.condition == 0) v = v && connected;else v = v || connected;
          return v;
        };
        return GearDisplay2;
      }(GearBase));
      var GearFontSize = exports('GearFontSize', /*#__PURE__*/function (_GearBase5) {
        _inheritsLoose(GearFontSize, _GearBase5);
        function GearFontSize() {
          var _this4;
          _this4 = _GearBase5.apply(this, arguments) || this;
          _this4._default = 0;
          return _this4;
        }
        var _proto7 = GearFontSize.prototype;
        _proto7.init = function init() {
          this._default = this._owner.getProp(ObjectPropID.FontSize);
          this._storage = {};
        };
        _proto7.addStatus = function addStatus(pageId, buffer) {
          if (!pageId) this._default = buffer.readInt();else this._storage[pageId] = buffer.readInt();
        };
        _proto7.apply = function apply() {
          this._owner._gearLocked = true;
          var data = this._storage[this._controller.selectedPageId];
          if (data !== undefined) this._owner.setProp(ObjectPropID.FontSize, data);else this._owner.setProp(ObjectPropID.FontSize, this._default);
          this._owner._gearLocked = false;
        };
        _proto7.updateState = function updateState() {
          this._storage[this._controller.selectedPageId] = this._owner.getProp(ObjectPropID.FontSize);
        };
        return GearFontSize;
      }(GearBase));
      var GearIcon = exports('GearIcon', /*#__PURE__*/function (_GearBase6) {
        _inheritsLoose(GearIcon, _GearBase6);
        function GearIcon() {
          return _GearBase6.apply(this, arguments) || this;
        }
        var _proto8 = GearIcon.prototype;
        _proto8.init = function init() {
          this._default = this._owner.icon;
          this._storage = {};
        };
        _proto8.addStatus = function addStatus(pageId, buffer) {
          if (!pageId) this._default = buffer.readS();else this._storage[pageId] = buffer.readS();
        };
        _proto8.apply = function apply() {
          this._owner._gearLocked = true;
          var data = this._storage[this._controller.selectedPageId];
          if (data !== undefined) this._owner.icon = data;else this._owner.icon = this._default;
          this._owner._gearLocked = false;
        };
        _proto8.updateState = function updateState() {
          this._storage[this._controller.selectedPageId] = this._owner.icon;
        };
        return GearIcon;
      }(GearBase));
      var Pool = /*#__PURE__*/function () {
        function Pool(type, init, reset) {
          this.pool = [];
          this._init = init;
          this._reset = reset;
          this._ct = type;
        }
        var _proto9 = Pool.prototype;
        _proto9.borrow = function borrow() {
          var ret;
          if (this.pool.length > 0) ret = this.pool.pop();else ret = new this._ct();
          for (var _len = arguments.length, argArray = new Array(_len), _key = 0; _key < _len; _key++) {
            argArray[_key] = arguments[_key];
          }
          if (this._init) this._init.apply(this, [ret].concat(argArray));
          return ret;
        };
        _proto9.returns = function returns(element) {
          if (Array.isArray(element)) {
            var count = element.length;
            for (var i = 0; i < count; i++) {
              var element2 = element[i];
              if (this._reset) this._reset(element2);
              this.pool.push(element2);
            }
            element.length = 0;
          } else {
            if (this._reset) this._reset(element);
            this.pool.push(element);
          }
        };
        return Pool;
      }(); // Author: Daniele Giardini - http://www.demigiant.com
      // Created: 2014/07/19 14:11
      // 
      // License Copyright (c) Daniele Giardini.
      // This work is subject to the terms at http://dotween.demigiant.com/license.php
      // 
      // =============================================================
      // Contains Daniele Giardini's C# port of the easing equations created by Robert Penner
      // (all easing equations except for Flash, InFlash, OutFlash, InOutFlash,
      // which use some parts of Robert Penner's equations but were created by Daniele Giardini)
      // http://robertpenner.com/easing, see license below:
      // =============================================================
      //
      // TERMS OF USE - EASING EQUATIONS
      //
      // Open source under the BSD License.
      //
      // Copyright ? 2001 Robert Penner
      // All rights reserved.
      //
      // Redistribution and use in source and binary forms, with or without modification,
      // are permitted provided that the following conditions are met:
      //
      // - Redistributions of source code must retain the above copyright notice,
      // this list of conditions and the following disclaimer.
      // - Redistributions in binary form must reproduce the above copyright notice,
      // this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
      // - Neither the name of the author nor the names of contributors may be used to endorse
      // or promote products derived} from this software without specific prior written permission.
      // - THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
      // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
      // THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
      // IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
      // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
      // LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
      // STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
      // EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      var _PiOver2 = Math.PI * 0.5;
      var _TwoPi = Math.PI * 2;
      function evaluateEase(easeType, time, duration, overshootOrAmplitude, period) {
        switch (easeType) {
          case EaseType.Linear:
            return time / duration;
          case EaseType.SineIn:
            return -Math.cos(time / duration * _PiOver2) + 1;
          case EaseType.SineOut:
            return Math.sin(time / duration * _PiOver2);
          case EaseType.SineInOut:
            return -0.5 * (Math.cos(Math.PI * time / duration) - 1);
          case EaseType.QuadIn:
            return (time /= duration) * time;
          case EaseType.QuadOut:
            return -(time /= duration) * (time - 2);
          case EaseType.QuadInOut:
            if ((time /= duration * 0.5) < 1) return 0.5 * time * time;
            return -0.5 * (--time * (time - 2) - 1);
          case EaseType.CubicIn:
            return (time /= duration) * time * time;
          case EaseType.CubicOut:
            return (time = time / duration - 1) * time * time + 1;
          case EaseType.CubicInOut:
            if ((time /= duration * 0.5) < 1) return 0.5 * time * time * time;
            return 0.5 * ((time -= 2) * time * time + 2);
          case EaseType.QuartIn:
            return (time /= duration) * time * time * time;
          case EaseType.QuartOut:
            return -((time = time / duration - 1) * time * time * time - 1);
          case EaseType.QuartInOut:
            if ((time /= duration * 0.5) < 1) return 0.5 * time * time * time * time;
            return -0.5 * ((time -= 2) * time * time * time - 2);
          case EaseType.QuintIn:
            return (time /= duration) * time * time * time * time;
          case EaseType.QuintOut:
            return (time = time / duration - 1) * time * time * time * time + 1;
          case EaseType.QuintInOut:
            if ((time /= duration * 0.5) < 1) return 0.5 * time * time * time * time * time;
            return 0.5 * ((time -= 2) * time * time * time * time + 2);
          case EaseType.ExpoIn:
            return time == 0 ? 0 : Math.pow(2, 10 * (time / duration - 1));
          case EaseType.ExpoOut:
            if (time == duration) return 1;
            return -Math.pow(2, -10 * time / duration) + 1;
          case EaseType.ExpoInOut:
            if (time == 0) return 0;
            if (time == duration) return 1;
            if ((time /= duration * 0.5) < 1) return 0.5 * Math.pow(2, 10 * (time - 1));
            return 0.5 * (-Math.pow(2, -10 * --time) + 2);
          case EaseType.CircIn:
            return -(Math.sqrt(1 - (time /= duration) * time) - 1);
          case EaseType.CircOut:
            return Math.sqrt(1 - (time = time / duration - 1) * time);
          case EaseType.CircInOut:
            if ((time /= duration * 0.5) < 1) return -0.5 * (Math.sqrt(1 - time * time) - 1);
            return 0.5 * (Math.sqrt(1 - (time -= 2) * time) + 1);
          case EaseType.ElasticIn:
            var s0;
            if (time == 0) return 0;
            if ((time /= duration) == 1) return 1;
            if (period == 0) period = duration * 0.3;
            if (overshootOrAmplitude < 1) {
              overshootOrAmplitude = 1;
              s0 = period / 4;
            } else s0 = period / _TwoPi * Math.asin(1 / overshootOrAmplitude);
            return -(overshootOrAmplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - s0) * _TwoPi / period));
          case EaseType.ElasticOut:
            var s1;
            if (time == 0) return 0;
            if ((time /= duration) == 1) return 1;
            if (period == 0) period = duration * 0.3;
            if (overshootOrAmplitude < 1) {
              overshootOrAmplitude = 1;
              s1 = period / 4;
            } else s1 = period / _TwoPi * Math.asin(1 / overshootOrAmplitude);
            return overshootOrAmplitude * Math.pow(2, -10 * time) * Math.sin((time * duration - s1) * _TwoPi / period) + 1;
          case EaseType.ElasticInOut:
            var s;
            if (time == 0) return 0;
            if ((time /= duration * 0.5) == 2) return 1;
            if (period == 0) period = duration * (0.3 * 1.5);
            if (overshootOrAmplitude < 1) {
              overshootOrAmplitude = 1;
              s = period / 4;
            } else s = period / _TwoPi * Math.asin(1 / overshootOrAmplitude);
            if (time < 1) return -0.5 * (overshootOrAmplitude * Math.pow(2, 10 * (time -= 1)) * Math.sin((time * duration - s) * _TwoPi / period));
            return overshootOrAmplitude * Math.pow(2, -10 * (time -= 1)) * Math.sin((time * duration - s) * _TwoPi / period) * 0.5 + 1;
          case EaseType.BackIn:
            return (time /= duration) * time * ((overshootOrAmplitude + 1) * time - overshootOrAmplitude);
          case EaseType.BackOut:
            return (time = time / duration - 1) * time * ((overshootOrAmplitude + 1) * time + overshootOrAmplitude) + 1;
          case EaseType.BackInOut:
            if ((time /= duration * 0.5) < 1) return 0.5 * (time * time * (((overshootOrAmplitude *= 1.525) + 1) * time - overshootOrAmplitude));
            return 0.5 * ((time -= 2) * time * (((overshootOrAmplitude *= 1.525) + 1) * time + overshootOrAmplitude) + 2);
          case EaseType.BounceIn:
            return bounce_easeIn(time, duration);
          case EaseType.BounceOut:
            return bounce_easeOut(time, duration);
          case EaseType.BounceInOut:
            return bounce_easeInOut(time, duration);
          default:
            return -(time /= duration) * (time - 2);
        }
      }
      function bounce_easeIn(time, duration) {
        return 1 - bounce_easeOut(duration - time, duration);
      }
      function bounce_easeOut(time, duration) {
        if ((time /= duration) < 1 / 2.75) {
          return 7.5625 * time * time;
        }
        if (time < 2 / 2.75) {
          return 7.5625 * (time -= 1.5 / 2.75) * time + 0.75;
        }
        if (time < 2.5 / 2.75) {
          return 7.5625 * (time -= 2.25 / 2.75) * time + 0.9375;
        }
        return 7.5625 * (time -= 2.625 / 2.75) * time + 0.984375;
      }
      function bounce_easeInOut(time, duration) {
        if (time < duration * 0.5) {
          return bounce_easeIn(time * 2, duration) * 0.5;
        }
        return bounce_easeOut(time * 2 - duration, duration) * 0.5 + 0.5;
      }
      var TweenValue = /*#__PURE__*/function () {
        function TweenValue() {
          this.x = this.y = this.z = this.w = 0;
        }
        var _proto10 = TweenValue.prototype;
        _proto10.getField = function getField(index) {
          switch (index) {
            case 0:
              return this.x;
            case 1:
              return this.y;
            case 2:
              return this.z;
            case 3:
              return this.w;
            default:
              throw new Error("Index out of bounds: " + index);
          }
        };
        _proto10.setField = function setField(index, value) {
          switch (index) {
            case 0:
              this.x = value;
              break;
            case 1:
              this.y = value;
              break;
            case 2:
              this.z = value;
              break;
            case 3:
              this.w = value;
              break;
            default:
              throw new Error("Index out of bounds: " + index);
          }
        };
        _proto10.setZero = function setZero() {
          this.x = this.y = this.z = this.w = 0;
        };
        _createClass(TweenValue, [{
          key: "color",
          get: function get() {
            return (this.w << 24) + (this.x << 16) + (this.y << 8) + this.z;
          },
          set: function set(value) {
            this.x = (value & 0xFF0000) >> 16;
            this.y = (value & 0x00FF00) >> 8;
            this.z = value & 0x0000FF;
            this.w = (value & 0xFF000000) >> 24;
          }
        }]);
        return TweenValue;
      }();
      var s_vec2$5 = new Vec2();
      var GTweener = exports('GTweener', /*#__PURE__*/function () {
        function GTweener() {
          this._delay = 0;
          this._duration = 0;
          this._breakpoint = 0;
          this._easeType = 0;
          this._easeOvershootOrAmplitude = 0;
          this._easePeriod = 0;
          this._repeat = 0;
          this._yoyo = false;
          this._timeScale = 1;
          this._snapping = false;
          this._startValue = new TweenValue();
          this._endValue = new TweenValue();
          this._value = new TweenValue();
          this._deltaValue = new TweenValue();
          this._reset();
        }
        var _proto11 = GTweener.prototype;
        _proto11.setDelay = function setDelay(value) {
          this._delay = value;
          return this;
        };
        _proto11.setDuration = function setDuration(value) {
          this._duration = value;
          return this;
        };
        _proto11.setBreakpoint = function setBreakpoint(value) {
          this._breakpoint = value;
          return this;
        };
        _proto11.setEase = function setEase(value) {
          this._easeType = value;
          return this;
        };
        _proto11.setEasePeriod = function setEasePeriod(value) {
          this._easePeriod = value;
          return this;
        };
        _proto11.setEaseOvershootOrAmplitude = function setEaseOvershootOrAmplitude(value) {
          this._easeOvershootOrAmplitude = value;
          return this;
        };
        _proto11.setRepeat = function setRepeat(repeat, yoyo) {
          this._repeat = repeat;
          this._yoyo = yoyo;
          return this;
        };
        _proto11.setTimeScale = function setTimeScale(value) {
          this._timeScale = value;
          return this;
        };
        _proto11.setSnapping = function setSnapping(value) {
          this._snapping = value;
          return this;
        };
        _proto11.setTarget = function setTarget(value, propType) {
          this._target = value;
          this._propType = propType;
          return this;
        };
        _proto11.setPath = function setPath(value) {
          this._path = value;
          return this;
        };
        _proto11.setUserData = function setUserData(value) {
          this._userData = value;
          return this;
        };
        _proto11.onUpdate = function onUpdate(callback, target) {
          this._onUpdate = callback;
          this._onUpdateCaller = target;
          return this;
        };
        _proto11.onStart = function onStart(callback, target) {
          this._onStart = callback;
          this._onStartCaller = target;
          return this;
        };
        _proto11.onComplete = function onComplete(callback, target) {
          this._onComplete = callback;
          this._onCompleteCaller = target;
          return this;
        };
        _proto11.setPaused = function setPaused(paused) {
          this._paused = paused;
          return this;
        } /**
          * seek position of the tween, in seconds.
          */;
        _proto11.seek = function seek(time) {
          if (this._killed) return;
          this._elapsedTime = time;
          if (this._elapsedTime < this._delay) {
            if (this._started) this._elapsedTime = this._delay;else return;
          }
          this.update();
        };
        _proto11.kill = function kill(complete) {
          if (this._killed) return;
          if (complete) {
            if (this._ended == 0) {
              if (this._breakpoint >= 0) this._elapsedTime = this._delay + this._breakpoint;else if (this._repeat >= 0) this._elapsedTime = this._delay + this._duration * (this._repeat + 1);else this._elapsedTime = this._delay + this._duration * 2;
              this.update();
            }
            this.callCompleteCallback();
          }
          this._killed = true;
        };
        _proto11._to = function _to(start, end, duration) {
          this._valueSize = 1;
          this._startValue.x = start;
          this._endValue.x = end;
          this._value.x = start;
          this._duration = duration;
          return this;
        };
        _proto11._to2 = function _to2(start, start2, end, end2, duration) {
          this._valueSize = 2;
          this._startValue.x = start;
          this._endValue.x = end;
          this._startValue.y = start2;
          this._endValue.y = end2;
          this._value.x = start;
          this._value.y = start2;
          this._duration = duration;
          return this;
        };
        _proto11._to3 = function _to3(start, start2, start3, end, end2, end3, duration) {
          this._valueSize = 3;
          this._startValue.x = start;
          this._endValue.x = end;
          this._startValue.y = start2;
          this._endValue.y = end2;
          this._startValue.z = start3;
          this._endValue.z = end3;
          this._value.x = start;
          this._value.y = start2;
          this._value.z = start3;
          this._duration = duration;
          return this;
        };
        _proto11._to4 = function _to4(start, start2, start3, start4, end, end2, end3, end4, duration) {
          this._valueSize = 4;
          this._startValue.x = start;
          this._endValue.x = end;
          this._startValue.y = start2;
          this._endValue.y = end2;
          this._startValue.z = start3;
          this._endValue.z = end3;
          this._startValue.w = start4;
          this._endValue.w = end4;
          this._value.x = start;
          this._value.y = start2;
          this._value.z = start3;
          this._value.w = start4;
          this._duration = duration;
          return this;
        };
        _proto11._toColor = function _toColor(start, end, duration) {
          this._valueSize = 5;
          this._startValue.color = start;
          this._endValue.color = end;
          this._value.color = start;
          this._duration = duration;
          return this;
        };
        _proto11._shake = function _shake(startX, startY, amplitude, duration) {
          this._valueSize = 6;
          this._startValue.x = startX;
          this._startValue.y = startY;
          this._startValue.w = amplitude;
          this._duration = duration;
          return this;
        };
        _proto11._init = function _init() {
          this._delay = 0;
          this._duration = 0;
          this._breakpoint = -1;
          this._easeType = EaseType.QuadOut;
          this._timeScale = 1;
          this._easePeriod = 0;
          this._easeOvershootOrAmplitude = 1.70158;
          this._snapping = false;
          this._repeat = 0;
          this._yoyo = false;
          this._valueSize = 0;
          this._started = false;
          this._paused = false;
          this._killed = false;
          this._elapsedTime = 0;
          this._normalizedTime = 0;
          this._ended = 0;
        };
        _proto11._reset = function _reset() {
          this._target = null;
          this._propType = null;
          this._userData = null;
          this._path = null;
          this._onStart = this._onUpdate = this._onComplete = null;
          this._onStartCaller = this._onUpdateCaller = this._onCompleteCaller = null;
        };
        _proto11._update = function _update(dt) {
          if (this._timeScale != 1) dt *= this._timeScale;
          if (dt == 0) return;
          if (this._ended != 0)
            //Maybe completed by seek
            {
              this.callCompleteCallback();
              this._killed = true;
              return;
            }
          this._elapsedTime += dt;
          this.update();
          if (this._ended != 0) {
            if (!this._killed) {
              this.callCompleteCallback();
              this._killed = true;
            }
          }
        };
        _proto11.update = function update() {
          this._ended = 0;
          if (this._valueSize == 0)
            //DelayedCall
            {
              if (this._elapsedTime >= this._delay + this._duration) this._ended = 1;
              return;
            }
          if (!this._started) {
            if (this._elapsedTime < this._delay) return;
            this._started = true;
            this.callStartCallback();
            if (this._killed) return;
          }
          var reversed = false;
          var tt = this._elapsedTime - this._delay;
          if (this._breakpoint >= 0 && tt >= this._breakpoint) {
            tt = this._breakpoint;
            this._ended = 2;
          }
          if (this._repeat != 0) {
            var round = Math.floor(tt / this._duration);
            tt -= this._duration * round;
            if (this._yoyo) reversed = round % 2 == 1;
            if (this._repeat > 0 && this._repeat - round < 0) {
              if (this._yoyo) reversed = this._repeat % 2 == 1;
              tt = this._duration;
              this._ended = 1;
            }
          } else if (tt >= this._duration) {
            tt = this._duration;
            this._ended = 1;
          }
          this._normalizedTime = evaluateEase(this._easeType, reversed ? this._duration - tt : tt, this._duration, this._easeOvershootOrAmplitude, this._easePeriod);
          this._value.setZero();
          this._deltaValue.setZero();
          if (this._valueSize == 6) {
            if (this._ended == 0) {
              var r = this._startValue.w * (1 - this._normalizedTime);
              var rx = r * (Math.random() > 0.5 ? 1 : -1);
              var ry = r * (Math.random() > 0.5 ? 1 : -1);
              this._deltaValue.x = rx;
              this._deltaValue.y = ry;
              this._value.x = this._startValue.x + rx;
              this._value.y = this._startValue.y + ry;
            } else {
              this._value.x = this._startValue.x;
              this._value.y = this._startValue.y;
            }
          } else if (this._path) {
            var pt = this._path.getPointAt(this._normalizedTime, s_vec2$5);
            if (this._snapping) {
              pt.x = Math.round(pt.x);
              pt.y = Math.round(pt.y);
            }
            this._deltaValue.x = pt.x - this._value.x;
            this._deltaValue.y = pt.y - this._value.y;
            this._value.x = pt.x;
            this._value.y = pt.y;
          } else {
            var cnt = Math.min(this._valueSize, 4);
            for (var i = 0; i < cnt; i++) {
              var n1 = this._startValue.getField(i);
              var n2 = this._endValue.getField(i);
              var f = n1 + (n2 - n1) * this._normalizedTime;
              if (this._snapping) f = Math.round(f);
              this._deltaValue.setField(i, f - this._value.getField(i));
              this._value.setField(i, f);
            }
          }
          if (this._target && this._propType) {
            if (this._propType instanceof Function) {
              switch (this._valueSize) {
                case 1:
                  this._propType.call(this._target, this._value.x);
                  break;
                case 2:
                  this._propType.call(this._target, this._value.x, this._value.y);
                  break;
                case 3:
                  this._propType.call(this._target, this._value.x, this._value.y, this._value.z);
                  break;
                case 4:
                  this._propType.call(this._target, this._value.x, this._value.y, this._value.z, this._value.w);
                  break;
                case 5:
                  this._propType.call(this._target, this._value.color);
                  break;
                case 6:
                  this._propType.call(this._target, this._value.x, this._value.y);
                  break;
              }
            } else {
              if (this._valueSize == 5) this._target[this._propType] = this._value.color;else this._target[this._propType] = this._value.x;
            }
          }
          this.callUpdateCallback();
        };
        _proto11.callStartCallback = function callStartCallback() {
          if (this._onStart) {
            try {
              this._onStart.call(this._onStartCaller, this);
            } catch (err) {
              console.log("error in start callback > " + err);
            }
          }
        };
        _proto11.callUpdateCallback = function callUpdateCallback() {
          if (this._onUpdate) {
            try {
              this._onUpdate.call(this._onUpdateCaller, this);
            } catch (err) {
              console.log("error in update callback > " + err);
            }
          }
        };
        _proto11.callCompleteCallback = function callCompleteCallback() {
          if (this._onComplete) {
            try {
              this._onComplete.call(this._onCompleteCaller, this);
            } catch (err) {
              console.log("error in complete callback > " + err);
            }
          }
        };
        _createClass(GTweener, [{
          key: "delay",
          get: function get() {
            return this._delay;
          }
        }, {
          key: "duration",
          get: function get() {
            return this._duration;
          }
        }, {
          key: "repeat",
          get: function get() {
            return this._repeat;
          }
        }, {
          key: "target",
          get: function get() {
            return this._target;
          }
        }, {
          key: "userData",
          get: function get() {
            return this._userData;
          }
        }, {
          key: "startValue",
          get: function get() {
            return this._startValue;
          }
        }, {
          key: "endValue",
          get: function get() {
            return this._endValue;
          }
        }, {
          key: "value",
          get: function get() {
            return this._value;
          }
        }, {
          key: "deltaValue",
          get: function get() {
            return this._deltaValue;
          }
        }, {
          key: "normalizedTime",
          get: function get() {
            return this._normalizedTime;
          }
        }, {
          key: "completed",
          get: function get() {
            return this._ended != 0;
          }
        }, {
          key: "allCompleted",
          get: function get() {
            return this._ended == 1;
          }
        }]);
        return GTweener;
      }());
      var TweenManager = /*#__PURE__*/function () {
        function TweenManager() {}
        TweenManager.createTween = function createTween() {
          if (!_root) {
            _root = new Node("[TweenManager]");
            game.addPersistRootNode(_root);
            director.getScheduler().schedule(TweenManager.update, _root, 0, macro.REPEAT_FOREVER, 0, false);
          }
          var tweener = _tweenerPool.borrow();
          _activeTweens[_totalActiveTweens++] = tweener;
          return tweener;
        };
        TweenManager.isTweening = function isTweening(target, propType) {
          if (target == null) return false;
          var anyType = !propType;
          for (var i = 0; i < _totalActiveTweens; i++) {
            var tweener = _activeTweens[i];
            if (tweener && tweener.target == target && !tweener._killed && (anyType || tweener._propType == propType)) return true;
          }
          return false;
        };
        TweenManager.killTweens = function killTweens(target, completed, propType) {
          if (target == null) return false;
          var flag = false;
          var cnt = _totalActiveTweens;
          var anyType = !propType;
          for (var i = 0; i < cnt; i++) {
            var tweener = _activeTweens[i];
            if (tweener && tweener.target == target && !tweener._killed && (anyType || tweener._propType == propType)) {
              tweener.kill(completed);
              flag = true;
            }
          }
          return flag;
        };
        TweenManager.getTween = function getTween(target, propType) {
          if (target == null) return null;
          var cnt = _totalActiveTweens;
          var anyType = !propType;
          for (var i = 0; i < cnt; i++) {
            var tweener = _activeTweens[i];
            if (tweener && tweener.target == target && !tweener._killed && (anyType || tweener._propType == propType)) {
              return tweener;
            }
          }
          return null;
        };
        TweenManager.update = function update(dt) {
          var tweens = _activeTweens;
          var cnt = _totalActiveTweens;
          var freePosStart = -1;
          for (var i = 0; i < cnt; i++) {
            var tweener = tweens[i];
            if (tweener == null) {
              if (freePosStart == -1) freePosStart = i;
            } else if (tweener._killed) {
              tweener._reset();
              _tweenerPool.returns(tweener);
              tweens[i] = null;
              if (freePosStart == -1) freePosStart = i;
            } else {
              if (tweener._target && 'isDisposed' in tweener._target && tweener._target.isDisposed) tweener._killed = true;else if (!tweener._paused) tweener._update(dt);
              if (freePosStart != -1) {
                tweens[freePosStart] = tweener;
                tweens[i] = null;
                freePosStart++;
              }
            }
          }
          if (freePosStart >= 0) {
            if (_totalActiveTweens != cnt)
              //new tweens added
              {
                var j = cnt;
                cnt = _totalActiveTweens - cnt;
                for (i = 0; i < cnt; i++) tweens[freePosStart++] = tweens[j++];
              }
            _totalActiveTweens = freePosStart;
          }
          return false;
        };
        return TweenManager;
      }();
      var _activeTweens = new Array();
      var _tweenerPool = new Pool(GTweener, function (e) {
        return e._init();
      }, function (e) {
        return e._reset();
      });
      var _totalActiveTweens = 0;
      var _root;
      var GTween = exports('GTween', /*#__PURE__*/function () {
        function GTween() {}
        GTween.to = function to(start, end, duration) {
          return TweenManager.createTween()._to(start, end, duration);
        };
        GTween.to2 = function to2(start, start2, end, end2, duration) {
          return TweenManager.createTween()._to2(start, start2, end, end2, duration);
        };
        GTween.to3 = function to3(start, start2, start3, end, end2, end3, duration) {
          return TweenManager.createTween()._to3(start, start2, start3, end, end2, end3, duration);
        };
        GTween.to4 = function to4(start, start2, start3, start4, end, end2, end3, end4, duration) {
          return TweenManager.createTween()._to4(start, start2, start3, start4, end, end2, end3, end4, duration);
        };
        GTween.toColor = function toColor(start, end, duration) {
          return TweenManager.createTween()._toColor(start, end, duration);
        };
        GTween.delayedCall = function delayedCall(delay) {
          return TweenManager.createTween().setDelay(delay);
        };
        GTween.shake = function shake(startX, startY, amplitude, duration) {
          return TweenManager.createTween()._shake(startX, startY, amplitude, duration);
        };
        GTween.isTweening = function isTweening(target, propType) {
          return TweenManager.isTweening(target, propType);
        };
        GTween.kill = function kill(target, complete, propType) {
          TweenManager.killTweens(target, complete, propType);
        };
        GTween.getTween = function getTween(target, propType) {
          return TweenManager.getTween(target, propType);
        };
        return GTween;
      }());
      GTween.catchCallbackExceptions = true;
      var GearLook = exports('GearLook', /*#__PURE__*/function (_GearBase7) {
        _inheritsLoose(GearLook, _GearBase7);
        function GearLook() {
          return _GearBase7.apply(this, arguments) || this;
        }
        var _proto12 = GearLook.prototype;
        _proto12.init = function init() {
          this._default = {
            alpha: this._owner.alpha,
            rotation: this._owner.rotation,
            grayed: this._owner.grayed,
            touchable: this._owner.touchable
          };
          this._storage = {};
        };
        _proto12.addStatus = function addStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else {
            gv = {};
            this._storage[pageId] = gv;
          }
          gv.alpha = buffer.readFloat();
          gv.rotation = buffer.readFloat();
          gv.grayed = buffer.readBool();
          gv.touchable = buffer.readBool();
        };
        _proto12.apply = function apply() {
          var gv = this._storage[this._controller.selectedPageId] || this._default;
          if (this.allowTween) {
            this._owner._gearLocked = true;
            this._owner.grayed = gv.grayed;
            this._owner.touchable = gv.touchable;
            this._owner._gearLocked = false;
            if (this._tweenConfig._tweener) {
              if (this._tweenConfig._tweener.endValue.x != gv.alpha || this._tweenConfig._tweener.endValue.y != gv.rotation) {
                this._tweenConfig._tweener.kill(true);
                this._tweenConfig._tweener = null;
              } else return;
            }
            var a = gv.alpha != this._owner.alpha;
            var b = gv.rotation != this._owner.rotation;
            if (a || b) {
              if (this._owner.checkGearController(0, this._controller)) this._tweenConfig._displayLockToken = this._owner.addDisplayLock();
              this._tweenConfig._tweener = GTween.to2(this._owner.alpha, this._owner.rotation, gv.alpha, gv.rotation, this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((a ? 1 : 0) + (b ? 2 : 0)).setTarget(this).onUpdate(this.__tweenUpdate, this).onComplete(this.__tweenComplete, this);
            }
          } else {
            this._owner._gearLocked = true;
            this._owner.grayed = gv.grayed;
            this._owner.alpha = gv.alpha;
            this._owner.rotation = gv.rotation;
            this._owner.touchable = gv.touchable;
            this._owner._gearLocked = false;
          }
        };
        _proto12.__tweenUpdate = function __tweenUpdate(tweener) {
          var flag = tweener.userData;
          this._owner._gearLocked = true;
          if ((flag & 1) != 0) this._owner.alpha = tweener.value.x;
          if ((flag & 2) != 0) this._owner.rotation = tweener.value.y;
          this._owner._gearLocked = false;
        };
        _proto12.__tweenComplete = function __tweenComplete() {
          if (this._tweenConfig._displayLockToken != 0) {
            this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken);
            this._tweenConfig._displayLockToken = 0;
          }
          this._tweenConfig._tweener = null;
        };
        _proto12.updateState = function updateState() {
          var gv = this._storage[this._controller.selectedPageId];
          if (!gv) {
            gv = {};
            this._storage[this._controller.selectedPageId] = gv;
          }
          gv.alpha = this._owner.alpha;
          gv.rotation = this._owner.rotation;
          gv.grayed = this._owner.grayed;
          gv.touchable = this._owner.touchable;
        };
        return GearLook;
      }(GearBase));
      var GearSize = exports('GearSize', /*#__PURE__*/function (_GearBase8) {
        _inheritsLoose(GearSize, _GearBase8);
        function GearSize() {
          return _GearBase8.apply(this, arguments) || this;
        }
        var _proto13 = GearSize.prototype;
        _proto13.init = function init() {
          this._default = {
            width: this._owner.width,
            height: this._owner.height,
            scaleX: this._owner.scaleX,
            scaleY: this._owner.scaleY
          };
          this._storage = {};
        };
        _proto13.addStatus = function addStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else {
            gv = {};
            this._storage[pageId] = gv;
          }
          gv.width = buffer.readInt();
          gv.height = buffer.readInt();
          gv.scaleX = buffer.readFloat();
          gv.scaleY = buffer.readFloat();
        };
        _proto13.apply = function apply() {
          var gv = this._storage[this._controller.selectedPageId] || this._default;
          if (this.allowTween) {
            if (this._tweenConfig._tweener) {
              if (this._tweenConfig._tweener.endValue.x != gv.width || this._tweenConfig._tweener.endValue.y != gv.height || this._tweenConfig._tweener.endValue.z != gv.scaleX || this._tweenConfig._tweener.endValue.w != gv.scaleY) {
                this._tweenConfig._tweener.kill(true);
                this._tweenConfig._tweener = null;
              } else return;
            }
            var a = gv.width != this._owner.width || gv.height != this._owner.height;
            var b = gv.scaleX != this._owner.scaleX || gv.scaleY != this._owner.scaleY;
            if (a || b) {
              if (this._owner.checkGearController(0, this._controller)) this._tweenConfig._displayLockToken = this._owner.addDisplayLock();
              this._tweenConfig._tweener = GTween.to4(this._owner.width, this._owner.height, this._owner.scaleX, this._owner.scaleY, gv.width, gv.height, gv.scaleX, gv.scaleY, this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((a ? 1 : 0) + (b ? 2 : 0)).setTarget(this).onUpdate(this.__tweenUpdate, this).onComplete(this.__tweenComplete, this);
            }
          } else {
            this._owner._gearLocked = true;
            this._owner.setSize(gv.width, gv.height, this._owner.checkGearController(1, this._controller));
            this._owner.setScale(gv.scaleX, gv.scaleY);
            this._owner._gearLocked = false;
          }
        };
        _proto13.__tweenUpdate = function __tweenUpdate(tweener) {
          var flag = tweener.userData;
          this._owner._gearLocked = true;
          if ((flag & 1) != 0) this._owner.setSize(tweener.value.x, tweener.value.y, this._owner.checkGearController(1, this._controller));
          if ((flag & 2) != 0) this._owner.setScale(tweener.value.z, tweener.value.w);
          this._owner._gearLocked = false;
        };
        _proto13.__tweenComplete = function __tweenComplete() {
          if (this._tweenConfig._displayLockToken != 0) {
            this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken);
            this._tweenConfig._displayLockToken = 0;
          }
          this._tweenConfig._tweener = null;
        };
        _proto13.updateState = function updateState() {
          var gv = this._storage[this._controller.selectedPageId];
          if (!gv) {
            gv = {};
            this._storage[this._controller.selectedPageId] = gv;
          }
          gv.width = this._owner.width;
          gv.height = this._owner.height;
          gv.scaleX = this._owner.scaleX;
          gv.scaleY = this._owner.scaleY;
        };
        _proto13.updateFromRelations = function updateFromRelations(dx, dy) {
          if (this._controller == null || this._storage == null) return;
          for (var key in this._storage) {
            var gv = this._storage[key];
            gv.width += dx;
            gv.height += dy;
          }
          this._default.width += dx;
          this._default.height += dy;
          this.updateState();
        };
        return GearSize;
      }(GearBase));
      var GearText = exports('GearText', /*#__PURE__*/function (_GearBase9) {
        _inheritsLoose(GearText, _GearBase9);
        function GearText() {
          return _GearBase9.apply(this, arguments) || this;
        }
        var _proto14 = GearText.prototype;
        _proto14.init = function init() {
          this._default = this._owner.text;
          this._storage = {};
        };
        _proto14.addStatus = function addStatus(pageId, buffer) {
          if (pageId == null) this._default = buffer.readS();else this._storage[pageId] = buffer.readS();
        };
        _proto14.apply = function apply() {
          this._owner._gearLocked = true;
          var data = this._storage[this._controller.selectedPageId];
          if (data !== undefined) this._owner.text = data;else this._owner.text = this._default;
          this._owner._gearLocked = false;
        };
        _proto14.updateState = function updateState() {
          this._storage[this._controller.selectedPageId] = this._owner.text;
        };
        return GearText;
      }(GearBase));
      var GearXY = exports('GearXY', /*#__PURE__*/function (_GearBase10) {
        _inheritsLoose(GearXY, _GearBase10);
        function GearXY() {
          return _GearBase10.apply(this, arguments) || this;
        }
        var _proto15 = GearXY.prototype;
        _proto15.init = function init() {
          this._default = {
            x: this._owner.x,
            y: this._owner.y,
            px: this._owner.x / this._owner.parent.width,
            py: this._owner.y / this._owner.parent.height
          };
          this._storage = {};
        };
        _proto15.addStatus = function addStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else {
            gv = {};
            this._storage[pageId] = gv;
          }
          gv.x = buffer.readInt();
          gv.y = buffer.readInt();
        };
        _proto15.addExtStatus = function addExtStatus(pageId, buffer) {
          var gv;
          if (!pageId) gv = this._default;else gv = this._storage[pageId];
          gv.px = buffer.readFloat();
          gv.py = buffer.readFloat();
        };
        _proto15.apply = function apply() {
          var pt = this._storage[this._controller.selectedPageId] || this._default;
          var ex;
          var ey;
          if (this.positionsInPercent && this._owner.parent) {
            ex = pt.px * this._owner.parent.width;
            ey = pt.py * this._owner.parent.height;
          } else {
            ex = pt.x;
            ey = pt.y;
          }
          if (this.allowTween) {
            if (this._tweenConfig._tweener) {
              if (this._tweenConfig._tweener.endValue.x != ex || this._tweenConfig._tweener.endValue.y != ey) {
                this._tweenConfig._tweener.kill(true);
                this._tweenConfig._tweener = null;
              } else return;
            }
            var ox = this._owner.x;
            var oy = this._owner.y;
            if (ox != ex || oy != ey) {
              if (this._owner.checkGearController(0, this._controller)) this._tweenConfig._displayLockToken = this._owner.addDisplayLock();
              this._tweenConfig._tweener = GTween.to2(ox, oy, ex, ey, this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate, this).onComplete(this.__tweenComplete, this);
            }
          } else {
            this._owner._gearLocked = true;
            this._owner.setPosition(ex, ey);
            this._owner._gearLocked = false;
          }
        };
        _proto15.__tweenUpdate = function __tweenUpdate(tweener) {
          this._owner._gearLocked = true;
          this._owner.setPosition(tweener.value.x, tweener.value.y);
          this._owner._gearLocked = false;
        };
        _proto15.__tweenComplete = function __tweenComplete() {
          if (this._tweenConfig._displayLockToken != 0) {
            this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken);
            this._tweenConfig._displayLockToken = 0;
          }
          this._tweenConfig._tweener = null;
        };
        _proto15.updateState = function updateState() {
          var pt = this._storage[this._controller.selectedPageId];
          if (!pt) {
            pt = {};
            this._storage[this._controller.selectedPageId] = pt;
          }
          pt.x = this._owner.x;
          pt.y = this._owner.y;
          pt.px = this._owner.x / this._owner.parent.width;
          pt.py = this._owner.y / this._owner.parent.height;
        };
        _proto15.updateFromRelations = function updateFromRelations(dx, dy) {
          if (this._controller == null || this._storage == null || this.positionsInPercent) return;
          for (var key in this._storage) {
            var pt = this._storage[key];
            pt.x += dx;
            pt.y += dy;
          }
          this._default.x += dx;
          this._default.y += dy;
          this.updateState();
        };
        return GearXY;
      }(GearBase));
      var RelationItem = /*#__PURE__*/function () {
        function RelationItem(owner) {
          this._owner = owner;
          this._defs = new Array();
        }
        var _proto16 = RelationItem.prototype;
        _proto16.add = function add(relationType, usePercent) {
          if (relationType == RelationType.Size) {
            this.add(RelationType.Width, usePercent);
            this.add(RelationType.Height, usePercent);
            return;
          }
          var length = this._defs.length;
          for (var i = 0; i < length; i++) {
            var def = this._defs[i];
            if (def.type == relationType) return;
          }
          this.internalAdd(relationType, usePercent);
        };
        _proto16.internalAdd = function internalAdd(relationType, usePercent) {
          if (relationType == RelationType.Size) {
            this.internalAdd(RelationType.Width, usePercent);
            this.internalAdd(RelationType.Height, usePercent);
            return;
          }
          var info = new RelationDef();
          info.percent = usePercent;
          info.type = relationType;
          info.axis = relationType <= RelationType.Right_Right || relationType == RelationType.Width || relationType >= RelationType.LeftExt_Left && relationType <= RelationType.RightExt_Right ? 0 : 1;
          this._defs.push(info);
        };
        _proto16.remove = function remove(relationType) {
          if (relationType == RelationType.Size) {
            this.remove(RelationType.Width);
            this.remove(RelationType.Height);
            return;
          }
          var dc = this._defs.length;
          for (var k = 0; k < dc; k++) {
            if (this._defs[k].type == relationType) {
              this._defs.splice(k, 1);
              break;
            }
          }
        };
        _proto16.copyFrom = function copyFrom(source) {
          this.target = source.target;
          this._defs.length = 0;
          var length = source._defs.length;
          for (var i = 0; i < length; i++) {
            var info = source._defs[i];
            var info2 = new RelationDef();
            info2.copyFrom(info);
            this._defs.push(info2);
          }
        };
        _proto16.dispose = function dispose() {
          if (this._target) {
            this.releaseRefTarget(this._target);
            this._target = null;
          }
        };
        _proto16.applyOnSelfResized = function applyOnSelfResized(dWidth, dHeight, applyPivot) {
          var ox = this._owner.x;
          var oy = this._owner.y;
          var length = this._defs.length;
          for (var i = 0; i < length; i++) {
            var info = this._defs[i];
            switch (info.type) {
              case RelationType.Center_Center:
                this._owner.x -= (0.5 - (applyPivot ? this._owner.pivotX : 0)) * dWidth;
                break;
              case RelationType.Right_Center:
              case RelationType.Right_Left:
              case RelationType.Right_Right:
                this._owner.x -= (1 - (applyPivot ? this._owner.pivotX : 0)) * dWidth;
                break;
              case RelationType.Middle_Middle:
                this._owner.y -= (0.5 - (applyPivot ? this._owner.pivotY : 0)) * dHeight;
                break;
              case RelationType.Bottom_Middle:
              case RelationType.Bottom_Top:
              case RelationType.Bottom_Bottom:
                this._owner.y -= (1 - (applyPivot ? this._owner.pivotY : 0)) * dHeight;
                break;
            }
          }
          if (ox != this._owner.x || oy != this._owner.y) {
            ox = this._owner.x - ox;
            oy = this._owner.y - oy;
            this._owner.updateGearFromRelations(1, ox, oy);
            if (this._owner.parent) {
              var len = this._owner.parent._transitions.length;
              if (len > 0) {
                for (var i = 0; i < len; ++i) {
                  this._owner.parent._transitions[i].updateFromRelations(this._owner.id, ox, oy);
                }
              }
            }
          }
        };
        _proto16.applyOnXYChanged = function applyOnXYChanged(info, dx, dy) {
          var tmp;
          switch (info.type) {
            case RelationType.Left_Left:
            case RelationType.Left_Center:
            case RelationType.Left_Right:
            case RelationType.Center_Center:
            case RelationType.Right_Left:
            case RelationType.Right_Center:
            case RelationType.Right_Right:
              this._owner.x += dx;
              break;
            case RelationType.Top_Top:
            case RelationType.Top_Middle:
            case RelationType.Top_Bottom:
            case RelationType.Middle_Middle:
            case RelationType.Bottom_Top:
            case RelationType.Bottom_Middle:
            case RelationType.Bottom_Bottom:
              this._owner.y += dy;
              break;
            case RelationType.Width:
            case RelationType.Height:
              break;
            case RelationType.LeftExt_Left:
            case RelationType.LeftExt_Right:
              if (this._owner != this._target.parent) {
                tmp = this._owner.xMin;
                this._owner.width = this._owner._rawWidth - dx;
                this._owner.xMin = tmp + dx;
              } else this._owner.width = this._owner._rawWidth - dx;
              break;
            case RelationType.RightExt_Left:
            case RelationType.RightExt_Right:
              if (this._owner != this._target.parent) {
                tmp = this._owner.xMin;
                this._owner.width = this._owner._rawWidth + dx;
                this._owner.xMin = tmp;
              } else this._owner.width = this._owner._rawWidth + dx;
              break;
            case RelationType.TopExt_Top:
            case RelationType.TopExt_Bottom:
              if (this._owner != this._target.parent) {
                tmp = this._owner.yMin;
                this._owner.height = this._owner._rawHeight - dy;
                this._owner.yMin = tmp + dy;
              } else this._owner.height = this._owner._rawHeight - dy;
              break;
            case RelationType.BottomExt_Top:
            case RelationType.BottomExt_Bottom:
              if (this._owner != this._target.parent) {
                tmp = this._owner.yMin;
                this._owner.height = this._owner._rawHeight + dy;
                this._owner.yMin = tmp;
              } else this._owner.height = this._owner._rawHeight + dy;
              break;
          }
        };
        _proto16.applyOnSizeChanged = function applyOnSizeChanged(info) {
          var pos = 0,
            pivot = 0,
            delta = 0;
          var v, tmp;
          if (info.axis == 0) {
            if (this._target != this._owner.parent) {
              pos = this._target.x;
              if (this._target.pivotAsAnchor) pivot = this._target.pivotX;
            }
            if (info.percent) {
              if (this._targetWidth != 0) delta = this._target._width / this._targetWidth;
            } else delta = this._target._width - this._targetWidth;
          } else {
            if (this._target != this._owner.parent) {
              pos = this._target.y;
              if (this._target.pivotAsAnchor) pivot = this._target.pivotY;
            }
            if (info.percent) {
              if (this._targetHeight != 0) delta = this._target._height / this._targetHeight;
            } else delta = this._target._height - this._targetHeight;
          }
          switch (info.type) {
            case RelationType.Left_Left:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin - pos) * delta;else if (pivot != 0) this._owner.x += delta * -pivot;
              break;
            case RelationType.Left_Center:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin - pos) * delta;else this._owner.x += delta * (0.5 - pivot);
              break;
            case RelationType.Left_Right:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin - pos) * delta;else this._owner.x += delta * (1 - pivot);
              break;
            case RelationType.Center_Center:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin + this._owner._rawWidth * 0.5 - pos) * delta - this._owner._rawWidth * 0.5;else this._owner.x += delta * (0.5 - pivot);
              break;
            case RelationType.Right_Left:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin + this._owner._rawWidth - pos) * delta - this._owner._rawWidth;else if (pivot != 0) this._owner.x += delta * -pivot;
              break;
            case RelationType.Right_Center:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin + this._owner._rawWidth - pos) * delta - this._owner._rawWidth;else this._owner.x += delta * (0.5 - pivot);
              break;
            case RelationType.Right_Right:
              if (info.percent) this._owner.xMin = pos + (this._owner.xMin + this._owner._rawWidth - pos) * delta - this._owner._rawWidth;else this._owner.x += delta * (1 - pivot);
              break;
            case RelationType.Top_Top:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin - pos) * delta;else if (pivot != 0) this._owner.y += delta * -pivot;
              break;
            case RelationType.Top_Middle:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin - pos) * delta;else this._owner.y += delta * (0.5 - pivot);
              break;
            case RelationType.Top_Bottom:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin - pos) * delta;else this._owner.y += delta * (1 - pivot);
              break;
            case RelationType.Middle_Middle:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin + this._owner._rawHeight * 0.5 - pos) * delta - this._owner._rawHeight * 0.5;else this._owner.y += delta * (0.5 - pivot);
              break;
            case RelationType.Bottom_Top:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin + this._owner._rawHeight - pos) * delta - this._owner._rawHeight;else if (pivot != 0) this._owner.y += delta * -pivot;
              break;
            case RelationType.Bottom_Middle:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin + this._owner._rawHeight - pos) * delta - this._owner._rawHeight;else this._owner.y += delta * (0.5 - pivot);
              break;
            case RelationType.Bottom_Bottom:
              if (info.percent) this._owner.yMin = pos + (this._owner.yMin + this._owner._rawHeight - pos) * delta - this._owner._rawHeight;else this._owner.y += delta * (1 - pivot);
              break;
            case RelationType.Width:
              if (this._owner._underConstruct && this._owner == this._target.parent) v = this._owner.sourceWidth - this._target.initWidth;else v = this._owner._rawWidth - this._targetWidth;
              if (info.percent) v = v * delta;
              if (this._target == this._owner.parent) {
                if (this._owner.pivotAsAnchor) {
                  tmp = this._owner.xMin;
                  this._owner.setSize(this._target._width + v, this._owner._rawHeight, true);
                  this._owner.xMin = tmp;
                } else this._owner.setSize(this._target._width + v, this._owner._rawHeight, true);
              } else this._owner.width = this._target._width + v;
              break;
            case RelationType.Height:
              if (this._owner._underConstruct && this._owner == this._target.parent) v = this._owner.sourceHeight - this._target.initHeight;else v = this._owner._rawHeight - this._targetHeight;
              if (info.percent) v = v * delta;
              if (this._target == this._owner.parent) {
                if (this._owner.pivotAsAnchor) {
                  tmp = this._owner.yMin;
                  this._owner.setSize(this._owner._rawWidth, this._target._height + v, true);
                  this._owner.yMin = tmp;
                } else this._owner.setSize(this._owner._rawWidth, this._target._height + v, true);
              } else this._owner.height = this._target._height + v;
              break;
            case RelationType.LeftExt_Left:
              tmp = this._owner.xMin;
              if (info.percent) v = pos + (tmp - pos) * delta - tmp;else v = delta * -pivot;
              this._owner.width = this._owner._rawWidth - v;
              this._owner.xMin = tmp + v;
              break;
            case RelationType.LeftExt_Right:
              tmp = this._owner.xMin;
              if (info.percent) v = pos + (tmp - pos) * delta - tmp;else v = delta * (1 - pivot);
              this._owner.width = this._owner._rawWidth - v;
              this._owner.xMin = tmp + v;
              break;
            case RelationType.RightExt_Left:
              tmp = this._owner.xMin;
              if (info.percent) v = pos + (tmp + this._owner._rawWidth - pos) * delta - (tmp + this._owner._rawWidth);else v = delta * -pivot;
              this._owner.width = this._owner._rawWidth + v;
              this._owner.xMin = tmp;
              break;
            case RelationType.RightExt_Right:
              tmp = this._owner.xMin;
              if (info.percent) {
                if (this._owner == this._target.parent) {
                  if (this._owner._underConstruct) this._owner.width = pos + this._target._width - this._target._width * pivot + (this._owner.sourceWidth - pos - this._target.initWidth + this._target.initWidth * pivot) * delta;else this._owner.width = pos + (this._owner._rawWidth - pos) * delta;
                } else {
                  v = pos + (tmp + this._owner._rawWidth - pos) * delta - (tmp + this._owner._rawWidth);
                  this._owner.width = this._owner._rawWidth + v;
                  this._owner.xMin = tmp;
                }
              } else {
                if (this._owner == this._target.parent) {
                  if (this._owner._underConstruct) this._owner.width = this._owner.sourceWidth + (this._target._width - this._target.initWidth) * (1 - pivot);else this._owner.width = this._owner._rawWidth + delta * (1 - pivot);
                } else {
                  v = delta * (1 - pivot);
                  this._owner.width = this._owner._rawWidth + v;
                  this._owner.xMin = tmp;
                }
              }
              break;
            case RelationType.TopExt_Top:
              tmp = this._owner.yMin;
              if (info.percent) v = pos + (tmp - pos) * delta - tmp;else v = delta * -pivot;
              this._owner.height = this._owner._rawHeight - v;
              this._owner.yMin = tmp + v;
              break;
            case RelationType.TopExt_Bottom:
              tmp = this._owner.yMin;
              if (info.percent) v = pos + (tmp - pos) * delta - tmp;else v = delta * (1 - pivot);
              this._owner.height = this._owner._rawHeight - v;
              this._owner.yMin = tmp + v;
              break;
            case RelationType.BottomExt_Top:
              tmp = this._owner.yMin;
              if (info.percent) v = pos + (tmp + this._owner._rawHeight - pos) * delta - (tmp + this._owner._rawHeight);else v = delta * -pivot;
              this._owner.height = this._owner._rawHeight + v;
              this._owner.yMin = tmp;
              break;
            case RelationType.BottomExt_Bottom:
              tmp = this._owner.yMin;
              if (info.percent) {
                if (this._owner == this._target.parent) {
                  if (this._owner._underConstruct) this._owner.height = pos + this._target._height - this._target._height * pivot + (this._owner.sourceHeight - pos - this._target.initHeight + this._target.initHeight * pivot) * delta;else this._owner.height = pos + (this._owner._rawHeight - pos) * delta;
                } else {
                  v = pos + (tmp + this._owner._rawHeight - pos) * delta - (tmp + this._owner._rawHeight);
                  this._owner.height = this._owner._rawHeight + v;
                  this._owner.yMin = tmp;
                }
              } else {
                if (this._owner == this._target.parent) {
                  if (this._owner._underConstruct) this._owner.height = this._owner.sourceHeight + (this._target._height - this._target.initHeight) * (1 - pivot);else this._owner.height = this._owner._rawHeight + delta * (1 - pivot);
                } else {
                  v = delta * (1 - pivot);
                  this._owner.height = this._owner._rawHeight + v;
                  this._owner.yMin = tmp;
                }
              }
              break;
          }
        };
        _proto16.addRefTarget = function addRefTarget(target) {
          if (target != this._owner.parent) target.on(Event.XY_CHANGED, this.__targetXYChanged, this);
          target.on(Event.SIZE_CHANGED, this.__targetSizeChanged, this);
          target.on(Event.SIZE_DELAY_CHANGE, this.__targetSizeWillChange, this);
          this._targetX = this._target.x;
          this._targetY = this._target.y;
          this._targetWidth = this._target._width;
          this._targetHeight = this._target._height;
        };
        _proto16.releaseRefTarget = function releaseRefTarget(target) {
          if (!target.node) return;
          target.off(Event.XY_CHANGED, this.__targetXYChanged, this);
          target.off(Event.SIZE_CHANGED, this.__targetSizeChanged, this);
          target.off(Event.SIZE_DELAY_CHANGE, this.__targetSizeWillChange, this);
        };
        _proto16.__targetXYChanged = function __targetXYChanged(evt) {
          if (this._owner.relations.handling != null || this._owner.group != null && this._owner.group._updating) {
            this._targetX = this._target.x;
            this._targetY = this._target.y;
            return;
          }
          this._owner.relations.handling = this._target;
          var ox = this._owner.x;
          var oy = this._owner.y;
          var dx = this._target.x - this._targetX;
          var dy = this._target.y - this._targetY;
          var length = this._defs.length;
          for (var i = 0; i < length; i++) {
            var info = this._defs[i];
            this.applyOnXYChanged(info, dx, dy);
          }
          this._targetX = this._target.x;
          this._targetY = this._target.y;
          if (ox != this._owner.x || oy != this._owner.y) {
            ox = this._owner.x - ox;
            oy = this._owner.y - oy;
            this._owner.updateGearFromRelations(1, ox, oy);
            if (this._owner.parent) {
              var len = this._owner.parent._transitions.length;
              if (len > 0) {
                for (var i = 0; i < len; ++i) {
                  this._owner.parent._transitions[i].updateFromRelations(this._owner.id, ox, oy);
                }
              }
            }
          }
          this._owner.relations.handling = null;
        };
        _proto16.__targetSizeChanged = function __targetSizeChanged(evt) {
          if (this._owner.relations.handling != null) return;
          this._owner.relations.handling = this._target;
          var ox = this._owner.x;
          var oy = this._owner.y;
          var ow = this._owner._rawWidth;
          var oh = this._owner._rawHeight;
          var length = this._defs.length;
          for (var i = 0; i < length; i++) {
            var info = this._defs[i];
            this.applyOnSizeChanged(info);
          }
          this._targetWidth = this._target._width;
          this._targetHeight = this._target._height;
          if (ox != this._owner.x || oy != this._owner.y) {
            ox = this._owner.x - ox;
            oy = this._owner.y - oy;
            this._owner.updateGearFromRelations(1, ox, oy);
            if (this._owner.parent) {
              var len = this._owner.parent._transitions.length;
              if (len > 0) {
                for (var i = 0; i < len; ++i) {
                  this._owner.parent._transitions[i].updateFromRelations(this._owner.id, ox, oy);
                }
              }
            }
          }
          if (ow != this._owner._rawWidth || oh != this._owner._rawHeight) {
            ow = this._owner._rawWidth - ow;
            oh = this._owner._rawHeight - oh;
            this._owner.updateGearFromRelations(2, ow, oh);
          }
          this._owner.relations.handling = null;
        };
        _proto16.__targetSizeWillChange = function __targetSizeWillChange(evt) {
          this._owner.relations.sizeDirty = true;
        };
        _createClass(RelationItem, [{
          key: "owner",
          get: function get() {
            return this._owner;
          }
        }, {
          key: "target",
          get: function get() {
            return this._target;
          },
          set: function set(value) {
            if (this._target != value) {
              if (this._target) this.releaseRefTarget(this._target);
              this._target = value;
              if (this._target) this.addRefTarget(this._target);
            }
          }
        }, {
          key: "isEmpty",
          get: function get() {
            return this._defs.length == 0;
          }
        }]);
        return RelationItem;
      }();
      var RelationDef = /*#__PURE__*/function () {
        function RelationDef() {
          this.percent = false;
          this.type = 0;
          this.axis = 0;
        }
        var _proto17 = RelationDef.prototype;
        _proto17.copyFrom = function copyFrom(source) {
          this.percent = source.percent;
          this.type = source.type;
          this.axis = source.axis;
        };
        return RelationDef;
      }();
      var Relations = /*#__PURE__*/function () {
        function Relations(owner) {
          this.sizeDirty = false;
          this._owner = owner;
          this._items = new Array();
        }
        var _proto18 = Relations.prototype;
        _proto18.add = function add(target, relationType, usePercent) {
          var length = this._items.length;
          for (var i = 0; i < length; i++) {
            var item = this._items[i];
            if (item.target == target) {
              item.add(relationType, usePercent);
              return;
            }
          }
          var newItem = new RelationItem(this._owner);
          newItem.target = target;
          newItem.add(relationType, usePercent);
          this._items.push(newItem);
        };
        _proto18.remove = function remove(target, relationType) {
          relationType = relationType || 0;
          var cnt = this._items.length;
          var i = 0;
          while (i < cnt) {
            var item = this._items[i];
            if (item.target == target) {
              item.remove(relationType);
              if (item.isEmpty) {
                item.dispose();
                this._items.splice(i, 1);
                cnt--;
              } else i++;
            } else i++;
          }
        };
        _proto18.contains = function contains(target) {
          var length = this._items.length;
          for (var i = 0; i < length; i++) {
            var item = this._items[i];
            if (item.target == target) return true;
          }
          return false;
        };
        _proto18.clearFor = function clearFor(target) {
          var cnt = this._items.length;
          var i = 0;
          while (i < cnt) {
            var item = this._items[i];
            if (item.target == target) {
              item.dispose();
              this._items.splice(i, 1);
              cnt--;
            } else i++;
          }
        };
        _proto18.clearAll = function clearAll() {
          var length = this._items.length;
          for (var i = 0; i < length; i++) {
            var item = this._items[i];
            item.dispose();
          }
          this._items.length = 0;
        };
        _proto18.copyFrom = function copyFrom(source) {
          this.clearAll();
          var arr = source._items;
          var length = arr.length;
          for (var i = 0; i < length; i++) {
            var ri = arr[i];
            var item = new RelationItem(this._owner);
            item.copyFrom(ri);
            this._items.push(item);
          }
        };
        _proto18.dispose = function dispose() {
          this.clearAll();
        };
        _proto18.onOwnerSizeChanged = function onOwnerSizeChanged(dWidth, dHeight, applyPivot) {
          if (this._items.length == 0) return;
          var length = this._items.length;
          for (var i = 0; i < length; i++) {
            var item = this._items[i];
            item.applyOnSelfResized(dWidth, dHeight, applyPivot);
          }
        };
        _proto18.ensureRelationsSizeCorrect = function ensureRelationsSizeCorrect() {
          if (this._items.length == 0) return;
          this.sizeDirty = false;
          var length = this._items.length;
          for (var i = 0; i < length; i++) {
            var item = this._items[i];
            item.target.ensureSizeCorrect();
          }
        };
        _proto18.setup = function setup(buffer, parentToChild) {
          var cnt = buffer.readByte();
          var target;
          for (var i = 0; i < cnt; i++) {
            var targetIndex = buffer.readShort();
            if (targetIndex == -1) target = this._owner.parent;else if (parentToChild) target = this._owner.getChildAt(targetIndex);else target = this._owner.parent.getChildAt(targetIndex);
            var newItem = new RelationItem(this._owner);
            newItem.target = target;
            this._items.push(newItem);
            var cnt2 = buffer.readByte();
            for (var j = 0; j < cnt2; j++) {
              var rt = buffer.readByte();
              var usePercent = buffer.readBool();
              newItem.internalAdd(rt, usePercent);
            }
          }
        };
        _createClass(Relations, [{
          key: "empty",
          get: function get() {
            return this._items.length == 0;
          }
        }]);
        return Relations;
      }();
      var UIConfig = exports('UIConfig', function UIConfig() {}); //Default font name
      UIConfig.defaultFont = "Arial"; //When a modal window is in front, the background becomes dark.
      UIConfig.modalLayerColor = new Color(0x33, 0x33, 0x33, 0x33);
      UIConfig.buttonSoundVolumeScale = 1; //Scrolling step in pixels
      UIConfig.defaultScrollStep = 25; //Deceleration ratio of scrollpane when its in touch dragging.
      UIConfig.defaultScrollDecelerationRate = 0.967; //Default scrollbar display mode. Recommened visible for Desktop and Auto for mobile.
      UIConfig.defaultScrollBarDisplay = ScrollBarDisplayType.Visible; //Allow dragging the content to scroll. Recommeded true for mobile.
      UIConfig.defaultScrollTouchEffect = true; //The "rebound" effect in the scolling container. Recommeded true for mobile.
      UIConfig.defaultScrollBounceEffect = true; //Max items displayed in combobox without scrolling.
      UIConfig.defaultComboBoxVisibleItemCount = 10; // Pixel offsets of finger to trigger scrolling.
      UIConfig.touchScrollSensitivity = 20; // Pixel offsets of finger to trigger dragging.
      UIConfig.touchDragSensitivity = 10; // Pixel offsets of mouse pointer to trigger dragging.
      UIConfig.clickDragSensitivity = 2; // When click the window, brings to front automatically.
      UIConfig.bringWindowToFrontOnClick = true;
      UIConfig.frameTimeForAsyncUIConstruction = 0.002;
      UIConfig.linkUnderline = true; //Default group name of UI node.<br/>
      UIConfig.defaultUILayer = Layers.Enum.UI_2D;
      var _fontRegistry = {};
      function registerFont(name, font, bundle) {
        if (font instanceof Font) _fontRegistry[name] = font;else {
          (bundle || resources).load(font || name, Font, function (err, asset) {
            _fontRegistry[name] = asset;
          });
        }
      }
      function getFontByName(name) {
        return _fontRegistry[name];
      }
      var GObject = exports('GObject', /*#__PURE__*/function () {
        function GObject() {
          this._x = 0;
          this._y = 0;
          this._alpha = 1;
          this._visible = true;
          this._touchable = true;
          this._skewX = 0;
          this._skewY = 0;
          this._sortingOrder = 0;
          this._internalVisible = true;
          this.sourceWidth = 0;
          this.sourceHeight = 0;
          this.initWidth = 0;
          this.initHeight = 0;
          this.minWidth = 0;
          this.minHeight = 0;
          this.maxWidth = 0;
          this.maxHeight = 0;
          this._width = 0;
          this._height = 0;
          this._rawWidth = 0;
          this._rawHeight = 0;
          this._underConstruct = false;
          this._sizePercentInGroup = 0;
          this._node = new Node();
          this._uiTrans = this._node.addComponent(UITransform);
          this._uiOpacity = this.node.addComponent(UIOpacity);
          this._node["$gobj"] = this;
          this._node.layer = UIConfig.defaultUILayer;
          this._uiTrans.setAnchorPoint(0, 1);
          this._node.on(Node.EventType.ANCHOR_CHANGED, this.handleAnchorChanged, this);
          this._id = this._node.uuid;
          this._name = "";
          this._relations = new Relations(this);
          this._gears = new Array(10);
          this._blendMode = BlendMode.Normal;
          this._partner = this._node.addComponent(GObjectPartner);
        }
        var _proto19 = GObject.prototype;
        _proto19.setPosition = function setPosition(xv, yv) {
          if (this._x != xv || this._y != yv) {
            var dx = xv - this._x;
            var dy = yv - this._y;
            this._x = xv;
            this._y = yv;
            this.handlePositionChanged();
            if (this instanceof GGroup) this.moveChildren(dx, dy);
            this.updateGear(1);
            if (this._parent && !("setVirtual" in this._parent) /*not list*/) {
              this._parent.setBoundsChangedFlag();
              if (this._group) this._group.setBoundsChangedFlag(true);
              this._node.emit(Event.XY_CHANGED, this);
            }
            if (GObject.draggingObject == this && !s_dragging) this.localToGlobalRect(0, 0, this._width, this._height, sGlobalRect);
          }
        };
        _proto19.center = function center(restraint) {
          var r;
          if (this._parent) r = this.parent;else r = Decls$1.GRoot.inst;
          this.setPosition((r.width - this._width) / 2, (r.height - this._height) / 2);
          if (restraint) {
            this.addRelation(r, RelationType.Center_Center);
            this.addRelation(r, RelationType.Middle_Middle);
          }
        };
        _proto19.setSize = function setSize(wv, hv, ignorePivot) {
          if (this._rawWidth != wv || this._rawHeight != hv) {
            this._rawWidth = wv;
            this._rawHeight = hv;
            if (wv < this.minWidth) wv = this.minWidth;
            if (hv < this.minHeight) hv = this.minHeight;
            if (this.maxWidth > 0 && wv > this.maxWidth) wv = this.maxWidth;
            if (this.maxHeight > 0 && hv > this.maxHeight) hv = this.maxHeight;
            var dWidth = wv - this._width;
            var dHeight = hv - this._height;
            this._width = wv;
            this._height = hv;
            this.handleSizeChanged();
            if ((this._uiTrans.anchorX != 0 || this._uiTrans.anchorY != 1) && !this._pivotAsAnchor && !ignorePivot) this.setPosition(this.x - this._uiTrans.anchorX * dWidth, this.y - (1 - this._uiTrans.anchorY) * dHeight);else this.handlePositionChanged();
            if (this instanceof GGroup) this.resizeChildren(dWidth, dHeight);
            this.updateGear(2);
            if (this._parent) {
              this._relations.onOwnerSizeChanged(dWidth, dHeight, this._pivotAsAnchor || !ignorePivot);
              this._parent.setBoundsChangedFlag();
              if (this._group) this._group.setBoundsChangedFlag();
            }
            this._node.emit(Event.SIZE_CHANGED, this);
          }
        };
        _proto19.makeFullScreen = function makeFullScreen() {
          this.setSize(Decls$1.GRoot.inst.width, Decls$1.GRoot.inst.height);
        };
        _proto19.ensureSizeCorrect = function ensureSizeCorrect() {};
        _proto19.setScale = function setScale(sx, sy) {
          if (this._node.scale.x != sx || this._node.scale.y != sy) {
            this._node.setScale(sx, sy);
            this.updateGear(2);
          }
        };
        _proto19.setPivot = function setPivot(xv, yv, asAnchor) {
          if (this._uiTrans.anchorX != xv || this._uiTrans.anchorY != 1 - yv) {
            this._pivotAsAnchor = asAnchor;
            this._uiTrans.setAnchorPoint(xv, 1 - yv);
          } else if (this._pivotAsAnchor != asAnchor) {
            this._pivotAsAnchor = asAnchor;
            this.handlePositionChanged();
          }
        };
        _proto19.requestFocus = function requestFocus() {};
        _proto19.getGear = function getGear(index) {
          var gear = this._gears[index];
          if (!gear) this._gears[index] = gear = createGear(this, index);
          return gear;
        };
        _proto19.updateGear = function updateGear(index) {
          if (this._underConstruct || this._gearLocked) return;
          var gear = this._gears[index];
          if (gear && gear.controller) gear.updateState();
        };
        _proto19.checkGearController = function checkGearController(index, c) {
          return this._gears[index] && this._gears[index].controller == c;
        };
        _proto19.updateGearFromRelations = function updateGearFromRelations(index, dx, dy) {
          if (this._gears[index]) this._gears[index].updateFromRelations(dx, dy);
        };
        _proto19.addDisplayLock = function addDisplayLock() {
          var gearDisplay = this._gears[0];
          if (gearDisplay && gearDisplay.controller) {
            var ret = gearDisplay.addLock();
            this.checkGearDisplay();
            return ret;
          } else return 0;
        };
        _proto19.releaseDisplayLock = function releaseDisplayLock(token) {
          var gearDisplay = this._gears[0];
          if (gearDisplay && gearDisplay.controller) {
            gearDisplay.releaseLock(token);
            this.checkGearDisplay();
          }
        };
        _proto19.checkGearDisplay = function checkGearDisplay() {
          if (this._handlingController) return;
          var connected = this._gears[0] == null || this._gears[0].connected;
          if (this._gears[8]) connected = this._gears[8].evaluate(connected);
          if (connected != this._internalVisible) {
            this._internalVisible = connected;
            this.handleVisibleChanged();
            if (this._group && this._group.excludeInvisibles) this._group.setBoundsChangedFlag();
          }
        };
        _proto19.addRelation = function addRelation(target, relationType, usePercent) {
          this._relations.add(target, relationType, usePercent);
        };
        _proto19.removeRelation = function removeRelation(target, relationType) {
          this._relations.remove(target, relationType);
        };
        _proto19.removeFromParent = function removeFromParent() {
          if (this._parent) this._parent.removeChild(this);
        };
        _proto19.findParent = function findParent() {
          if (this._parent) return this._parent; //childrennode
          var pn = this._node.parent;
          while (pn) {
            var gobj = pn["$gobj"];
            if (gobj) return gobj;
            pn = pn.parent;
          }
          return null;
        };
        GObject.cast = function cast(obj) {
          return obj["$gobj"];
        };
        _proto19.dispose = function dispose() {
          var n = this._node;
          if (!n) return;
          this.removeFromParent();
          this._relations.dispose();
          this._node = null;
          n.destroy();
          for (var i = 0; i < 10; i++) {
            var gear = this._gears[i];
            if (gear) gear.dispose();
          }
        };
        _proto19.onEnable = function onEnable() {};
        _proto19.onDisable = function onDisable() {};
        _proto19.onUpdate = function onUpdate() {};
        _proto19.onDestroy = function onDestroy() {};
        _proto19.onClick = function onClick(listener, target) {
          this._node.on(Event.CLICK, listener, target);
        };
        _proto19.onceClick = function onceClick(listener, target) {
          this._node.once(Event.CLICK, listener, target);
        };
        _proto19.offClick = function offClick(listener, target) {
          this._node.off(Event.CLICK, listener, target);
        };
        _proto19.clearClick = function clearClick() {
          this._node.off(Event.CLICK);
        };
        _proto19.hasClickListener = function hasClickListener() {
          return this._node.hasEventListener(Event.CLICK);
        };
        _proto19.on = function on(type, listener, target) {
          if (type == Event.DISPLAY || type == Event.UNDISPLAY) this._partner._emitDisplayEvents = true;
          this._node.on(type, listener, target);
        };
        _proto19.once = function once(type, listener, target) {
          if (type == Event.DISPLAY || type == Event.UNDISPLAY) this._partner._emitDisplayEvents = true;
          this._node.once(type, listener, target);
        };
        _proto19.off = function off(type, listener, target) {
          this._node.off(type, listener, target);
        };
        _proto19.startDrag = function startDrag(touchId) {
          if (!this._node.activeInHierarchy) return;
          this.dragBegin(touchId);
        };
        _proto19.stopDrag = function stopDrag() {
          this.dragEnd();
        };
        _proto19.localToGlobal = function localToGlobal(ax, ay, result) {
          ax = ax || 0;
          ay = ay || 0;
          s_vec3$1.x = ax;
          s_vec3$1.y = -ay;
          if (!this._pivotAsAnchor) {
            s_vec3$1.x -= this._uiTrans.anchorX * this._width;
            s_vec3$1.y += (1 - this._uiTrans.anchorY) * this._height;
          }
          this._uiTrans.convertToWorldSpaceAR(s_vec3$1, s_vec3$1);
          s_vec3$1.y = Decls$1.GRoot.inst.height - s_vec3$1.y;
          result = result || new Vec2();
          result.x = s_vec3$1.x;
          result.y = s_vec3$1.y;
          return result;
        };
        _proto19.globalToLocal = function globalToLocal(ax, ay, result) {
          ax = ax || 0;
          ay = ay || 0;
          s_vec3$1.x = ax;
          s_vec3$1.y = Decls$1.GRoot.inst.height - ay;
          this._uiTrans.convertToNodeSpaceAR(s_vec3$1, s_vec3$1);
          if (!this._pivotAsAnchor) {
            s_vec3$1.x += this._uiTrans.anchorX * this._width;
            s_vec3$1.y -= (1 - this._uiTrans.anchorY) * this._height;
          }
          result = result || new Vec2();
          result.x = s_vec3$1.x;
          result.y = -s_vec3$1.y;
          return result;
        };
        _proto19.localToGlobalRect = function localToGlobalRect(ax, ay, aw, ah, result) {
          ax = ax || 0;
          ay = ay || 0;
          aw = aw || 0;
          ah = ah || 0;
          result = result || new Rect();
          var pt = this.localToGlobal(ax, ay);
          result.x = pt.x;
          result.y = pt.y;
          pt = this.localToGlobal(ax + aw, ay + ah, pt);
          result.xMax = pt.x;
          result.yMax = pt.y;
          return result;
        };
        _proto19.globalToLocalRect = function globalToLocalRect(ax, ay, aw, ah, result) {
          ax = ax || 0;
          ay = ay || 0;
          aw = aw || 0;
          ah = ah || 0;
          result = result || new Rect();
          var pt = this.globalToLocal(ax, ay);
          result.x = pt.x;
          result.y = pt.y;
          pt = this.globalToLocal(ax + aw, ay + ah, pt);
          result.xMax = pt.x;
          result.yMax = pt.y;
          return result;
        };
        _proto19.handleControllerChanged = function handleControllerChanged(c) {
          this._handlingController = true;
          for (var i = 0; i < 10; i++) {
            var gear = this._gears[i];
            if (gear && gear.controller == c) gear.apply();
          }
          this._handlingController = false;
          this.checkGearDisplay();
        };
        _proto19.handleAnchorChanged = function handleAnchorChanged() {
          this.handlePositionChanged();
        };
        _proto19.handlePositionChanged = function handlePositionChanged() {
          var xv = this._x;
          var yv = -this._y;
          if (!this._pivotAsAnchor) {
            xv += this._uiTrans.anchorX * this._width;
            yv -= (1 - this._uiTrans.anchorY) * this._height;
          }
          if (this._pixelSnapping) {
            xv = Math.round(xv);
            yv = Math.round(yv);
          }
          this._node.setPosition(xv, yv);
        };
        _proto19.handleSizeChanged = function handleSizeChanged() {
          this._uiTrans.setContentSize(this._width, this._height);
        };
        _proto19.handleGrayedChanged = function handleGrayedChanged() {//nothing is base
        };
        _proto19.handleVisibleChanged = function handleVisibleChanged() {
          this._node.active = this._finalVisible;
          if (this instanceof GGroup) this.handleVisibleChanged();
          if (this._parent) this._parent.setBoundsChangedFlag();
        };
        _proto19.hitTest = function hitTest(globalPt, forTouch) {
          if (forTouch == null) forTouch = true;
          if (forTouch && (this._touchDisabled || !this._touchable || !this._node.activeInHierarchy)) return null;
          if (!this._hitTestPt) this._hitTestPt = new Vec2();
          this.globalToLocal(globalPt.x, globalPt.y, this._hitTestPt);
          if (this._pivotAsAnchor) {
            this._hitTestPt.x += this._uiTrans.anchorX * this._width;
            this._hitTestPt.y += (1 - this._uiTrans.anchorY) * this._height;
          }
          return this._hitTest(this._hitTestPt, globalPt);
        };
        _proto19._hitTest = function _hitTest(pt, globalPt) {
          if (pt.x >= 0 && pt.y >= 0 && pt.x < this._width && pt.y < this._height) return this;else return null;
        };
        _proto19.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Text:
              return this.text;
            case ObjectPropID.Icon:
              return this.icon;
            case ObjectPropID.Color:
              return null;
            case ObjectPropID.OutlineColor:
              return null;
            case ObjectPropID.Playing:
              return false;
            case ObjectPropID.Frame:
              return 0;
            case ObjectPropID.DeltaTime:
              return 0;
            case ObjectPropID.TimeScale:
              return 1;
            case ObjectPropID.FontSize:
              return 0;
            case ObjectPropID.Selected:
              return false;
            default:
              return undefined;
          }
        };
        _proto19.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Text:
              this.text = value;
              break;
            case ObjectPropID.Icon:
              this.icon = value;
              break;
          }
        };
        _proto19.constructFromResource = function constructFromResource() {};
        _proto19.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          buffer.seek(beginPos, 0);
          buffer.skip(5);
          var f1;
          var f2;
          this._id = buffer.readS();
          this.name = buffer.readS();
          f1 = buffer.readInt();
          f2 = buffer.readInt();
          this.setPosition(f1, f2);
          if (buffer.readBool()) {
            this.initWidth = buffer.readInt();
            this.initHeight = buffer.readInt();
            this.setSize(this.initWidth, this.initHeight, true);
          }
          if (buffer.readBool()) {
            this.minWidth = buffer.readInt();
            this.maxWidth = buffer.readInt();
            this.minHeight = buffer.readInt();
            this.maxHeight = buffer.readInt();
          }
          if (buffer.readBool()) {
            f1 = buffer.readFloat();
            f2 = buffer.readFloat();
            this.setScale(f1, f2);
          }
          if (buffer.readBool()) {
            f1 = buffer.readFloat();
            f2 = buffer.readFloat(); //this.setSkew(f1, f2);
          }
          if (buffer.readBool()) {
            f1 = buffer.readFloat();
            f2 = buffer.readFloat();
            this.setPivot(f1, f2, buffer.readBool());
          }
          f1 = buffer.readFloat();
          if (f1 != 1) this.alpha = f1;
          f1 = buffer.readFloat();
          if (f1 != 0) this.rotation = f1;
          if (!buffer.readBool()) this.visible = false;
          if (!buffer.readBool()) this.touchable = false;
          if (buffer.readBool()) this.grayed = true;
          this.blendMode = buffer.readByte();
          buffer.readByte();
          var str = buffer.readS();
          if (str != null) this.data = str;
        };
        _proto19.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          buffer.seek(beginPos, 1);
          var str = buffer.readS();
          if (str != null) this.tooltips = str;
          var groupId = buffer.readShort();
          if (groupId >= 0) this.group = this.parent.getChildAt(groupId);
          buffer.seek(beginPos, 2);
          var cnt = buffer.readShort();
          for (var i = 0; i < cnt; i++) {
            var nextPos = buffer.readShort();
            nextPos += buffer.position;
            var gear = this.getGear(buffer.readByte());
            gear.setup(buffer);
            buffer.position = nextPos;
          }
        } //toolTips support
        ;
        _proto19.onRollOver = function onRollOver() {
          Decls$1.GRoot.inst.showTooltips(this.tooltips);
        };
        _proto19.onRollOut = function onRollOut() {
          Decls$1.GRoot.inst.hideTooltips();
        }; //drag support
        //-------------------------------------------------------------------
        _proto19.initDrag = function initDrag() {
          if (this._draggable) {
            this.on(Event.TOUCH_BEGIN, this.onTouchBegin_0, this);
            this.on(Event.TOUCH_MOVE, this.onTouchMove_0, this);
            this.on(Event.TOUCH_END, this.onTouchEnd_0, this);
          } else {
            this.off(Event.TOUCH_BEGIN, this.onTouchBegin_0, this);
            this.off(Event.TOUCH_MOVE, this.onTouchMove_0, this);
            this.off(Event.TOUCH_END, this.onTouchEnd_0, this);
          }
        };
        _proto19.dragBegin = function dragBegin(touchId) {
          if (GObject.draggingObject) {
            var tmp = GObject.draggingObject;
            tmp.stopDrag();
            GObject.draggingObject = null;
            tmp._node.emit(Event.DRAG_END);
          }
          if (touchId == undefined) touchId = Decls$1.GRoot.inst.inputProcessor.getAllTouches()[0];
          sGlobalDragStart.set(Decls$1.GRoot.inst.getTouchPosition(touchId));
          this.localToGlobalRect(0, 0, this._width, this._height, sGlobalRect);
          GObject.draggingObject = this;
          this._dragTesting = false;
          Decls$1.GRoot.inst.inputProcessor.addTouchMonitor(touchId, this);
          this.on(Event.TOUCH_MOVE, this.onTouchMove_0, this);
          this.on(Event.TOUCH_END, this.onTouchEnd_0, this);
        };
        _proto19.dragEnd = function dragEnd() {
          if (GObject.draggingObject == this) {
            this._dragTesting = false;
            GObject.draggingObject = null;
          }
          s_dragQuery = false;
        };
        _proto19.onTouchBegin_0 = function onTouchBegin_0(evt) {
          if (this._dragStartPos == null) this._dragStartPos = new Vec2();
          this._dragStartPos.set(evt.pos);
          this._dragTesting = true;
          evt.captureTouch();
        };
        _proto19.onTouchMove_0 = function onTouchMove_0(evt) {
          if (GObject.draggingObject != this && this._draggable && this._dragTesting) {
            var sensitivity = UIConfig.touchDragSensitivity;
            if (this._dragStartPos && Math.abs(this._dragStartPos.x - evt.pos.x) < sensitivity && Math.abs(this._dragStartPos.y - evt.pos.y) < sensitivity) return;
            this._dragTesting = false;
            s_dragQuery = true;
            this._node.emit(Event.DRAG_START, evt);
            if (s_dragQuery) this.dragBegin(evt.touchId);
          }
          if (GObject.draggingObject == this) {
            var xx = evt.pos.x - sGlobalDragStart.x + sGlobalRect.x;
            var yy = evt.pos.y - sGlobalDragStart.y + sGlobalRect.y;
            if (this._dragBounds) {
              var rect = Decls$1.GRoot.inst.localToGlobalRect(this._dragBounds.x, this._dragBounds.y, this._dragBounds.width, this._dragBounds.height, s_rect$1);
              if (xx < rect.x) xx = rect.x;else if (xx + sGlobalRect.width > rect.xMax) {
                xx = rect.xMax - sGlobalRect.width;
                if (xx < rect.x) xx = rect.x;
              }
              if (yy < rect.y) yy = rect.y;else if (yy + sGlobalRect.height > rect.yMax) {
                yy = rect.yMax - sGlobalRect.height;
                if (yy < rect.y) yy = rect.y;
              }
            }
            s_dragging = true;
            var pt = this.parent.globalToLocal(xx, yy, s_vec2$4);
            this.setPosition(Math.round(pt.x), Math.round(pt.y));
            s_dragging = false;
            this._node.emit(Event.DRAG_MOVE, evt);
          }
        };
        _proto19.onTouchEnd_0 = function onTouchEnd_0(evt) {
          if (GObject.draggingObject == this) {
            GObject.draggingObject = null;
            this._node.emit(Event.DRAG_END, evt);
          }
        } /** */;
        _proto19.Get = function Get(type) {
          return this.node.getComponent(type);
        };
        _createClass(GObject, [{
          key: "id",
          get: function get() {
            return this._id;
          }
        }, {
          key: "name",
          get: function get() {
            return this._name;
          },
          set: function set(value) {
            this._name = value;
            this._node.name = value || "";
          }
        }, {
          key: "x",
          get: function get() {
            return this._x;
          },
          set: function set(value) {
            this.setPosition(value, this._y);
          }
        }, {
          key: "y",
          get: function get() {
            return this._y;
          },
          set: function set(value) {
            this.setPosition(this._x, value);
          }
        }, {
          key: "xMin",
          get: function get() {
            return this._pivotAsAnchor ? this._x - this._width * this._uiTrans.anchorX : this._x;
          },
          set: function set(value) {
            if (this._pivotAsAnchor) this.setPosition(value + this._width * this._uiTrans.anchorX, this._y);else this.setPosition(value, this._y);
          }
        }, {
          key: "yMin",
          get: function get() {
            return this._pivotAsAnchor ? this._y - this._height * (1 - this._uiTrans.anchorY) : this._y;
          },
          set: function set(value) {
            if (this._pivotAsAnchor) this.setPosition(this._x, value + this._height * (1 - this._uiTrans.anchorY));else this.setPosition(this._x, value);
          }
        }, {
          key: "pixelSnapping",
          get: function get() {
            return this._pixelSnapping;
          },
          set: function set(value) {
            if (this._pixelSnapping != value) {
              this._pixelSnapping = value;
              this.handlePositionChanged();
            }
          }
        }, {
          key: "width",
          get: function get() {
            this.ensureSizeCorrect();
            if (this._relations.sizeDirty) this._relations.ensureRelationsSizeCorrect();
            return this._width;
          },
          set: function set(value) {
            this.setSize(value, this._rawHeight);
          }
        }, {
          key: "height",
          get: function get() {
            this.ensureSizeCorrect();
            if (this._relations.sizeDirty) this._relations.ensureRelationsSizeCorrect();
            return this._height;
          },
          set: function set(value) {
            this.setSize(this._rawWidth, value);
          }
        }, {
          key: "actualWidth",
          get: function get() {
            return this.width * Math.abs(this._node.scale.x);
          }
        }, {
          key: "actualHeight",
          get: function get() {
            return this.height * Math.abs(this._node.scale.y);
          }
        }, {
          key: "scaleX",
          get: function get() {
            return this._node.scale.x;
          },
          set: function set(value) {
            this.setScale(value, this._node.scale.y);
          }
        }, {
          key: "scaleY",
          get: function get() {
            return this._node.scale.y;
          },
          set: function set(value) {
            this.setScale(this._node.scale.x, value);
          }
        }, {
          key: "skewX",
          get: function get() {
            return this._skewX;
          }
        }, {
          key: "pivotX",
          get: function get() {
            return this._uiTrans.anchorX;
          },
          set: function set(value) {
            this._uiTrans.anchorX = value;
          }
        }, {
          key: "pivotY",
          get: function get() {
            return 1 - this._uiTrans.anchorY;
          },
          set: function set(value) {
            this._uiTrans.anchorY = 1 - value;
          }
        }, {
          key: "pivotAsAnchor",
          get: function get() {
            return this._pivotAsAnchor;
          }
        }, {
          key: "touchable",
          get: function get() {
            return this._touchable;
          },
          set: function set(value) {
            if (this._touchable != value) {
              this._touchable = value;
              this.updateGear(3);
            }
          }
        }, {
          key: "grayed",
          get: function get() {
            return this._grayed;
          },
          set: function set(value) {
            if (this._grayed != value) {
              this._grayed = value;
              this.handleGrayedChanged();
              this.updateGear(3);
            }
          }
        }, {
          key: "enabled",
          get: function get() {
            return !this._grayed && this._touchable;
          },
          set: function set(value) {
            this.grayed = !value;
            this.touchable = value;
          }
        }, {
          key: "rotation",
          get: function get() {
            return -this._node.angle;
          },
          set: function set(value) {
            value = -value;
            if (this._node.angle != value) {
              this._node.angle = value;
              this.updateGear(3);
            }
          }
        }, {
          key: "alpha",
          get: function get() {
            return this._alpha;
          },
          set: function set(value) {
            if (this._alpha != value) {
              this._alpha = value;
              this._uiOpacity.opacity = this._alpha * 255;
              if (this instanceof GGroup) this.handleAlphaChanged();
              this.updateGear(3);
            }
          }
        }, {
          key: "visible",
          get: function get() {
            return this._visible;
          },
          set: function set(value) {
            if (this._visible != value) {
              this._visible = value;
              this.handleVisibleChanged();
              if (this._group && this._group.excludeInvisibles) this._group.setBoundsChangedFlag();
            }
          }
        }, {
          key: "_finalVisible",
          get: function get() {
            return this._visible && this._internalVisible && (!this._group || this._group._finalVisible);
          }
        }, {
          key: "internalVisible3",
          get: function get() {
            return this._visible && this._internalVisible;
          }
        }, {
          key: "sortingOrder",
          get: function get() {
            return this._sortingOrder;
          },
          set: function set(value) {
            if (value < 0) value = 0;
            if (this._sortingOrder != value) {
              var old = this._sortingOrder;
              this._sortingOrder = value;
              if (this._parent) this._parent.childSortingOrderChanged(this, old, this._sortingOrder);
            }
          }
        }, {
          key: "tooltips",
          get: function get() {
            return this._tooltips;
          },
          set: function set(value) {
            if (this._tooltips) {
              this._node.off(Event.ROLL_OVER, this.onRollOver, this);
              this._node.off(Event.ROLL_OUT, this.onRollOut, this);
            }
            this._tooltips = value;
            if (this._tooltips) {
              this._node.on(Event.ROLL_OVER, this.onRollOver, this);
              this._node.on(Event.ROLL_OUT, this.onRollOut, this);
            }
          }
        }, {
          key: "blendMode",
          get: function get() {
            return this._blendMode;
          },
          set: function set(value) {
            if (this._blendMode != value) {
              this._blendMode = value;
              BlendModeUtils.apply(this._node, value);
            }
          }
        }, {
          key: "onStage",
          get: function get() {
            return this._node && this._node.activeInHierarchy;
          }
        }, {
          key: "resourceURL",
          get: function get() {
            if (this.packageItem) return "ui://" + this.packageItem.owner.id + this.packageItem.id;else return null;
          }
        }, {
          key: "group",
          get: function get() {
            return this._group;
          },
          set: function set(value) {
            if (this._group != value) {
              if (this._group) this._group.setBoundsChangedFlag();
              this._group = value;
              if (this._group) this._group.setBoundsChangedFlag();
            }
          }
        }, {
          key: "gearXY",
          get: function get() {
            return this.getGear(1);
          }
        }, {
          key: "gearSize",
          get: function get() {
            return this.getGear(2);
          }
        }, {
          key: "gearLook",
          get: function get() {
            return this.getGear(3);
          }
        }, {
          key: "relations",
          get: function get() {
            return this._relations;
          }
        }, {
          key: "node",
          get: function get() {
            return this._node;
          }
        }, {
          key: "parent",
          get: function get() {
            return this._parent;
          }
        }, {
          key: "asCom",
          get: function get() {
            return this;
          }
        }, {
          key: "text",
          get: function get() {
            return null;
          },
          set: function set(value) {}
        }, {
          key: "icon",
          get: function get() {
            return null;
          },
          set: function set(value) {}
        }, {
          key: "treeNode",
          get: function get() {
            return this._treeNode;
          }
        }, {
          key: "isDisposed",
          get: function get() {
            return this._node == null;
          }
        }, {
          key: "draggable",
          get: function get() {
            return this._draggable;
          },
          set: function set(value) {
            if (this._draggable != value) {
              this._draggable = value;
              this.initDrag();
            }
          }
        }, {
          key: "dragBounds",
          get: function get() {
            return this._dragBounds;
          },
          set: function set(value) {
            this._dragBounds = value;
          }
        }, {
          key: "dragging",
          get: function get() {
            return GObject.draggingObject == this;
          }
        }]);
        return GObject;
      }()); //-------------------------------------------------------------------
      var GObjectPartner = /*#__PURE__*/function (_Component) {
        _inheritsLoose(GObjectPartner, _Component);
        function GObjectPartner() {
          return _Component.apply(this, arguments) || this;
        }
        var _proto20 = GObjectPartner.prototype;
        _proto20.callLater = function callLater(callback, delay) {
          if (!director.getScheduler().isScheduled(callback, this)) this.scheduleOnce(callback, delay);
        };
        _proto20.onClickLink = function onClickLink(evt, text) {
          this.node.emit(Event.LINK, text, evt);
        };
        _proto20.onEnable = function onEnable() {
          this.node["$gobj"].onEnable();
          if (this._emitDisplayEvents) this.node.emit(Event.DISPLAY);
        };
        _proto20.onDisable = function onDisable() {
          this.node["$gobj"].onDisable();
          if (this._emitDisplayEvents) this.node.emit(Event.UNDISPLAY);
        };
        _proto20.update = function update(dt) {
          this.node["$gobj"].onUpdate(dt);
        };
        _proto20.onDestroy = function onDestroy() {
          this.node["$gobj"].onDestroy();
        };
        return GObjectPartner;
      }(Component); //-------------------------------------------------------------------
      var GearClasses = [GearDisplay, GearXY, GearSize, GearLook, GearColor, GearAnimation, GearText, GearIcon, GearDisplay2, GearFontSize];
      function createGear(owner, index) {
        var ret = new GearClasses[index]();
        ret._owner = owner;
        return ret;
      }
      var s_vec2$4 = new Vec2();
      var s_vec3$1 = new Vec3();
      var s_rect$1 = new Rect();
      var sGlobalDragStart = new Vec2();
      var sGlobalRect = new Rect();
      var s_dragging;
      var s_dragQuery;
      var Decls$1 = {};
      var constructingDepth = {
        n: 0
      };
      var GGroup = exports('GGroup', /*#__PURE__*/function (_GObject) {
        _inheritsLoose(GGroup, _GObject);
        function GGroup() {
          var _this5;
          _this5 = _GObject.call(this) || this;
          _this5._layout = 0;
          _this5._lineGap = 0;
          _this5._columnGap = 0;
          _this5._mainGridIndex = -1;
          _this5._mainGridMinSize = 50;
          _this5._mainChildIndex = -1;
          _this5._totalSize = 0;
          _this5._numChildren = 0;
          _this5._updating = 0;
          _this5._node.name = "GGroup";
          _this5._touchDisabled = true;
          return _this5;
        }
        var _proto21 = GGroup.prototype;
        _proto21.dispose = function dispose() {
          this._boundsChanged = false;
          _GObject.prototype.dispose.call(this);
        };
        _proto21.setBoundsChangedFlag = function setBoundsChangedFlag(positionChangedOnly) {
          if (positionChangedOnly === void 0) {
            positionChangedOnly = false;
          }
          if (this._updating == 0 && this._parent) {
            if (!positionChangedOnly) this._percentReady = false;
            if (!this._boundsChanged) {
              this._boundsChanged = true;
              if (this._layout != GroupLayoutType.None) this._partner.callLater(this._ensureBoundsCorrect);
            }
          }
        };
        _proto21._ensureBoundsCorrect = function _ensureBoundsCorrect() {
          var _t = GObject.cast(this.node);
          _t.ensureBoundsCorrect();
        };
        _proto21.ensureSizeCorrect = function ensureSizeCorrect() {
          if (this._parent == null || !this._boundsChanged || this._layout == 0) return;
          this._boundsChanged = false;
          if (this._autoSizeDisabled) this.resizeChildren(0, 0);else {
            this.handleLayout();
            this.updateBounds();
          }
        };
        _proto21.ensureBoundsCorrect = function ensureBoundsCorrect() {
          if (this._parent == null || !this._boundsChanged) return;
          this._boundsChanged = false;
          if (this._layout == 0) this.updateBounds();else {
            if (this._autoSizeDisabled) this.resizeChildren(0, 0);else {
              this.handleLayout();
              this.updateBounds();
            }
          }
        };
        _proto21.updateBounds = function updateBounds() {
          this._partner.unschedule(this._ensureBoundsCorrect);
          var cnt = this._parent.numChildren;
          var i;
          var child;
          var ax = Number.POSITIVE_INFINITY,
            ay = Number.POSITIVE_INFINITY;
          var ar = Number.NEGATIVE_INFINITY,
            ab = Number.NEGATIVE_INFINITY;
          var tmp;
          var empty = true;
          for (i = 0; i < cnt; i++) {
            child = this._parent.getChildAt(i);
            if (child.group != this || this._excludeInvisibles && !child.internalVisible3) continue;
            tmp = child.xMin;
            if (tmp < ax) ax = tmp;
            tmp = child.yMin;
            if (tmp < ay) ay = tmp;
            tmp = child.xMin + child.width;
            if (tmp > ar) ar = tmp;
            tmp = child.yMin + child.height;
            if (tmp > ab) ab = tmp;
            empty = false;
          }
          var w = 0,
            h = 0;
          if (!empty) {
            this._updating |= 1;
            this.setPosition(ax, ay);
            this._updating &= 2;
            w = ar - ax;
            h = ab - ay;
          }
          if ((this._updating & 2) == 0) {
            this._updating |= 2;
            this.setSize(w, h);
            this._updating &= 1;
          } else {
            this._updating &= 1;
            this.resizeChildren(this._width - w, this._height - h);
          }
        };
        _proto21.handleLayout = function handleLayout() {
          this._updating |= 1;
          var child;
          var i;
          var cnt;
          if (this._layout == GroupLayoutType.Horizontal) {
            var curX = this.x;
            cnt = this._parent.numChildren;
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (this._excludeInvisibles && !child.internalVisible3) continue;
              child.xMin = curX;
              if (child.width != 0) curX += child.width + this._columnGap;
            }
          } else if (this._layout == GroupLayoutType.Vertical) {
            var curY = this.y;
            cnt = this._parent.numChildren;
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (this._excludeInvisibles && !child.internalVisible3) continue;
              child.yMin = curY;
              if (child.height != 0) curY += child.height + this._lineGap;
            }
          }
          this._updating &= 2;
        };
        _proto21.moveChildren = function moveChildren(dx, dy) {
          if ((this._updating & 1) != 0 || this._parent == null) return;
          this._updating |= 1;
          var cnt = this._parent.numChildren;
          var i;
          var child;
          for (i = 0; i < cnt; i++) {
            child = this._parent.getChildAt(i);
            if (child.group == this) {
              child.setPosition(child.x + dx, child.y + dy);
            }
          }
          this._updating &= 2;
        };
        _proto21.resizeChildren = function resizeChildren(dw, dh) {
          if (this._layout == GroupLayoutType.None || (this._updating & 2) != 0 || this._parent == null) return;
          this._updating |= 2;
          if (this._boundsChanged) {
            this._boundsChanged = false;
            if (!this._autoSizeDisabled) {
              this.updateBounds();
              return;
            }
          }
          var cnt = this._parent.numChildren;
          var i;
          var child;
          if (!this._percentReady) {
            this._percentReady = true;
            this._numChildren = 0;
            this._totalSize = 0;
            this._mainChildIndex = -1;
            var j = 0;
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (!this._excludeInvisibles || child.internalVisible3) {
                if (j == this._mainGridIndex) this._mainChildIndex = i;
                this._numChildren++;
                if (this._layout == 1) this._totalSize += child.width;else this._totalSize += child.height;
              }
              j++;
            }
            if (this._mainChildIndex != -1) {
              if (this._layout == 1) {
                child = this._parent.getChildAt(this._mainChildIndex);
                this._totalSize += this._mainGridMinSize - child.width;
                child._sizePercentInGroup = this._mainGridMinSize / this._totalSize;
              } else {
                child = this._parent.getChildAt(this._mainChildIndex);
                this._totalSize += this._mainGridMinSize - child.height;
                child._sizePercentInGroup = this._mainGridMinSize / this._totalSize;
              }
            }
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (i == this._mainChildIndex) continue;
              if (this._totalSize > 0) child._sizePercentInGroup = (this._layout == 1 ? child.width : child.height) / this._totalSize;else child._sizePercentInGroup = 0;
            }
          }
          var remainSize = 0;
          var remainPercent = 1;
          var priorHandled = false;
          if (this._layout == 1) {
            remainSize = this.width - (this._numChildren - 1) * this._columnGap;
            if (this._mainChildIndex != -1 && remainSize >= this._totalSize) {
              child = this._parent.getChildAt(this._mainChildIndex);
              child.setSize(remainSize - (this._totalSize - this._mainGridMinSize), child._rawHeight + dh, true);
              remainSize -= child.width;
              remainPercent -= child._sizePercentInGroup;
              priorHandled = true;
            }
            var curX = this.x;
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (this._excludeInvisibles && !child.internalVisible3) {
                child.setSize(child._rawWidth, child._rawHeight + dh, true);
                continue;
              }
              if (!priorHandled || i != this._mainChildIndex) {
                child.setSize(Math.round(child._sizePercentInGroup / remainPercent * remainSize), child._rawHeight + dh, true);
                remainPercent -= child._sizePercentInGroup;
                remainSize -= child.width;
              }
              child.xMin = curX;
              if (child.width != 0) curX += child.width + this._columnGap;
            }
          } else {
            remainSize = this.height - (this._numChildren - 1) * this._lineGap;
            if (this._mainChildIndex != -1 && remainSize >= this._totalSize) {
              child = this._parent.getChildAt(this._mainChildIndex);
              child.setSize(child._rawWidth + dw, remainSize - (this._totalSize - this._mainGridMinSize), true);
              remainSize -= child.height;
              remainPercent -= child._sizePercentInGroup;
              priorHandled = true;
            }
            var curY = this.y;
            for (i = 0; i < cnt; i++) {
              child = this._parent.getChildAt(i);
              if (child.group != this) continue;
              if (this._excludeInvisibles && !child.internalVisible3) {
                child.setSize(child._rawWidth + dw, child._rawHeight, true);
                continue;
              }
              if (!priorHandled || i != this._mainChildIndex) {
                child.setSize(child._rawWidth + dw, Math.round(child._sizePercentInGroup / remainPercent * remainSize), true);
                remainPercent -= child._sizePercentInGroup;
                remainSize -= child.height;
              }
              child.yMin = curY;
              if (child.height != 0) curY += child.height + this._lineGap;
            }
          }
          this._updating &= 1;
        };
        _proto21.handleAlphaChanged = function handleAlphaChanged() {
          if (this._underConstruct) return;
          var cnt = this._parent.numChildren;
          for (var i = 0; i < cnt; i++) {
            var child = this._parent.getChildAt(i);
            if (child.group == this) child.alpha = this.alpha;
          }
        };
        _proto21.handleVisibleChanged = function handleVisibleChanged() {
          if (!this._parent) return;
          var cnt = this._parent.numChildren;
          for (var i = 0; i < cnt; i++) {
            var child = this._parent.getChildAt(i);
            if (child.group == this) child.handleVisibleChanged();
          }
        };
        _proto21.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this._layout = buffer.readByte();
          this._lineGap = buffer.readInt();
          this._columnGap = buffer.readInt();
          if (buffer.version >= 2) {
            this._excludeInvisibles = buffer.readBool();
            this._autoSizeDisabled = buffer.readBool();
            this._mainGridIndex = buffer.readShort();
          }
        };
        _proto21.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GObject.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!this.visible) this.handleVisibleChanged();
        };
        _createClass(GGroup, [{
          key: "layout",
          get: function get() {
            return this._layout;
          },
          set: function set(value) {
            if (this._layout != value) {
              this._layout = value;
              this.setBoundsChangedFlag();
            }
          }
        }, {
          key: "lineGap",
          get: function get() {
            return this._lineGap;
          },
          set: function set(value) {
            if (this._lineGap != value) {
              this._lineGap = value;
              this.setBoundsChangedFlag(true);
            }
          }
        }, {
          key: "columnGap",
          get: function get() {
            return this._columnGap;
          },
          set: function set(value) {
            if (this._columnGap != value) {
              this._columnGap = value;
              this.setBoundsChangedFlag(true);
            }
          }
        }, {
          key: "excludeInvisibles",
          get: function get() {
            return this._excludeInvisibles;
          },
          set: function set(value) {
            if (this._excludeInvisibles != value) {
              this._excludeInvisibles = value;
              this.setBoundsChangedFlag();
            }
          }
        }, {
          key: "autoSizeDisabled",
          get: function get() {
            return this._autoSizeDisabled;
          },
          set: function set(value) {
            this._autoSizeDisabled = value;
          }
        }, {
          key: "mainGridMinSize",
          get: function get() {
            return this._mainGridMinSize;
          },
          set: function set(value) {
            if (this._mainGridMinSize != value) {
              this._mainGridMinSize = value;
              this.setBoundsChangedFlag();
            }
          }
        }, {
          key: "mainGridIndex",
          get: function get() {
            return this._mainGridIndex;
          },
          set: function set(value) {
            if (this._mainGridIndex != value) {
              this._mainGridIndex = value;
              this.setBoundsChangedFlag();
            }
          }
        }]);
        return GGroup;
      }(GObject));
      var GGraph = exports('GGraph', /*#__PURE__*/function (_GObject2) {
        _inheritsLoose(GGraph, _GObject2);
        function GGraph() {
          var _this6;
          _this6 = _GObject2.call(this) || this;
          _this6._type = 0;
          _this6._lineSize = 0;
          _this6._node.name = "GGraph";
          _this6._lineSize = 1;
          _this6._lineColor = new Color();
          _this6._fillColor = new Color(255, 255, 255, 255);
          _this6._content = _this6._node.addComponent(Graphics);
          return _this6;
        }
        var _proto22 = GGraph.prototype;
        _proto22.drawRect = function drawRect(lineSize, lineColor, fillColor, corner) {
          this._type = 1;
          this._lineSize = lineSize;
          this._lineColor.set(lineColor);
          this._fillColor.set(fillColor);
          this._cornerRadius = corner;
          this.updateGraph();
        };
        _proto22.drawEllipse = function drawEllipse(lineSize, lineColor, fillColor) {
          this._type = 2;
          this._lineSize = lineSize;
          this._lineColor.set(lineColor);
          this._fillColor.set(fillColor);
          this.updateGraph();
        };
        _proto22.drawRegularPolygon = function drawRegularPolygon(lineSize, lineColor, fillColor, sides, startAngle, distances) {
          this._type = 4;
          this._lineSize = lineSize;
          this._lineColor.set(lineColor);
          this._fillColor.set(fillColor);
          this._sides = sides;
          this._startAngle = startAngle || 0;
          this._distances = distances;
          this.updateGraph();
        };
        _proto22.drawPolygon = function drawPolygon(lineSize, lineColor, fillColor, points) {
          this._type = 3;
          this._lineSize = lineSize;
          this._lineColor.set(lineColor);
          this._fillColor.set(fillColor);
          this._polygonPoints = points;
          this.updateGraph();
        };
        _proto22.clearGraphics = function clearGraphics() {
          this._type = 0;
          if (this._hasContent) {
            this._content.clear();
            this._hasContent = false;
          }
        };
        _proto22.updateGraph = function updateGraph() {
          var ctx = this._content;
          if (this._hasContent) {
            this._hasContent = false;
            ctx.clear();
          }
          var w = this._width;
          var h = this._height;
          if (w == 0 || h == 0) return;
          var px = -this.pivotX * this._width;
          var py = this.pivotY * this._height;
          var ls = this._lineSize / 2;
          ctx.lineWidth = this._lineSize;
          ctx.strokeColor = this._lineColor;
          ctx.fillColor = this._fillColor;
          if (this._type == 1) {
            if (this._cornerRadius) {
              ctx.roundRect(px + ls, -h + py + ls, w - this._lineSize, h - this._lineSize, this._cornerRadius[0]);
            } else ctx.rect(px + ls, -h + py + ls, w - this._lineSize, h - this._lineSize);
          } else if (this._type == 2) {
            ctx.ellipse(w / 2 + px, -h / 2 + py, w / 2 - ls, h / 2 - ls);
          } else if (this._type == 3) {
            this.drawPath(ctx, this._polygonPoints, px, py);
          } else if (this._type == 4) {
            if (!this._polygonPoints) this._polygonPoints = [];
            var radius = Math.min(w, h) / 2 - ls;
            this._polygonPoints.length = 0;
            var angle = misc.degreesToRadians(this._startAngle);
            var deltaAngle = 2 * Math.PI / this._sides;
            var dist;
            for (var i = 0; i < this._sides; i++) {
              if (this._distances) {
                dist = this._distances[i];
                if (isNaN(dist)) dist = 1;
              } else dist = 1;
              var xv = radius + radius * dist * Math.cos(angle);
              var yv = radius + radius * dist * Math.sin(angle);
              this._polygonPoints.push(xv, yv);
              angle += deltaAngle;
            }
            this.drawPath(ctx, this._polygonPoints, px, py);
          }
          if (ls != 0) ctx.stroke();
          if (this._fillColor.a != 0) ctx.fill();
          this._hasContent = true;
        };
        _proto22.drawPath = function drawPath(ctx, points, px, py) {
          var cnt = points.length;
          ctx.moveTo(points[0] + px, -points[1] + py);
          for (var i = 2; i < cnt; i += 2) ctx.lineTo(points[i] + px, -points[i + 1] + py);
          ctx.lineTo(points[0] + px, -points[1] + py);
        };
        _proto22.handleSizeChanged = function handleSizeChanged() {
          _GObject2.prototype.handleSizeChanged.call(this);
          if (this._type != 0) this.updateGraph();
        };
        _proto22.handleAnchorChanged = function handleAnchorChanged() {
          _GObject2.prototype.handleAnchorChanged.call(this);
          if (this._type != 0) this.updateGraph();
        };
        _proto22.getProp = function getProp(index) {
          if (index == ObjectPropID.Color) return this.color;else return _GObject2.prototype.getProp.call(this, index);
        };
        _proto22.setProp = function setProp(index, value) {
          if (index == ObjectPropID.Color) this.color = value;else _GObject2.prototype.setProp.call(this, index, value);
        };
        _proto22._hitTest = function _hitTest(pt) {
          if (pt.x >= 0 && pt.y >= 0 && pt.x < this._width && pt.y < this._height) {
            if (this._type == 3) {
              var points = this._polygonPoints;
              var len = points.length / 2;
              var i;
              var j = len - 1;
              var oddNodes = false;
              this._width;
              this._height;
              for (i = 0; i < len; ++i) {
                var ix = points[i * 2];
                var iy = points[i * 2 + 1];
                var jx = points[j * 2];
                var jy = points[j * 2 + 1];
                if ((iy < pt.y && jy >= pt.y || jy < pt.y && iy >= pt.y) && (ix <= pt.x || jx <= pt.x)) {
                  if (ix + (pt.y - iy) / (jy - iy) * (jx - ix) < pt.x) oddNodes = !oddNodes;
                }
                j = i;
              }
              return oddNodes ? this : null;
            } else return this;
          } else return null;
        };
        _proto22.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject2.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this._type = buffer.readByte();
          if (this._type != 0) {
            var i;
            var cnt;
            this._lineSize = buffer.readInt();
            this._lineColor.set(buffer.readColor(true));
            this._fillColor.set(buffer.readColor(true));
            if (buffer.readBool()) {
              this._cornerRadius = new Array(4);
              for (i = 0; i < 4; i++) this._cornerRadius[i] = buffer.readFloat();
            }
            if (this._type == 3) {
              cnt = buffer.readShort();
              this._polygonPoints = [];
              this._polygonPoints.length = cnt;
              for (i = 0; i < cnt; i++) this._polygonPoints[i] = buffer.readFloat();
            } else if (this._type == 4) {
              this._sides = buffer.readShort();
              this._startAngle = buffer.readFloat();
              cnt = buffer.readShort();
              if (cnt > 0) {
                this._distances = [];
                for (i = 0; i < cnt; i++) this._distances[i] = buffer.readFloat();
              }
            }
            this.updateGraph();
          }
        };
        _createClass(GGraph, [{
          key: "distances",
          get: function get() {
            return this._distances;
          },
          set: function set(value) {
            this._distances = value;
            if (this._type == 3) this.updateGraph();
          }
        }, {
          key: "type",
          get: function get() {
            return this._type;
          }
        }, {
          key: "color",
          get: function get() {
            return this._fillColor;
          },
          set: function set(value) {
            this._fillColor.set(value);
            if (this._type != 0) this.updateGraph();
          }
        }]);
        return GGraph;
      }(GObject));
      var Image$1 = exports('Image', /*#__PURE__*/function (_Sprite) {
        _inheritsLoose(Image, _Sprite);
        function Image() {
          var _this7;
          _this7 = _Sprite.call(this) || this;
          _this7._flip = FlipType.None;
          _this7._fillMethod = FillMethod.None;
          _this7._fillOrigin = FillOrigin.Left;
          _this7._fillAmount = 0;
          return _this7;
        }
        var _proto23 = Image.prototype;
        _proto23.setupFill = function setupFill() {
          if (this._fillMethod == FillMethod.Horizontal) {
            this._fillClockwise = this._fillOrigin == FillOrigin.Right || this._fillOrigin == FillOrigin.Bottom;
            this.fillStart = this._fillClockwise ? 1 : 0;
          } else if (this._fillMethod == FillMethod.Vertical) {
            this._fillClockwise = this._fillOrigin == FillOrigin.Left || this._fillOrigin == FillOrigin.Top;
            this.fillStart = this._fillClockwise ? 1 : 0;
          } else {
            switch (this._fillOrigin) {
              case FillOrigin.Right:
                this.fillOrigin = 0;
                break;
              case FillOrigin.Top:
                this.fillStart = 0.25;
                break;
              case FillOrigin.Left:
                this.fillStart = 0.5;
                break;
              case FillOrigin.Bottom:
                this.fillStart = 0.75;
                break;
            }
          }
        };
        _createClass(Image, [{
          key: "flip",
          get: function get() {
            return this._flip;
          },
          set: function set(value) {
            if (this._flip != value) {
              this._flip = value;
              var sx = 1,
                sy = 1;
              if (this._flip == FlipType.Horizontal || this._flip == FlipType.Both) sx = -1;
              if (this._flip == FlipType.Vertical || this._flip == FlipType.Both) sy = -1;
              if (sx != 1 || sy != 1) {
                var uiTrans = this.node.getComponent(UITransform);
                uiTrans.setAnchorPoint(0.5, 0.5);
              }
              this.node.setScale(sx, sy);
            }
          }
        }, {
          key: "fillMethod",
          get: function get() {
            return this._fillMethod;
          },
          set: function set(value) {
            if (this._fillMethod != value) {
              this._fillMethod = value;
              if (this._fillMethod != 0) {
                this.type = Sprite.Type.FILLED;
                if (this._fillMethod <= 3) this.fillType = this._fillMethod - 1;else this.fillType = Sprite.FillType.RADIAL;
                this.fillCenter = new Vec2(0.5, 0.5);
                this.setupFill();
              } else {
                this.type = Sprite.Type.SIMPLE;
              }
            }
          }
        }, {
          key: "fillOrigin",
          get: function get() {
            return this._fillOrigin;
          },
          set: function set(value) {
            if (this._fillOrigin != value) {
              this._fillOrigin = value;
              if (this._fillMethod != 0) this.setupFill();
            }
          }
        }, {
          key: "fillClockwise",
          get: function get() {
            return this._fillClockwise;
          },
          set: function set(value) {
            if (this._fillClockwise != value) {
              this._fillClockwise = value;
              if (this._fillMethod != 0) this.setupFill();
            }
          }
        }, {
          key: "fillAmount",
          get: function get() {
            return this._fillAmount;
          },
          set: function set(value) {
            if (this._fillAmount != value) {
              this._fillAmount = value;
              if (this._fillMethod != 0) {
                if (this._fillClockwise) this.fillRange = -this._fillAmount;else this.fillRange = this._fillAmount;
              }
            }
          }
        }]);
        return Image;
      }(Sprite));
      var GImage = exports('GImage', /*#__PURE__*/function (_GObject3) {
        _inheritsLoose(GImage, _GObject3);
        function GImage() {
          var _this8;
          _this8 = _GObject3.call(this) || this;
          _this8._renderUpdateScheduled = false;
          _this8._node.name = "GImage";
          _this8._touchDisabled = true;
          _this8._content = _this8._node.addComponent(Image$1);
          _this8._content.sizeMode = Sprite.SizeMode.CUSTOM;
          _this8._content.trim = false;
          return _this8;
        }
        var _proto24 = GImage.prototype;
        _proto24.constructFromResource = function constructFromResource() {
          var contentItem = this.packageItem.getBranch();
          this.sourceWidth = contentItem.width;
          this.sourceHeight = contentItem.height;
          this.initWidth = this.sourceWidth;
          this.initHeight = this.sourceHeight;
          this.setSize(this.sourceWidth, this.sourceHeight);
          contentItem = contentItem.getHighResolution();
          contentItem.load();
          if (contentItem.scale9Grid) this._content.type = Sprite.Type.SLICED;else if (contentItem.scaleByTile) this._content.type = Sprite.Type.TILED;
          this._content.spriteFrame = contentItem.asset;
        };
        _proto24.handleGrayedChanged = function handleGrayedChanged() {
          this._content.grayscale = this._grayed;
        };
        _proto24.handleSizeChanged = function handleSizeChanged() {
          var _this9 = this;
          _GObject3.prototype.handleSizeChanged.call(this);
          if (this._content && !this._renderUpdateScheduled) {
            this._renderUpdateScheduled = true;
            Promise.resolve().then(function () {
              _this9._renderUpdateScheduled = false;
              if (_this9._content && _this9._content.isValid) {
                _this9._content.markForUpdateRenderData();
                if (_this9._content.updateRenderer) _this9._content.updateRenderer();
              }
            });
          }
        };
        _proto24.getProp = function getProp(index) {
          if (index == ObjectPropID.Color) return this.color;else return _GObject3.prototype.getProp.call(this, index);
        };
        _proto24.setProp = function setProp(index, value) {
          if (index == ObjectPropID.Color) this.color = value;else _GObject3.prototype.setProp.call(this, index, value);
        };
        _proto24.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject3.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          if (buffer.readBool()) this.color = buffer.readColor();
          this._content.flip = buffer.readByte();
          this._content.fillMethod = buffer.readByte();
          if (this._content.fillMethod != 0) {
            this._content.fillOrigin = buffer.readByte();
            this._content.fillClockwise = buffer.readBool();
            this._content.fillAmount = buffer.readFloat();
          }
        };
        _createClass(GImage, [{
          key: "color",
          get: function get() {
            return this._content.color;
          },
          set: function set(value) {
            this._content.color = value;
            this.updateGear(4);
          }
        }, {
          key: "flip",
          get: function get() {
            return this._content.flip;
          },
          set: function set(value) {
            this._content.flip = value;
          }
        }, {
          key: "fillMethod",
          get: function get() {
            return this._content.fillMethod;
          },
          set: function set(value) {
            this._content.fillMethod = value;
          }
        }, {
          key: "fillOrigin",
          get: function get() {
            return this._content.fillOrigin;
          },
          set: function set(value) {
            this._content.fillOrigin = value;
          }
        }, {
          key: "fillClockwise",
          get: function get() {
            return this._content.fillClockwise;
          },
          set: function set(value) {
            this._content.fillClockwise = value;
          }
        }, {
          key: "fillAmount",
          get: function get() {
            return this._content.fillAmount;
          },
          set: function set(value) {
            this._content.fillAmount = value;
          }
        }]);
        return GImage;
      }(GObject));
      var MovieClip = exports('MovieClip', /*#__PURE__*/function (_Image$) {
        _inheritsLoose(MovieClip, _Image$);
        function MovieClip() {
          var _this10;
          _this10 = _Image$.call(this) || this;
          _this10.interval = 0;
          _this10.swing = false;
          _this10.repeatDelay = 0;
          _this10.timeScale = 1;
          _this10._playing = true;
          _this10._frameCount = 0;
          _this10._frame = 0;
          _this10._start = 0;
          _this10._end = 0;
          _this10._times = 0;
          _this10._endAt = 0;
          _this10._status = 0; //0-none, 1-next loop, 2-ending, 3-ended
          _this10._smoothing = true;
          _this10._frameElapsed = 0; //
          _this10._reversed = false;
          _this10._repeatedCount = 0;
          return _this10;
        }
        var _proto25 = MovieClip.prototype;
        _proto25.rewind = function rewind() {
          this._frame = 0;
          this._frameElapsed = 0;
          this._reversed = false;
          this._repeatedCount = 0;
          this.drawFrame();
        };
        _proto25.syncStatus = function syncStatus(anotherMc) {
          this._frame = anotherMc._frame;
          this._frameElapsed = anotherMc._frameElapsed;
          this._reversed = anotherMc._reversed;
          this._repeatedCount = anotherMc._repeatedCount;
          this.drawFrame();
        };
        _proto25.advance = function advance(timeInSeconds) {
          var beginFrame = this._frame;
          var beginReversed = this._reversed;
          var backupTime = timeInSeconds;
          while (true) {
            var tt = this.interval + this._frames[this._frame].addDelay;
            if (this._frame == 0 && this._repeatedCount > 0) tt += this.repeatDelay;
            if (timeInSeconds < tt) {
              this._frameElapsed = 0;
              break;
            }
            timeInSeconds -= tt;
            if (this.swing) {
              if (this._reversed) {
                this._frame--;
                if (this._frame <= 0) {
                  this._frame = 0;
                  this._repeatedCount++;
                  this._reversed = !this._reversed;
                }
              } else {
                this._frame++;
                if (this._frame > this._frameCount - 1) {
                  this._frame = Math.max(0, this._frameCount - 2);
                  this._repeatedCount++;
                  this._reversed = !this._reversed;
                }
              }
            } else {
              this._frame++;
              if (this._frame > this._frameCount - 1) {
                this._frame = 0;
                this._repeatedCount++;
              }
            }
            if (this._frame == beginFrame && this._reversed == beginReversed)
              //
              {
                var roundTime = backupTime - timeInSeconds; //
                timeInSeconds -= Math.floor(timeInSeconds / roundTime) * roundTime; //
              }
          }
          this.drawFrame();
        } //startend-1times0endAt-1end
        ;
        _proto25.setPlaySettings = function setPlaySettings(start, end, times, endAt, endCallback) {
          if (start == undefined) start = 0;
          if (end == undefined) end = -1;
          if (times == undefined) times = 0;
          if (endAt == undefined) endAt = -1;
          this._start = start;
          this._end = end;
          if (this._end == -1 || this._end > this._frameCount - 1) this._end = this._frameCount - 1;
          this._times = times;
          this._endAt = endAt;
          if (this._endAt == -1) this._endAt = this._end;
          this._status = 0;
          this._callback = endCallback;
          this.frame = start;
        };
        _proto25.update = function update(dt) {
          if (!this._playing || this._frameCount == 0 || this._status == 3) return;
          if (this.timeScale != 1) dt *= this.timeScale;
          this._frameElapsed += dt;
          var tt = this.interval + this._frames[this._frame].addDelay;
          if (this._frame == 0 && this._repeatedCount > 0) tt += this.repeatDelay;
          if (this._frameElapsed < tt) return;
          this._frameElapsed -= tt;
          if (this._frameElapsed > this.interval) this._frameElapsed = this.interval;
          if (this.swing) {
            if (this._reversed) {
              this._frame--;
              if (this._frame <= 0) {
                this._frame = 0;
                this._repeatedCount++;
                this._reversed = !this._reversed;
              }
            } else {
              this._frame++;
              if (this._frame > this._frameCount - 1) {
                this._frame = Math.max(0, this._frameCount - 2);
                this._repeatedCount++;
                this._reversed = !this._reversed;
              }
            }
          } else {
            this._frame++;
            if (this._frame > this._frameCount - 1) {
              this._frame = 0;
              this._repeatedCount++;
            }
          }
          if (this._status == 1)
            //new loop
            {
              this._frame = this._start;
              this._frameElapsed = 0;
              this._status = 0;
            } else if (this._status == 2)
            //ending
            {
              this._frame = this._endAt;
              this._frameElapsed = 0;
              this._status = 3; //ended
              //play end
              if (this._callback != null) {
                var callback = this._callback;
                this._callback = null;
                callback();
              }
            } else {
            if (this._frame == this._end) {
              if (this._times > 0) {
                this._times--;
                if (this._times == 0) this._status = 2; //ending
                else this._status = 1; //new loop
              } else if (this._start != 0) this._status = 1; //new loop
            }
          }
          this.drawFrame();
        };
        _proto25.drawFrame = function drawFrame() {
          if (this._frameCount > 0 && this._frame < this._frames.length) {
            var frame = this._frames[this._frame];
            this.spriteFrame = frame.texture;
          }
        };
        _createClass(MovieClip, [{
          key: "frames",
          get: function get() {
            return this._frames;
          },
          set: function set(value) {
            this._frames = value;
            if (this._frames) {
              this._frameCount = this._frames.length;
              if (this._end == -1 || this._end > this._frameCount - 1) this._end = this._frameCount - 1;
              if (this._endAt == -1 || this._endAt > this._frameCount - 1) this._endAt = this._frameCount - 1;
              if (this._frame < 0 || this._frame > this._frameCount - 1) this._frame = this._frameCount - 1;
              this.type = Sprite.Type.SIMPLE;
              this.drawFrame();
              this._frameElapsed = 0;
              this._repeatedCount = 0;
              this._reversed = false;
            } else {
              this._frameCount = 0;
            }
          }
        }, {
          key: "frameCount",
          get: function get() {
            return this._frameCount;
          }
        }, {
          key: "frame",
          get: function get() {
            return this._frame;
          },
          set: function set(value) {
            if (this._frame != value) {
              if (this._frames && value >= this._frameCount) value = this._frameCount - 1;
              this._frame = value;
              this._frameElapsed = 0;
              this.drawFrame();
            }
          }
        }, {
          key: "playing",
          get: function get() {
            return this._playing;
          },
          set: function set(value) {
            if (this._playing != value) {
              this._playing = value;
            }
          }
        }, {
          key: "smoothing",
          get: function get() {
            return this._smoothing;
          },
          set: function set(value) {
            this._smoothing = value;
          }
        }]);
        return MovieClip;
      }(Image$1));
      var GMovieClip = exports('GMovieClip', /*#__PURE__*/function (_GObject4) {
        _inheritsLoose(GMovieClip, _GObject4);
        function GMovieClip() {
          var _this11;
          _this11 = _GObject4.call(this) || this;
          _this11._node.name = "GMovieClip";
          _this11._touchDisabled = true;
          _this11._content = _this11._node.addComponent(MovieClip);
          _this11._content.sizeMode = Sprite.SizeMode.CUSTOM;
          _this11._content.trim = false;
          _this11._content.setPlaySettings();
          return _this11;
        }
        var _proto26 = GMovieClip.prototype;
        _proto26.rewind = function rewind() {
          this._content.rewind();
        };
        _proto26.syncStatus = function syncStatus(anotherMc) {
          this._content.syncStatus(anotherMc._content);
        };
        _proto26.advance = function advance(timeInSeconds) {
          this._content.advance(timeInSeconds);
        } //startend-1times0endAt-1end
        ;
        _proto26.setPlaySettings = function setPlaySettings(start, end, times, endAt, endCallback) {
          this._content.setPlaySettings(start, end, times, endAt, endCallback);
        };
        _proto26.handleGrayedChanged = function handleGrayedChanged() {
          this._content.grayscale = this._grayed;
        };
        _proto26.handleSizeChanged = function handleSizeChanged() {
          _GObject4.prototype.handleSizeChanged.call(this); //
          this._content.sizeMode = Sprite.SizeMode.CUSTOM;
        };
        _proto26.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.color;
            case ObjectPropID.Playing:
              return this.playing;
            case ObjectPropID.Frame:
              return this.frame;
            case ObjectPropID.TimeScale:
              return this.timeScale;
            default:
              return _GObject4.prototype.getProp.call(this, index);
          }
        };
        _proto26.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.color = value;
              break;
            case ObjectPropID.Playing:
              this.playing = value;
              break;
            case ObjectPropID.Frame:
              this.frame = value;
              break;
            case ObjectPropID.TimeScale:
              this.timeScale = value;
              break;
            case ObjectPropID.DeltaTime:
              this.advance(value);
              break;
            default:
              _GObject4.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto26.constructFromResource = function constructFromResource() {
          var contentItem = this.packageItem.getBranch();
          this.sourceWidth = contentItem.width;
          this.sourceHeight = contentItem.height;
          this.initWidth = this.sourceWidth;
          this.initHeight = this.sourceHeight;
          this.setSize(this.sourceWidth, this.sourceHeight);
          contentItem = contentItem.getHighResolution();
          contentItem.load();
          this._content.interval = contentItem.interval;
          this._content.swing = contentItem.swing;
          this._content.repeatDelay = contentItem.repeatDelay;
          this._content.frames = contentItem.frames;
          this._content.smoothing = contentItem.smoothing;
        };
        _proto26.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject4.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          if (buffer.readBool()) this.color = buffer.readColor();
          buffer.readByte(); //flip
          this._content.frame = buffer.readInt();
          this._content.playing = buffer.readBool();
        };
        _createClass(GMovieClip, [{
          key: "color",
          get: function get() {
            return this._content.color;
          },
          set: function set(value) {
            this._content.color = value;
            this.updateGear(4);
          }
        }, {
          key: "playing",
          get: function get() {
            return this._content.playing;
          },
          set: function set(value) {
            if (this._content.playing != value) {
              this._content.playing = value;
              this.updateGear(5);
            }
          }
        }, {
          key: "frame",
          get: function get() {
            return this._content.frame;
          },
          set: function set(value) {
            if (this._content.frame != value) {
              this._content.frame = value;
              this.updateGear(5);
            }
          }
        }, {
          key: "timeScale",
          get: function get() {
            return this._content.timeScale;
          },
          set: function set(value) {
            this._content.timeScale = value;
          }
        }]);
        return GMovieClip;
      }(GObject));
      var UIContentScaler = function UIContentScaler() {};
      UIContentScaler.scaleFactor = 1;
      UIContentScaler.scaleLevel = 0;
      UIContentScaler.rootSize = new Size();
      function updateScaler() {
        var size = screen.windowSize;
        size.width /= view.getScaleX();
        size.height /= view.getScaleY();
        UIContentScaler.rootSize.set(size);
        var ss = Math.max(view.getScaleX(), view.getScaleY());
        UIContentScaler.scaleFactor = ss;
        if (ss >= 3.5) UIContentScaler.scaleLevel = 3; //x4
        else if (ss >= 2.5) UIContentScaler.scaleLevel = 2; //x3
        else if (ss >= 1.5) UIContentScaler.scaleLevel = 1; //x2
        else UIContentScaler.scaleLevel = 0;
      }
      var PackageItem = exports('PackageItem', /*#__PURE__*/function () {
        function PackageItem() {
          this.width = 0;
          this.height = 0;
        }
        var _proto27 = PackageItem.prototype;
        _proto27.load = function load() {
          return this.owner.getItemAsset(this);
        };
        _proto27.getBranch = function getBranch() {
          if (this.branches && this.owner._branchIndex != -1) {
            var itemId = this.branches[this.owner._branchIndex];
            if (itemId) return this.owner.getItemById(itemId);
          }
          return this;
        };
        _proto27.getHighResolution = function getHighResolution() {
          if (this.highResolution && UIContentScaler.scaleLevel > 0) {
            var itemId = this.highResolution[UIContentScaler.scaleLevel - 1];
            if (itemId) return this.owner.getItemById(itemId);
          }
          return this;
        };
        _proto27.toString = function toString() {
          return this.name;
        };
        return PackageItem;
      }());
      var TranslationHelper = exports('TranslationHelper', /*#__PURE__*/function () {
        function TranslationHelper() {}
        TranslationHelper.loadFromXML = function loadFromXML(source) {
          TranslationHelper.strings = {};
          var strings = TranslationHelper.strings;
          var xml = new DOMParser().parseFromString(source, "text/xml").documentElement;
          var nodes = xml.childNodes;
          var length1 = nodes.length;
          for (var i1 = 0; i1 < length1; i1++) {
            var cxml = nodes[i1];
            if (cxml.tagName == "string") {
              var key = cxml.getAttribute("name");
              var text = cxml.childNodes.length > 0 ? cxml.firstChild.nodeValue : "";
              var i = key.indexOf("-");
              if (i == -1) continue;
              var key2 = key.substring(0, i);
              var key3 = key.substring(i + 1);
              var col = strings[key2];
              if (!col) {
                col = {};
                strings[key2] = col;
              }
              col[key3] = text;
            }
          }
        };
        TranslationHelper.translateComponent = function translateComponent(item) {
          if (TranslationHelper.strings == null) return;
          var compStrings = TranslationHelper.strings[item.owner.id + item.id];
          if (compStrings == null) return;
          var elementId, value;
          var buffer = item.rawData;
          var nextPos;
          var itemCount;
          var i, j, k;
          var dataLen;
          var curPos;
          var valueCnt;
          var page;
          buffer.seek(0, 2);
          var childCount = buffer.readShort();
          for (i = 0; i < childCount; i++) {
            dataLen = buffer.readShort();
            curPos = buffer.position;
            buffer.seek(curPos, 0);
            var baseType = buffer.readByte();
            var type = baseType;
            buffer.skip(4);
            elementId = buffer.readS();
            if (type == ObjectType.Component) {
              if (buffer.seek(curPos, 6)) type = buffer.readByte();
            }
            buffer.seek(curPos, 1);
            if ((value = compStrings[elementId + "-tips"]) != null) buffer.writeS(value);
            buffer.seek(curPos, 2);
            var gearCnt = buffer.readShort();
            for (j = 0; j < gearCnt; j++) {
              nextPos = buffer.readShort();
              nextPos += buffer.position;
              if (buffer.readByte() == 6)
                //gearText
                {
                  buffer.skip(2); //controller
                  valueCnt = buffer.readShort();
                  for (k = 0; k < valueCnt; k++) {
                    page = buffer.readS();
                    if (page != null) {
                      if ((value = compStrings[elementId + "-texts_" + k]) != null) buffer.writeS(value);else buffer.skip(2);
                    }
                  }
                  if (buffer.readBool() && (value = compStrings[elementId + "-texts_def"]) != null) buffer.writeS(value);
                }
              buffer.position = nextPos;
            }
            if (baseType == ObjectType.Component && buffer.version >= 2) {
              buffer.seek(curPos, 4);
              buffer.skip(2); //pageController
              buffer.skip(4 * buffer.readShort());
              var cpCount = buffer.readShort();
              for (var k = 0; k < cpCount; k++) {
                var target = buffer.readS();
                var propertyId = buffer.readShort();
                if (propertyId == 0 && (value = compStrings[elementId + "-cp-" + target]) != null) buffer.writeS(value);else buffer.skip(2);
              }
            }
            switch (type) {
              case ObjectType.Text:
              case ObjectType.RichText:
              case ObjectType.InputText:
                {
                  if ((value = compStrings[elementId]) != null) {
                    buffer.seek(curPos, 6);
                    buffer.writeS(value);
                  }
                  if ((value = compStrings[elementId + "-prompt"]) != null) {
                    buffer.seek(curPos, 4);
                    buffer.writeS(value);
                  }
                  break;
                }
              case ObjectType.List:
              case ObjectType.Tree:
                {
                  buffer.seek(curPos, 8);
                  buffer.skip(2);
                  itemCount = buffer.readShort();
                  for (j = 0; j < itemCount; j++) {
                    nextPos = buffer.readShort();
                    nextPos += buffer.position;
                    buffer.skip(2); //url
                    if (type == ObjectType.Tree) buffer.skip(2); //title
                    if ((value = compStrings[elementId + "-" + j]) != null) buffer.writeS(value);else buffer.skip(2); //selected title
                    if ((value = compStrings[elementId + "-" + j + "-0"]) != null) buffer.writeS(value);else buffer.skip(2);
                    if (buffer.version >= 2) {
                      buffer.skip(6);
                      buffer.skip(buffer.readUshort() * 4); //controllers
                      var cpCount = buffer.readUshort();
                      for (var k = 0; k < cpCount; k++) {
                        var target = buffer.readS();
                        var propertyId = buffer.readUshort();
                        if (propertyId == 0 && (value = compStrings[elementId + "-" + j + "-" + target]) != null) buffer.writeS(value);else buffer.skip(2);
                      }
                    }
                    buffer.position = nextPos;
                  }
                  break;
                }
              case ObjectType.Label:
                {
                  if (buffer.seek(curPos, 6) && buffer.readByte() == type) {
                    if ((value = compStrings[elementId]) != null) buffer.writeS(value);else buffer.skip(2);
                    buffer.skip(2);
                    if (buffer.readBool()) buffer.skip(4);
                    buffer.skip(4);
                    if (buffer.readBool() && (value = compStrings[elementId + "-prompt"]) != null) buffer.writeS(value);
                  }
                  break;
                }
              case ObjectType.Button:
                {
                  if (buffer.seek(curPos, 6) && buffer.readByte() == type) {
                    if ((value = compStrings[elementId]) != null) buffer.writeS(value);else buffer.skip(2);
                    if ((value = compStrings[elementId + "-0"]) != null) buffer.writeS(value);
                  }
                  break;
                }
              case ObjectType.ComboBox:
                {
                  if (buffer.seek(curPos, 6) && buffer.readByte() == type) {
                    itemCount = buffer.readShort();
                    for (j = 0; j < itemCount; j++) {
                      nextPos = buffer.readShort();
                      nextPos += buffer.position;
                      if ((value = compStrings[elementId + "-" + j]) != null) buffer.writeS(value);
                      buffer.position = nextPos;
                    }
                    if ((value = compStrings[elementId]) != null) buffer.writeS(value);
                  }
                  break;
                }
            }
            buffer.position = curPos + dataLen;
          }
        };
        return TranslationHelper;
      }());
      var ByteBuffer = exports('ByteBuffer', /*#__PURE__*/function () {
        function ByteBuffer(buffer, offset, length) {
          this.version = 0;
          offset = offset || 0;
          if (length == null || length == -1) length = buffer.byteLength - offset;
          this._bytes = new Uint8Array(buffer, offset, length);
          this._view = new DataView(this._bytes.buffer, offset, length);
          this._pos = 0;
          this._length = length;
        }
        var _proto28 = ByteBuffer.prototype;
        _proto28.skip = function skip(count) {
          this._pos += count;
        };
        _proto28.validate = function validate(forward) {
          if (this._pos + forward > this._length) throw new Error("Out of bounds");
        };
        _proto28.readByte = function readByte() {
          this.validate(1);
          return this._view.getUint8(this._pos++);
        };
        _proto28.readBool = function readBool() {
          return this.readByte() == 1;
        };
        _proto28.readShort = function readShort() {
          this.validate(2);
          var ret = this._view.getInt16(this._pos, this.littleEndian);
          this._pos += 2;
          return ret;
        };
        _proto28.readUshort = function readUshort() {
          this.validate(2);
          var ret = this._view.getUint16(this._pos, this.littleEndian);
          this._pos += 2;
          return ret;
        };
        _proto28.readInt = function readInt() {
          this.validate(4);
          var ret = this._view.getInt32(this._pos, this.littleEndian);
          this._pos += 4;
          return ret;
        };
        _proto28.readUint = function readUint() {
          this.validate(4);
          var ret = this._view.getUint32(this._pos, this.littleEndian);
          this._pos += 4;
          return ret;
        };
        _proto28.readFloat = function readFloat() {
          this.validate(4);
          var ret = this._view.getFloat32(this._pos, this.littleEndian);
          this._pos += 4;
          return ret;
        };
        _proto28.readString = function readString(len) {
          if (len == undefined) len = this.readUshort();
          this.validate(len);
          var v = "",
            max = this._pos + len,
            c = 0,
            c2 = 0,
            c3 = 0,
            f = String.fromCharCode;
          var u = this._bytes;
          var pos = this._pos;
          while (pos < max) {
            c = u[pos++];
            if (c < 0x80) {
              if (c != 0) {
                v += f(c);
              }
            } else if (c < 0xE0) {
              v += f((c & 0x3F) << 6 | u[pos++] & 0x7F);
            } else if (c < 0xF0) {
              c2 = u[pos++];
              v += f((c & 0x1F) << 12 | (c2 & 0x7F) << 6 | u[pos++] & 0x7F);
            } else {
              c2 = u[pos++];
              c3 = u[pos++];
              v += f((c & 0x0F) << 18 | (c2 & 0x7F) << 12 | c3 << 6 & 0x7F | u[pos++] & 0x7F);
            }
          }
          this._pos += len;
          return v;
        };
        _proto28.readS = function readS() {
          var index = this.readUshort();
          if (index == 65534)
            //null
            return null;else if (index == 65533) return "";else return this.stringTable[index];
        };
        _proto28.readSArray = function readSArray(cnt) {
          var ret = new Array(cnt);
          for (var i = 0; i < cnt; i++) ret[i] = this.readS();
          return ret;
        };
        _proto28.writeS = function writeS(value) {
          var index = this.readUshort();
          if (index != 65534 && index != 65533) this.stringTable[index] = value;
        };
        _proto28.readColor = function readColor(hasAlpha) {
          var r = this.readByte();
          var g = this.readByte();
          var b = this.readByte();
          var a = this.readByte();
          return new Color(r, g, b, hasAlpha ? a : 255);
        };
        _proto28.readChar = function readChar() {
          var i = this.readUshort();
          return String.fromCharCode(i);
        };
        _proto28.readBuffer = function readBuffer() {
          var count = this.readUint();
          this.validate(count);
          var ba = new ByteBuffer(this._bytes.buffer, this._bytes.byteOffset + this._pos, count);
          ba.stringTable = this.stringTable;
          ba.version = this.version;
          this._pos += count;
          return ba;
        };
        _proto28.seek = function seek(indexTablePos, blockIndex) {
          var tmp = this._pos;
          this._pos = indexTablePos;
          var segCount = this.readByte();
          if (blockIndex < segCount) {
            var useShort = this.readByte() == 1;
            var newPos;
            if (useShort) {
              this._pos += 2 * blockIndex;
              newPos = this.readUshort();
            } else {
              this._pos += 4 * blockIndex;
              newPos = this.readUint();
            }
            if (newPos > 0) {
              this._pos = indexTablePos + newPos;
              return true;
            } else {
              this._pos = tmp;
              return false;
            }
          } else {
            this._pos = tmp;
            return false;
          }
        };
        _createClass(ByteBuffer, [{
          key: "data",
          get: function get() {
            return this._bytes;
          }
        }, {
          key: "position",
          get: function get() {
            return this._pos;
          },
          set: function set(value) {
            if (value > this._length) throw new Error("Out of bounds");
            this._pos = value;
          }
        }]);
        return ByteBuffer;
      }());
      var PixelHitTest = exports('PixelHitTest', /*#__PURE__*/function () {
        function PixelHitTest(data, offsetX, offsetY) {
          this._data = data;
          this.offsetX = offsetX == undefined ? 0 : offsetX;
          this.offsetY = offsetY == undefined ? 0 : offsetY;
          this.scaleX = 1;
          this.scaleY = 1;
        }
        var _proto29 = PixelHitTest.prototype;
        _proto29.hitTest = function hitTest(pt) {
          var x = Math.floor((pt.x / this.scaleX - this.offsetX) * this._data.scale);
          var y = Math.floor((pt.y / this.scaleY - this.offsetY) * this._data.scale);
          if (x < 0 || y < 0 || x >= this._data.pixelWidth) return false;
          var pos = y * this._data.pixelWidth + x;
          var pos2 = Math.floor(pos / 8);
          var pos3 = pos % 8;
          if (pos2 >= 0 && pos2 < this._data.pixels.length) return (this._data.pixels[pos2] >> pos3 & 0x1) == 1;else return false;
        };
        return PixelHitTest;
      }());
      var PixelHitTestData = function PixelHitTestData(ba) {
        ba.readInt();
        this.pixelWidth = ba.readInt();
        this.scale = 1 / ba.readByte();
        this.pixels = ba.readBuffer().data;
      };
      var ChildHitArea = /*#__PURE__*/function () {
        function ChildHitArea(child) {
          this._child = child;
        }
        var _proto30 = ChildHitArea.prototype;
        _proto30.hitTest = function hitTest(pt, globalPt) {
          return this._child.hitTest(globalPt, false) != null;
        };
        return ChildHitArea;
      }();
      var PathUtils = path;
      var UIPackage = exports('UIPackage', /*#__PURE__*/function () {
        function UIPackage() {
          this._items = [];
          this._itemsById = {};
          this._itemsByName = {};
          this._sprites = {};
          this._dependencies = [];
          this._branches = [];
          this._branchIndex = -1;
        }
        UIPackage.getVar = function getVar(key) {
          return _vars[key];
        };
        UIPackage.setVar = function setVar(key, value) {
          _vars[key] = value;
        };
        UIPackage.getById = function getById(id) {
          return _instById[id];
        };
        UIPackage.getByName = function getByName(name) {
          return _instByName[name];
        } /**
          * resources
          * @param path  resources 
          */;
        UIPackage.addPackage = function addPackage(path) {
          var pkg = _instById[path];
          if (pkg) return pkg;
          var asset = resources.get(path, BufferAsset);
          if (!asset) throw new Error("Resource '" + path + "' not ready");
          var buffer = asset.buffer();
          if (!buffer) throw new Error("Missing asset data.");
          pkg = new UIPackage();
          pkg._bundle = resources;
          pkg.loadPackage(new ByteBuffer(buffer), path);
          _instById[pkg.id] = pkg;
          _instByName[pkg.name] = pkg;
          _instById[pkg._path] = pkg;
          return pkg;
        };
        UIPackage.loadPackage = function loadPackage() {
          var path;
          var onProgress;
          var onComplete;
          var bundle;
          if ((arguments.length <= 0 ? undefined : arguments[0]) instanceof AssetManager.Bundle) {
            bundle = arguments.length <= 0 ? undefined : arguments[0];
            path = arguments.length <= 1 ? undefined : arguments[1];
            if (arguments.length > 3) {
              onProgress = arguments.length <= 2 ? undefined : arguments[2];
              onComplete = arguments.length <= 3 ? undefined : arguments[3];
            } else onComplete = arguments.length <= 2 ? undefined : arguments[2];
          } else {
            path = arguments.length <= 0 ? undefined : arguments[0];
            if (arguments.length > 2) {
              onProgress = arguments.length <= 1 ? undefined : arguments[1];
              onComplete = arguments.length <= 2 ? undefined : arguments[2];
            } else onComplete = arguments.length <= 1 ? undefined : arguments[1];
          }
          bundle = bundle || resources; // 20%80%
          var MAIN_PACKAGE_WEIGHT = 0.2; // 20%
          var RESOURCES_WEIGHT = 0.8; // 80%
          var mainPackageProgress = {
            finish: 0,
            total: 1,
            completed: false
          };
          var resourceProgressMap = new Map();
          var resourcesInitialized = false; // 
          var updateUnifiedProgress = function updateUnifiedProgress() {
            if (onProgress) {
              var mainProgress = 0;
              var resourcesProgress = 0; //  (0-20%)
              if (mainPackageProgress.completed) {
                mainProgress = MAIN_PACKAGE_WEIGHT;
              } else {
                mainProgress = MAIN_PACKAGE_WEIGHT * (mainPackageProgress.finish / mainPackageProgress.total);
              } //  (0-80%)
              if (resourcesInitialized && resourceProgressMap.size > 0) {
                var resourceTotalFinish = 0;
                var resourceTotalCount = 0;
                resourceProgressMap.forEach(function (progress) {
                  if (progress.completed) {
                    resourceTotalFinish += progress.total;
                    resourceTotalCount += progress.total;
                  } else {
                    resourceTotalFinish += progress.finish;
                    resourceTotalCount += progress.total;
                  }
                });
                if (resourceTotalCount > 0) {
                  resourcesProgress = RESOURCES_WEIGHT * (resourceTotalFinish / resourceTotalCount);
                }
              } else if (mainPackageProgress.completed && resourceProgressMap.size === 0) {
                // 
                resourcesProgress = RESOURCES_WEIGHT;
              } //  =  + 
              var totalProgress = mainProgress + resourcesProgress; //  (0-100)
              onProgress(Math.round(totalProgress * 100), 100, null);
            }
          }; // 
          var mainPackageProgressCallback = onProgress ? function (finish, total, item) {
            mainPackageProgress.finish = finish;
            mainPackageProgress.total = total;
            updateUnifiedProgress();
          } : null;
          bundle.load(path, Asset, mainPackageProgressCallback, function (err, asset) {
            if (err) {
              if (onComplete != null) onComplete(err, null);
              return;
            } // 
            mainPackageProgress.completed = true;
            mainPackageProgress.finish = mainPackageProgress.total;
            var pkg = new UIPackage();
            pkg._bundle = bundle;
            var buffer = asset.buffer ? asset.buffer() : asset._nativeAsset;
            pkg.loadPackage(new ByteBuffer(buffer), path);
            var cnt = pkg._items.length;
            var urls = [];
            for (var i = 0; i < cnt; i++) {
              var pi = pkg._items[i];
              if (pi.type == PackageItemType.Atlas || pi.type == PackageItemType.Sound) {
                ItemTypeToAssetType[pi.type];
                urls.push(pi.file);
              }
            }
            var total = urls.length;
            var lastErr;
            var loadedCount = 0; // 
            urls.forEach(function (url) {
              resourceProgressMap.set(url, {
                finish: 0,
                total: 1,
                completed: false
              });
            }); // 
            resourcesInitialized = true; // 20% + 0%
            updateUnifiedProgress();
            var taskComplete = function taskComplete(err, asset, url) {
              loadedCount++;
              if (err) lastErr = err; // 
              if (url && resourceProgressMap.has(url)) {
                var progress = resourceProgressMap.get(url);
                progress.completed = true;
                progress.finish = progress.total; // 100%
                resourceProgressMap.set(url, progress);
                updateUnifiedProgress(); // 
              }
              if (loadedCount >= total) {
                _instById[pkg.id] = pkg;
                _instByName[pkg.name] = pkg;
                if (pkg._path) _instById[pkg._path] = pkg;
                if (onComplete != null) onComplete(lastErr, pkg);
              }
            };
            if (total > 0) {
              urls.forEach(function (url, index) {
                var urlProgress = function urlProgress(finish, total, item) {
                  // URL
                  if (resourceProgressMap.has(url)) {
                    var progress = resourceProgressMap.get(url);
                    if (!progress.completed) {
                      progress.finish = finish;
                      progress.total = total;
                      resourceProgressMap.set(url, progress);
                      updateUnifiedProgress();
                    }
                  }
                };
                var urlComplete = function urlComplete(err, asset) {
                  taskComplete(err, asset, url);
                };
                bundle.load(url, Asset, onProgress ? urlProgress : null, urlComplete);
              });
            } else taskComplete(null);
          });
        };
        UIPackage.removePackage = function removePackage(packageIdOrName) {
          var pkg = _instById[packageIdOrName];
          if (!pkg) pkg = _instByName[packageIdOrName];
          if (!pkg) throw new Error("No package found: " + packageIdOrName);
          pkg.dispose();
          delete _instById[pkg.id];
          delete _instByName[pkg.name];
          if (pkg._path) delete _instById[pkg._path];
        };
        UIPackage.createObject = function createObject(pkgName, resName, userClass) {
          var pkg = UIPackage.getByName(pkgName);
          if (pkg) return pkg.createObject(resName, userClass);else return null;
        };
        UIPackage.createObjectFromURL = function createObjectFromURL(url, userClass) {
          var pi = UIPackage.getItemByURL(url);
          if (pi) return pi.owner.internalCreateObject(pi, userClass);else return null;
        };
        UIPackage.getItemURL = function getItemURL(pkgName, resName) {
          var pkg = UIPackage.getByName(pkgName);
          if (!pkg) return null;
          var pi = pkg._itemsByName[resName];
          if (!pi) return null;
          return "ui://" + pkg.id + pi.id;
        };
        UIPackage.getItemByURL = function getItemByURL(url) {
          var pos1 = url.indexOf("//");
          if (pos1 == -1) return null;
          var pos2 = url.indexOf("/", pos1 + 2);
          if (pos2 == -1) {
            if (url.length > 13) {
              var pkgId = url.substring(5, 13);
              var pkg = UIPackage.getById(pkgId);
              if (pkg != null) {
                var srcId = url.substring(13);
                return pkg.getItemById(srcId);
              }
            }
          } else {
            var pkgName = url.substring(pos1 + 2, pos2);
            pkg = UIPackage.getByName(pkgName);
            if (pkg != null) {
              var srcName = url.substring(pos2 + 1);
              return pkg.getItemByName(srcName);
            }
          }
          return null;
        };
        UIPackage.normalizeURL = function normalizeURL(url) {
          if (url == null) return null;
          var pos1 = url.indexOf("//");
          if (pos1 == -1) return null;
          var pos2 = url.indexOf("/", pos1 + 2);
          if (pos2 == -1) return url;
          var pkgName = url.substring(pos1 + 2, pos2);
          var srcName = url.substring(pos2 + 1);
          return UIPackage.getItemURL(pkgName, srcName);
        };
        UIPackage.setStringsSource = function setStringsSource(source) {
          TranslationHelper.loadFromXML(source);
        };
        var _proto31 = UIPackage.prototype;
        _proto31.loadPackage = function loadPackage(buffer, path) {
          if (buffer.readUint() != 0x46475549) throw new Error("FairyGUI: old package format found in '" + path + "'");
          this._path = path;
          buffer.version = buffer.readInt();
          var ver2 = buffer.version >= 2;
          buffer.readBool();
          this._id = buffer.readString();
          this._name = buffer.readString();
          buffer.skip(20);
          var indexTablePos = buffer.position;
          var cnt;
          var i;
          var nextPos;
          var str;
          var branchIncluded;
          buffer.seek(indexTablePos, 4);
          cnt = buffer.readInt();
          var stringTable = new Array(cnt);
          buffer.stringTable = stringTable;
          for (i = 0; i < cnt; i++) stringTable[i] = buffer.readString();
          if (buffer.seek(indexTablePos, 5)) {
            cnt = buffer.readInt();
            for (i = 0; i < cnt; i++) {
              var index = buffer.readUshort();
              var len = buffer.readInt();
              stringTable[index] = buffer.readString(len);
            }
          }
          buffer.seek(indexTablePos, 0);
          cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) this._dependencies.push({
            id: buffer.readS(),
            name: buffer.readS()
          });
          if (ver2) {
            cnt = buffer.readShort();
            if (cnt > 0) {
              this._branches = buffer.readSArray(cnt);
              if (_branch) this._branchIndex = this._branches.indexOf(_branch);
            }
            branchIncluded = cnt > 0;
          }
          buffer.seek(indexTablePos, 1);
          var pi;
          var pos = path.lastIndexOf('/');
          var shortPath = pos == -1 ? "" : path.substring(0, pos + 1);
          path = path + "_";
          cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) {
            nextPos = buffer.readInt();
            nextPos += buffer.position;
            pi = new PackageItem();
            pi.owner = this;
            pi.type = buffer.readByte();
            pi.id = buffer.readS();
            pi.name = buffer.readS();
            buffer.readS(); //path
            pi.file = buffer.readS();
            buffer.readBool(); //exported
            pi.width = buffer.readInt();
            pi.height = buffer.readInt();
            switch (pi.type) {
              case PackageItemType.Image:
                {
                  pi.objectType = ObjectType.Image;
                  var scaleOption = buffer.readByte();
                  if (scaleOption == 1) {
                    pi.scale9Grid = new Rect();
                    pi.scale9Grid.x = buffer.readInt();
                    pi.scale9Grid.y = buffer.readInt();
                    pi.scale9Grid.width = buffer.readInt();
                    pi.scale9Grid.height = buffer.readInt();
                    pi.tileGridIndice = buffer.readInt();
                  } else if (scaleOption == 2) pi.scaleByTile = true;
                  pi.smoothing = buffer.readBool();
                  break;
                }
              case PackageItemType.MovieClip:
                {
                  pi.smoothing = buffer.readBool();
                  pi.objectType = ObjectType.MovieClip;
                  pi.rawData = buffer.readBuffer();
                  break;
                }
              case PackageItemType.Font:
                {
                  pi.rawData = buffer.readBuffer();
                  break;
                }
              case PackageItemType.Component:
                {
                  var extension = buffer.readByte();
                  if (extension > 0) pi.objectType = extension;else pi.objectType = ObjectType.Component;
                  pi.rawData = buffer.readBuffer();
                  Decls.UIObjectFactory.resolveExtension(pi);
                  break;
                }
              case PackageItemType.Atlas:
              case PackageItemType.Sound:
              case PackageItemType.Misc:
                {
                  pi.file = path + PathUtils.mainFileName(pi.file);
                  break;
                }
              case PackageItemType.Spine:
              case PackageItemType.DragonBones:
                {
                  pi.file = shortPath + PathUtils.mainFileName(pi.file);
                  pi.skeletonAnchor = new Vec2();
                  pi.skeletonAnchor.x = buffer.readFloat();
                  pi.skeletonAnchor.y = buffer.readFloat();
                  break;
                }
            }
            if (ver2) {
              str = buffer.readS(); //branch
              if (str) pi.name = str + "/" + pi.name;
              var branchCnt = buffer.readByte();
              if (branchCnt > 0) {
                if (branchIncluded) pi.branches = buffer.readSArray(branchCnt);else this._itemsById[buffer.readS()] = pi;
              }
              var highResCnt = buffer.readByte();
              if (highResCnt > 0) pi.highResolution = buffer.readSArray(highResCnt);
            }
            this._items.push(pi);
            this._itemsById[pi.id] = pi;
            if (pi.name != null) this._itemsByName[pi.name] = pi;
            buffer.position = nextPos;
          }
          buffer.seek(indexTablePos, 2);
          cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            var itemId = buffer.readS();
            pi = this._itemsById[buffer.readS()];
            var rect = new Rect();
            rect.x = buffer.readInt();
            rect.y = buffer.readInt();
            rect.width = buffer.readInt();
            rect.height = buffer.readInt();
            var sprite = {
              atlas: pi,
              rect: rect,
              offset: new Vec2(),
              originalSize: new Size(0, 0)
            };
            sprite.rotated = buffer.readBool();
            if (ver2 && buffer.readBool()) {
              sprite.offset.x = buffer.readInt();
              sprite.offset.y = buffer.readInt();
              sprite.originalSize.width = buffer.readInt();
              sprite.originalSize.height = buffer.readInt();
            } else {
              sprite.originalSize.width = sprite.rect.width;
              sprite.originalSize.height = sprite.rect.height;
            }
            this._sprites[itemId] = sprite;
            buffer.position = nextPos;
          }
          if (buffer.seek(indexTablePos, 3)) {
            cnt = buffer.readShort();
            for (i = 0; i < cnt; i++) {
              nextPos = buffer.readInt();
              nextPos += buffer.position;
              pi = this._itemsById[buffer.readS()];
              if (pi && pi.type == PackageItemType.Image) pi.hitTestData = new PixelHitTestData(buffer);
              buffer.position = nextPos;
            }
          }
        };
        _proto31.dispose = function dispose() {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var pi = this._items[i];
            if (pi.asset) assetManager.releaseAsset(pi.asset);
          }
        };
        _proto31.createObject = function createObject(resName, userClass) {
          var pi = this._itemsByName[resName];
          if (pi) return this.internalCreateObject(pi, userClass);else return null;
        };
        _proto31.internalCreateObject = function internalCreateObject(item, userClass) {
          var g = Decls.UIObjectFactory.newObject(item, userClass);
          if (g == null) return null;
          constructingDepth.n++;
          g.constructFromResource();
          constructingDepth.n--;
          return g;
        };
        _proto31.getItemById = function getItemById(itemId) {
          return this._itemsById[itemId];
        };
        _proto31.getItemByName = function getItemByName(resName) {
          return this._itemsByName[resName];
        };
        _proto31.getItemAssetByName = function getItemAssetByName(resName) {
          var pi = this._itemsByName[resName];
          if (pi == null) {
            throw new Error("Resource not found -" + resName);
          }
          return this.getItemAsset(pi);
        };
        _proto31.getItemAsset = function getItemAsset(item) {
          switch (item.type) {
            case PackageItemType.Image:
              if (!item.decoded) {
                item.decoded = true;
                var sprite = this._sprites[item.id];
                if (sprite) {
                  var atlasTexture = this.getItemAsset(sprite.atlas);
                  if (atlasTexture) {
                    var sf = new SpriteFrame();
                    sf.texture = atlasTexture;
                    sf.rect = sprite.rect;
                    sf.rotated = sprite.rotated;
                    sf.offset = new Vec2(sprite.offset.x - (sprite.originalSize.width - sprite.rect.width) / 2, -(sprite.offset.y - (sprite.originalSize.height - sprite.rect.height) / 2));
                    sf.originalSize = sprite.originalSize;
                    if (item.scale9Grid) {
                      sf.insetLeft = item.scale9Grid.x;
                      sf.insetTop = item.scale9Grid.y;
                      sf.insetRight = item.width - item.scale9Grid.xMax;
                      sf.insetBottom = item.height - item.scale9Grid.yMax;
                    }
                    item.asset = sf;
                  }
                }
              }
              break;
            case PackageItemType.Atlas:
            case PackageItemType.Sound:
              if (!item.decoded) {
                item.decoded = true;
                item.asset = this._bundle.get(item.file, ItemTypeToAssetType[item.type]);
                if (!item.asset) console.log("Resource '" + item.file + "' not found");else if (item.type == PackageItemType.Atlas) {
                  var _asset = item.asset;
                  var tex = _asset['_texture'];
                  if (!tex) {
                    tex = new Texture2D();
                    tex.name = _asset.nativeUrl;
                    tex.image = _asset;
                  }
                  item.asset = tex;
                } else {
                  item.asset = item.asset;
                }
              }
              break;
            case PackageItemType.Font:
              if (!item.decoded) {
                item.decoded = true;
                this.loadFont(item);
              }
              break;
            case PackageItemType.MovieClip:
              if (!item.decoded) {
                item.decoded = true;
                this.loadMovieClip(item);
              }
              break;
          }
          return item.asset;
        };
        _proto31.getItemAssetAsync = function getItemAssetAsync(item, onComplete) {
          if (item.decoded) {
            onComplete(null, item);
            return;
          }
          if (item.loading) {
            item.loading.push(onComplete);
            return;
          }
          switch (item.type) {
            case PackageItemType.Spine:
              item.loading = [onComplete];
              this.loadSpine(item);
              break;
            case PackageItemType.DragonBones:
              item.loading = [onComplete];
              this.loadDragonBones(item);
              break;
            default:
              this.getItemAsset(item);
              onComplete(null, item);
              break;
          }
        };
        _proto31.loadAllAssets = function loadAllAssets() {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var pi = this._items[i];
            this.getItemAsset(pi);
          }
        };
        _proto31.loadMovieClip = function loadMovieClip(item) {
          var buffer = item.rawData;
          buffer.seek(0, 0);
          item.interval = buffer.readInt() / 1000;
          item.swing = buffer.readBool();
          item.repeatDelay = buffer.readInt() / 1000;
          buffer.seek(0, 1);
          var frameCount = buffer.readShort();
          item.frames = Array(frameCount);
          var spriteId;
          var sprite;
          for (var i = 0; i < frameCount; i++) {
            var nextPos = buffer.readShort();
            nextPos += buffer.position;
            var rect = new Rect();
            rect.x = buffer.readInt();
            rect.y = buffer.readInt();
            rect.width = buffer.readInt();
            rect.height = buffer.readInt();
            var addDelay = buffer.readInt() / 1000;
            var frame = {
              rect: rect,
              addDelay: addDelay,
              texture: null
            };
            spriteId = buffer.readS();
            if (spriteId != null && (sprite = this._sprites[spriteId]) != null) {
              var atlasTexture = this.getItemAsset(sprite.atlas);
              if (atlasTexture) {
                item.width / frame.rect.width;
                var sf = new SpriteFrame();
                sf.texture = atlasTexture;
                sf.rect = sprite.rect;
                sf.rotated = sprite.rotated;
                sf.offset = new Vec2(frame.rect.x - (item.width - frame.rect.width) / 2, -(frame.rect.y - (item.height - frame.rect.height) / 2));
                sf.originalSize = new Size(item.width, item.height);
                frame.texture = sf;
              }
            }
            item.frames[i] = frame;
            buffer.position = nextPos;
          }
        };
        _proto31.loadFont = function loadFont(item) {
          var font = new BitmapFont();
          item.asset = font;
          font.fntConfig = {
            commonHeight: 0,
            fontSize: 0,
            kerningDict: {},
            fontDefDictionary: {}
          };
          var dict = font.fntConfig.fontDefDictionary;
          var buffer = item.rawData;
          buffer.seek(0, 0);
          var ttf = buffer.readBool();
          var canTint = buffer.readBool();
          var resizable = buffer.readBool();
          buffer.readBool(); //has channel
          var fontSize = buffer.readInt();
          var xadvance = buffer.readInt();
          var lineHeight = buffer.readInt();
          var mainTexture;
          var mainSprite = this._sprites[item.id];
          if (mainSprite) mainTexture = this.getItemAsset(mainSprite.atlas);
          buffer.seek(0, 1);
          var bg;
          var cnt = buffer.readInt();
          for (var i = 0; i < cnt; i++) {
            var nextPos = buffer.readShort();
            nextPos += buffer.position;
            bg = {};
            var ch = buffer.readUshort();
            dict[ch] = bg;
            var rect = new Rect();
            bg.rect = rect;
            var img = buffer.readS();
            rect.x = buffer.readInt();
            rect.y = buffer.readInt();
            bg.xOffset = buffer.readInt();
            bg.yOffset = buffer.readInt();
            rect.width = buffer.readInt();
            rect.height = buffer.readInt();
            bg.xAdvance = buffer.readInt();
            bg.channel = buffer.readByte();
            if (bg.channel == 1) bg.channel = 3;else if (bg.channel == 2) bg.channel = 2;else if (bg.channel == 3) bg.channel = 1;
            if (ttf) {
              rect.x += mainSprite.rect.x;
              rect.y += mainSprite.rect.y;
            } else {
              var sprite = this._sprites[img];
              if (sprite) {
                rect.set(sprite.rect);
                bg.xOffset += sprite.offset.x;
                bg.yOffset += sprite.offset.y;
                if (fontSize == 0) fontSize = sprite.originalSize.height;
                if (!mainTexture) {
                  sprite.atlas.load();
                  mainTexture = sprite.atlas.asset;
                }
              }
              if (bg.xAdvance == 0) {
                if (xadvance == 0) bg.xAdvance = bg.xOffset + bg.rect.width;else bg.xAdvance = xadvance;
              }
            }
            buffer.position = nextPos;
          }
          font.fontSize = fontSize;
          font.fntConfig.fontSize = fontSize;
          font.fntConfig.commonHeight = lineHeight == 0 ? fontSize : lineHeight;
          font.fntConfig.resizable = resizable;
          font.fntConfig.canTint = canTint;
          var spriteFrame = new SpriteFrame();
          spriteFrame.texture = mainTexture;
          font.spriteFrame = spriteFrame;
          font.onLoaded();
        };
        _proto31.loadSpine = function loadSpine(item) {
          this._bundle.load(item.file, sp.SkeletonData, function (err, asset) {
            item.decoded = true;
            item.asset = asset;
            var arr = item.loading;
            delete item.loading;
            arr.forEach(function (e) {
              return e(err, item);
            });
          });
        };
        _proto31.loadDragonBones = function loadDragonBones(item) {
          var _this12 = this;
          this._bundle.load(item.file, dragonBones.DragonBonesAsset, function (err, asset) {
            if (err) {
              item.decoded = true;
              var arr = item.loading;
              delete item.loading;
              arr.forEach(function (e) {
                return e(err, item);
              });
              return;
            }
            item.asset = asset;
            var atlasFile = item.file.replace("_ske", "_tex");
            var pos = atlasFile.lastIndexOf('.');
            if (pos != -1) atlasFile = atlasFile.substring(0, pos + 1) + "json";
            _this12._bundle.load(atlasFile, dragonBones.DragonBonesAtlasAsset, function (err, asset) {
              item.decoded = true;
              item.atlasAsset = asset;
              var arr = item.loading;
              delete item.loading;
              arr.forEach(function (e) {
                return e(err, item);
              });
            });
          });
        };
        _createClass(UIPackage, [{
          key: "id",
          get: function get() {
            return this._id;
          }
        }, {
          key: "name",
          get: function get() {
            return this._name;
          }
        }, {
          key: "path",
          get: function get() {
            return this._path;
          }
        }, {
          key: "dependencies",
          get: function get() {
            return this._dependencies;
          }
        }], [{
          key: "branch",
          get: function get() {
            return _branch;
          },
          set: function set(value) {
            _branch = value;
            for (var pkgId in _instById) {
              var pkg = _instById[pkgId];
              if (pkg._branches) {
                pkg._branchIndex = pkg._branches.indexOf(value);
              }
            }
          }
        }]);
        return UIPackage;
      }());
      var ItemTypeToAssetType = (_ItemTypeToAssetType = {}, _ItemTypeToAssetType[PackageItemType.Atlas] = ImageAsset, _ItemTypeToAssetType[PackageItemType.Sound] = AudioClip, _ItemTypeToAssetType);
      var _instById = {};
      var _instByName = {};
      var _branch = "";
      var _vars = {};
      var Decls = {};
      function toGrayedColor(c) {
        var v = c.r * 0.299 + c.g * 0.587 + c.b * 0.114;
        return new Color(v, v, v, c.a);
      }
      var UBBParser = exports('UBBParser', /*#__PURE__*/function () {
        function UBBParser() {
          this._readPos = 0;
          this._handlers = {};
          this._handlers["url"] = this.onTag_URL;
          this._handlers["img"] = this.onTag_IMG;
          this._handlers["b"] = this.onTag_Simple;
          this._handlers["i"] = this.onTag_Simple;
          this._handlers["u"] = this.onTag_Simple; //this._handlers["sup"] = this.onTag_Simple;
          //this._handlers["sub"] = this.onTag_Simple;
          this._handlers["color"] = this.onTag_COLOR; //this._handlers["font"] = this.onTag_FONT;
          this._handlers["size"] = this.onTag_SIZE;
        }
        var _proto32 = UBBParser.prototype;
        _proto32.onTag_URL = function onTag_URL(tagName, end, attr) {
          if (!end) {
            var ret;
            if (attr != null) ret = "<on click=\"onClickLink\" param=\"" + attr + "\">";else {
              var href = this.getTagText();
              ret = "<on click=\"onClickLink\" param=\"" + href + "\">";
            }
            if (this.linkUnderline) ret += "<u>";
            if (this.linkColor) ret += "<color=" + this.linkColor + ">";
            return ret;
          } else {
            var _ret = "";
            if (this.linkColor) _ret += "</color>";
            if (this.linkUnderline) _ret += "</u>";
            _ret += "</on>";
            return _ret;
          }
        };
        _proto32.onTag_IMG = function onTag_IMG(tagName, end, attr) {
          if (!end) {
            var src = this.getTagText(true);
            if (!src) return null;
            return "<img src=\"" + src + "\"/>";
          } else return null;
        };
        _proto32.onTag_Simple = function onTag_Simple(tagName, end, attr) {
          return end ? "</" + tagName + ">" : "<" + tagName + ">";
        };
        _proto32.onTag_COLOR = function onTag_COLOR(tagName, end, attr) {
          if (!end) {
            this.lastColor = attr;
            return "<color=" + attr + ">";
          } else return "</color>";
        };
        _proto32.onTag_FONT = function onTag_FONT(tagName, end, attr) {
          if (!end) return "<font face=\"" + attr + "\">";else return "</font>";
        };
        _proto32.onTag_SIZE = function onTag_SIZE(tagName, end, attr) {
          if (!end) {
            this.lastSize = attr;
            return "<size=" + attr + ">";
          } else return "</size>";
        };
        _proto32.getTagText = function getTagText(remove) {
          var pos1 = this._readPos;
          var pos2;
          var result = "";
          while ((pos2 = this._text.indexOf("[", pos1)) != -1) {
            if (this._text.charCodeAt(pos2 - 1) == 92)
              //\
              {
                result += this._text.substring(pos1, pos2 - 1);
                result += "[";
                pos1 = pos2 + 1;
              } else {
              result += this._text.substring(pos1, pos2);
              break;
            }
          }
          if (pos2 == -1) return null;
          if (remove) this._readPos = pos2;
          return result;
        };
        _proto32.parse = function parse(text, remove) {
          this._text = text;
          this.lastColor = null;
          this.lastSize = null;
          var pos1 = 0,
            pos2,
            pos3;
          var end;
          var tag, attr;
          var repl;
          var func;
          var result = "";
          while ((pos2 = this._text.indexOf("[", pos1)) != -1) {
            if (pos2 > 0 && this._text.charCodeAt(pos2 - 1) == 92)
              //\
              {
                result += this._text.substring(pos1, pos2 - 1);
                result += "[";
                pos1 = pos2 + 1;
                continue;
              }
            result += this._text.substring(pos1, pos2);
            pos1 = pos2;
            pos2 = this._text.indexOf("]", pos1);
            if (pos2 == -1) break;
            end = this._text.charAt(pos1 + 1) == '/';
            tag = this._text.substring(end ? pos1 + 2 : pos1 + 1, pos2);
            this._readPos = pos2 + 1;
            attr = null;
            repl = null;
            pos3 = tag.indexOf("=");
            if (pos3 != -1) {
              attr = tag.substring(pos3 + 1);
              tag = tag.substring(0, pos3);
            }
            tag = tag.toLowerCase();
            func = this._handlers[tag];
            if (func != null) {
              repl = func.call(this, tag, end, attr);
              if (repl != null && !remove) result += repl;
            } else result += this._text.substring(pos1, this._readPos);
            pos1 = this._readPos;
          }
          if (pos1 < this._text.length) result += this._text.substring(pos1);
          this._text = null;
          return result;
        };
        return UBBParser;
      }());
      var defaultParser = new UBBParser();
      var GTextField = exports('GTextField', /*#__PURE__*/function (_GObject5) {
        _inheritsLoose(GTextField, _GObject5);
        function GTextField() {
          var _this13;
          _this13 = _GObject5.call(this) || this;
          _this13._fontSize = 0;
          _this13._leading = 0;
          _this13._node.name = "GTextField";
          _this13._touchDisabled = true;
          _this13._text = "";
          _this13._color = new Color(255, 255, 255, 255);
          _this13.createRenderer();
          _this13.fontSize = 12;
          _this13.leading = 3;
          _this13.singleLine = false;
          _this13._sizeDirty = false;
          _this13._node.on(Node.EventType.SIZE_CHANGED, _this13.onLabelSizeChanged, _assertThisInitialized(_this13));
          return _this13;
        }
        var _proto33 = GTextField.prototype;
        _proto33.createRenderer = function createRenderer() {
          this._label = this._node.addComponent(Label);
          this._label.string = "";
          this.autoSize = AutoSizeType.Both;
        };
        _proto33.parseTemplate = function parseTemplate(template) {
          var pos1 = 0,
            pos2,
            pos3;
          var tag;
          var value;
          var result = "";
          while ((pos2 = template.indexOf("{", pos1)) != -1) {
            if (pos2 > 0 && template.charCodeAt(pos2 - 1) == 92)
              //\
              {
                result += template.substring(pos1, pos2 - 1);
                result += "{";
                pos1 = pos2 + 1;
                continue;
              }
            result += template.substring(pos1, pos2);
            pos1 = pos2;
            pos2 = template.indexOf("}", pos1);
            if (pos2 == -1) break;
            if (pos2 == pos1 + 1) {
              result += template.substring(pos1, pos1 + 2);
              pos1 = pos2 + 1;
              continue;
            }
            tag = template.substring(pos1 + 1, pos2);
            pos3 = tag.indexOf("=");
            if (pos3 != -1) {
              value = this._templateVars[tag.substring(0, pos3)];
              if (value == null) result += tag.substring(pos3 + 1);else result += value;
            } else {
              value = this._templateVars[tag];
              if (value != null) result += value;
            }
            pos1 = pos2 + 1;
          }
          if (pos1 < template.length) result += template.substring(pos1);
          return result;
        };
        _proto33.setVar = function setVar(name, value) {
          if (!this._templateVars) this._templateVars = {};
          this._templateVars[name] = value;
          return this;
        };
        _proto33.flushVars = function flushVars() {
          this.markSizeChanged();
          this.updateText();
        };
        _proto33.ensureSizeCorrect = function ensureSizeCorrect() {
          if (this._sizeDirty) {
            this._label.updateRenderData(true);
            this._sizeDirty = false;
          }
        };
        _proto33.updateText = function updateText() {
          var text2 = this._text;
          if (this._templateVars) text2 = this.parseTemplate(text2);
          if (this._ubbEnabled)
            //
            text2 = defaultParser.parse(text2, true);
          this._label.string = text2;
        };
        _proto33.assignFont = function assignFont(label, value) {
          if (value instanceof Font) label.font = value;else {
            var font = getFontByName(value);
            if (!font) {
              label.fontFamily = value;
              label.useSystemFont = true;
            } else label.font = font;
          }
        };
        _proto33.assignFontColor = function assignFontColor(label, value) {
          var font = label.font;
          if (font instanceof BitmapFont && !font.fntConfig.canTint) value = Color.WHITE;
          if (this._grayed) value = toGrayedColor(value);
          label.color = value;
        };
        _proto33.updateFont = function updateFont() {
          this.assignFont(this._label, this._realFont);
        };
        _proto33.updateFontColor = function updateFontColor() {
          this.assignFontColor(this._label, this._color);
        };
        _proto33.updateStrokeColor = function updateStrokeColor() {
          if (!this._label || !this._label.enableOutline) return;
          if (!this._strokeColor) this._strokeColor = new Color();
          if (this._grayed) this._label.outlineColor = toGrayedColor(this._strokeColor);else this._label.outlineColor = this._strokeColor;
        };
        _proto33.updateShadowColor = function updateShadowColor() {
          if (!this._label || !this._label.enableShadow) return;
          if (!this._shadowColor) this._shadowColor = new Color();
          if (this._grayed) this._label.shadowColor = toGrayedColor(this._shadowColor);else this._label.shadowColor = this._shadowColor;
        };
        _proto33.updateFontSize = function updateFontSize() {
          var font = this._label.font;
          if (font instanceof BitmapFont) {
            var fntConfig = font.fntConfig;
            if (fntConfig.resizable) this._label.fontSize = this._fontSize;else this._label.fontSize = fntConfig.fontSize;
            this._label.lineHeight = fntConfig.fontSize + (this._leading + 4) * fntConfig.fontSize / this._label.fontSize;
          } else {
            this._label.fontSize = this._fontSize;
            this._label.lineHeight = this._fontSize + this._leading;
          }
        };
        _proto33.updateOverflow = function updateOverflow() {
          if (this._autoSize == AutoSizeType.Both) this._label.overflow = Label.Overflow.NONE;else if (this._autoSize == AutoSizeType.Height) {
            this._label.overflow = Label.Overflow.RESIZE_HEIGHT;
            this._uiTrans.width = this._width;
          } else if (this._autoSize == AutoSizeType.Shrink) {
            this._label.overflow = Label.Overflow.SHRINK;
            this._uiTrans.setContentSize(this._width, this._height);
          } else {
            this._label.overflow = Label.Overflow.CLAMP;
            this._uiTrans.setContentSize(this._width, this._height);
          }
        };
        _proto33.markSizeChanged = function markSizeChanged() {
          if (this._underConstruct) return;
          if (this._autoSize == AutoSizeType.Both || this._autoSize == AutoSizeType.Height) {
            if (!this._sizeDirty) {
              this._node.emit(Event.SIZE_DELAY_CHANGE);
              this._sizeDirty = true;
            }
          }
        };
        _proto33.onLabelSizeChanged = function onLabelSizeChanged() {
          this._sizeDirty = false;
          if (this._underConstruct) return;
          if (this._autoSize == AutoSizeType.Both || this._autoSize == AutoSizeType.Height) {
            this._updatingSize = true;
            this.setSize(this._uiTrans.width, this._uiTrans.height);
            this._updatingSize = false;
          }
        };
        _proto33.handleSizeChanged = function handleSizeChanged() {
          if (this._updatingSize) return;
          if (this._autoSize == AutoSizeType.None || this._autoSize == AutoSizeType.Shrink) {
            this._uiTrans.setContentSize(this._width, this._height);
          } else if (this._autoSize == AutoSizeType.Height) this._uiTrans.width = this._width;
        };
        _proto33.handleGrayedChanged = function handleGrayedChanged() {
          this.updateFontColor();
          this.updateStrokeColor();
        };
        _proto33.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.color;
            case ObjectPropID.OutlineColor:
              return this.strokeColor;
            case ObjectPropID.FontSize:
              return this.fontSize;
            default:
              return _GObject5.prototype.getProp.call(this, index);
          }
        };
        _proto33.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.color = value;
              break;
            case ObjectPropID.OutlineColor:
              this.strokeColor = value;
              break;
            case ObjectPropID.FontSize:
              this.fontSize = value;
              break;
            default:
              _GObject5.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto33.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject5.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this.font = buffer.readS();
          this.fontSize = buffer.readShort();
          this.color = buffer.readColor();
          this.align = buffer.readByte();
          this.verticalAlign = buffer.readByte();
          this.leading = buffer.readShort();
          this.letterSpacing = buffer.readShort();
          this._ubbEnabled = buffer.readBool();
          this.autoSize = buffer.readByte();
          this.underline = buffer.readBool();
          this.italic = buffer.readBool();
          this.bold = buffer.readBool();
          this.singleLine = buffer.readBool();
          if (buffer.readBool()) {
            this.strokeColor = buffer.readColor();
            this.stroke = buffer.readFloat();
          }
          if (buffer.readBool()) {
            this.shadowColor = buffer.readColor();
            var f1 = buffer.readFloat();
            var f2 = buffer.readFloat();
            this.shadowOffset = new Vec2(f1, f2);
          }
          if (buffer.readBool()) this._templateVars = {};
        };
        _proto33.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GObject5.prototype.setup_afterAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 6);
          var str = buffer.readS();
          if (str != null) {
            this.text = str;
          } else {
            this.text = "";
          }
        };
        _createClass(GTextField, [{
          key: "text",
          get: function get() {
            return this._text;
          },
          set: function set(value) {
            this._text = value;
            if (this._text == null) this._text = "";
            this.updateGear(6);
            this.markSizeChanged();
            this.updateText();
          }
        }, {
          key: "font",
          get: function get() {
            return this._font;
          },
          set: function set(value) {
            if (this._font != value || !value) {
              this._font = value;
              this.markSizeChanged();
              var newFont = value ? value : UIConfig.defaultFont;
              if (newFont.startsWith("ui://")) {
                var pi = UIPackage.getItemByURL(newFont);
                if (pi) newFont = pi.owner.getItemAsset(pi);else newFont = UIConfig.defaultFont;
              }
              this._realFont = newFont;
              this.updateFont();
            }
          }
        }, {
          key: "fontSize",
          get: function get() {
            return this._fontSize;
          },
          set: function set(value) {
            if (value < 0) return;
            if (this._fontSize != value) {
              this._fontSize = value;
              this.markSizeChanged();
              this.updateFontSize();
            }
          }
        }, {
          key: "color",
          get: function get() {
            return this._color;
          },
          set: function set(value) {
            this._color.set(value);
            this.updateGear(4);
            this.updateFontColor();
          }
        }, {
          key: "align",
          get: function get() {
            return this._label ? this._label.horizontalAlign : 0;
          },
          set: function set(value) {
            if (this._label) this._label.horizontalAlign = value;
          }
        }, {
          key: "verticalAlign",
          get: function get() {
            return this._label ? this._label.verticalAlign : 0;
          },
          set: function set(value) {
            if (this._label) this._label.verticalAlign = value;
          }
        }, {
          key: "leading",
          get: function get() {
            return this._leading;
          },
          set: function set(value) {
            if (this._leading != value) {
              this._leading = value;
              this.markSizeChanged();
              this.updateFontSize();
            }
          }
        }, {
          key: "letterSpacing",
          get: function get() {
            return this._label ? this._label.spacingX : 0;
          },
          set: function set(value) {
            if (this._label && this._label.spacingX != value) {
              this.markSizeChanged();
              this._label.spacingX = value;
            }
          }
        }, {
          key: "underline",
          get: function get() {
            return this._label ? this._label.isUnderline : false;
          },
          set: function set(value) {
            if (this._label) this._label.isUnderline = value;
          }
        }, {
          key: "bold",
          get: function get() {
            return this._label ? this._label.isBold : false;
          },
          set: function set(value) {
            if (this._label) this._label.isBold = value;
          }
        }, {
          key: "italic",
          get: function get() {
            return this._label ? this._label.isItalic : false;
          },
          set: function set(value) {
            if (this._label) this._label.isItalic = value;
          }
        }, {
          key: "singleLine",
          get: function get() {
            return this._label ? !this._label.enableWrapText : false;
          },
          set: function set(value) {
            if (this._label) this._label.enableWrapText = !value;
          }
        }, {
          key: "stroke",
          get: function get() {
            return this._label ? this._label.outlineWidth : 0;
          },
          set: function set(value) {
            if (!this._label) return;
            this._label.outlineWidth = value;
            this._label.enableOutline = value > 0;
            if (value > 0) this.updateStrokeColor();
          }
        }, {
          key: "strokeColor",
          get: function get() {
            return this._strokeColor;
          },
          set: function set(value) {
            if (!this._strokeColor) this._strokeColor = new Color();
            this._strokeColor.set(value);
            this.updateGear(4);
            this.updateStrokeColor();
          }
        }, {
          key: "shadowOffset",
          get: function get() {
            return this._shadowOffset;
          },
          set: function set(value) {
            if (!this._shadowOffset) this._shadowOffset = new Vec2();
            this._shadowOffset.set(value);
            if (!this._label) return;
            this._label.shadowOffset = new Vec2(this._shadowOffset.x, -this._shadowOffset.y);
            this._label.enableShadow = value.x != 0 || value.y != 0;
            if (this._label.enableShadow) this.updateShadowColor();
          }
        }, {
          key: "shadowColor",
          get: function get() {
            return this._shadowColor;
          },
          set: function set(value) {
            if (!this._shadowColor) this._shadowColor = new Color();
            this._shadowColor.set(value);
            this.updateShadowColor();
          }
        }, {
          key: "ubbEnabled",
          get: function get() {
            return this._ubbEnabled;
          },
          set: function set(value) {
            if (this._ubbEnabled != value) {
              this._ubbEnabled = value;
              this.markSizeChanged();
              this.updateText();
            }
          }
        }, {
          key: "autoSize",
          get: function get() {
            return this._autoSize;
          },
          set: function set(value) {
            if (this._autoSize != value) {
              this._autoSize = value;
              this.markSizeChanged();
              this.updateOverflow();
            }
          }
        }, {
          key: "templateVars",
          get: function get() {
            return this._templateVars;
          },
          set: function set(value) {
            if (this._templateVars == null && value == null) return;
            this._templateVars = value;
            this.flushVars();
          }
        }, {
          key: "textWidth",
          get: function get() {
            this.ensureSizeCorrect();
            return this._uiTrans.width;
          }
        }]);
        return GTextField;
      }(GObject));
      var RichTextImageAtlas = /*#__PURE__*/function (_SpriteAtlas) {
        _inheritsLoose(RichTextImageAtlas, _SpriteAtlas);
        function RichTextImageAtlas() {
          return _SpriteAtlas.apply(this, arguments) || this;
        }
        var _proto34 = RichTextImageAtlas.prototype;
        _proto34.getSpriteFrame = function getSpriteFrame(key) {
          var pi = UIPackage.getItemByURL(key);
          if (pi) {
            pi.load();
            if (pi.type == PackageItemType.Image) return pi.asset;else if (pi.type == PackageItemType.MovieClip) return pi.frames[0].texture;
          }
          return _SpriteAtlas.prototype.getSpriteFrame.call(this, key);
        };
        return RichTextImageAtlas;
      }(SpriteAtlas);
      var imageAtlas = new RichTextImageAtlas();
      var GRichTextField = exports('GRichTextField', /*#__PURE__*/function (_GTextField) {
        _inheritsLoose(GRichTextField, _GTextField);
        function GRichTextField() {
          var _this14;
          _this14 = _GTextField.call(this) || this;
          _this14._node.name = "GRichTextField";
          _this14._touchDisabled = false;
          _this14.linkUnderline = UIConfig.linkUnderline;
          return _this14;
        }
        var _proto35 = GRichTextField.prototype;
        _proto35.createRenderer = function createRenderer() {
          this._richText = this._node.addComponent(RichText);
          this._richText.handleTouchEvent = false;
          this.autoSize = AutoSizeType.None;
          this._richText.imageAtlas = imageAtlas;
        };
        _proto35.markSizeChanged = function markSizeChanged() {//RichText
        };
        _proto35.updateText = function updateText() {
          var text2 = this._text;
          if (this._templateVars) text2 = this.parseTemplate(text2);
          if (this._ubbEnabled) {
            defaultParser.linkUnderline = this.linkUnderline;
            defaultParser.linkColor = this.linkColor;
            text2 = defaultParser.parse(text2);
          }
          if (this._bold) text2 = "<b>" + text2 + "</b>";
          if (this._italics) text2 = "<i>" + text2 + "</i>";
          if (this._underline) text2 = "<u>" + text2 + "</u>";
          var c = this._color;
          if (this._grayed) c = toGrayedColor(c);
          text2 = "<color=" + c.toHEX("#rrggbb") + ">" + text2 + "</color>";
          if (this._autoSize == AutoSizeType.Both) {
            if (this._richText.maxWidth != 0) this._richText["_maxWidth"] = 0;
            this._richText.string = text2;
            if (this.maxWidth != 0 && this._uiTrans.contentSize.width > this.maxWidth) this._richText.maxWidth = this.maxWidth;
          } else this._richText.string = text2;
        };
        _proto35.updateFont = function updateFont() {
          this.assignFont(this._richText, this._realFont);
        };
        _proto35.updateFontColor = function updateFontColor() {
          this.assignFontColor(this._richText, this._color);
        };
        _proto35.updateFontSize = function updateFontSize() {
          var fontSize = this._fontSize;
          var font = this._richText.font;
          if (font instanceof BitmapFont) {
            if (!font.fntConfig.resizable) fontSize = font.fntConfig.fontSize;
          }
          this._richText.fontSize = fontSize;
          this._richText.lineHeight = fontSize + this._leading * 2;
        };
        _proto35.updateOverflow = function updateOverflow() {
          if (this._autoSize == AutoSizeType.Both) this._richText.maxWidth = 0;else this._richText.maxWidth = this._width;
        };
        _proto35.handleSizeChanged = function handleSizeChanged() {
          if (this._updatingSize) return;
          if (this._autoSize != AutoSizeType.Both) this._richText.maxWidth = this._width;
        };
        _createClass(GRichTextField, [{
          key: "align",
          get: function get() {
            return this._richText.horizontalAlign;
          },
          set: function set(value) {
            this._richText.horizontalAlign = value;
          }
        }, {
          key: "underline",
          get: function get() {
            return this._underline;
          },
          set: function set(value) {
            if (this._underline != value) {
              this._underline = value;
              this.updateText();
            }
          }
        }, {
          key: "bold",
          get: function get() {
            return this._bold;
          },
          set: function set(value) {
            if (this._bold != value) {
              this._bold = value;
              this.updateText();
            }
          }
        }, {
          key: "italic",
          get: function get() {
            return this._italics;
          },
          set: function set(value) {
            if (this._italics != value) {
              this._italics = value;
              this.updateText();
            }
          }
        }]);
        return GRichTextField;
      }(GTextField));
      var InputProcessor = /*#__PURE__*/function (_Component2) {
        _inheritsLoose(InputProcessor, _Component2);
        function InputProcessor() {
          var _this15;
          _this15 = _Component2.call(this) || this;
          _this15._touches = new Array();
          _this15._rollOutChain = new Array();
          _this15._rollOverChain = new Array();
          _this15._touchPos = new Vec2();
          return _this15;
        }
        var _proto36 = InputProcessor.prototype;
        _proto36.onLoad = function onLoad() {
          this._owner = GObject.cast(this.node);
        };
        _proto36.onEnable = function onEnable() {
          var node = this.node;
          node.on(Node.EventType.TOUCH_START, this.touchBeginHandler, this);
          node.on(Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);
          node.on(Node.EventType.TOUCH_END, this.touchEndHandler, this);
          node.on(Node.EventType.TOUCH_CANCEL, this.touchCancelHandler, this);
          node.on(Node.EventType.MOUSE_DOWN, this.mouseDownHandler, this);
          node.on(Node.EventType.MOUSE_MOVE, this.mouseMoveHandler, this);
          node.on(Node.EventType.MOUSE_UP, this.mouseUpHandler, this);
          node.on(Node.EventType.MOUSE_WHEEL, this.mouseWheelHandler, this);
          this._touchListener = this.node.eventProcessor.touchListener;
        };
        _proto36.onDisable = function onDisable() {
          var node = this.node;
          node.off(Node.EventType.TOUCH_START, this.touchBeginHandler, this);
          node.off(Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);
          node.off(Node.EventType.TOUCH_END, this.touchEndHandler, this);
          node.off(Node.EventType.TOUCH_CANCEL, this.touchCancelHandler, this);
          node.off(Node.EventType.MOUSE_DOWN, this.mouseDownHandler, this);
          node.off(Node.EventType.MOUSE_MOVE, this.mouseMoveHandler, this);
          node.off(Node.EventType.MOUSE_UP, this.mouseUpHandler, this);
          node.off(Node.EventType.MOUSE_WHEEL, this.mouseWheelHandler, this);
          this._touchListener = null;
        };
        _proto36.getAllTouches = function getAllTouches(touchIds) {
          touchIds = touchIds || new Array();
          var cnt = this._touches.length;
          for (var i = 0; i < cnt; i++) {
            var ti = this._touches[i];
            if (ti.touchId != -1) touchIds.push(ti.touchId);
          }
          return touchIds;
        };
        _proto36.getTouchPosition = function getTouchPosition(touchId) {
          if (touchId === undefined) touchId = -1;
          var cnt = this._touches.length;
          for (var i = 0; i < cnt; i++) {
            var ti = this._touches[i];
            if (ti.touchId != -1 && (touchId == -1 || ti.touchId == touchId)) return ti.pos;
          }
          return Vec2.ZERO;
        };
        _proto36.getTouchTarget = function getTouchTarget() {
          var cnt = this._touches.length;
          for (var i = 0; i < cnt; i++) {
            var ti = this._touches[i];
            if (ti.touchId != -1) return ti.target;
          }
          return null;
        };
        _proto36.addTouchMonitor = function addTouchMonitor(touchId, target) {
          var ti = this.getInfo(touchId, false);
          if (!ti) return;
          var index = ti.touchMonitors.indexOf(target);
          if (index == -1) ti.touchMonitors.push(target);
        };
        _proto36.removeTouchMonitor = function removeTouchMonitor(target) {
          var cnt = this._touches.length;
          for (var i = 0; i < cnt; i++) {
            var ti = this._touches[i];
            var index = ti.touchMonitors.indexOf(target);
            if (index != -1) ti.touchMonitors.splice(index, 1);
          }
        };
        _proto36.cancelClick = function cancelClick(touchId) {
          var ti = this.getInfo(touchId, false);
          if (ti) ti.clickCancelled = true;
        };
        _proto36.simulateClick = function simulateClick(target) {
          var evt;
          evt = borrowEvent(Event.TOUCH_BEGIN, true);
          evt.initiator = target;
          evt.pos.set(target.localToGlobal());
          evt.touchId = 0;
          evt.clickCount = 1;
          evt.button = 0;
          evt._processor = this;
          if (this._captureCallback) this._captureCallback.call(this._owner, evt);
          target.node.dispatchEvent(evt);
          evt.unuse();
          evt.type = Event.TOUCH_END;
          evt.bubbles = true;
          target.node.dispatchEvent(evt);
          evt.unuse();
          evt.type = Event.CLICK;
          evt.bubbles = true;
          target.node.dispatchEvent(evt);
          returnEvent(evt);
        };
        _proto36.touchBeginHandler = function touchBeginHandler(evt) {
          var ti = this.updateInfo(evt.getID(), evt.getLocation());
          this.setBegin(ti);
          if (this._touchListener) {
            this._touchListener.setSwallowTouches(ti.target != this._owner);
          } else {
            // since cc3.4.0, setSwallowTouches removed
            var e = evt;
            e.preventSwallow = ti.target == this._owner;
          }
          var evt2 = this.getEvent(ti, ti.target, Event.TOUCH_BEGIN, true);
          if (this._captureCallback) this._captureCallback.call(this._owner, evt2);
          ti.target.node.dispatchEvent(evt2);
          this.handleRollOver(ti, ti.target);
          return true;
        };
        _proto36.touchMoveHandler = function touchMoveHandler(evt) {
          var ti = this.updateInfo(evt.getID(), evt.getLocation());
          if (!this._touchListener) {
            var e = evt;
            e.preventSwallow = ti.target == this._owner;
          }
          this.handleRollOver(ti, ti.target);
          if (ti.began) {
            var evt2 = this.getEvent(ti, ti.target, Event.TOUCH_MOVE, false);
            var done = false;
            var cnt = ti.touchMonitors.length;
            for (var i = 0; i < cnt; i++) {
              var mm = ti.touchMonitors[i];
              if (mm.node == null || !mm.node.activeInHierarchy) continue;
              evt2.unuse();
              evt2.type = Event.TOUCH_MOVE;
              mm.node.dispatchEvent(evt2);
              if (mm == this._owner) done = true;
            }
            if (!done && this.node) {
              evt2.unuse();
              evt2.type = Event.TOUCH_MOVE;
              this.node.dispatchEvent(evt2);
            }
            returnEvent(evt2);
          }
        };
        _proto36.touchEndHandler = function touchEndHandler(evt) {
          var ti = this.updateInfo(evt.getID(), evt.getLocation());
          if (!this._touchListener) {
            var e = evt;
            e.preventSwallow = ti.target == this._owner;
          }
          this.setEnd(ti);
          var evt2 = this.getEvent(ti, ti.target, Event.TOUCH_END, false);
          var cnt = ti.touchMonitors.length;
          for (var i = 0; i < cnt; i++) {
            var mm = ti.touchMonitors[i];
            if (mm == ti.target || mm.node == null || !mm.node.activeInHierarchy || 'isAncestorOf' in mm && mm.isAncestorOf(ti.target)) continue;
            evt2.unuse();
            evt2.type = Event.TOUCH_END;
            mm.node.dispatchEvent(evt2);
          }
          ti.touchMonitors.length = 0;
          if (ti.target && ti.target.node) {
            if (ti.target instanceof GRichTextField) ti.target.node.getComponent(RichText)["_onTouchEnded"](evt);
            evt2.unuse();
            evt2.type = Event.TOUCH_END;
            evt2.bubbles = true;
            ti.target.node.dispatchEvent(evt2);
          }
          returnEvent(evt2);
          ti.target = this.clickTest(ti);
          if (ti.target) {
            evt2 = this.getEvent(ti, ti.target, Event.CLICK, true);
            ti.target.node.dispatchEvent(evt2);
            returnEvent(evt2);
          }
          if (sys.isMobile)
            //on mobile platform, trigger RollOut on up event, but not on PC
            this.handleRollOver(ti, null);else this.handleRollOver(ti, ti.target);
          ti.target = null;
          ti.touchId = -1;
          ti.button = -1;
        };
        _proto36.touchCancelHandler = function touchCancelHandler(evt) {
          var ti = this.updateInfo(evt.getID(), evt.getLocation());
          if (!this._touchListener) {
            var e = evt;
            e.preventSwallow = ti.target == this._owner;
          }
          var evt2 = this.getEvent(ti, ti.target, Event.TOUCH_END, false);
          var cnt = ti.touchMonitors.length;
          for (var i = 0; i < cnt; i++) {
            var mm = ti.touchMonitors[i];
            if (mm == ti.target || mm.node == null || !mm.node.activeInHierarchy || 'isAncestorOf' in mm && mm.isAncestorOf(ti.target)) continue;
            evt2.initiator = mm;
            mm.node.dispatchEvent(evt2);
          }
          ti.touchMonitors.length = 0;
          if (ti.target && ti.target.node) {
            evt2.bubbles = true;
            ti.target.node.dispatchEvent(evt2);
          }
          returnEvent(evt2);
          this.handleRollOver(ti, null);
          ti.target = null;
          ti.touchId = -1;
          ti.button = -1;
        };
        _proto36.mouseDownHandler = function mouseDownHandler(evt) {
          var ti = this.getInfo(0, true);
          ti.button = evt.getButton();
        };
        _proto36.mouseUpHandler = function mouseUpHandler(evt) {
          var ti = this.getInfo(0, true);
          ti.button = evt.getButton();
        };
        _proto36.mouseMoveHandler = function mouseMoveHandler(evt) {
          var ti = this.getInfo(0, false);
          if (ti && Math.abs(ti.pos.x - evt.getLocationX()) < 1 && Math.abs(ti.pos.y - (UIContentScaler.rootSize.height - evt.getLocationY())) < 1) return;
          ti = this.updateInfo(0, evt.getLocation());
          this.handleRollOver(ti, ti.target);
          if (ti.began) {
            var evt2 = this.getEvent(ti, ti.target, Event.TOUCH_MOVE, false);
            var done = false;
            var cnt = ti.touchMonitors.length;
            for (var i = 0; i < cnt; i++) {
              var mm = ti.touchMonitors[i];
              if (mm.node == null || !mm.node.activeInHierarchy) continue;
              evt2.initiator = mm;
              mm.node.dispatchEvent(evt2);
              if (mm == this._owner) done = true;
            }
            if (!done && this.node) {
              evt2.initiator = this._owner;
              this.node.dispatchEvent(evt2);
              returnEvent(evt2);
            }
            returnEvent(evt2);
          }
        };
        _proto36.mouseWheelHandler = function mouseWheelHandler(evt) {
          var ti = this.updateInfo(0, evt.getLocation());
          ti.mouseWheelDelta = Math.max(evt.getScrollX(), evt.getScrollY());
          var evt2 = this.getEvent(ti, ti.target, Event.MOUSE_WHEEL, true);
          ti.target.node.dispatchEvent(evt2);
          returnEvent(evt2);
        };
        _proto36.updateInfo = function updateInfo(touchId, pos) {
          var camera = director.root.batcher2D.getFirstRenderCamera(this.node);
          if (camera) {
            s_vec3.set(pos.x, pos.y);
            camera.screenToWorld(s_vec3_2, s_vec3);
            this._touchPos.set(s_vec3_2.x, s_vec3_2.y);
          } else this._touchPos.set(pos);
          this._touchPos.y = UIContentScaler.rootSize.height - this._touchPos.y;
          var target = this._owner.hitTest(this._touchPos);
          if (!target) target = this._owner;
          var ti = this.getInfo(touchId);
          ti.target = target;
          ti.pos.set(this._touchPos);
          ti.button = EventMouse.BUTTON_LEFT;
          ti.touchId = touchId;
          return ti;
        };
        _proto36.getInfo = function getInfo(touchId, createIfNotExisits) {
          if (createIfNotExisits === undefined) createIfNotExisits = true;
          var ret = null;
          var cnt = this._touches.length;
          for (var i = 0; i < cnt; i++) {
            var ti = this._touches[i];
            if (ti.touchId == touchId) return ti;else if (ti.touchId == -1) ret = ti;
          }
          if (!ret) {
            if (!createIfNotExisits) return null;
            ret = new TouchInfo();
            this._touches.push(ret);
          }
          ret.touchId = touchId;
          return ret;
        };
        _proto36.setBegin = function setBegin(ti) {
          ti.began = true;
          ti.clickCancelled = false;
          ti.downPos.set(ti.pos);
          ti.downTargets.length = 0;
          var obj = ti.target;
          while (obj) {
            ti.downTargets.push(obj);
            obj = obj.findParent();
          }
        };
        _proto36.setEnd = function setEnd(ti) {
          ti.began = false;
          var now = game.totalTime / 1000;
          var elapsed = now - ti.lastClickTime;
          if (elapsed < 0.45) {
            if (ti.clickCount == 2) ti.clickCount = 1;else ti.clickCount++;
          } else ti.clickCount = 1;
          ti.lastClickTime = now;
        };
        _proto36.clickTest = function clickTest(ti) {
          if (ti.downTargets.length == 0 || ti.clickCancelled || Math.abs(ti.pos.x - ti.downPos.x) > 50 || Math.abs(ti.pos.y - ti.downPos.y) > 50) return null;
          var obj = ti.downTargets[0];
          if (obj && obj.node && obj.node.activeInHierarchy) return obj;
          obj = ti.target;
          while (obj) {
            var index = ti.downTargets.indexOf(obj);
            if (index != -1 && obj.node && obj.node.activeInHierarchy) break;
            obj = obj.findParent();
          }
          return obj;
        };
        _proto36.handleRollOver = function handleRollOver(ti, target) {
          if (ti.lastRollOver == target) return;
          var element = ti.lastRollOver;
          while (element && element.node) {
            this._rollOutChain.push(element);
            element = element.findParent();
          }
          element = target;
          while (element && element.node) {
            var i = this._rollOutChain.indexOf(element);
            if (i != -1) {
              this._rollOutChain.length = i;
              break;
            }
            this._rollOverChain.push(element);
            element = element.findParent();
          }
          ti.lastRollOver = target;
          var cnt = this._rollOutChain.length;
          for (var _i = 0; _i < cnt; _i++) {
            element = this._rollOutChain[_i];
            if (element.node && element.node.activeInHierarchy) {
              var evt = this.getEvent(ti, element, Event.ROLL_OUT, false);
              element.node.dispatchEvent(evt);
              returnEvent(evt);
            }
          }
          cnt = this._rollOverChain.length;
          for (var _i2 = 0; _i2 < cnt; _i2++) {
            element = this._rollOverChain[_i2];
            if (element.node && element.node.activeInHierarchy) {
              var _evt = this.getEvent(ti, element, Event.ROLL_OVER, false);
              element.node.dispatchEvent(_evt);
              returnEvent(_evt);
            }
          }
          this._rollOutChain.length = 0;
          this._rollOverChain.length = 0;
        };
        _proto36.getEvent = function getEvent(ti, target, type, bubbles) {
          var evt = borrowEvent(type, bubbles);
          evt.initiator = target;
          evt.pos.set(ti.pos);
          evt.touchId = ti.touchId;
          evt.clickCount = ti.clickCount;
          evt.button = ti.button;
          evt.mouseWheelDelta = ti.mouseWheelDelta;
          evt._processor = this;
          return evt;
        };
        return InputProcessor;
      }(Component);
      var TouchInfo = function TouchInfo() {
        this.pos = new Vec2();
        this.touchId = 0;
        this.clickCount = 0;
        this.mouseWheelDelta = 0;
        this.button = -1;
        this.downPos = new Vec2();
        this.began = false;
        this.clickCancelled = false;
        this.lastClickTime = 0;
        this.downTargets = new Array();
        this.touchMonitors = new Array();
      };
      var s_vec3 = new Vec3();
      var s_vec3_2 = new Vec3();
      var ControllerAction = /*#__PURE__*/function () {
        function ControllerAction() {}
        var _proto37 = ControllerAction.prototype;
        _proto37.run = function run(controller, prevPage, curPage) {
          if ((!this.fromPage || this.fromPage.length == 0 || this.fromPage.indexOf(prevPage) != -1) && (!this.toPage || this.toPage.length == 0 || this.toPage.indexOf(curPage) != -1)) this.enter(controller);else this.leave(controller);
        };
        _proto37.enter = function enter(controller) {};
        _proto37.leave = function leave(controller) {};
        _proto37.setup = function setup(buffer) {
          var cnt;
          var i;
          cnt = buffer.readShort();
          this.fromPage = [];
          for (i = 0; i < cnt; i++) this.fromPage[i] = buffer.readS();
          cnt = buffer.readShort();
          this.toPage = [];
          for (i = 0; i < cnt; i++) this.toPage[i] = buffer.readS();
        };
        return ControllerAction;
      }();
      var PlayTransitionAction = /*#__PURE__*/function (_ControllerAction) {
        _inheritsLoose(PlayTransitionAction, _ControllerAction);
        function PlayTransitionAction() {
          var _this16;
          _this16 = _ControllerAction.call(this) || this;
          _this16.playTimes = 1;
          _this16.delay = 0;
          return _this16;
        }
        var _proto38 = PlayTransitionAction.prototype;
        _proto38.enter = function enter(controller) {
          var trans = controller.parent.getTransition(this.transitionName);
          if (trans) {
            if (this._currentTransition && this._currentTransition.playing) trans.changePlayTimes(this.playTimes);else trans.play(null, this.playTimes, this.delay);
            this._currentTransition = trans;
          }
        };
        _proto38.leave = function leave(controller) {
          if (this.stopOnExit && this._currentTransition) {
            this._currentTransition.stop();
            this._currentTransition = null;
          }
        };
        _proto38.setup = function setup(buffer) {
          _ControllerAction.prototype.setup.call(this, buffer);
          this.transitionName = buffer.readS();
          this.playTimes = buffer.readInt();
          this.delay = buffer.readFloat();
          this.stopOnExit = buffer.readBool();
        };
        return PlayTransitionAction;
      }(ControllerAction);
      var ChangePageAction = /*#__PURE__*/function (_ControllerAction2) {
        _inheritsLoose(ChangePageAction, _ControllerAction2);
        function ChangePageAction() {
          return _ControllerAction2.call(this) || this;
        }
        var _proto39 = ChangePageAction.prototype;
        _proto39.enter = function enter(controller) {
          if (!this.controllerName) return;
          var gcom;
          if (this.objectId) gcom = controller.parent.getChildById(this.objectId);else gcom = controller.parent;
          if (gcom) {
            var cc = gcom.getController(this.controllerName);
            if (cc && cc != controller && !cc.changing) {
              if (this.targetPage == "~1") {
                if (controller.selectedIndex < cc.pageCount) cc.selectedIndex = controller.selectedIndex;
              } else if (this.targetPage == "~2") cc.selectedPage = controller.selectedPage;else cc.selectedPageId = this.targetPage;
            }
          }
        };
        _proto39.setup = function setup(buffer) {
          _ControllerAction2.prototype.setup.call(this, buffer);
          this.objectId = buffer.readS();
          this.controllerName = buffer.readS();
          this.targetPage = buffer.readS();
        };
        return ChangePageAction;
      }(ControllerAction);
      var _nextPageId = 0;
      var Controller = exports('Controller', /*#__PURE__*/function (_EventTarget) {
        _inheritsLoose(Controller, _EventTarget);
        function Controller() {
          var _this17;
          _this17 = _EventTarget.call(this) || this;
          _this17._pageIds = [];
          _this17._pageNames = [];
          _this17._selectedIndex = -1;
          _this17._previousIndex = -1;
          return _this17;
        }
        var _proto40 = Controller.prototype;
        _proto40.dispose = function dispose() {};
        _proto40.onChanged = function onChanged(callback, thisArg) {
          this.on(Event.STATUS_CHANGED, callback, thisArg);
        };
        _proto40.offChanged = function offChanged(callback, thisArg) {
          this.off(Event.STATUS_CHANGED, callback, thisArg);
        } //selectedIndex
        ;
        _proto40.setSelectedIndex = function setSelectedIndex(value) {
          if (this._selectedIndex != value) {
            if (value > this._pageIds.length - 1) throw new Error("index out of bounds: " + value);
            this.changing = true;
            this._previousIndex = this._selectedIndex;
            this._selectedIndex = value;
            this.parent.applyController(this);
            this.changing = false;
          }
        }; //selectedPage
        _proto40.setSelectedPage = function setSelectedPage(value) {
          var i = this._pageNames.indexOf(value);
          if (i == -1) i = 0;
          this.setSelectedIndex(i);
        };
        _proto40.getPageName = function getPageName(index) {
          return this._pageNames[index];
        };
        _proto40.addPage = function addPage(name) {
          name = name || "";
          this.addPageAt(name, this._pageIds.length);
        };
        _proto40.addPageAt = function addPageAt(name, index) {
          name = name || "";
          var nid = "" + _nextPageId++;
          if (index == null || index == this._pageIds.length) {
            this._pageIds.push(nid);
            this._pageNames.push(name);
          } else {
            this._pageIds.splice(index, 0, nid);
            this._pageNames.splice(index, 0, name);
          }
        };
        _proto40.removePage = function removePage(name) {
          var i = this._pageNames.indexOf(name);
          if (i != -1) {
            this._pageIds.splice(i, 1);
            this._pageNames.splice(i, 1);
            if (this._selectedIndex >= this._pageIds.length) this.selectedIndex = this._selectedIndex - 1;else this.parent.applyController(this);
          }
        };
        _proto40.removePageAt = function removePageAt(index) {
          this._pageIds.splice(index, 1);
          this._pageNames.splice(index, 1);
          if (this._selectedIndex >= this._pageIds.length) this.selectedIndex = this._selectedIndex - 1;else this.parent.applyController(this);
        };
        _proto40.clearPages = function clearPages() {
          this._pageIds.length = 0;
          this._pageNames.length = 0;
          if (this._selectedIndex != -1) this.selectedIndex = -1;else this.parent.applyController(this);
        };
        _proto40.hasPage = function hasPage(aName) {
          return this._pageNames.indexOf(aName) != -1;
        };
        _proto40.getPageIndexById = function getPageIndexById(aId) {
          return this._pageIds.indexOf(aId);
        };
        _proto40.getPageIdByName = function getPageIdByName(aName) {
          var i = this._pageNames.indexOf(aName);
          if (i != -1) return this._pageIds[i];else return null;
        };
        _proto40.getPageNameById = function getPageNameById(aId) {
          var i = this._pageIds.indexOf(aId);
          if (i != -1) return this._pageNames[i];else return null;
        };
        _proto40.getPageId = function getPageId(index) {
          return this._pageIds[index];
        };
        _proto40.runActions = function runActions() {
          if (this._actions) {
            var cnt = this._actions.length;
            for (var i = 0; i < cnt; i++) {
              this._actions[i].run(this, this.previousPageId, this.selectedPageId);
            }
          }
        };
        _proto40.setup = function setup(buffer) {
          var beginPos = buffer.position;
          buffer.seek(beginPos, 0);
          this.name = buffer.readS();
          if (buffer.readBool()) this.autoRadioGroupDepth = true;
          buffer.seek(beginPos, 1);
          var i;
          var nextPos;
          var cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) {
            this._pageIds.push(buffer.readS());
            this._pageNames.push(buffer.readS());
          }
          var homePageIndex = 0;
          if (buffer.version >= 2) {
            var homePageType = buffer.readByte();
            switch (homePageType) {
              case 1:
                homePageIndex = buffer.readShort();
                break;
              case 2:
                homePageIndex = this._pageNames.indexOf(UIPackage.branch);
                if (homePageIndex == -1) homePageIndex = 0;
                break;
              case 3:
                homePageIndex = this._pageNames.indexOf(UIPackage.getVar(buffer.readS()));
                if (homePageIndex == -1) homePageIndex = 0;
                break;
            }
          }
          buffer.seek(beginPos, 2);
          cnt = buffer.readShort();
          if (cnt > 0) {
            if (!this._actions) this._actions = new Array();
            for (i = 0; i < cnt; i++) {
              nextPos = buffer.readShort();
              nextPos += buffer.position;
              var action = createAction(buffer.readByte());
              action.setup(buffer);
              this._actions.push(action);
              buffer.position = nextPos;
            }
          }
          if (this.parent && this._pageIds.length > 0) this._selectedIndex = homePageIndex;else this._selectedIndex = -1;
        };
        _createClass(Controller, [{
          key: "selectedIndex",
          get: function get() {
            return this._selectedIndex;
          },
          set: function set(value) {
            if (this._selectedIndex != value) {
              if (value > this._pageIds.length - 1) throw new Error("index out of bounds: " + value);
              this.changing = true;
              this._previousIndex = this._selectedIndex;
              this._selectedIndex = value;
              this.parent.applyController(this);
              this.emit(Event.STATUS_CHANGED, this);
              this.changing = false;
            }
          }
        }, {
          key: "previsousIndex",
          get: function get() {
            return this._previousIndex;
          }
        }, {
          key: "selectedPage",
          get: function get() {
            if (this._selectedIndex == -1) return null;else return this._pageNames[this._selectedIndex];
          },
          set: function set(val) {
            var i = this._pageNames.indexOf(val);
            if (i == -1) i = 0;
            this.selectedIndex = i;
          }
        }, {
          key: "previousPage",
          get: function get() {
            if (this._previousIndex == -1) return null;else return this._pageNames[this._previousIndex];
          }
        }, {
          key: "pageCount",
          get: function get() {
            return this._pageIds.length;
          }
        }, {
          key: "selectedPageId",
          get: function get() {
            if (this._selectedIndex == -1) return null;else return this._pageIds[this._selectedIndex];
          },
          set: function set(val) {
            var i = this._pageIds.indexOf(val);
            this.selectedIndex = i;
          }
        }, {
          key: "oppositePageId",
          set: function set(val) {
            var i = this._pageIds.indexOf(val);
            if (i > 0) this.selectedIndex = 0;else if (this._pageIds.length > 1) this.selectedIndex = 1;
          }
        }, {
          key: "previousPageId",
          get: function get() {
            if (this._previousIndex == -1) return null;else return this._pageIds[this._previousIndex];
          }
        }]);
        return Controller;
      }(EventTarget));
      function createAction(type) {
        switch (type) {
          case 0:
            return new PlayTransitionAction();
          case 1:
            return new ChangePageAction();
        }
        return null;
      }
      var Margin = /*#__PURE__*/function () {
        function Margin() {
          this.left = 0;
          this.right = 0;
          this.top = 0;
          this.bottom = 0;
        }
        var _proto41 = Margin.prototype;
        _proto41.copy = function copy(source) {
          this.top = source.top;
          this.bottom = source.bottom;
          this.left = source.left;
          this.right = source.right;
        };
        _proto41.isNone = function isNone() {
          return this.left == 0 && this.right == 0 && this.top == 0 && this.bottom == 0;
        };
        return Margin;
      }();
      var ScrollPane = exports('ScrollPane', /*#__PURE__*/function (_Component3) {
        _inheritsLoose(ScrollPane, _Component3);
        function ScrollPane() {
          var _this18;
          _this18 = _Component3.apply(this, arguments) || this;
          _this18._aniFlag = 0;
          return _this18;
        }
        var _proto42 = ScrollPane.prototype;
        _proto42.setup = function setup(buffer) {
          var o = this._owner = GObject.cast(this.node);
          this._maskContainer = new Node("ScrollPane");
          this._maskContainer.layer = UIConfig.defaultUILayer;
          this._maskContainerUITrans = this._maskContainer.addComponent(UITransform);
          this._maskContainerUITrans.setAnchorPoint(0, 1);
          this._maskContainer.parent = o.node;
          this._container = o._container;
          this._container.parent = this._maskContainer;
          this._scrollBarMargin = new Margin();
          this._mouseWheelEnabled = true;
          this._xPos = 0;
          this._yPos = 0;
          this._aniFlag = 0;
          this._tweening = 0;
          this._footerLockedSize = 0;
          this._headerLockedSize = 0;
          this._viewSize = new Vec2();
          this._contentSize = new Vec2();
          this._pageSize = new Vec2(1, 1);
          this._overlapSize = new Vec2();
          this._tweenTime = new Vec2();
          this._tweenStart = new Vec2();
          this._tweenDuration = new Vec2();
          this._tweenChange = new Vec2();
          this._velocity = new Vec2();
          this._containerPos = new Vec2();
          this._beginTouchPos = new Vec2();
          this._lastTouchPos = new Vec2();
          this._lastTouchGlobalPos = new Vec2();
          this._scrollStep = UIConfig.defaultScrollStep;
          this._mouseWheelStep = this._scrollStep * 2;
          this._decelerationRate = UIConfig.defaultScrollDecelerationRate;
          this._snappingPolicy = 0;
          o.on(Event.TOUCH_BEGIN, this.onTouchBegin, this);
          o.on(Event.TOUCH_MOVE, this.onTouchMove, this);
          o.on(Event.TOUCH_END, this.onTouchEnd, this);
          o.on(Event.MOUSE_WHEEL, this.onMouseWheel, this);
          this._scrollType = buffer.readByte();
          var scrollBarDisplay = buffer.readByte();
          var flags = buffer.readInt();
          if (buffer.readBool()) {
            this._scrollBarMargin.top = buffer.readInt();
            this._scrollBarMargin.bottom = buffer.readInt();
            this._scrollBarMargin.left = buffer.readInt();
            this._scrollBarMargin.right = buffer.readInt();
          }
          var vtScrollBarRes = buffer.readS();
          var hzScrollBarRes = buffer.readS();
          var headerRes = buffer.readS();
          var footerRes = buffer.readS();
          if ((flags & 1) != 0) this._displayOnLeft = true;
          if ((flags & 2) != 0) this._snapToItem = true;
          if ((flags & 4) != 0) this._displayInDemand = true;
          if ((flags & 8) != 0) this._pageMode = true;
          if (flags & 16) this._touchEffect = true;else if (flags & 32) this._touchEffect = false;else this._touchEffect = UIConfig.defaultScrollTouchEffect;
          if (flags & 64) this._bouncebackEffect = true;else if (flags & 128) this._bouncebackEffect = false;else this._bouncebackEffect = UIConfig.defaultScrollBounceEffect;
          if ((flags & 256) != 0) this._inertiaDisabled = true;
          if ((flags & 512) != 0) this._dontClip = true;
          if ((flags & 1024) != 0) this._floating = true;
          if ((flags & 2048) != 0) this._dontClipMargin = true;
          if (!this._dontClip) this._maskContainer.addComponent(Mask);
          if (scrollBarDisplay == ScrollBarDisplayType.Default) scrollBarDisplay = UIConfig.defaultScrollBarDisplay;
          if (scrollBarDisplay != ScrollBarDisplayType.Hidden) {
            if (this._scrollType == ScrollType.Both || this._scrollType == ScrollType.Vertical) {
              var res = vtScrollBarRes ? vtScrollBarRes : UIConfig.verticalScrollBar;
              if (res) {
                this._vtScrollBar = UIPackage.createObjectFromURL(res);
                if (!this._vtScrollBar) throw new Error("cannot create scrollbar from " + res);
                this._vtScrollBar.setScrollPane(this, true);
                this._vtScrollBar.node.parent = o.node;
              }
            }
            if (this._scrollType == ScrollType.Both || this._scrollType == ScrollType.Horizontal) {
              var res = hzScrollBarRes ? hzScrollBarRes : UIConfig.horizontalScrollBar;
              if (res) {
                this._hzScrollBar = UIPackage.createObjectFromURL(res);
                if (!this._hzScrollBar) throw new Error("cannot create scrollbar from " + res);
                this._hzScrollBar.setScrollPane(this, false);
                this._hzScrollBar.node.parent = o.node;
              }
            }
            if (scrollBarDisplay == ScrollBarDisplayType.Auto) this._scrollBarDisplayAuto = true;
            if (this._scrollBarDisplayAuto) {
              if (this._vtScrollBar) this._vtScrollBar.node.active = false;
              if (this._hzScrollBar) this._hzScrollBar.node.active = false;
              o.on(Event.ROLL_OVER, this.onRollOver, this);
              o.on(Event.ROLL_OUT, this.onRollOut, this);
            }
          }
          if (headerRes) {
            this._header = UIPackage.createObjectFromURL(headerRes);
            if (this._header == null) throw new Error("cannot create scrollPane header from " + headerRes);else this._maskContainer.insertChild(this._header.node, 0);
          }
          if (footerRes) {
            this._footer = UIPackage.createObjectFromURL(footerRes);
            if (this._footer == null) throw new Error("cannot create scrollPane footer from " + footerRes);else this._maskContainer.insertChild(this._footer.node, 0);
          }
          this._refreshBarAxis = this._scrollType == ScrollType.Both || this._scrollType == ScrollType.Vertical ? "y" : "x";
          this.setSize(o.width, o.height);
        };
        _proto42.onDestroy = function onDestroy() {
          delete this._pageController;
          if (this._hzScrollBar) this._hzScrollBar.dispose();
          if (this._vtScrollBar) this._vtScrollBar.dispose();
          if (this._header) this._header.dispose();
          if (this._footer) this._footer.dispose();
        };
        _proto42.hitTest = function hitTest(pt, globalPt) {
          var target;
          if (this._vtScrollBar) {
            target = this._vtScrollBar.hitTest(globalPt);
            if (target) return target;
          }
          if (this._hzScrollBar) {
            target = this._hzScrollBar.hitTest(globalPt);
            if (target) return target;
          }
          if (this._header && this._header.node.activeInHierarchy) {
            target = this._header.hitTest(globalPt);
            if (target) return target;
          }
          if (this._footer && this._footer.node.activeInHierarchy) {
            target = this._footer.hitTest(globalPt);
            if (target) return target;
          }
          if (this._dontClip) return this._owner;else if (this._dontClipMargin) {
            if (pt.x >= 0 && pt.y >= 0 && pt.x < this._owner.width && pt.y < this._owner.height) return this._owner;
          } else {
            if (pt.x >= this._owner.margin.left && pt.y >= this._owner.margin.top && pt.x < this._owner.margin.left + this._viewSize.x && pt.y < this._owner.margin.top + this._viewSize.y) return this._owner;
          }
          return null;
        };
        _proto42.setPercX = function setPercX(value, ani) {
          this._owner.ensureBoundsCorrect();
          this.setPosX(this._overlapSize.x * math.clamp01(value), ani);
        };
        _proto42.setPercY = function setPercY(value, ani) {
          this._owner.ensureBoundsCorrect();
          this.setPosY(this._overlapSize.y * math.clamp01(value), ani);
        };
        _proto42.setPosX = function setPosX(value, ani) {
          this._owner.ensureBoundsCorrect();
          if (this._loop == 1) value = this.loopCheckingNewPos(value, "x");
          value = math.clamp(value, 0, this._overlapSize.x);
          if (value != this._xPos) {
            this._xPos = value;
            this.posChanged(ani);
          }
        };
        _proto42.setPosY = function setPosY(value, ani) {
          this._owner.ensureBoundsCorrect();
          if (this._loop == 1) value = this.loopCheckingNewPos(value, "y");
          value = math.clamp(value, 0, this._overlapSize.y);
          if (value != this._yPos) {
            this._yPos = value;
            this.posChanged(ani);
          }
        };
        _proto42.setCurrentPageX = function setCurrentPageX(value, ani) {
          if (!this._pageMode) return;
          this._owner.ensureBoundsCorrect();
          if (this._overlapSize.x > 0) this.setPosX(value * this._pageSize.x, ani);
        };
        _proto42.setCurrentPageY = function setCurrentPageY(value, ani) {
          if (!this._pageMode) return;
          this._owner.ensureBoundsCorrect();
          if (this._overlapSize.y > 0) this.setPosY(value * this._pageSize.y, ani);
        };
        _proto42.scrollTop = function scrollTop(ani) {
          this.setPercY(0, ani);
        };
        _proto42.scrollBottom = function scrollBottom(ani) {
          this.setPercY(1, ani);
        };
        _proto42.scrollUp = function scrollUp(ratio, ani) {
          if (ratio == undefined) ratio = 1;
          if (this._pageMode) this.setPosY(this._yPos - this._pageSize.y * ratio, ani);else this.setPosY(this._yPos - this._scrollStep * ratio, ani);
        };
        _proto42.scrollDown = function scrollDown(ratio, ani) {
          if (ratio == undefined) ratio = 1;
          if (this._pageMode) this.setPosY(this._yPos + this._pageSize.y * ratio, ani);else this.setPosY(this._yPos + this._scrollStep * ratio, ani);
        };
        _proto42.scrollLeft = function scrollLeft(ratio, ani) {
          if (ratio == undefined) ratio = 1;
          if (this._pageMode) this.setPosX(this._xPos - this._pageSize.x * ratio, ani);else this.setPosX(this._xPos - this._scrollStep * ratio, ani);
        };
        _proto42.scrollRight = function scrollRight(ratio, ani) {
          if (ratio == undefined) ratio = 1;
          if (this._pageMode) this.setPosX(this._xPos + this._pageSize.x * ratio, ani);else this.setPosX(this._xPos + this._scrollStep * ratio, ani);
        };
        _proto42.scrollToView = function scrollToView(target, ani, setFirst) {
          this._owner.ensureBoundsCorrect();
          if (this._needRefresh) this.refresh();
          var rect;
          if (target instanceof GObject) {
            if (target.parent != this._owner) {
              target.parent.localToGlobalRect(target.x, target.y, target.width, target.height, s_rect);
              rect = this._owner.globalToLocalRect(s_rect.x, s_rect.y, s_rect.width, s_rect.height, s_rect);
            } else {
              rect = s_rect;
              rect.x = target.x;
              rect.y = target.y;
              rect.width = target.width;
              rect.height = target.height;
            }
          } else rect = target;
          if (this._overlapSize.y > 0) {
            var bottom = this._yPos + this._viewSize.y;
            if (setFirst || rect.y <= this._yPos || rect.height >= this._viewSize.y) {
              if (this._pageMode) this.setPosY(Math.floor(rect.y / this._pageSize.y) * this._pageSize.y, ani);else this.setPosY(rect.y, ani);
            } else if (rect.y + rect.height > bottom) {
              if (this._pageMode) this.setPosY(Math.floor(rect.y / this._pageSize.y) * this._pageSize.y, ani);else if (rect.height <= this._viewSize.y / 2) this.setPosY(rect.y + rect.height * 2 - this._viewSize.y, ani);else this.setPosY(rect.y + rect.height - this._viewSize.y, ani);
            }
          }
          if (this._overlapSize.x > 0) {
            var right = this._xPos + this._viewSize.x;
            if (setFirst || rect.x <= this._xPos || rect.width >= this._viewSize.x) {
              if (this._pageMode) this.setPosX(Math.floor(rect.x / this._pageSize.x) * this._pageSize.x, ani);else this.setPosX(rect.x, ani);
            } else if (rect.x + rect.width > right) {
              if (this._pageMode) this.setPosX(Math.floor(rect.x / this._pageSize.x) * this._pageSize.x, ani);else if (rect.width <= this._viewSize.x / 2) this.setPosX(rect.x + rect.width * 2 - this._viewSize.x, ani);else this.setPosX(rect.x + rect.width - this._viewSize.x, ani);
            }
          }
          if (!ani && this._needRefresh) this.refresh();
        };
        _proto42.isChildInView = function isChildInView(obj) {
          if (this._overlapSize.y > 0) {
            var dist = obj.y + -this._container.position.y;
            if (dist < -obj.height || dist > this._viewSize.y) return false;
          }
          if (this._overlapSize.x > 0) {
            dist = obj.x + this._container.position.x;
            if (dist < -obj.width || dist > this._viewSize.x) return false;
          }
          return true;
        };
        _proto42.cancelDragging = function cancelDragging() {
          if (ScrollPane.draggingPane == this) ScrollPane.draggingPane = null;
          _gestureFlag = 0;
          this._dragged = false;
        };
        _proto42.lockHeader = function lockHeader(size) {
          if (this._headerLockedSize == size) return;
          var cx = this._container.position.x;
          var cy = -this._container.position.y;
          var cr = this._refreshBarAxis == "x" ? cx : cy;
          this._headerLockedSize = size;
          if (!this._refreshEventDispatching && cr >= 0) {
            this._tweenStart.x = cx;
            this._tweenStart.y = cy;
            this._tweenChange.set(Vec2.ZERO);
            this._tweenChange[this._refreshBarAxis] = this._headerLockedSize - this._tweenStart[this._refreshBarAxis];
            this._tweenDuration.x = this._tweenDuration.y = TWEEN_TIME_DEFAULT;
            this.startTween(2);
          }
        };
        _proto42.lockFooter = function lockFooter(size) {
          if (this._footerLockedSize == size) return;
          var cx = this._container.position.x;
          var cy = -this._container.position.y;
          var cr = this._refreshBarAxis == "x" ? cx : cy;
          this._footerLockedSize = size;
          if (!this._refreshEventDispatching && cr <= -this._overlapSize[this._refreshBarAxis]) {
            this._tweenStart.x = cx;
            this._tweenStart.y = cy;
            this._tweenChange.set(Vec2.ZERO);
            var max = this._overlapSize[this._refreshBarAxis];
            if (max == 0) max = Math.max(this._contentSize[this._refreshBarAxis] + this._footerLockedSize - this._viewSize[this._refreshBarAxis], 0);else max += this._footerLockedSize;
            this._tweenChange[this._refreshBarAxis] = -max - this._tweenStart[this._refreshBarAxis];
            this._tweenDuration.x = this._tweenDuration.y = TWEEN_TIME_DEFAULT;
            this.startTween(2);
          }
        };
        _proto42.onOwnerSizeChanged = function onOwnerSizeChanged() {
          this.setSize(this._owner.width, this._owner.height);
          this.posChanged(false);
        };
        _proto42.handleControllerChanged = function handleControllerChanged(c) {
          if (this._pageController == c) {
            if (this._scrollType == ScrollType.Horizontal) this.setCurrentPageX(c.selectedIndex, true);else this.setCurrentPageY(c.selectedIndex, true);
          }
        };
        _proto42.updatePageController = function updatePageController() {
          if (this._pageController && !this._pageController.changing) {
            var index;
            if (this._scrollType == ScrollType.Horizontal) index = this.currentPageX;else index = this.currentPageY;
            if (index < this._pageController.pageCount) {
              var c = this._pageController;
              this._pageController = null; //HandleControllerChanged
              c.selectedIndex = index;
              this._pageController = c;
            }
          }
        };
        _proto42.adjustMaskContainer = function adjustMaskContainer() {
          var mx = 0;
          if (this._displayOnLeft && this._vtScrollBar && !this._floating) mx = this._vtScrollBar.width;
          var o = this._owner;
          if (this._dontClipMargin) this._maskContainerUITrans.setAnchorPoint((o.margin.left + o._alignOffset.x) / o.width, 1 - (o.margin.top + o._alignOffset.y) / o.height);else this._maskContainerUITrans.setAnchorPoint(o._alignOffset.x / this._viewSize.x, 1 - o._alignOffset.y / this._viewSize.y);
          if (o._customMask) this._maskContainer.setPosition(mx + o._alignOffset.x, -o._alignOffset.y);else this._maskContainer.setPosition(o._pivotCorrectX + mx + o._alignOffset.x, o._pivotCorrectY - o._alignOffset.y);
        };
        _proto42.setSize = function setSize(aWidth, aHeight) {
          if (this._hzScrollBar) {
            this._hzScrollBar.y = aHeight - this._hzScrollBar.height;
            if (this._vtScrollBar) {
              this._hzScrollBar.width = aWidth - this._vtScrollBar.width - this._scrollBarMargin.left - this._scrollBarMargin.right;
              if (this._displayOnLeft) this._hzScrollBar.x = this._scrollBarMargin.left + this._vtScrollBar.width;else this._hzScrollBar.x = this._scrollBarMargin.left;
            } else {
              this._hzScrollBar.width = aWidth - this._scrollBarMargin.left - this._scrollBarMargin.right;
              this._hzScrollBar.x = this._scrollBarMargin.left;
            }
          }
          if (this._vtScrollBar) {
            if (!this._displayOnLeft) this._vtScrollBar.x = aWidth - this._vtScrollBar.width;
            if (this._hzScrollBar) this._vtScrollBar.height = aHeight - this._hzScrollBar.height - this._scrollBarMargin.top - this._scrollBarMargin.bottom;else this._vtScrollBar.height = aHeight - this._scrollBarMargin.top - this._scrollBarMargin.bottom;
            this._vtScrollBar.y = this._scrollBarMargin.top;
          }
          this._viewSize.x = aWidth;
          this._viewSize.y = aHeight;
          if (this._hzScrollBar && !this._floating) this._viewSize.y -= this._hzScrollBar.height;
          if (this._vtScrollBar && !this._floating) this._viewSize.x -= this._vtScrollBar.width;
          this._viewSize.x -= this._owner.margin.left + this._owner.margin.right;
          this._viewSize.y -= this._owner.margin.top + this._owner.margin.bottom;
          this._viewSize.x = Math.max(1, this._viewSize.x);
          this._viewSize.y = Math.max(1, this._viewSize.y);
          this._pageSize.x = this._viewSize.x;
          this._pageSize.y = this._viewSize.y;
          this.adjustMaskContainer();
          this.handleSizeChanged();
        };
        _proto42.setContentSize = function setContentSize(aWidth, aHeight) {
          if (this._contentSize.x == aWidth && this._contentSize.y == aHeight) return;
          this._contentSize.x = aWidth;
          this._contentSize.y = aHeight;
          this.handleSizeChanged();
          if (this._snapToItem && this._snappingPolicy != 0 && this._xPos == 0 && this._yPos == 0) this.posChanged(false);
        };
        _proto42.changeContentSizeOnScrolling = function changeContentSizeOnScrolling(deltaWidth, deltaHeight, deltaPosX, deltaPosY) {
          var isRightmost = this._xPos == this._overlapSize.x;
          var isBottom = this._yPos == this._overlapSize.y;
          this._contentSize.x += deltaWidth;
          this._contentSize.y += deltaHeight;
          this.handleSizeChanged();
          if (this._tweening == 1) {
            //
            if (deltaWidth != 0 && isRightmost && this._tweenChange.x < 0) {
              this._xPos = this._overlapSize.x;
              this._tweenChange.x = -this._xPos - this._tweenStart.x;
            }
            if (deltaHeight != 0 && isBottom && this._tweenChange.y < 0) {
              this._yPos = this._overlapSize.y;
              this._tweenChange.y = -this._yPos - this._tweenStart.y;
            }
          } else if (this._tweening == 2) {
            //
            if (deltaPosX != 0) {
              this._container.setPosition(this._container.position.x - deltaPosX, this._container.position.y);
              this._tweenStart.x -= deltaPosX;
              this._xPos = -this._container.position.x;
            }
            if (deltaPosY != 0) {
              this._container.setPosition(this._container.position.x, this._container.position.y + deltaPosY);
              this._tweenStart.y -= deltaPosY;
              this._yPos = - -this._container.position.y;
            }
          } else if (this._dragged) {
            if (deltaPosX != 0) {
              this._container.setPosition(this._container.position.x - deltaPosX, this._container.position.y);
              this._containerPos.x -= deltaPosX;
              this._xPos = -this._container.position.x;
            }
            if (deltaPosY != 0) {
              this._container.setPosition(this._container.position.x, this._container.position.y + deltaPosY);
              this._containerPos.y -= deltaPosY;
              this._yPos = - -this._container.position.y;
            }
          } else {
            //
            if (deltaWidth != 0 && isRightmost) {
              this._xPos = this._overlapSize.x;
              this._container.setPosition(-this._xPos, this._container.position.y);
            }
            if (deltaHeight != 0 && isBottom) {
              this._yPos = this._overlapSize.y;
              this._container.setPosition(this._container.position.x, this._yPos);
            }
          }
          if (this._pageMode) this.updatePageController();
        };
        _proto42.handleSizeChanged = function handleSizeChanged() {
          if (this._displayInDemand) {
            this._vScrollNone = this._contentSize.y <= this._viewSize.y;
            this._hScrollNone = this._contentSize.x <= this._viewSize.x;
          }
          if (this._vtScrollBar) {
            if (this._contentSize.y == 0) this._vtScrollBar.setDisplayPerc(0);else this._vtScrollBar.setDisplayPerc(Math.min(1, this._viewSize.y / this._contentSize.y));
          }
          if (this._hzScrollBar) {
            if (this._contentSize.x == 0) this._hzScrollBar.setDisplayPerc(0);else this._hzScrollBar.setDisplayPerc(Math.min(1, this._viewSize.x / this._contentSize.x));
          }
          this.updateScrollBarVisible();
          var maskWidth = this._viewSize.x;
          var maskHeight = this._viewSize.y;
          if (this._vScrollNone && this._vtScrollBar) maskWidth += this._vtScrollBar.width;
          if (this._hScrollNone && this._hzScrollBar) maskHeight += this._hzScrollBar.height;
          if (this._dontClipMargin) {
            maskWidth += this._owner.margin.left + this._owner.margin.right;
            maskHeight += this._owner.margin.top + this._owner.margin.bottom;
          }
          this._maskContainerUITrans.setContentSize(maskWidth, maskHeight);
          if (this._vtScrollBar) this._vtScrollBar.handlePositionChanged();
          if (this._hzScrollBar) this._hzScrollBar.handlePositionChanged();
          if (this._header) this._header.handlePositionChanged();
          if (this._footer) this._footer.handlePositionChanged();
          if (this._scrollType == ScrollType.Horizontal || this._scrollType == ScrollType.Both) this._overlapSize.x = Math.ceil(Math.max(0, this._contentSize.x - this._viewSize.x));else this._overlapSize.x = 0;
          if (this._scrollType == ScrollType.Vertical || this._scrollType == ScrollType.Both) this._overlapSize.y = Math.ceil(Math.max(0, this._contentSize.y - this._viewSize.y));else this._overlapSize.y = 0; //
          this._xPos = math.clamp(this._xPos, 0, this._overlapSize.x);
          this._yPos = math.clamp(this._yPos, 0, this._overlapSize.y);
          var max = this._overlapSize[this._refreshBarAxis];
          if (max == 0) max = Math.max(this._contentSize[this._refreshBarAxis] + this._footerLockedSize - this._viewSize[this._refreshBarAxis], 0);else max += this._footerLockedSize;
          if (this._refreshBarAxis == "x") this._container.setPosition(math.clamp(this._container.position.x, -max, this._headerLockedSize), -math.clamp(-this._container.position.y, -this._overlapSize.y, 0));else this._container.setPosition(math.clamp(this._container.position.x, -this._overlapSize.x, 0), -math.clamp(-this._container.position.y, -max, this._headerLockedSize));
          if (this._header) {
            if (this._refreshBarAxis == "x") this._header.height = this._viewSize.y;else this._header.width = this._viewSize.x;
          }
          if (this._footer) {
            if (this._refreshBarAxis == "y") this._footer.height = this._viewSize.y;else this._footer.width = this._viewSize.x;
          }
          this.updateScrollBarPos();
          if (this._pageMode) this.updatePageController();
        };
        _proto42.posChanged = function posChanged(ani) {
          if (this._aniFlag == 0) this._aniFlag = ani ? 1 : -1;else if (this._aniFlag == 1 && !ani) this._aniFlag = -1;
          this._needRefresh = true;
          if (!director.getScheduler().isScheduled(this.refresh, this)) this.scheduleOnce(this.refresh);
        };
        _proto42.refresh = function refresh(dt) {
          this._needRefresh = false;
          this.unschedule(this.refresh);
          if (this._pageMode || this._snapToItem) {
            sEndPos.x = -this._xPos;
            sEndPos.y = -this._yPos;
            this.alignPosition(sEndPos, false);
            this._xPos = -sEndPos.x;
            this._yPos = -sEndPos.y;
          }
          this.refresh2();
          this._owner.node.emit(Event.SCROLL, this._owner);
          if (this._needRefresh)
            //onScroll
            {
              this._needRefresh = false;
              this.unschedule(this.refresh);
              this.refresh2();
            }
          this.updateScrollBarPos();
          this._aniFlag = 0;
        };
        _proto42.refresh2 = function refresh2() {
          if (this._aniFlag == 1 && !this._dragged) {
            var posX;
            var posY;
            if (this._overlapSize.x > 0) posX = -Math.floor(this._xPos);else {
              if (this._container.position.x != 0) this._container.setPosition(0, this._container.position.y);
              posX = 0;
            }
            if (this._overlapSize.y > 0) posY = -Math.floor(this._yPos);else {
              if (this._container.position.y != 0) this._container.setPosition(this._container.position.x, 0);
              posY = 0;
            }
            if (posX != this._container.position.x || posY != -this._container.position.y) {
              this._tweenDuration.x = this._tweenDuration.y = TWEEN_TIME_GO;
              this._tweenStart.x = this._container.position.x;
              this._tweenStart.y = -this._container.position.y;
              this._tweenChange.x = posX - this._tweenStart.x;
              this._tweenChange.y = posY - this._tweenStart.y;
              this.startTween(1);
            } else if (this._tweening != 0) this.killTween();
          } else {
            if (this._tweening != 0) this.killTween();
            this._container.setPosition(Math.floor(-this._xPos), -Math.floor(-this._yPos));
            this.loopCheckingCurrent();
          }
          if (this._pageMode) this.updatePageController();
        };
        _proto42.onTouchBegin = function onTouchBegin(evt) {
          if (!this._touchEffect) return;
          evt.captureTouch();
          if (this._tweening != 0) {
            this.killTween();
            Decls$1.GRoot.inst.inputProcessor.cancelClick(evt.touchId);
            this._dragged = true;
          } else this._dragged = false;
          var pt = this._owner.globalToLocal(evt.pos.x, evt.pos.y, s_vec2$3);
          this._containerPos.x = this._container.position.x;
          this._containerPos.y = -this._container.position.y;
          this._beginTouchPos.set(pt);
          this._lastTouchPos.set(pt);
          this._lastTouchGlobalPos.set(evt.pos);
          this._isHoldAreaDone = false;
          this._velocity.set(Vec2.ZERO);
          this._velocityScale = 1;
          this._lastMoveTime = game.totalTime / 1000;
        };
        _proto42.onTouchMove = function onTouchMove(evt) {
          if (!isValid(this._owner.node)) return;
          if (!this._touchEffect) return;
          if (GObject.draggingObject && GObject.draggingObject.onStage) return;
          if (ScrollPane.draggingPane && ScrollPane.draggingPane != this && ScrollPane.draggingPane._owner.onStage) return;
          var pt = this._owner.globalToLocal(evt.pos.x, evt.pos.y, s_vec2$3);
          var sensitivity = UIConfig.touchScrollSensitivity;
          var diff, diff2;
          var sv, sh;
          if (this._scrollType == ScrollType.Vertical) {
            if (!this._isHoldAreaDone) {
              //
              _gestureFlag |= 1;
              diff = Math.abs(this._beginTouchPos.y - pt.y);
              if (diff < sensitivity) return;
              if ((_gestureFlag & 2) != 0)
                //
                {
                  diff2 = Math.abs(this._beginTouchPos.x - pt.x);
                  if (diff < diff2)
                    //
                    return;
                }
            }
            sv = true;
          } else if (this._scrollType == ScrollType.Horizontal) {
            if (!this._isHoldAreaDone) {
              _gestureFlag |= 2;
              diff = Math.abs(this._beginTouchPos.x - pt.x);
              if (diff < sensitivity) return;
              if ((_gestureFlag & 1) != 0) {
                diff2 = Math.abs(this._beginTouchPos.y - pt.y);
                if (diff < diff2) return;
              }
            }
            sh = true;
          } else {
            _gestureFlag = 3;
            if (!this._isHoldAreaDone) {
              diff = Math.abs(this._beginTouchPos.y - pt.y);
              if (diff < sensitivity) {
                diff = Math.abs(this._beginTouchPos.x - pt.x);
                if (diff < sensitivity) return;
              }
            }
            sv = sh = true;
          }
          var newPosX = Math.floor(this._containerPos.x + pt.x - this._beginTouchPos.x);
          var newPosY = Math.floor(this._containerPos.y + pt.y - this._beginTouchPos.y);
          if (sv) {
            if (newPosY > 0) {
              if (!this._bouncebackEffect) this._container.setPosition(this._container.position.x, 0);else if (this._header && this._header.maxHeight != 0) this._container.setPosition(this._container.position.x, -Math.floor(Math.min(newPosY * 0.5, this._header.maxHeight)));else this._container.setPosition(this._container.position.x, -Math.floor(Math.min(newPosY * 0.5, this._viewSize.y * PULL_RATIO)));
            } else if (newPosY < -this._overlapSize.y) {
              if (!this._bouncebackEffect) this._container.setPosition(this._container.position.x, this._overlapSize.y);else if (this._footer && this._footer.maxHeight > 0) this._container.setPosition(this._container.position.x, -Math.floor(Math.max((newPosY + this._overlapSize.y) * 0.5, -this._footer.maxHeight) - this._overlapSize.y));else this._container.setPosition(this._container.position.x, -Math.floor(Math.max((newPosY + this._overlapSize.y) * 0.5, -this._viewSize.y * PULL_RATIO) - this._overlapSize.y));
            } else this._container.setPosition(this._container.position.x, -newPosY);
          }
          if (sh) {
            if (newPosX > 0) {
              if (!this._bouncebackEffect) this._container.setPosition(0, this._container.position.y);else if (this._header && this._header.maxWidth != 0) this._container.setPosition(Math.floor(Math.min(newPosX * 0.5, this._header.maxWidth)), this._container.position.y);else this._container.setPosition(Math.floor(Math.min(newPosX * 0.5, this._viewSize.x * PULL_RATIO)), this._container.position.y);
            } else if (newPosX < 0 - this._overlapSize.x) {
              if (!this._bouncebackEffect) this._container.setPosition(-this._overlapSize.x, this._container.position.y);else if (this._footer && this._footer.maxWidth > 0) this._container.setPosition(Math.floor(Math.max((newPosX + this._overlapSize.x) * 0.5, -this._footer.maxWidth) - this._overlapSize.x), this._container.position.y);else this._container.setPosition(Math.floor(Math.max((newPosX + this._overlapSize.x) * 0.5, -this._viewSize.x * PULL_RATIO) - this._overlapSize.x), this._container.position.y);
            } else this._container.setPosition(newPosX, this._container.position.y);
          } //
          var now = game.totalTime / 1000;
          var deltaTime = Math.max(now - this._lastMoveTime, 1 / 60);
          var deltaPositionX = pt.x - this._lastTouchPos.x;
          var deltaPositionY = pt.y - this._lastTouchPos.y;
          if (!sh) deltaPositionX = 0;
          if (!sv) deltaPositionY = 0;
          if (deltaTime != 0) {
            var frameRate = 60;
            var elapsed = deltaTime * frameRate - 1;
            if (elapsed > 1)
              //
              {
                var factor = Math.pow(0.833, elapsed);
                this._velocity.x = this._velocity.x * factor;
                this._velocity.y = this._velocity.y * factor;
              }
            this._velocity.x = math.lerp(this._velocity.x, deltaPositionX * 60 / frameRate / deltaTime, deltaTime * 10);
            this._velocity.y = math.lerp(this._velocity.y, deltaPositionY * 60 / frameRate / deltaTime, deltaTime * 10);
          } /*
            */
          var deltaGlobalPositionX = this._lastTouchGlobalPos.x - evt.pos.x;
          var deltaGlobalPositionY = this._lastTouchGlobalPos.y - evt.pos.y;
          if (deltaPositionX != 0) this._velocityScale = Math.abs(deltaGlobalPositionX / deltaPositionX);else if (deltaPositionY != 0) this._velocityScale = Math.abs(deltaGlobalPositionY / deltaPositionY);
          this._lastTouchPos.set(pt);
          this._lastTouchGlobalPos.set(evt.pos);
          this._lastMoveTime = now; //pos
          if (this._overlapSize.x > 0) this._xPos = math.clamp(-this._container.position.x, 0, this._overlapSize.x);
          if (this._overlapSize.y > 0) this._yPos = math.clamp(- -this._container.position.y, 0, this._overlapSize.y); //
          if (this._loop != 0) {
            newPosX = this._container.position.x;
            newPosY = -this._container.position.y;
            if (this.loopCheckingCurrent()) {
              this._containerPos.x += this._container.position.x - newPosX;
              this._containerPos.y += -this._container.position.y - newPosY;
            }
          }
          ScrollPane.draggingPane = this;
          this._isHoldAreaDone = true;
          this._dragged = true;
          this.updateScrollBarPos();
          this.updateScrollBarVisible();
          if (this._pageMode) this.updatePageController();
          this._owner.node.emit(Event.SCROLL);
        };
        _proto42.onTouchEnd = function onTouchEnd(evt) {
          if (ScrollPane.draggingPane == this) ScrollPane.draggingPane = null;
          _gestureFlag = 0;
          if (!this._dragged || !this._touchEffect || !this._owner.node.activeInHierarchy) {
            this._dragged = false;
            return;
          }
          this._dragged = false;
          this._tweenStart.x = this._container.position.x;
          this._tweenStart.y = -this._container.position.y;
          sEndPos.set(this._tweenStart);
          var flag = false;
          if (this._container.position.x > 0) {
            sEndPos.x = 0;
            flag = true;
          } else if (this._container.position.x < -this._overlapSize.x) {
            sEndPos.x = -this._overlapSize.x;
            flag = true;
          }
          if (-this._container.position.y > 0) {
            sEndPos.y = 0;
            flag = true;
          } else if (-this._container.position.y < -this._overlapSize.y) {
            sEndPos.y = -this._overlapSize.y;
            flag = true;
          }
          if (flag) {
            this._tweenChange.x = sEndPos.x - this._tweenStart.x;
            this._tweenChange.y = sEndPos.y - this._tweenStart.y;
            if (this._tweenChange.x < -UIConfig.touchDragSensitivity || this._tweenChange.y < -UIConfig.touchDragSensitivity) {
              this._refreshEventDispatching = true;
              this._owner.node.emit(Event.PULL_DOWN_RELEASE), this._owner;
              this._refreshEventDispatching = false;
            } else if (this._tweenChange.x > UIConfig.touchDragSensitivity || this._tweenChange.y > UIConfig.touchDragSensitivity) {
              this._refreshEventDispatching = true;
              this._owner.node.emit(Event.PULL_UP_RELEASE, this._owner);
              this._refreshEventDispatching = false;
            }
            if (this._headerLockedSize > 0 && sEndPos[this._refreshBarAxis] == 0) {
              sEndPos[this._refreshBarAxis] = this._headerLockedSize;
              this._tweenChange.x = sEndPos.x - this._tweenStart.x;
              this._tweenChange.y = sEndPos.y - this._tweenStart.y;
            } else if (this._footerLockedSize > 0 && sEndPos[this._refreshBarAxis] == -this._overlapSize[this._refreshBarAxis]) {
              var max = this._overlapSize[this._refreshBarAxis];
              if (max == 0) max = Math.max(this._contentSize[this._refreshBarAxis] + this._footerLockedSize - this._viewSize[this._refreshBarAxis], 0);else max += this._footerLockedSize;
              sEndPos[this._refreshBarAxis] = -max;
              this._tweenChange.x = sEndPos.x - this._tweenStart.x;
              this._tweenChange.y = sEndPos.y - this._tweenStart.y;
            }
            this._tweenDuration.x = this._tweenDuration.y = TWEEN_TIME_DEFAULT;
          } else {
            //
            if (!this._inertiaDisabled) {
              var frameRate = 60;
              var elapsed = (game.totalTime / 1000 - this._lastMoveTime) * frameRate - 1;
              if (elapsed > 1) {
                var factor = Math.pow(0.833, elapsed);
                this._velocity.x = this._velocity.x * factor;
                this._velocity.y = this._velocity.y * factor;
              } //
              this.updateTargetAndDuration(this._tweenStart, sEndPos);
            } else this._tweenDuration.x = this._tweenDuration.y = TWEEN_TIME_DEFAULT;
            sOldChange.x = sEndPos.x - this._tweenStart.x;
            sOldChange.y = sEndPos.y - this._tweenStart.y; //
            this.loopCheckingTarget(sEndPos);
            if (this._pageMode || this._snapToItem) this.alignPosition(sEndPos, true);
            this._tweenChange.x = sEndPos.x - this._tweenStart.x;
            this._tweenChange.y = sEndPos.y - this._tweenStart.y;
            if (this._tweenChange.x == 0 && this._tweenChange.y == 0) {
              this.updateScrollBarVisible();
              return;
            } //
            if (this._pageMode || this._snapToItem) {
              this.fixDuration("x", sOldChange.x);
              this.fixDuration("y", sOldChange.y);
            }
          }
          this.startTween(2);
        };
        _proto42.onRollOver = function onRollOver() {
          this._hover = true;
          this.updateScrollBarVisible();
        };
        _proto42.onRollOut = function onRollOut() {
          this._hover = false;
          this.updateScrollBarVisible();
        };
        _proto42.onMouseWheel = function onMouseWheel(evt) {
          if (!this._mouseWheelEnabled) return;
          var delta = evt.mouseWheelDelta > 0 ? -1 : 1;
          if (this._overlapSize.x > 0 && this._overlapSize.y == 0) {
            if (this._pageMode) this.setPosX(this._xPos + this._pageSize.x * delta, false);else this.setPosX(this._xPos + this._mouseWheelStep * delta, false);
          } else {
            if (this._pageMode) this.setPosY(this._yPos + this._pageSize.y * delta, false);else this.setPosY(this._yPos + this._mouseWheelStep * delta, false);
          }
        };
        _proto42.updateScrollBarPos = function updateScrollBarPos() {
          if (this._vtScrollBar) this._vtScrollBar.setScrollPerc(this._overlapSize.y == 0 ? 0 : math.clamp(this._container.position.y, 0, this._overlapSize.y) / this._overlapSize.y);
          if (this._hzScrollBar) this._hzScrollBar.setScrollPerc(this._overlapSize.x == 0 ? 0 : math.clamp(-this._container.position.x, 0, this._overlapSize.x) / this._overlapSize.x);
          this.checkRefreshBar();
        };
        _proto42.updateScrollBarVisible = function updateScrollBarVisible() {
          if (this._vtScrollBar) {
            if (this._viewSize.y <= this._vtScrollBar.minSize || this._vScrollNone) this._vtScrollBar.node.active = false;else this.updateScrollBarVisible2(this._vtScrollBar);
          }
          if (this._hzScrollBar) {
            if (this._viewSize.x <= this._hzScrollBar.minSize || this._hScrollNone) this._hzScrollBar.node.active = false;else this.updateScrollBarVisible2(this._hzScrollBar);
          }
        };
        _proto42.updateScrollBarVisible2 = function updateScrollBarVisible2(bar) {
          if (this._scrollBarDisplayAuto) GTween.kill(bar, false, "alpha");
          if (this._scrollBarDisplayAuto && !this._hover && this._tweening == 0 && !this._dragged && !bar.gripDragging) {
            if (bar.node.active) GTween.to(1, 0, 0.5).setDelay(0.5).onComplete(this.__barTweenComplete, this).setTarget(bar, "alpha");
          } else {
            bar.alpha = 1;
            bar.node.active = true;
          }
        };
        _proto42.__barTweenComplete = function __barTweenComplete(tweener) {
          var bar = tweener.target;
          bar.alpha = 1;
          bar.node.active = false;
        };
        _proto42.getLoopPartSize = function getLoopPartSize(division, axis) {
          return (this._contentSize[axis] + (axis == "x" ? this._owner.columnGap : this._owner.lineGap)) / division;
        };
        _proto42.loopCheckingCurrent = function loopCheckingCurrent() {
          var changed = false;
          if (this._loop == 1 && this._overlapSize.x > 0) {
            if (this._xPos < 0.001) {
              this._xPos += this.getLoopPartSize(2, "x");
              changed = true;
            } else if (this._xPos >= this._overlapSize.x) {
              this._xPos -= this.getLoopPartSize(2, "x");
              changed = true;
            }
          } else if (this._loop == 2 && this._overlapSize.y > 0) {
            if (this._yPos < 0.001) {
              this._yPos += this.getLoopPartSize(2, "y");
              changed = true;
            } else if (this._yPos >= this._overlapSize.y) {
              this._yPos -= this.getLoopPartSize(2, "y");
              changed = true;
            }
          }
          if (changed) {
            this._container.setPosition(Math.floor(-this._xPos), -Math.floor(-this._yPos));
          }
          return changed;
        };
        _proto42.loopCheckingTarget = function loopCheckingTarget(endPos) {
          if (this._loop == 1) this.loopCheckingTarget2(endPos, "x");
          if (this._loop == 2) this.loopCheckingTarget2(endPos, "y");
        };
        _proto42.loopCheckingTarget2 = function loopCheckingTarget2(endPos, axis) {
          var halfSize;
          var tmp;
          if (endPos[axis] > 0) {
            halfSize = this.getLoopPartSize(2, axis);
            tmp = this._tweenStart[axis] - halfSize;
            if (tmp <= 0 && tmp >= -this._overlapSize[axis]) {
              endPos[axis] -= halfSize;
              this._tweenStart[axis] = tmp;
            }
          } else if (endPos[axis] < -this._overlapSize[axis]) {
            halfSize = this.getLoopPartSize(2, axis);
            tmp = this._tweenStart[axis] + halfSize;
            if (tmp <= 0 && tmp >= -this._overlapSize[axis]) {
              endPos[axis] += halfSize;
              this._tweenStart[axis] = tmp;
            }
          }
        };
        _proto42.loopCheckingNewPos = function loopCheckingNewPos(value, axis) {
          if (this._overlapSize[axis] == 0) return value;
          var pos = axis == "x" ? this._xPos : this._yPos;
          var changed = false;
          var v;
          if (value < 0.001) {
            value += this.getLoopPartSize(2, axis);
            if (value > pos) {
              v = this.getLoopPartSize(6, axis);
              v = Math.ceil((value - pos) / v) * v;
              pos = math.clamp(pos + v, 0, this._overlapSize[axis]);
              changed = true;
            }
          } else if (value >= this._overlapSize[axis]) {
            value -= this.getLoopPartSize(2, axis);
            if (value < pos) {
              v = this.getLoopPartSize(6, axis);
              v = Math.ceil((pos - value) / v) * v;
              pos = math.clamp(pos - v, 0, this._overlapSize[axis]);
              changed = true;
            }
          }
          if (changed) {
            if (axis == "x") this._container.setPosition(-Math.floor(pos), this._container.position.y);else this._container.setPosition(this._container.position.x, Math.floor(pos));
          }
          return value;
        };
        _proto42.alignPosition = function alignPosition(pos, inertialScrolling) {
          var ax = 0,
            ay = 0;
          if (this._snappingPolicy == 1) {
            if (this._owner.numChildren > 0) {
              //assume all children are same size
              var obj = this._owner.getChildAt(0);
              ax = Math.floor(this._viewSize.x * 0.5 - obj.width * 0.5);
              ay = Math.floor(this._viewSize.y * 0.5 - obj.height * 0.5);
            }
          } else if (this._snappingPolicy == 2) {
            if (this._owner.numChildren > 0) {
              //assume all children are same size
              var _obj = this._owner.getChildAt(0);
              ax = Math.floor(this._viewSize.x - _obj.width);
              ay = Math.floor(this._viewSize.y - _obj.height);
            }
          }
          pos.x -= ax;
          pos.y -= ay;
          if (this._pageMode) {
            pos.x = this.alignByPage(pos.x, "x", inertialScrolling);
            pos.y = this.alignByPage(pos.y, "y", inertialScrolling);
          } else if (this._snapToItem) {
            var pt = this._owner.getSnappingPosition(-pos.x, -pos.y, s_vec2$3);
            if (pos.x < 0 && pos.x > -this._overlapSize.x) pos.x = -pt.x;
            if (pos.y < 0 && pos.y > -this._overlapSize.y) pos.y = -pt.y;
          }
          pos.x += ax;
          pos.y += ay;
        };
        _proto42.alignByPage = function alignByPage(pos, axis, inertialScrolling) {
          var page;
          if (pos > 0) page = 0;else if (pos < -this._overlapSize[axis]) page = Math.ceil(this._contentSize[axis] / this._pageSize[axis]) - 1;else {
            page = Math.floor(-pos / this._pageSize[axis]);
            var change = inertialScrolling ? pos - this._containerPos[axis] : pos - (axis == "x" ? this._container.position.x : -this._container.position.y);
            var testPageSize = Math.min(this._pageSize[axis], this._contentSize[axis] - (page + 1) * this._pageSize[axis]);
            var delta = -pos - page * this._pageSize[axis]; //
            if (Math.abs(change) > this._pageSize[axis])
              //1,
              {
                if (delta > testPageSize * 0.5) page++;
              } else
              //1/3
              {
                if (delta > testPageSize * (change < 0 ? 0.3 : 0.7)) page++;
              } //
            pos = -page * this._pageSize[axis];
            if (pos < -this._overlapSize[axis])
              //pageSize
              pos = -this._overlapSize[axis];
          } //
          if (inertialScrolling) {
            var oldPos = this._tweenStart[axis];
            var oldPage;
            if (oldPos > 0) oldPage = 0;else if (oldPos < -this._overlapSize[axis]) oldPage = Math.ceil(this._contentSize[axis] / this._pageSize[axis]) - 1;else oldPage = Math.floor(-oldPos / this._pageSize[axis]);
            var startPage = Math.floor(-this._containerPos[axis] / this._pageSize[axis]);
            if (Math.abs(page - startPage) > 1 && Math.abs(oldPage - startPage) <= 1) {
              if (page > startPage) page = startPage + 1;else page = startPage - 1;
              pos = -page * this._pageSize[axis];
            }
          }
          return pos;
        };
        _proto42.updateTargetAndDuration = function updateTargetAndDuration(orignPos, resultPos) {
          resultPos.x = this.updateTargetAndDuration2(orignPos.x, "x");
          resultPos.y = this.updateTargetAndDuration2(orignPos.y, "y");
        };
        _proto42.updateTargetAndDuration2 = function updateTargetAndDuration2(pos, axis) {
          var v = this._velocity[axis];
          var duration = 0;
          if (pos > 0) pos = 0;else if (pos < -this._overlapSize[axis]) pos = -this._overlapSize[axis];else {
            //
            var isMobile = sys.isMobile;
            var v2 = Math.abs(v) * this._velocityScale;
            var winSize = screen.windowSize; //1136
            if (isMobile) v2 *= 1136 / Math.max(winSize.width, winSize.height); //
            var ratio = 0;
            if (this._pageMode || !isMobile) {
              if (v2 > 500) ratio = Math.pow((v2 - 500) / 500, 2);
            } else {
              if (v2 > 1000) ratio = Math.pow((v2 - 1000) / 1000, 2);
            }
            if (ratio != 0) {
              if (ratio > 1) ratio = 1;
              v2 *= ratio;
              v *= ratio;
              this._velocity[axis] = v; //v*this._decelerationRaten= 60n6060
              duration = Math.log(60 / v2) / Math.log(this._decelerationRate) / 60; //
              //
              //var change:number = (v/ 60 - 1) / (1 - this._decelerationRate);
              var change = Math.floor(v * duration * 0.4);
              pos += change;
            }
          }
          if (duration < TWEEN_TIME_DEFAULT) duration = TWEEN_TIME_DEFAULT;
          this._tweenDuration[axis] = duration;
          return pos;
        };
        _proto42.fixDuration = function fixDuration(axis, oldChange) {
          if (this._tweenChange[axis] == 0 || Math.abs(this._tweenChange[axis]) >= Math.abs(oldChange)) return;
          var newDuration = Math.abs(this._tweenChange[axis] / oldChange) * this._tweenDuration[axis];
          if (newDuration < TWEEN_TIME_DEFAULT) newDuration = TWEEN_TIME_DEFAULT;
          this._tweenDuration[axis] = newDuration;
        };
        _proto42.startTween = function startTween(type) {
          this._tweenTime.set(Vec2.ZERO);
          this._tweening = type;
          this.updateScrollBarVisible();
        };
        _proto42.killTween = function killTween() {
          if (this._tweening == 1)
            //1tween
            {
              this._container.setPosition(this._tweenStart.x + this._tweenChange.x, -(this._tweenStart.y + this._tweenChange.y));
              this._owner.node.emit(Event.SCROLL, this._owner);
            }
          this._tweening = 0;
          this.updateScrollBarVisible();
          this._owner.node.emit(Event.SCROLL_END, this._owner);
        };
        _proto42.checkRefreshBar = function checkRefreshBar() {
          if (this._header == null && this._footer == null) return;
          var pos = this._refreshBarAxis == "x" ? this._container.position.x : -this._container.position.y;
          if (this._header) {
            if (pos > 0) {
              this._header.node.active = true;
              var pt = s_vec2$3;
              pt.x = this._header.width;
              pt.y = this._header.height;
              pt[this._refreshBarAxis] = pos;
              this._header.setSize(pt.x, pt.y);
            } else {
              this._header.node.active = false;
            }
          }
          if (this._footer) {
            var max = this._overlapSize[this._refreshBarAxis];
            if (pos < -max || max == 0 && this._footerLockedSize > 0) {
              this._footer.node.active = true;
              pt = s_vec2$3;
              pt.x = this._footer.x;
              pt.y = this._footer.y;
              if (max > 0) pt[this._refreshBarAxis] = pos + this._contentSize[this._refreshBarAxis];else pt[this._refreshBarAxis] = Math.max(Math.min(pos + this._viewSize[this._refreshBarAxis], this._viewSize[this._refreshBarAxis] - this._footerLockedSize), this._viewSize[this._refreshBarAxis] - this._contentSize[this._refreshBarAxis]);
              this._footer.setPosition(pt.x, pt.y);
              pt.x = this._footer.width;
              pt.y = this._footer.height;
              if (max > 0) pt[this._refreshBarAxis] = -max - pos;else pt[this._refreshBarAxis] = this._viewSize[this._refreshBarAxis] - this._footer[this._refreshBarAxis];
              this._footer.setSize(pt.x, pt.y);
            } else {
              this._footer.node.active = false;
            }
          }
        };
        _proto42.update = function update(dt) {
          if (this._tweening == 0) return;
          var nx = this.runTween("x", dt);
          var ny = this.runTween("y", dt);
          this._container.setPosition(nx, -ny);
          if (this._tweening == 2) {
            if (this._overlapSize.x > 0) this._xPos = math.clamp(-nx, 0, this._overlapSize.x);
            if (this._overlapSize.y > 0) this._yPos = math.clamp(-ny, 0, this._overlapSize.y);
            if (this._pageMode) this.updatePageController();
          }
          if (this._tweenChange.x == 0 && this._tweenChange.y == 0) {
            this._tweening = 0;
            this.loopCheckingCurrent();
            this.updateScrollBarPos();
            this.updateScrollBarVisible();
            this._owner.node.emit(Event.SCROLL, this._owner);
            this._owner.node.emit(Event.SCROLL_END, this._owner);
          } else {
            this.updateScrollBarPos();
            this._owner.node.emit(Event.SCROLL, this._owner);
          }
          return true;
        };
        _proto42.runTween = function runTween(axis, dt) {
          var newValue;
          if (this._tweenChange[axis] != 0) {
            this._tweenTime[axis] += dt;
            if (this._tweenTime[axis] >= this._tweenDuration[axis]) {
              newValue = this._tweenStart[axis] + this._tweenChange[axis];
              this._tweenChange[axis] = 0;
            } else {
              var ratio = easeFunc(this._tweenTime[axis], this._tweenDuration[axis]);
              newValue = this._tweenStart[axis] + Math.floor(this._tweenChange[axis] * ratio);
            }
            var threshold1 = 0;
            var threshold2 = -this._overlapSize[axis];
            if (this._headerLockedSize > 0 && this._refreshBarAxis == axis) threshold1 = this._headerLockedSize;
            if (this._footerLockedSize > 0 && this._refreshBarAxis == axis) {
              var max = this._overlapSize[this._refreshBarAxis];
              if (max == 0) max = Math.max(this._contentSize[this._refreshBarAxis] + this._footerLockedSize - this._viewSize[this._refreshBarAxis], 0);else max += this._footerLockedSize;
              threshold2 = -max;
            }
            if (this._tweening == 2 && this._bouncebackEffect) {
              if (newValue > 20 + threshold1 && this._tweenChange[axis] > 0 || newValue > threshold1 && this._tweenChange[axis] == 0)
                //
                {
                  this._tweenTime[axis] = 0;
                  this._tweenDuration[axis] = TWEEN_TIME_DEFAULT;
                  this._tweenChange[axis] = -newValue + threshold1;
                  this._tweenStart[axis] = newValue;
                } else if (newValue < threshold2 - 20 && this._tweenChange[axis] < 0 || newValue < threshold2 && this._tweenChange[axis] == 0)
                //
                {
                  this._tweenTime[axis] = 0;
                  this._tweenDuration[axis] = TWEEN_TIME_DEFAULT;
                  this._tweenChange[axis] = threshold2 - newValue;
                  this._tweenStart[axis] = newValue;
                }
            } else {
              if (newValue > threshold1) {
                newValue = threshold1;
                this._tweenChange[axis] = 0;
              } else if (newValue < threshold2) {
                newValue = threshold2;
                this._tweenChange[axis] = 0;
              }
            }
          } else newValue = axis == "x" ? this._container.position.x : -this._container.position.y;
          return newValue;
        };
        _createClass(ScrollPane, [{
          key: "owner",
          get: function get() {
            return this._owner;
          }
        }, {
          key: "hzScrollBar",
          get: function get() {
            return this._hzScrollBar;
          }
        }, {
          key: "vtScrollBar",
          get: function get() {
            return this._vtScrollBar;
          }
        }, {
          key: "header",
          get: function get() {
            return this._header;
          }
        }, {
          key: "footer",
          get: function get() {
            return this._footer;
          }
        }, {
          key: "bouncebackEffect",
          get: function get() {
            return this._bouncebackEffect;
          },
          set: function set(sc) {
            this._bouncebackEffect = sc;
          }
        }, {
          key: "touchEffect",
          get: function get() {
            return this._touchEffect;
          },
          set: function set(sc) {
            this._touchEffect = sc;
          }
        }, {
          key: "scrollStep",
          get: function get() {
            return this._scrollStep;
          },
          set: function set(val) {
            this._scrollStep = val;
            if (this._scrollStep == 0) this._scrollStep = UIConfig.defaultScrollStep;
            this._mouseWheelStep = this._scrollStep * 2;
          }
        }, {
          key: "decelerationRate",
          get: function get() {
            return this._decelerationRate;
          },
          set: function set(val) {
            this._decelerationRate = val;
          }
        }, {
          key: "snapToItem",
          get: function get() {
            return this._snapToItem;
          },
          set: function set(value) {
            this._snapToItem = value;
          }
        }, {
          key: "snappingPolicy",
          get: function get() {
            return this._snappingPolicy;
          },
          set: function set(value) {
            this._snappingPolicy = value;
          }
        }, {
          key: "mouseWheelEnabled",
          get: function get() {
            return this._mouseWheelEnabled;
          },
          set: function set(value) {
            this._mouseWheelEnabled = value;
          }
        }, {
          key: "isDragged",
          get: function get() {
            return this._dragged;
          }
        }, {
          key: "percX",
          get: function get() {
            return this._overlapSize.x == 0 ? 0 : this._xPos / this._overlapSize.x;
          },
          set: function set(value) {
            this.setPercX(value, false);
          }
        }, {
          key: "percY",
          get: function get() {
            return this._overlapSize.y == 0 ? 0 : this._yPos / this._overlapSize.y;
          },
          set: function set(value) {
            this.setPercY(value, false);
          }
        }, {
          key: "posX",
          get: function get() {
            return this._xPos;
          },
          set: function set(value) {
            this.setPosX(value, false);
          }
        }, {
          key: "posY",
          get: function get() {
            return this._yPos;
          },
          set: function set(value) {
            this.setPosY(value, false);
          }
        }, {
          key: "contentWidth",
          get: function get() {
            return this._contentSize.x;
          }
        }, {
          key: "contentHeight",
          get: function get() {
            return this._contentSize.y;
          }
        }, {
          key: "viewWidth",
          get: function get() {
            return this._viewSize.x;
          },
          set: function set(value) {
            value = value + this._owner.margin.left + this._owner.margin.right;
            if (this._vtScrollBar && !this._floating) value += this._vtScrollBar.width;
            this._owner.width = value;
          }
        }, {
          key: "viewHeight",
          get: function get() {
            return this._viewSize.y;
          },
          set: function set(value) {
            value = value + this._owner.margin.top + this._owner.margin.bottom;
            if (this._hzScrollBar && !this._floating) value += this._hzScrollBar.height;
            this._owner.height = value;
          }
        }, {
          key: "currentPageX",
          get: function get() {
            if (!this._pageMode) return 0;
            var page = Math.floor(this._xPos / this._pageSize.x);
            if (this._xPos - page * this._pageSize.x > this._pageSize.x * 0.5) page++;
            return page;
          },
          set: function set(value) {
            this.setCurrentPageX(value, false);
          }
        }, {
          key: "currentPageY",
          get: function get() {
            if (!this._pageMode) return 0;
            var page = Math.floor(this._yPos / this._pageSize.y);
            if (this._yPos - page * this._pageSize.y > this._pageSize.y * 0.5) page++;
            return page;
          },
          set: function set(value) {
            this.setCurrentPageY(value, false);
          }
        }, {
          key: "isBottomMost",
          get: function get() {
            return this._yPos == this._overlapSize.y || this._overlapSize.y == 0;
          }
        }, {
          key: "isRightMost",
          get: function get() {
            return this._xPos == this._overlapSize.x || this._overlapSize.x == 0;
          }
        }, {
          key: "pageController",
          get: function get() {
            return this._pageController;
          },
          set: function set(value) {
            this._pageController = value;
          }
        }, {
          key: "scrollingPosX",
          get: function get() {
            return math.clamp(-this._container.position.x, 0, this._overlapSize.x);
          }
        }, {
          key: "scrollingPosY",
          get: function get() {
            return math.clamp(- -this._container.position.y, 0, this._overlapSize.y);
          }
        }]);
        return ScrollPane;
      }(Component));
      var _gestureFlag = 0;
      var TWEEN_TIME_GO = 0.5; //SetPos(ani)
      var TWEEN_TIME_DEFAULT = 0.3; //
      var PULL_RATIO = 0.5; //
      var s_vec2$3 = new Vec2();
      var s_rect = new Rect();
      var sEndPos = new Vec2();
      var sOldChange = new Vec2();
      function easeFunc(t, d) {
        return (t = t / d - 1) * t * t + 1; //cubicOut
      }
      var CurveType;
      (function (CurveType) {
        CurveType[CurveType["CRSpline"] = 0] = "CRSpline";
        CurveType[CurveType["Bezier"] = 1] = "Bezier";
        CurveType[CurveType["CubicBezier"] = 2] = "CubicBezier";
        CurveType[CurveType["Straight"] = 3] = "Straight";
      })(CurveType || (CurveType = {}));
      var GPathPoint = /*#__PURE__*/function () {
        function GPathPoint() {
          this.x = 0;
          this.y = 0;
          this.control1_x = 0;
          this.control1_y = 0;
          this.control2_x = 0;
          this.control2_y = 0;
          this.curveType = 0;
        }
        GPathPoint.newPoint = function newPoint(x, y, curveType) {
          var pt = new GPathPoint();
          pt.x = x || 0;
          pt.y = y || 0;
          pt.control1_x = 0;
          pt.control1_y = 0;
          pt.control2_x = 0;
          pt.control2_y = 0;
          pt.curveType = curveType || CurveType.CRSpline;
          return pt;
        };
        GPathPoint.newBezierPoint = function newBezierPoint(x, y, control1_x, control1_y) {
          var pt = new GPathPoint();
          pt.x = x || 0;
          pt.y = y || 0;
          pt.control1_x = control1_x || 0;
          pt.control1_y = control1_y || 0;
          pt.control2_x = 0;
          pt.control2_y = 0;
          pt.curveType = CurveType.Bezier;
          return pt;
        };
        GPathPoint.newCubicBezierPoint = function newCubicBezierPoint(x, y, control1_x, control1_y, control2_x, control2_y) {
          var pt = new GPathPoint();
          pt.x = x || 0;
          pt.y = y || 0;
          pt.control1_x = control1_x || 0;
          pt.control1_y = control1_y || 0;
          pt.control2_x = control2_x || 0;
          pt.control2_y = control2_y || 0;
          pt.curveType = CurveType.CubicBezier;
          return pt;
        };
        var _proto43 = GPathPoint.prototype;
        _proto43.clone = function clone() {
          var ret = new GPathPoint();
          ret.x = this.x;
          ret.y = this.y;
          ret.control1_x = this.control1_x;
          ret.control1_y = this.control1_y;
          ret.control2_x = this.control2_x;
          ret.control2_y = this.control2_y;
          ret.curveType = this.curveType;
          return ret;
        };
        return GPathPoint;
      }();
      var GPath = /*#__PURE__*/function () {
        function GPath() {
          this._segments = new Array();
          this._points = new Array();
        }
        var _proto44 = GPath.prototype;
        _proto44.create2 = function create2(pt1, pt2, pt3, pt4) {
          var points = new Array();
          points.push(pt1);
          points.push(pt2);
          if (pt3) points.push(pt3);
          if (pt4) points.push(pt4);
          this.create(points);
        };
        _proto44.create = function create(points) {
          this._segments.length = 0;
          this._points.length = 0;
          this._fullLength = 0;
          var cnt = points.length;
          if (cnt == 0) return;
          var splinePoints = [];
          var prev = points[0];
          if (prev.curveType == CurveType.CRSpline) splinePoints.push(new Vec2(prev.x, prev.y));
          for (var i = 1; i < cnt; i++) {
            var current = points[i];
            if (prev.curveType != CurveType.CRSpline) {
              var seg = {};
              seg.type = prev.curveType;
              seg.ptStart = this._points.length;
              if (prev.curveType == CurveType.Straight) {
                seg.ptCount = 2;
                this._points.push(new Vec2(prev.x, prev.y));
                this._points.push(new Vec2(current.x, current.y));
              } else if (prev.curveType == CurveType.Bezier) {
                seg.ptCount = 3;
                this._points.push(new Vec2(prev.x, prev.y));
                this._points.push(new Vec2(current.x, current.y));
                this._points.push(new Vec2(prev.control1_x, prev.control1_y));
              } else if (prev.curveType == CurveType.CubicBezier) {
                seg.ptCount = 4;
                this._points.push(new Vec2(prev.x, prev.y));
                this._points.push(new Vec2(current.x, current.y));
                this._points.push(new Vec2(prev.control1_x, prev.control1_y));
                this._points.push(new Vec2(prev.control2_x, prev.control2_y));
              }
              seg.length = distance(prev.x, prev.y, current.x, current.y);
              this._fullLength += seg.length;
              this._segments.push(seg);
            }
            if (current.curveType != CurveType.CRSpline) {
              if (splinePoints.length > 0) {
                splinePoints.push(new Vec2(current.x, current.y));
                this.createSplineSegment(splinePoints);
              }
            } else splinePoints.push(new Vec2(current.x, current.y));
            prev = current;
          }
          if (splinePoints.length > 1) this.createSplineSegment(splinePoints);
        };
        _proto44.createSplineSegment = function createSplineSegment(splinePoints) {
          var cnt = splinePoints.length;
          splinePoints.splice(0, 0, splinePoints[0]);
          splinePoints.push(splinePoints[cnt]);
          splinePoints.push(splinePoints[cnt]);
          cnt += 3;
          var seg = {};
          seg.type = CurveType.CRSpline;
          seg.ptStart = this._points.length;
          seg.ptCount = cnt;
          this._points = this._points.concat(splinePoints);
          seg.length = 0;
          for (var i = 1; i < cnt; i++) {
            seg.length += distance(splinePoints[i - 1].x, splinePoints[i - 1].y, splinePoints[i].x, splinePoints[i].y);
          }
          this._fullLength += seg.length;
          this._segments.push(seg);
          splinePoints.length = 0;
        };
        _proto44.clear = function clear() {
          this._segments.length = 0;
          this._points.length = 0;
        };
        _proto44.getPointAt = function getPointAt(t, result) {
          if (!result) result = new Vec2();else result.set(0, 0);
          t = math.clamp01(t);
          var cnt = this._segments.length;
          if (cnt == 0) {
            return result;
          }
          var seg;
          if (t == 1) {
            seg = this._segments[cnt - 1];
            if (seg.type == CurveType.Straight) {
              result.x = math.lerp(this._points[seg.ptStart].x, this._points[seg.ptStart + 1].x, t);
              result.y = math.lerp(this._points[seg.ptStart].y, this._points[seg.ptStart + 1].y, t);
              return result;
            } else if (seg.type == CurveType.Bezier || seg.type == CurveType.CubicBezier) return this.onBezierCurve(seg.ptStart, seg.ptCount, t, result);else return this.onCRSplineCurve(seg.ptStart, seg.ptCount, t, result);
          }
          var len = t * this._fullLength;
          for (var i = 0; i < cnt; i++) {
            seg = this._segments[i];
            len -= seg.length;
            if (len < 0) {
              t = 1 + len / seg.length;
              if (seg.type == CurveType.Straight) {
                result.x = math.lerp(this._points[seg.ptStart].x, this._points[seg.ptStart + 1].x, t);
                result.y = math.lerp(this._points[seg.ptStart].y, this._points[seg.ptStart + 1].y, t);
              } else if (seg.type == CurveType.Bezier || seg.type == CurveType.CubicBezier) result = this.onBezierCurve(seg.ptStart, seg.ptCount, t, result);else result = this.onCRSplineCurve(seg.ptStart, seg.ptCount, t, result);
              break;
            }
          }
          return result;
        };
        _proto44.getAnchorsInSegment = function getAnchorsInSegment(segmentIndex, points) {
          if (points == null) points = new Array();
          var seg = this._segments[segmentIndex];
          for (var i = 0; i < seg.ptCount; i++) points.push(new Vec2(this._points[seg.ptStart + i].x, this._points[seg.ptStart + i].y));
          return points;
        };
        _proto44.getPointsInSegment = function getPointsInSegment(segmentIndex, t0, t1, points, ts, pointDensity) {
          if (points == null) points = new Array();
          if (!pointDensity || isNaN(pointDensity)) pointDensity = 0.1;
          if (ts) ts.push(t0);
          var seg = this._segments[segmentIndex];
          if (seg.type == CurveType.Straight) {
            points.push(new Vec2(math.lerp(this._points[seg.ptStart].x, this._points[seg.ptStart + 1].x, t0), math.lerp(this._points[seg.ptStart].y, this._points[seg.ptStart + 1].y, t0)));
            points.push(new Vec2(math.lerp(this._points[seg.ptStart].x, this._points[seg.ptStart + 1].x, t1), math.lerp(this._points[seg.ptStart].y, this._points[seg.ptStart + 1].y, t1)));
          } else {
            var func;
            if (seg.type == CurveType.Bezier || seg.type == CurveType.CubicBezier) func = this.onBezierCurve;else func = this.onCRSplineCurve;
            points.push(func.call(this, seg.ptStart, seg.ptCount, t0, new Vec2()));
            var SmoothAmount = Math.min(seg.length * pointDensity, 50);
            for (var j = 0; j <= SmoothAmount; j++) {
              var t = j / SmoothAmount;
              if (t > t0 && t < t1) {
                points.push(func.call(this, seg.ptStart, seg.ptCount, t, new Vec2()));
                if (ts) ts.push(t);
              }
            }
            points.push(func.call(this, seg.ptStart, seg.ptCount, t1, new Vec2()));
          }
          if (ts) ts.push(t1);
          return points;
        };
        _proto44.getAllPoints = function getAllPoints(points, ts, pointDensity) {
          if (points == null) points = new Array();
          if (!pointDensity || isNaN(pointDensity)) pointDensity = 0.1;
          var cnt = this._segments.length;
          for (var i = 0; i < cnt; i++) this.getPointsInSegment(i, 0, 1, points, ts, pointDensity);
          return points;
        };
        _proto44.onCRSplineCurve = function onCRSplineCurve(ptStart, ptCount, t, result) {
          var adjustedIndex = Math.floor(t * (ptCount - 4)) + ptStart; //Since the equation works with 4 points, we adjust the starting point depending on t to return a point on the specific segment
          var p0x = this._points[adjustedIndex].x;
          var p0y = this._points[adjustedIndex].y;
          var p1x = this._points[adjustedIndex + 1].x;
          var p1y = this._points[adjustedIndex + 1].y;
          var p2x = this._points[adjustedIndex + 2].x;
          var p2y = this._points[adjustedIndex + 2].y;
          var p3x = this._points[adjustedIndex + 3].x;
          var p3y = this._points[adjustedIndex + 3].y;
          var adjustedT = t == 1 ? 1 : math.repeat(t * (ptCount - 4), 1); // Then we adjust t to be that value on that new piece of segment... for t == 1f don't use repeat (that would return 0f);
          var t0 = ((-adjustedT + 2) * adjustedT - 1) * adjustedT * 0.5;
          var t1 = ((3 * adjustedT - 5) * adjustedT * adjustedT + 2) * 0.5;
          var t2 = ((-3 * adjustedT + 4) * adjustedT + 1) * adjustedT * 0.5;
          var t3 = (adjustedT - 1) * adjustedT * adjustedT * 0.5;
          result.x = p0x * t0 + p1x * t1 + p2x * t2 + p3x * t3;
          result.y = p0y * t0 + p1y * t1 + p2y * t2 + p3y * t3;
          return result;
        };
        _proto44.onBezierCurve = function onBezierCurve(ptStart, ptCount, t, result) {
          var t2 = 1 - t;
          var p0x = this._points[ptStart].x;
          var p0y = this._points[ptStart].y;
          var p1x = this._points[ptStart + 1].x;
          var p1y = this._points[ptStart + 1].y;
          var cp0x = this._points[ptStart + 2].x;
          var cp0y = this._points[ptStart + 2].y;
          if (ptCount == 4) {
            var cp1x = this._points[ptStart + 3].x;
            var cp1y = this._points[ptStart + 3].y;
            result.x = t2 * t2 * t2 * p0x + 3 * t2 * t2 * t * cp0x + 3 * t2 * t * t * cp1x + t * t * t * p1x;
            result.y = t2 * t2 * t2 * p0y + 3 * t2 * t2 * t * cp0y + 3 * t2 * t * t * cp1y + t * t * t * p1y;
          } else {
            result.x = t2 * t2 * p0x + 2 * t2 * t * cp0x + t * t * p1x;
            result.y = t2 * t2 * p0y + 2 * t2 * t * cp0y + t * t * p1y;
          }
          return result;
        };
        _createClass(GPath, [{
          key: "length",
          get: function get() {
            return this._fullLength;
          }
        }, {
          key: "segmentCount",
          get: function get() {
            return this._segments.length;
          }
        }]);
        return GPath;
      }();
      function distance(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
      }
      var Transition = exports('Transition', /*#__PURE__*/function () {
        function Transition(owner) {
          this._ownerBaseX = 0;
          this._ownerBaseY = 0;
          this._totalTimes = 0;
          this._totalTasks = 0;
          this._options = 0;
          this._totalDuration = 0;
          this._autoPlayTimes = 1;
          this._autoPlayDelay = 0;
          this._timeScale = 1;
          this._startTime = 0;
          this._endTime = 0;
          this._owner = owner;
          this._items = new Array();
        }
        var _proto45 = Transition.prototype;
        _proto45.play = function play(onComplete, times, delay, startTime, endTime) {
          this._play(onComplete, times, delay, startTime, endTime, false);
        };
        _proto45.playReverse = function playReverse(onComplete, times, delay) {
          this._play(onComplete, times, delay, 0, -1, true);
        };
        _proto45.changePlayTimes = function changePlayTimes(value) {
          this._totalTimes = value;
        };
        _proto45.setAutoPlay = function setAutoPlay(value, times, delay) {
          if (times == undefined) times = -1;
          if (delay == undefined) delay = 0;
          if (this._autoPlay != value) {
            this._autoPlay = value;
            this._autoPlayTimes = times;
            this._autoPlayDelay = delay;
            if (this._autoPlay) {
              if (this._owner.onStage) this.play(null, this._autoPlayTimes, this._autoPlayDelay);
            } else {
              if (!this._owner.onStage) this.stop(false, true);
            }
          }
        };
        _proto45._play = function _play(onComplete, times, delay, startTime, endTime, reversed) {
          if (times == undefined) times = 1;
          if (delay == undefined) delay = 0;
          if (startTime == undefined) startTime = 0;
          if (endTime == undefined) endTime = -1;
          this.stop(true, true);
          this._totalTimes = times;
          this._reversed = reversed;
          this._startTime = startTime;
          this._endTime = endTime;
          this._playing = true;
          this._paused = false;
          this._onComplete = onComplete;
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.target == null) {
              if (item.targetId) item.target = this._owner.getChildById(item.targetId);else item.target = this._owner;
            } else if (item.target != this._owner && item.target.parent != this._owner) item.target = null;
            if (item.target && item.type == ActionType.Transition) {
              var trans = item.target.getTransition(item.value.transName);
              if (trans == this) trans = null;
              if (trans) {
                if (item.value.playTimes == 0)
                  //stop
                  {
                    var j;
                    for (j = i - 1; j >= 0; j--) {
                      var item2 = this._items[j];
                      if (item2.type == ActionType.Transition) {
                        if (item2.value.trans == trans) {
                          item2.value.stopTime = item.time - item2.time;
                          break;
                        }
                      }
                    }
                    if (j < 0) item.value.stopTime = 0;else trans = null; //no need to handle stop anymore
                  } else item.value.stopTime = -1;
              }
              item.value.trans = trans;
            }
          }
          if (delay == 0) this.onDelayedPlay();else GTween.delayedCall(delay).setTarget(this).onComplete(this.onDelayedPlay, this);
        };
        _proto45.stop = function stop(setToComplete, processCallback) {
          if (setToComplete == undefined) setToComplete = true;
          if (!this._playing) return;
          this._playing = false;
          this._totalTasks = 0;
          this._totalTimes = 0;
          var func = this._onComplete;
          this._onComplete = null;
          GTween.kill(this); //delay start
          var cnt = this._items.length;
          if (this._reversed) {
            for (var i = cnt - 1; i >= 0; i--) {
              var item = this._items[i];
              if (item.target == null) continue;
              this.stopItem(item, setToComplete);
            }
          } else {
            for (i = 0; i < cnt; i++) {
              item = this._items[i];
              if (item.target == null) continue;
              this.stopItem(item, setToComplete);
            }
          }
          if (processCallback && func != null) {
            func();
          }
        };
        _proto45.stopItem = function stopItem(item, setToComplete) {
          if (item.displayLockToken != 0) {
            item.target.releaseDisplayLock(item.displayLockToken);
            item.displayLockToken = 0;
          }
          if (item.tweener) {
            item.tweener.kill(setToComplete);
            item.tweener = null;
            if (item.type == ActionType.Shake && !setToComplete)
              //
              {
                item.target._gearLocked = true;
                item.target.setPosition(item.target.x - item.value.lastOffsetX, item.target.y - item.value.lastOffsetY);
                item.target._gearLocked = false;
              }
          }
          if (item.type == ActionType.Transition) {
            var trans = item.value.trans;
            if (trans) trans.stop(setToComplete, false);
          }
        };
        _proto45.setPaused = function setPaused(paused) {
          if (!this._playing || this._paused == paused) return;
          this._paused = paused;
          var tweener = GTween.getTween(this);
          if (tweener) tweener.setPaused(paused);
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.target == null) continue;
            if (item.type == ActionType.Transition) {
              if (item.value.trans) item.value.trans.setPaused(paused);
            } else if (item.type == ActionType.Animation) {
              if (paused) {
                item.value.flag = item.target.getProp(ObjectPropID.Playing);
                item.target.setProp(ObjectPropID.Playing, false);
              } else item.target.setProp(ObjectPropID.Playing, item.value.flag);
            }
            if (item.tweener) item.tweener.setPaused(paused);
          }
        };
        _proto45.dispose = function dispose() {
          if (this._playing) GTween.kill(this); //delay start
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.tweener) {
              item.tweener.kill();
              item.tweener = null;
            }
            item.target = null;
            item.hook = null;
            if (item.tweenConfig) item.tweenConfig.endHook = null;
          }
          this._items.length = 0;
          this._playing = false;
          this._onComplete = null;
        };
        _proto45.setValue = function setValue(label) {
          var cnt = this._items.length;
          var value;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.label == label) {
              if (item.tweenConfig) value = item.tweenConfig.startValue;else value = item.value;
            } else if (item.tweenConfig && item.tweenConfig.endLabel == label) {
              value = item.tweenConfig.endValue;
            } else continue;
            switch (item.type) {
              case ActionType.XY:
              case ActionType.Size:
              case ActionType.Pivot:
              case ActionType.Scale:
              case ActionType.Skew:
                value.b1 = true;
                value.b2 = true;
                value.f1 = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                value.f2 = parseFloat(arguments.length <= 2 ? undefined : arguments[2]);
                break;
              case ActionType.Alpha:
                value.f1 = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                break;
              case ActionType.Rotation:
                value.f1 = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                break;
              case ActionType.Color:
                value.f1 = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                break;
              case ActionType.Animation:
                value.frame = parseInt(arguments.length <= 1 ? undefined : arguments[1]);
                if ((arguments.length <= 1 ? 0 : arguments.length - 1) > 1) value.playing = arguments.length <= 2 ? undefined : arguments[2];
                break;
              case ActionType.Visible:
                value.visible = arguments.length <= 1 ? undefined : arguments[1];
                break;
              case ActionType.Sound:
                value.sound = arguments.length <= 1 ? undefined : arguments[1];
                if ((arguments.length <= 1 ? 0 : arguments.length - 1) > 1) value.volume = parseFloat(arguments.length <= 2 ? undefined : arguments[2]);
                break;
              case ActionType.Transition:
                value.transName = arguments.length <= 1 ? undefined : arguments[1];
                if ((arguments.length <= 1 ? 0 : arguments.length - 1) > 1) value.playTimes = parseInt(arguments.length <= 2 ? undefined : arguments[2]);
                break;
              case ActionType.Shake:
                value.amplitude = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                if ((arguments.length <= 1 ? 0 : arguments.length - 1) > 1) value.duration = parseFloat(arguments.length <= 2 ? undefined : arguments[2]);
                break;
              case ActionType.ColorFilter:
                value.f1 = parseFloat(arguments.length <= 1 ? undefined : arguments[1]);
                value.f2 = parseFloat(arguments.length <= 2 ? undefined : arguments[2]);
                value.f3 = parseFloat(arguments.length <= 3 ? undefined : arguments[3]);
                value.f4 = parseFloat(arguments.length <= 4 ? undefined : arguments[4]);
                break;
              case ActionType.Text:
              case ActionType.Icon:
                value.text = arguments.length <= 1 ? undefined : arguments[1];
                break;
            }
          }
        };
        _proto45.setHook = function setHook(label, callback) {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.label == label) {
              item.hook = callback;
              break;
            } else if (item.tweenConfig && item.tweenConfig.endLabel == label) {
              item.tweenConfig.endHook = callback;
              break;
            }
          }
        };
        _proto45.clearHooks = function clearHooks() {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            item.hook = null;
            if (item.tweenConfig) item.tweenConfig.endHook = null;
          }
        };
        _proto45.setTarget = function setTarget(label, newTarget) {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.label == label) {
              item.targetId = newTarget.id;
              item.target = null;
            }
          }
        };
        _proto45.setDuration = function setDuration(label, value) {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.tweenConfig && item.label == label) item.tweenConfig.duration = value;
          }
        };
        _proto45.getLabelTime = function getLabelTime(label) {
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.label == label) return item.time;else if (item.tweenConfig && item.tweenConfig.endLabel == label) return item.time + item.tweenConfig.duration;
          }
          return Number.NaN;
        };
        _proto45.updateFromRelations = function updateFromRelations(targetId, dx, dy) {
          var cnt = this._items.length;
          if (cnt == 0) return;
          for (var i = 0; i < cnt; i++) {
            var item = this._items[i];
            if (item.type == ActionType.XY && item.targetId == targetId) {
              if (item.tweenConfig) {
                item.tweenConfig.startValue.f1 += dx;
                item.tweenConfig.startValue.f2 += dy;
                item.tweenConfig.endValue.f1 += dx;
                item.tweenConfig.endValue.f2 += dy;
              } else {
                item.value.f1 += dx;
                item.value.f2 += dy;
              }
            }
          }
        };
        _proto45.onEnable = function onEnable() {
          if (this._autoPlay && !this._playing) this.play(null, this._autoPlayTimes, this._autoPlayDelay);
        };
        _proto45.onDisable = function onDisable() {
          if ((this._options & OPTION_AUTO_STOP_DISABLED) == 0) this.stop((this._options & OPTION_AUTO_STOP_AT_END) != 0 ? true : false, false);
        };
        _proto45.onDelayedPlay = function onDelayedPlay() {
          this.internalPlay();
          this._playing = this._totalTasks > 0;
          if (this._playing) {
            if ((this._options & OPTION_IGNORE_DISPLAY_CONTROLLER) != 0) {
              var cnt = this._items.length;
              for (var i = 0; i < cnt; i++) {
                var item = this._items[i];
                if (item.target && item.target != this._owner) item.displayLockToken = item.target.addDisplayLock();
              }
            }
          } else if (this._onComplete != null) {
            var func = this._onComplete;
            this._onComplete = null;
            func();
          }
        };
        _proto45.internalPlay = function internalPlay() {
          this._ownerBaseX = this._owner.x;
          this._ownerBaseY = this._owner.y;
          this._totalTasks = 1;
          var cnt = this._items.length;
          var item;
          var needSkipAnimations = false;
          var i;
          if (!this._reversed) {
            for (i = 0; i < cnt; i++) {
              item = this._items[i];
              if (item.target == null) continue;
              if (item.type == ActionType.Animation && this._startTime != 0 && item.time <= this._startTime) {
                needSkipAnimations = true;
                item.value.flag = false;
              } else this.playItem(item);
            }
          } else {
            for (i = cnt - 1; i >= 0; i--) {
              item = this._items[i];
              if (item.target == null) continue;
              this.playItem(item);
            }
          }
          if (needSkipAnimations) this.skipAnimations();
          this._totalTasks--;
        };
        _proto45.playItem = function playItem(item) {
          var time;
          if (item.tweenConfig) {
            if (this._reversed) time = this._totalDuration - item.time - item.tweenConfig.duration;else time = item.time;
            if (this._endTime == -1 || time <= this._endTime) {
              var startValue;
              var endValue;
              if (this._reversed) {
                startValue = item.tweenConfig.endValue;
                endValue = item.tweenConfig.startValue;
              } else {
                startValue = item.tweenConfig.startValue;
                endValue = item.tweenConfig.endValue;
              }
              item.value.b1 = startValue.b1 || endValue.b1;
              item.value.b2 = startValue.b2 || endValue.b2;
              switch (item.type) {
                case ActionType.XY:
                case ActionType.Size:
                case ActionType.Scale:
                case ActionType.Skew:
                  item.tweener = GTween.to2(startValue.f1, startValue.f2, endValue.f1, endValue.f2, item.tweenConfig.duration);
                  break;
                case ActionType.Alpha:
                case ActionType.Rotation:
                  item.tweener = GTween.to(startValue.f1, endValue.f1, item.tweenConfig.duration);
                  break;
                case ActionType.Color:
                  item.tweener = GTween.toColor(startValue.f1, endValue.f1, item.tweenConfig.duration);
                  break;
                case ActionType.ColorFilter:
                  item.tweener = GTween.to4(startValue.f1, startValue.f2, startValue.f3, startValue.f4, endValue.f1, endValue.f2, endValue.f3, endValue.f4, item.tweenConfig.duration);
                  break;
              }
              item.tweener.setDelay(time).setEase(item.tweenConfig.easeType).setRepeat(item.tweenConfig.repeat, item.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(item).onStart(this.onTweenStart, this).onUpdate(this.onTweenUpdate, this).onComplete(this.onTweenComplete, this);
              if (this._endTime >= 0) item.tweener.setBreakpoint(this._endTime - time);
              this._totalTasks++;
            }
          } else if (item.type == ActionType.Shake) {
            if (this._reversed) time = this._totalDuration - item.time - item.value.duration;else time = item.time;
            item.value.offsetX = item.value.offsetY = 0;
            item.value.lastOffsetX = item.value.lastOffsetY = 0;
            item.tweener = GTween.shake(0, 0, item.value.amplitude, item.value.duration).setDelay(time).setTimeScale(this._timeScale).setTarget(item).onUpdate(this.onTweenUpdate, this).onComplete(this.onTweenComplete, this);
            if (this._endTime >= 0) item.tweener.setBreakpoint(this._endTime - item.time);
            this._totalTasks++;
          } else {
            if (this._reversed) time = this._totalDuration - item.time;else time = item.time;
            if (time <= this._startTime) {
              this.applyValue(item);
              this.callHook(item, false);
            } else if (this._endTime == -1 || time <= this._endTime) {
              this._totalTasks++;
              item.tweener = GTween.delayedCall(time).setTimeScale(this._timeScale).setTarget(item).onComplete(this.onDelayedPlayItem, this);
            }
          }
          if (item.tweener) item.tweener.seek(this._startTime);
        };
        _proto45.skipAnimations = function skipAnimations() {
          var frame;
          var playStartTime;
          var playTotalTime;
          var value;
          var target;
          var item;
          var cnt = this._items.length;
          for (var i = 0; i < cnt; i++) {
            item = this._items[i];
            if (item.type != ActionType.Animation || item.time > this._startTime) continue;
            value = item.value;
            if (value.flag) continue;
            target = item.target;
            frame = target.getProp(ObjectPropID.Frame);
            playStartTime = target.getProp(ObjectPropID.Playing) ? 0 : -1;
            playTotalTime = 0;
            for (var j = i; j < cnt; j++) {
              item = this._items[j];
              if (item.type != ActionType.Animation || item.target != target || item.time > this._startTime) continue;
              value = item.value;
              value.flag = true;
              if (value.frame != -1) {
                frame = value.frame;
                if (value.playing) playStartTime = item.time;else playStartTime = -1;
                playTotalTime = 0;
              } else {
                if (value.playing) {
                  if (playStartTime < 0) playStartTime = item.time;
                } else {
                  if (playStartTime >= 0) playTotalTime += item.time - playStartTime;
                  playStartTime = -1;
                }
              }
              this.callHook(item, false);
            }
            if (playStartTime >= 0) playTotalTime += this._startTime - playStartTime;
            target.setProp(ObjectPropID.Playing, playStartTime >= 0);
            target.setProp(ObjectPropID.Frame, frame);
            if (playTotalTime > 0) target.setProp(ObjectPropID.DeltaTime, playTotalTime);
          }
        };
        _proto45.onDelayedPlayItem = function onDelayedPlayItem(tweener) {
          var item = tweener.target;
          item.tweener = null;
          this._totalTasks--;
          this.applyValue(item);
          this.callHook(item, false);
          this.checkAllComplete();
        };
        _proto45.onTweenStart = function onTweenStart(tweener) {
          var item = tweener.target;
          if (item.type == ActionType.XY || item.type == ActionType.Size)
            //start
            {
              var startValue;
              var endValue;
              if (this._reversed) {
                startValue = item.tweenConfig.endValue;
                endValue = item.tweenConfig.startValue;
              } else {
                startValue = item.tweenConfig.startValue;
                endValue = item.tweenConfig.endValue;
              }
              if (item.type == ActionType.XY) {
                if (item.target != this._owner) {
                  if (!startValue.b1) tweener.startValue.x = item.target.x;else if (startValue.b3)
                    //percent
                    tweener.startValue.x = startValue.f1 * this._owner.width;
                  if (!startValue.b2) tweener.startValue.y = item.target.y;else if (startValue.b3)
                    //percent
                    tweener.startValue.y = startValue.f2 * this._owner.height;
                  if (!endValue.b1) tweener.endValue.x = tweener.startValue.x;else if (endValue.b3) tweener.endValue.x = endValue.f1 * this._owner.width;
                  if (!endValue.b2) tweener.endValue.y = tweener.startValue.y;else if (endValue.b3) tweener.endValue.y = endValue.f2 * this._owner.height;
                } else {
                  if (!startValue.b1) tweener.startValue.x = item.target.x - this._ownerBaseX;
                  if (!startValue.b2) tweener.startValue.y = item.target.y - this._ownerBaseY;
                  if (!endValue.b1) tweener.endValue.x = tweener.startValue.x;
                  if (!endValue.b2) tweener.endValue.y = tweener.startValue.y;
                }
              } else {
                if (!startValue.b1) tweener.startValue.x = item.target.width;
                if (!startValue.b2) tweener.startValue.y = item.target.height;
                if (!endValue.b1) tweener.endValue.x = tweener.startValue.x;
                if (!endValue.b2) tweener.endValue.y = tweener.startValue.y;
              }
              if (item.tweenConfig.path) {
                item.value.b1 = item.value.b2 = true;
                tweener.setPath(item.tweenConfig.path);
              }
            }
          this.callHook(item, false);
        };
        _proto45.onTweenUpdate = function onTweenUpdate(tweener) {
          var item = tweener.target;
          switch (item.type) {
            case ActionType.XY:
            case ActionType.Size:
            case ActionType.Scale:
            case ActionType.Skew:
              item.value.f1 = tweener.value.x;
              item.value.f2 = tweener.value.y;
              if (item.tweenConfig.path) {
                item.value.f1 += tweener.startValue.x;
                item.value.f2 += tweener.startValue.y;
              }
              break;
            case ActionType.Alpha:
            case ActionType.Rotation:
              item.value.f1 = tweener.value.x;
              break;
            case ActionType.Color:
              item.value.f1 = tweener.value.color;
              break;
            case ActionType.ColorFilter:
              item.value.f1 = tweener.value.x;
              item.value.f2 = tweener.value.y;
              item.value.f3 = tweener.value.z;
              item.value.f4 = tweener.value.w;
              break;
            case ActionType.Shake:
              item.value.offsetX = tweener.deltaValue.x;
              item.value.offsetY = tweener.deltaValue.y;
              break;
          }
          this.applyValue(item);
        };
        _proto45.onTweenComplete = function onTweenComplete(tweener) {
          var item = tweener.target;
          item.tweener = null;
          this._totalTasks--;
          if (tweener.allCompleted)
            //tween
            this.callHook(item, true);
          this.checkAllComplete();
        };
        _proto45.onPlayTransCompleted = function onPlayTransCompleted(item) {
          this._totalTasks--;
          this.checkAllComplete();
        };
        _proto45.callHook = function callHook(item, tweenEnd) {
          if (tweenEnd) {
            if (item.tweenConfig && item.tweenConfig.endHook != null) item.tweenConfig.endHook(item.label);
          } else {
            if (item.time >= this._startTime && item.hook != null) item.hook(item.label);
          }
        };
        _proto45.checkAllComplete = function checkAllComplete() {
          if (this._playing && this._totalTasks == 0) {
            if (this._totalTimes < 0) {
              this.internalPlay();
              if (this._totalTasks == 0) GTween.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete, this);
            } else {
              this._totalTimes--;
              if (this._totalTimes > 0) {
                this.internalPlay();
                if (this._totalTasks == 0) GTween.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete, this);
              } else {
                this._playing = false;
                var cnt = this._items.length;
                for (var i = 0; i < cnt; i++) {
                  var item = this._items[i];
                  if (item.target && item.displayLockToken != 0) {
                    item.target.releaseDisplayLock(item.displayLockToken);
                    item.displayLockToken = 0;
                  }
                }
                if (this._onComplete != null) {
                  var func = this._onComplete;
                  this._onComplete = null;
                  func();
                }
              }
            }
          }
        };
        _proto45.applyValue = function applyValue(item) {
          item.target._gearLocked = true;
          var value = item.value;
          switch (item.type) {
            case ActionType.XY:
              if (item.target == this._owner) {
                if (value.b1 && value.b2) item.target.setPosition(value.f1 + this._ownerBaseX, value.f2 + this._ownerBaseY);else if (value.b1) item.target.x = value.f1 + this._ownerBaseX;else item.target.y = value.f2 + this._ownerBaseY;
              } else {
                if (value.b3)
                  //position in percent
                  {
                    if (value.b1 && value.b2) item.target.setPosition(value.f1 * this._owner.width, value.f2 * this._owner.height);else if (value.b1) item.target.x = value.f1 * this._owner.width;else if (value.b2) item.target.y = value.f2 * this._owner.height;
                  } else {
                  if (value.b1 && value.b2) item.target.setPosition(value.f1, value.f2);else if (value.b1) item.target.x = value.f1;else if (value.b2) item.target.y = value.f2;
                }
              }
              break;
            case ActionType.Size:
              if (!value.b1) value.f1 = item.target.width;
              if (!value.b2) value.f2 = item.target.height;
              item.target.setSize(value.f1, value.f2);
              break;
            case ActionType.Pivot:
              item.target.setPivot(value.f1, value.f2, item.target.pivotAsAnchor);
              break;
            case ActionType.Alpha:
              item.target.alpha = value.f1;
              break;
            case ActionType.Rotation:
              item.target.rotation = value.f1;
              break;
            case ActionType.Scale:
              item.target.setScale(value.f1, value.f2);
              break;
            case ActionType.Skew:
              //item.target.setSkew(value.f1, value.f2);
              break;
            case ActionType.Color:
              var color = item.target.getProp(ObjectPropID.Color);
              if (color instanceof Color) {
                var i = Math.floor(value.f1);
                color.r = i >> 16 & 0xFF;
                color.g = i >> 8 & 0xFF;
                color.b = i & 0xFF;
                item.target.setProp(ObjectPropID.Color, color);
              }
              break;
            case ActionType.Animation:
              if (value.frame >= 0) item.target.setProp(ObjectPropID.Frame, value.frame);
              item.target.setProp(ObjectPropID.Playing, value.playing);
              item.target.setProp(ObjectPropID.TimeScale, this._timeScale);
              break;
            case ActionType.Visible:
              item.target.visible = value.visible;
              break;
            case ActionType.Transition:
              if (this._playing) {
                var trans = value.trans;
                if (trans) {
                  this._totalTasks++;
                  var startTime = this._startTime > item.time ? this._startTime - item.time : 0;
                  var endTime = this._endTime >= 0 ? this._endTime - item.time : -1;
                  if (value.stopTime >= 0 && (endTime < 0 || endTime > value.stopTime)) endTime = value.stopTime;
                  trans.timeScale = this._timeScale;
                  var localThis = this;
                  trans._play(function () {
                    localThis.onPlayTransCompleted(item);
                  }, value.playTimes, 0, startTime, endTime, this._reversed);
                }
              }
              break;
            case ActionType.Sound:
              if (this._playing && item.time >= this._startTime) {
                if (value.audioClip == null) {
                  var pi = UIPackage.getItemByURL(value.sound);
                  if (pi) value.audioClip = pi.owner.getItemAsset(pi);
                }
                if (value.audioClip) Decls$1.GRoot.inst.playOneShotSound(value.audioClip, value.volume);
              }
              break;
            case ActionType.Shake:
              item.target.setPosition(item.target.x - value.lastOffsetX + value.offsetX, item.target.y - value.lastOffsetY + value.offsetY);
              value.lastOffsetX = value.offsetX;
              value.lastOffsetY = value.offsetY;
              break;
            case ActionType.ColorFilter:
              {
                //TODO: filter support
                break;
              }
            case ActionType.Text:
              item.target.text = value.text;
              break;
            case ActionType.Icon:
              item.target.icon = value.text;
              break;
          }
          item.target._gearLocked = false;
        };
        _proto45.setup = function setup(buffer) {
          this.name = buffer.readS();
          this._options = buffer.readInt();
          this._autoPlay = buffer.readBool();
          this._autoPlayTimes = buffer.readInt();
          this._autoPlayDelay = buffer.readFloat();
          var cnt = buffer.readShort();
          for (var i = 0; i < cnt; i++) {
            var dataLen = buffer.readShort();
            var curPos = buffer.position;
            buffer.seek(curPos, 0);
            var item = new Item(buffer.readByte());
            this._items[i] = item;
            item.time = buffer.readFloat();
            var targetId = buffer.readShort();
            if (targetId < 0) item.targetId = "";else item.targetId = this._owner.getChildAt(targetId).id;
            item.label = buffer.readS();
            if (buffer.readBool()) {
              buffer.seek(curPos, 1);
              item.tweenConfig = new TweenConfig();
              item.tweenConfig.duration = buffer.readFloat();
              if (item.time + item.tweenConfig.duration > this._totalDuration) this._totalDuration = item.time + item.tweenConfig.duration;
              item.tweenConfig.easeType = buffer.readByte();
              item.tweenConfig.repeat = buffer.readInt();
              item.tweenConfig.yoyo = buffer.readBool();
              item.tweenConfig.endLabel = buffer.readS();
              buffer.seek(curPos, 2);
              this.decodeValue(item, buffer, item.tweenConfig.startValue);
              buffer.seek(curPos, 3);
              this.decodeValue(item, buffer, item.tweenConfig.endValue);
              if (buffer.version >= 2) {
                var pathLen = buffer.readInt();
                if (pathLen > 0) {
                  item.tweenConfig.path = new GPath();
                  var pts = new Array();
                  for (var j = 0; j < pathLen; j++) {
                    var curveType = buffer.readByte();
                    switch (curveType) {
                      case CurveType.Bezier:
                        pts.push(GPathPoint.newBezierPoint(buffer.readFloat(), buffer.readFloat(), buffer.readFloat(), buffer.readFloat()));
                        break;
                      case CurveType.CubicBezier:
                        pts.push(GPathPoint.newCubicBezierPoint(buffer.readFloat(), buffer.readFloat(), buffer.readFloat(), buffer.readFloat(), buffer.readFloat(), buffer.readFloat()));
                        break;
                      default:
                        pts.push(GPathPoint.newPoint(buffer.readFloat(), buffer.readFloat(), curveType));
                        break;
                    }
                  }
                  item.tweenConfig.path.create(pts);
                }
              }
            } else {
              if (item.time > this._totalDuration) this._totalDuration = item.time;
              buffer.seek(curPos, 2);
              this.decodeValue(item, buffer, item.value);
            }
            buffer.position = curPos + dataLen;
          }
        };
        _proto45.decodeValue = function decodeValue(item, buffer, value) {
          switch (item.type) {
            case ActionType.XY:
            case ActionType.Size:
            case ActionType.Pivot:
            case ActionType.Skew:
              value.b1 = buffer.readBool();
              value.b2 = buffer.readBool();
              value.f1 = buffer.readFloat();
              value.f2 = buffer.readFloat();
              if (buffer.version >= 2 && item.type == ActionType.XY) value.b3 = buffer.readBool(); //percent
              break;
            case ActionType.Alpha:
            case ActionType.Rotation:
              value.f1 = buffer.readFloat();
              break;
            case ActionType.Scale:
              value.f1 = buffer.readFloat();
              value.f2 = buffer.readFloat();
              break;
            case ActionType.Color:
              var color = buffer.readColor();
              value.f1 = (color.r << 16) + (color.g << 8) + color.b;
              break;
            case ActionType.Animation:
              value.playing = buffer.readBool();
              value.frame = buffer.readInt();
              break;
            case ActionType.Visible:
              value.visible = buffer.readBool();
              break;
            case ActionType.Sound:
              value.sound = buffer.readS();
              value.volume = buffer.readFloat();
              break;
            case ActionType.Transition:
              value.transName = buffer.readS();
              value.playTimes = buffer.readInt();
              break;
            case ActionType.Shake:
              value.amplitude = buffer.readFloat();
              value.duration = buffer.readFloat();
              break;
            case ActionType.ColorFilter:
              value.f1 = buffer.readFloat();
              value.f2 = buffer.readFloat();
              value.f3 = buffer.readFloat();
              value.f4 = buffer.readFloat();
              break;
            case ActionType.Text:
            case ActionType.Icon:
              value.text = buffer.readS();
              break;
          }
        };
        _createClass(Transition, [{
          key: "playing",
          get: function get() {
            return this._playing;
          }
        }, {
          key: "timeScale",
          get: function get() {
            return this._timeScale;
          },
          set: function set(value) {
            if (this._timeScale != value) {
              this._timeScale = value;
              if (this._playing) {
                var cnt = this._items.length;
                for (var i = 0; i < cnt; i++) {
                  var item = this._items[i];
                  if (item.tweener) item.tweener.setTimeScale(value);else if (item.type == ActionType.Transition) {
                    if (item.value.trans) item.value.trans.timeScale = value;
                  } else if (item.type == ActionType.Animation) {
                    if (item.target) item.target.setProp(ObjectPropID.TimeScale, value);
                  }
                }
              }
            }
          }
        }]);
        return Transition;
      }());
      var OPTION_IGNORE_DISPLAY_CONTROLLER = 1;
      var OPTION_AUTO_STOP_DISABLED = 2;
      var OPTION_AUTO_STOP_AT_END = 4;
      var ActionType;
      (function (ActionType) {
        ActionType[ActionType["XY"] = 0] = "XY";
        ActionType[ActionType["Size"] = 1] = "Size";
        ActionType[ActionType["Scale"] = 2] = "Scale";
        ActionType[ActionType["Pivot"] = 3] = "Pivot";
        ActionType[ActionType["Alpha"] = 4] = "Alpha";
        ActionType[ActionType["Rotation"] = 5] = "Rotation";
        ActionType[ActionType["Color"] = 6] = "Color";
        ActionType[ActionType["Animation"] = 7] = "Animation";
        ActionType[ActionType["Visible"] = 8] = "Visible";
        ActionType[ActionType["Sound"] = 9] = "Sound";
        ActionType[ActionType["Transition"] = 10] = "Transition";
        ActionType[ActionType["Shake"] = 11] = "Shake";
        ActionType[ActionType["ColorFilter"] = 12] = "ColorFilter";
        ActionType[ActionType["Skew"] = 13] = "Skew";
        ActionType[ActionType["Text"] = 14] = "Text";
        ActionType[ActionType["Icon"] = 15] = "Icon";
        ActionType[ActionType["Unknown"] = 16] = "Unknown";
      })(ActionType || (ActionType = {}));
      var Item = function Item(type) {
        this.type = type;
        this.value = {};
        this.displayLockToken = 0;
      };
      var TweenConfig = function TweenConfig() {
        this.easeType = EaseType.QuadOut;
        this.startValue = {
          b1: true,
          b2: true
        };
        this.endValue = {
          b1: true,
          b2: true
        };
      };
      var GComponent = exports('GComponent', /*#__PURE__*/function (_GObject6) {
        _inheritsLoose(GComponent, _GObject6);
        function GComponent() {
          var _this19;
          _this19 = _GObject6.call(this) || this;
          _this19._sortingChildCount = 0;
          _this19._invertedMask = false;
          _this19._childrenRenderOrder = ChildrenRenderOrder.Ascent;
          _this19._apexIndex = 0;
          _this19._node.name = "GComponent";
          _this19._children = new Array();
          _this19._controllers = new Array();
          _this19._transitions = new Array();
          _this19._margin = new Margin();
          _this19._alignOffset = new Vec2();
          _this19._container = new Node("Container");
          _this19._container.layer = UIConfig.defaultUILayer;
          _this19._containerUITrans = _this19._container.addComponent(UITransform);
          _this19._containerUITrans.setAnchorPoint(0, 1);
          _this19._node.addChild(_this19._container);
          return _this19;
        }
        var _proto46 = GComponent.prototype;
        _proto46.dispose = function dispose() {
          var i;
          var cnt;
          cnt = this._transitions.length;
          for (i = 0; i < cnt; ++i) {
            var trans = this._transitions[i];
            trans.dispose();
          }
          cnt = this._controllers.length;
          for (i = 0; i < cnt; ++i) {
            var cc = this._controllers[i];
            cc.dispose();
          }
          if (this._scrollPane) this._scrollPane.destroy();
          cnt = this._children.length;
          for (i = cnt - 1; i >= 0; --i) {
            var obj = this._children[i];
            obj._parent = null; //avoid removeFromParent call
            obj.dispose();
          }
          this._boundsChanged = false;
          _GObject6.prototype.dispose.call(this);
        };
        _proto46.addChild = function addChild(child) {
          this.addChildAt(child, this._children.length);
          return child;
        };
        _proto46.addChildAt = function addChildAt(child, index) {
          if (!child) throw new Error("child is null");
          var numChildren = this._children.length;
          if (index >= 0 && index <= numChildren) {
            if (child.parent == this) {
              this.setChildIndex(child, index);
            } else {
              child.removeFromParent();
              child._parent = this;
              var cnt = this._children.length;
              if (child.sortingOrder != 0) {
                this._sortingChildCount++;
                index = this.getInsertPosForSortingChild(child);
              } else if (this._sortingChildCount > 0) {
                if (index > cnt - this._sortingChildCount) index = cnt - this._sortingChildCount;
              }
              if (index == cnt) this._children.push(child);else this._children.splice(index, 0, child);
              this.onChildAdd(child, index);
              this.setBoundsChangedFlag();
            }
            return child;
          } else {
            throw new Error("Invalid child index");
          }
        };
        _proto46.getInsertPosForSortingChild = function getInsertPosForSortingChild(target) {
          var cnt = this._children.length;
          var i = 0;
          for (i = 0; i < cnt; i++) {
            var child = this._children[i];
            if (child == target) continue;
            if (target.sortingOrder < child.sortingOrder) break;
          }
          return i;
        };
        _proto46.removeChild = function removeChild(child, dispose) {
          var childIndex = this._children.indexOf(child);
          if (childIndex != -1) {
            this.removeChildAt(childIndex, dispose);
          }
          return child;
        };
        _proto46.removeChildAt = function removeChildAt(index, dispose) {
          if (index >= 0 && index < this.numChildren) {
            var child = this._children[index];
            child._parent = null;
            if (child.sortingOrder != 0) this._sortingChildCount--;
            this._children.splice(index, 1);
            child.group = null;
            this._container.removeChild(child.node);
            if (this._childrenRenderOrder == ChildrenRenderOrder.Arch) this._partner.callLater(this.buildNativeDisplayList);
            if (dispose) child.dispose();else child.node.parent = null;
            this.setBoundsChangedFlag();
            return child;
          } else {
            throw new Error("Invalid child index");
          }
        };
        _proto46.removeChildren = function removeChildren(beginIndex, endIndex, dispose) {
          if (beginIndex == undefined) beginIndex = 0;
          if (endIndex == undefined) endIndex = -1;
          if (endIndex < 0 || endIndex >= this.numChildren) endIndex = this.numChildren - 1;
          for (var i = beginIndex; i <= endIndex; ++i) this.removeChildAt(beginIndex, dispose);
        };
        _proto46.getChildAt = function getChildAt(index, classType) {
          if (index >= 0 && index < this.numChildren) return this._children[index];else throw new Error("Invalid child index");
        };
        _proto46.getChild = function getChild(name, classType) {
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            if (this._children[i].name == name) return this._children[i];
          }
          return null;
        };
        _proto46.getChildByPath = function getChildByPath(path, classType) {
          var arr = path.split(".");
          var cnt = arr.length;
          var gcom = this;
          var obj;
          for (var i = 0; i < cnt; ++i) {
            obj = gcom.getChild(arr[i]);
            if (!obj) break;
            if (i != cnt - 1) {
              if (!(obj instanceof GComponent)) {
                obj = null;
                break;
              } else gcom = obj;
            }
          }
          return obj;
        };
        _proto46.getVisibleChild = function getVisibleChild(name) {
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            var child = this._children[i];
            if (child._finalVisible && child.name == name) return child;
          }
          return null;
        };
        _proto46.getChildInGroup = function getChildInGroup(name, group) {
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            var child = this._children[i];
            if (child.group == group && child.name == name) return child;
          }
          return null;
        };
        _proto46.getChildById = function getChildById(id) {
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            if (this._children[i]._id == id) return this._children[i];
          }
          return null;
        };
        _proto46.getChildIndex = function getChildIndex(child) {
          return this._children.indexOf(child);
        };
        _proto46.setChildIndex = function setChildIndex(child, index) {
          var oldIndex = this._children.indexOf(child);
          if (oldIndex == -1) throw new Error("Not a child of this container");
          if (child.sortingOrder != 0)
            //no effect
            return;
          var cnt = this._children.length;
          if (this._sortingChildCount > 0) {
            if (index > cnt - this._sortingChildCount - 1) index = cnt - this._sortingChildCount - 1;
          }
          this._setChildIndex(child, oldIndex, index);
        };
        _proto46.setChildIndexBefore = function setChildIndexBefore(child, index) {
          var oldIndex = this._children.indexOf(child);
          if (oldIndex == -1) throw new Error("Not a child of this container");
          if (child.sortingOrder != 0)
            //no effect
            return oldIndex;
          var cnt = this._children.length;
          if (this._sortingChildCount > 0) {
            if (index > cnt - this._sortingChildCount - 1) index = cnt - this._sortingChildCount - 1;
          }
          if (oldIndex < index) return this._setChildIndex(child, oldIndex, index - 1);else return this._setChildIndex(child, oldIndex, index);
        };
        _proto46._setChildIndex = function _setChildIndex(child, oldIndex, index) {
          var cnt = this._children.length;
          if (index > cnt) index = cnt;
          if (oldIndex == index) return oldIndex;
          this._children.splice(oldIndex, 1);
          this._children.splice(index, 0, child);
          if (this._childrenRenderOrder == ChildrenRenderOrder.Ascent) child.node.setSiblingIndex(index);else if (this._childrenRenderOrder == ChildrenRenderOrder.Descent) child.node.setSiblingIndex(cnt - index);else this._partner.callLater(this.buildNativeDisplayList);
          this.setBoundsChangedFlag();
          return index;
        };
        _proto46.swapChildren = function swapChildren(child1, child2) {
          var index1 = this._children.indexOf(child1);
          var index2 = this._children.indexOf(child2);
          if (index1 == -1 || index2 == -1) throw new Error("Not a child of this container");
          this.swapChildrenAt(index1, index2);
        };
        _proto46.swapChildrenAt = function swapChildrenAt(index1, index2) {
          var child1 = this._children[index1];
          var child2 = this._children[index2];
          this.setChildIndex(child1, index2);
          this.setChildIndex(child2, index1);
        };
        _proto46.isAncestorOf = function isAncestorOf(child) {
          if (child == null) return false;
          var p = child.parent;
          while (p) {
            if (p == this) return true;
            p = p.parent;
          }
          return false;
        };
        _proto46.addController = function addController(controller) {
          this._controllers.push(controller);
          controller.parent = this;
          this.applyController(controller);
        };
        _proto46.getControllerAt = function getControllerAt(index) {
          return this._controllers[index];
        };
        _proto46.getController = function getController(name) {
          var cnt = this._controllers.length;
          for (var i = 0; i < cnt; ++i) {
            var c = this._controllers[i];
            if (c.name == name) return c;
          }
          return null;
        };
        _proto46.removeController = function removeController(c) {
          var index = this._controllers.indexOf(c);
          if (index == -1) throw new Error("controller not exists");
          c.parent = null;
          this._controllers.splice(index, 1);
          var length = this._children.length;
          for (var i = 0; i < length; i++) {
            var child = this._children[i];
            child.handleControllerChanged(c);
          }
        };
        _proto46.onChildAdd = function onChildAdd(child, index) {
          child.node.parent = this._container;
          child.node.active = child._finalVisible;
          if (this._buildingDisplayList) return;
          var cnt = this._children.length;
          if (this._childrenRenderOrder == ChildrenRenderOrder.Ascent) child.node.setSiblingIndex(index);else if (this._childrenRenderOrder == ChildrenRenderOrder.Descent) child.node.setSiblingIndex(cnt - index);else this._partner.callLater(this.buildNativeDisplayList);
        };
        _proto46.buildNativeDisplayList = function buildNativeDisplayList(dt) {
          if (!isNaN(dt)) {
            var _t = GObject.cast(this.node);
            _t.buildNativeDisplayList();
            return;
          }
          var cnt = this._children.length;
          if (cnt == 0) return;
          var child;
          switch (this._childrenRenderOrder) {
            case ChildrenRenderOrder.Ascent:
              {
                var j = 0;
                for (var i = 0; i < cnt; i++) {
                  child = this._children[i];
                  child.node.setSiblingIndex(j++);
                }
              }
              break;
            case ChildrenRenderOrder.Descent:
              {
                var _j = 0;
                for (var _i3 = cnt - 1; _i3 >= 0; _i3--) {
                  child = this._children[_i3];
                  child.node.setSiblingIndex(_j++);
                }
              }
              break;
            case ChildrenRenderOrder.Arch:
              {
                var _j2 = 0;
                for (var _i4 = 0; _i4 < this._apexIndex; _i4++) {
                  child = this._children[_i4];
                  child.node.setSiblingIndex(_j2++);
                }
                for (var _i5 = cnt - 1; _i5 >= this._apexIndex; _i5--) {
                  child = this._children[_i5];
                  child.node.setSiblingIndex(_j2++);
                }
              }
              break;
          }
        };
        _proto46.applyController = function applyController(c) {
          this._applyingController = c;
          var child;
          var length = this._children.length;
          for (var i = 0; i < length; i++) {
            child = this._children[i];
            child.handleControllerChanged(c);
          }
          this._applyingController = null;
          c.runActions();
        };
        _proto46.applyAllControllers = function applyAllControllers() {
          var cnt = this._controllers.length;
          for (var i = 0; i < cnt; ++i) {
            this.applyController(this._controllers[i]);
          }
        };
        _proto46.adjustRadioGroupDepth = function adjustRadioGroupDepth(obj, c) {
          var cnt = this._children.length;
          var i;
          var child;
          var myIndex = -1,
            maxIndex = -1;
          for (i = 0; i < cnt; i++) {
            child = this._children[i];
            if (child == obj) {
              myIndex = i;
            } else if ("relatedController" in child /*is button*/ && child.relatedController == c) {
              if (i > maxIndex) maxIndex = i;
            }
          }
          if (myIndex < maxIndex) {
            if (this._applyingController) this._children[maxIndex].handleControllerChanged(this._applyingController);
            this.swapChildrenAt(myIndex, maxIndex);
          }
        };
        _proto46.getTransitionAt = function getTransitionAt(index) {
          return this._transitions[index];
        };
        _proto46.getTransition = function getTransition(transName) {
          var cnt = this._transitions.length;
          for (var i = 0; i < cnt; ++i) {
            var trans = this._transitions[i];
            if (trans.name == transName) return trans;
          }
          return null;
        };
        _proto46.isChildInView = function isChildInView(child) {
          if (this._rectMask) {
            return child.x + child.width >= 0 && child.x <= this.width && child.y + child.height >= 0 && child.y <= this.height;
          } else if (this._scrollPane) {
            return this._scrollPane.isChildInView(child);
          } else return true;
        };
        _proto46.getFirstChildInView = function getFirstChildInView() {
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            var child = this._children[i];
            if (this.isChildInView(child)) return i;
          }
          return -1;
        };
        _proto46.setMask = function setMask(value, inverted) {
          if (this._maskContent) {
            this._maskContent.node.off(Node.EventType.TRANSFORM_CHANGED, this.onMaskContentChanged, this);
            this._maskContent.node.off(Node.EventType.SIZE_CHANGED, this.onMaskContentChanged, this);
            this._maskContent.node.off(Node.EventType.ANCHOR_CHANGED, this.onMaskContentChanged, this);
            this._maskContent.visible = true;
          }
          this._maskContent = value;
          if (this._maskContent) {
            if (!(value instanceof GImage) && !(value instanceof GGraph)) return;
            if (!this._customMask) {
              var maskNode = new Node("Mask");
              maskNode.layer = UIConfig.defaultUILayer;
              maskNode.addComponent(UITransform);
              maskNode.parent = this._node;
              if (this._scrollPane) this._container.parent.parent = maskNode;else this._container.parent = maskNode;
              this._customMask = maskNode.addComponent(Mask);
            }
            value.visible = false;
            value.node.on(Node.EventType.TRANSFORM_CHANGED, this.onMaskContentChanged, this);
            value.node.on(Node.EventType.SIZE_CHANGED, this.onMaskContentChanged, this);
            value.node.on(Node.EventType.ANCHOR_CHANGED, this.onMaskContentChanged, this);
            this._invertedMask = inverted;
            if (this._node.activeInHierarchy) this.onMaskReady();else this.on(Event.DISPLAY, this.onMaskReady, this);
            this.onMaskContentChanged();
            if (this._scrollPane) this._scrollPane.adjustMaskContainer();else this._container.setPosition(0, 0);
          } else if (this._customMask) {
            if (this._scrollPane) this._container.parent.parent = this._node;else this._container.parent = this._node;
            this._customMask.node.destroy();
            this._customMask = null;
            if (this._scrollPane) this._scrollPane.adjustMaskContainer();else this._container.setPosition(this._pivotCorrectX, this._pivotCorrectY);
          }
        };
        _proto46.onMaskReady = function onMaskReady() {
          this.off(Event.DISPLAY, this.onMaskReady, this);
          if (this._maskContent instanceof GImage) {
            this._customMask.type = Mask.Type.SPRITE_STENCIL;
            this._customMask.alphaThreshold = 0.0001;
            this._customMask.spriteFrame = this._maskContent._content.spriteFrame;
          } else if (this._maskContent instanceof GGraph) {
            if (this._maskContent.type == 2) this._customMask.type = Mask.Type.GRAPHICS_ELLIPSE;else this._customMask.type = Mask.Type.GRAPHICS_RECT;
          }
          this._customMask.inverted = this._invertedMask;
        };
        _proto46.onMaskContentChanged = function onMaskContentChanged() {
          var maskNode = this._customMask.node;
          var maskUITrans = maskNode.getComponent(UITransform);
          var contentNode = this._maskContent.node;
          var contentUITrans = this._maskContent._uiTrans;
          var w = this._maskContent.width * this._maskContent.scaleX;
          var h = this._maskContent.height * this._maskContent.scaleY;
          maskUITrans.setContentSize(w, h);
          var left = contentNode.position.x - contentUITrans.anchorX * w;
          var top = contentNode.position.y - contentUITrans.anchorY * h;
          maskUITrans.setAnchorPoint(-left / maskUITrans.width, -top / maskUITrans.height);
          maskNode.setPosition(this._pivotCorrectX, this._pivotCorrectY);
        };
        _proto46.setupScroll = function setupScroll(buffer) {
          this._scrollPane = this._node.addComponent(ScrollPane);
          this._scrollPane.setup(buffer);
        };
        _proto46.setupOverflow = function setupOverflow(overflow) {
          if (overflow == OverflowType.Hidden) this._rectMask = this._container.addComponent(Mask);
          if (!this._margin.isNone) this.handleSizeChanged();
        };
        _proto46.handleAnchorChanged = function handleAnchorChanged() {
          _GObject6.prototype.handleAnchorChanged.call(this);
          if (this._customMask) this._customMask.node.setPosition(this._pivotCorrectX, this._pivotCorrectY);else if (this._scrollPane) this._scrollPane.adjustMaskContainer();else this._container.setPosition(this._pivotCorrectX + this._alignOffset.x, this._pivotCorrectY - this._alignOffset.y);
        };
        _proto46.handleSizeChanged = function handleSizeChanged() {
          _GObject6.prototype.handleSizeChanged.call(this);
          if (this._customMask) this._customMask.node.setPosition(this._pivotCorrectX, this._pivotCorrectY);else if (!this._scrollPane) this._container.setPosition(this._pivotCorrectX, this._pivotCorrectY);
          if (this._scrollPane) this._scrollPane.onOwnerSizeChanged();else this._containerUITrans.setContentSize(this.viewWidth, this.viewHeight);
        };
        _proto46.handleGrayedChanged = function handleGrayedChanged() {
          var c = this.getController("grayed");
          if (c) {
            c.selectedIndex = this.grayed ? 1 : 0;
            return;
          }
          var v = this.grayed;
          var cnt = this._children.length;
          for (var i = 0; i < cnt; ++i) {
            this._children[i].grayed = v;
          }
        };
        _proto46.handleControllerChanged = function handleControllerChanged(c) {
          _GObject6.prototype.handleControllerChanged.call(this, c);
          if (this._scrollPane) this._scrollPane.handleControllerChanged(c);
        };
        _proto46._hitTest = function _hitTest(pt, globalPt) {
          if (this._customMask) {
            s_vec2$2.set(globalPt);
            s_vec2$2.y = UIContentScaler.rootSize.height - globalPt.y;
            var b = this._customMask.isHit(s_vec2$2) || false;
            if (!b) return null;
          }
          if (this.hitArea) {
            if (!this.hitArea.hitTest(pt, globalPt)) return null;
          } else if (this._rectMask) {
            s_vec2$2.set(pt);
            s_vec2$2.x += this._container.position.x;
            s_vec2$2.y += this._container.position.y;
            var clippingSize = this._containerUITrans.contentSize;
            if (s_vec2$2.x < 0 || s_vec2$2.y < 0 || s_vec2$2.x >= clippingSize.width || s_vec2$2.y >= clippingSize.height) return null;
          }
          if (this._scrollPane) {
            var _target = this._scrollPane.hitTest(pt, globalPt);
            if (!_target) return null;
            if (_target != this) return _target;
          }
          var target = null;
          var cnt = this._children.length;
          for (var i = cnt - 1; i >= 0; i--) {
            var child = this._children[i];
            if (this._maskContent == child || child._touchDisabled) continue;
            target = child.hitTest(globalPt);
            if (target) break;
          }
          if (!target && this._opaque && (this.hitArea || pt.x >= 0 && pt.y >= 0 && pt.x < this._width && pt.y < this._height)) target = this;
          return target;
        };
        _proto46.setBoundsChangedFlag = function setBoundsChangedFlag() {
          if (!this._scrollPane && !this._trackBounds) return;
          if (!this._boundsChanged) {
            this._boundsChanged = true;
            this._partner.callLater(this.refresh);
          }
        };
        _proto46.refresh = function refresh(dt) {
          if (!isNaN(dt)) {
            var _t = GObject.cast(this.node);
            _t.refresh();
            return;
          }
          if (this._boundsChanged) {
            var len = this._children.length;
            if (len > 0) {
              for (var i = 0; i < len; i++) {
                var child = this._children[i];
                child.ensureSizeCorrect();
              }
            }
            this.updateBounds();
          }
        };
        _proto46.ensureBoundsCorrect = function ensureBoundsCorrect() {
          var len = this._children.length;
          if (len > 0) {
            for (var i = 0; i < len; i++) {
              var child = this._children[i];
              child.ensureSizeCorrect();
            }
          }
          if (this._boundsChanged) this.updateBounds();
        };
        _proto46.updateBounds = function updateBounds() {
          var ax = 0,
            ay = 0,
            aw = 0,
            ah = 0;
          var len = this._children.length;
          if (len > 0) {
            ax = Number.POSITIVE_INFINITY, ay = Number.POSITIVE_INFINITY;
            var ar = Number.NEGATIVE_INFINITY,
              ab = Number.NEGATIVE_INFINITY;
            var tmp = 0;
            var i = 0;
            for (var i = 0; i < len; i++) {
              var child = this._children[i];
              tmp = child.x;
              if (tmp < ax) ax = tmp;
              tmp = child.y;
              if (tmp < ay) ay = tmp;
              tmp = child.x + child.actualWidth;
              if (tmp > ar) ar = tmp;
              tmp = child.y + child.actualHeight;
              if (tmp > ab) ab = tmp;
            }
            aw = ar - ax;
            ah = ab - ay;
          }
          this.setBounds(ax, ay, aw, ah);
        };
        _proto46.setBounds = function setBounds(ax, ay, aw, ah) {
          if (ah === void 0) {
            ah = 0;
          }
          this._boundsChanged = false;
          if (this._scrollPane) this._scrollPane.setContentSize(Math.round(ax + aw), Math.round(ay + ah));
        };
        _proto46.getSnappingPosition = function getSnappingPosition(xValue, yValue, resultPoint) {
          if (!resultPoint) resultPoint = new Vec2();
          var cnt = this._children.length;
          if (cnt == 0) {
            resultPoint.x = 0;
            resultPoint.y = 0;
            return resultPoint;
          }
          this.ensureBoundsCorrect();
          var obj = null;
          var prev = null;
          var i = 0;
          if (yValue != 0) {
            for (; i < cnt; i++) {
              obj = this._children[i];
              if (yValue < obj.y) {
                if (i == 0) {
                  yValue = 0;
                  break;
                } else {
                  prev = this._children[i - 1];
                  if (yValue < prev.y + prev.actualHeight / 2)
                    //top half part
                    yValue = prev.y;else
                    //bottom half part
                    yValue = obj.y;
                  break;
                }
              }
            }
            if (i == cnt) yValue = obj.y;
          }
          if (xValue != 0) {
            if (i > 0) i--;
            for (; i < cnt; i++) {
              obj = this._children[i];
              if (xValue < obj.x) {
                if (i == 0) {
                  xValue = 0;
                  break;
                } else {
                  prev = this._children[i - 1];
                  if (xValue < prev.x + prev.actualWidth / 2)
                    //top half part
                    xValue = prev.x;else
                    //bottom half part
                    xValue = obj.x;
                  break;
                }
              }
            }
            if (i == cnt) xValue = obj.x;
          }
          resultPoint.x = xValue;
          resultPoint.y = yValue;
          return resultPoint;
        };
        _proto46.childSortingOrderChanged = function childSortingOrderChanged(child, oldValue, newValue) {
          if (newValue === void 0) {
            newValue = 0;
          }
          if (newValue == 0) {
            this._sortingChildCount--;
            this.setChildIndex(child, this._children.length);
          } else {
            if (oldValue == 0) this._sortingChildCount++;
            var oldIndex = this._children.indexOf(child);
            var index = this.getInsertPosForSortingChild(child);
            if (oldIndex < index) this._setChildIndex(child, oldIndex, index - 1);else this._setChildIndex(child, oldIndex, index);
          }
        };
        _proto46.constructFromResource = function constructFromResource() {
          this.constructFromResource2(null, 0);
        };
        _proto46.constructFromResource2 = function constructFromResource2(objectPool, poolIndex) {
          var contentItem = this.packageItem.getBranch();
          if (!contentItem.decoded) {
            contentItem.decoded = true;
            TranslationHelper.translateComponent(contentItem);
          }
          var i;
          var dataLen;
          var curPos;
          var nextPos;
          var f1;
          var f2;
          var i1;
          var i2;
          var buffer = contentItem.rawData;
          buffer.seek(0, 0);
          this._underConstruct = true;
          this.sourceWidth = buffer.readInt();
          this.sourceHeight = buffer.readInt();
          this.initWidth = this.sourceWidth;
          this.initHeight = this.sourceHeight;
          this.setSize(this.sourceWidth, this.sourceHeight);
          if (buffer.readBool()) {
            this.minWidth = buffer.readInt();
            this.maxWidth = buffer.readInt();
            this.minHeight = buffer.readInt();
            this.maxHeight = buffer.readInt();
          }
          if (buffer.readBool()) {
            f1 = buffer.readFloat();
            f2 = buffer.readFloat();
            this.setPivot(f1, f2, buffer.readBool());
          }
          if (buffer.readBool()) {
            this._margin.top = buffer.readInt();
            this._margin.bottom = buffer.readInt();
            this._margin.left = buffer.readInt();
            this._margin.right = buffer.readInt();
          }
          var overflow = buffer.readByte();
          if (overflow == OverflowType.Scroll) {
            var savedPos = buffer.position;
            buffer.seek(0, 7);
            this.setupScroll(buffer);
            buffer.position = savedPos;
          } else this.setupOverflow(overflow);
          if (buffer.readBool()) buffer.skip(8);
          this._buildingDisplayList = true;
          buffer.seek(0, 1);
          var controllerCount = buffer.readShort();
          for (i = 0; i < controllerCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            var controller = new Controller();
            this._controllers.push(controller);
            controller.parent = this;
            controller.setup(buffer);
            buffer.position = nextPos;
          }
          buffer.seek(0, 2);
          var child;
          var childCount = buffer.readShort();
          for (i = 0; i < childCount; i++) {
            dataLen = buffer.readShort();
            curPos = buffer.position;
            if (objectPool) child = objectPool[poolIndex + i];else {
              buffer.seek(curPos, 0);
              var type = buffer.readByte();
              var src = buffer.readS();
              var pkgId = buffer.readS();
              var pi = null;
              if (src != null) {
                var pkg;
                if (pkgId != null) pkg = UIPackage.getById(pkgId);else pkg = contentItem.owner;
                pi = pkg ? pkg.getItemById(src) : null;
              }
              if (pi) {
                child = Decls.UIObjectFactory.newObject(pi);
                child.constructFromResource();
              } else child = Decls.UIObjectFactory.newObject(type);
            }
            child._underConstruct = true;
            child.setup_beforeAdd(buffer, curPos);
            child._parent = this;
            child.node.parent = this._container;
            this._children.push(child);
            buffer.position = curPos + dataLen;
          }
          buffer.seek(0, 3);
          this.relations.setup(buffer, true);
          buffer.seek(0, 2);
          buffer.skip(2);
          for (i = 0; i < childCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            buffer.seek(buffer.position, 3);
            this._children[i].relations.setup(buffer, false);
            buffer.position = nextPos;
          }
          buffer.seek(0, 2);
          buffer.skip(2);
          for (i = 0; i < childCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            child = this._children[i];
            child.setup_afterAdd(buffer, buffer.position);
            child._underConstruct = false;
            buffer.position = nextPos;
          }
          buffer.seek(0, 4);
          buffer.skip(2); //customData
          this.opaque = buffer.readBool();
          var maskId = buffer.readShort();
          if (maskId != -1) {
            this.setMask(this.getChildAt(maskId), buffer.readBool());
          }
          var hitTestId = buffer.readS();
          i1 = buffer.readInt();
          i2 = buffer.readInt();
          if (hitTestId != null) {
            pi = contentItem.owner.getItemById(hitTestId);
            if (pi && pi.hitTestData) this.hitArea = new PixelHitTest(pi.hitTestData, i1, i2);
          } else if (i1 != 0 && i2 != -1) {
            this.hitArea = new ChildHitArea(this.getChildAt(i2));
          }
          buffer.seek(0, 5);
          var transitionCount = buffer.readShort();
          for (i = 0; i < transitionCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            var trans = new Transition(this);
            trans.setup(buffer);
            this._transitions.push(trans);
            buffer.position = nextPos;
          }
          this.applyAllControllers();
          this._buildingDisplayList = false;
          this._underConstruct = false;
          this.buildNativeDisplayList();
          this.setBoundsChangedFlag();
          if (contentItem.objectType != ObjectType.Component) this.constructExtension(buffer);
          this.onConstruct();
        };
        _proto46.constructExtension = function constructExtension(buffer) {};
        _proto46.onConstruct = function onConstruct() {};
        _proto46.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GObject6.prototype.setup_afterAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 4);
          var pageController = buffer.readShort();
          if (pageController != -1 && this._scrollPane) this._scrollPane.pageController = this._parent.getControllerAt(pageController);
          var cnt = buffer.readShort();
          for (var i = 0; i < cnt; i++) {
            var cc = this.getController(buffer.readS());
            var pageId = buffer.readS();
            if (cc) cc.selectedPageId = pageId;
          }
          if (buffer.version >= 2) {
            cnt = buffer.readShort();
            for (i = 0; i < cnt; i++) {
              var target = buffer.readS();
              var propertyId = buffer.readShort();
              var value = buffer.readS();
              var obj = this.getChildByPath(target);
              if (obj) obj.setProp(propertyId, value);
            }
          }
        };
        _proto46.onEnable = function onEnable() {
          var cnt = this._transitions.length;
          for (var i = 0; i < cnt; ++i) this._transitions[i].onEnable();
        };
        _proto46.onDisable = function onDisable() {
          var cnt = this._transitions.length;
          for (var i = 0; i < cnt; ++i) this._transitions[i].onDisable();
        };
        _createClass(GComponent, [{
          key: "displayListContainer",
          get: function get() {
            return this._container;
          }
        }, {
          key: "numChildren",
          get: function get() {
            return this._children.length;
          }
        }, {
          key: "controllers",
          get: function get() {
            return this._controllers;
          }
        }, {
          key: "scrollPane",
          get: function get() {
            return this._scrollPane;
          }
        }, {
          key: "opaque",
          get: function get() {
            return this._opaque;
          },
          set: function set(value) {
            this._opaque = value;
          }
        }, {
          key: "margin",
          get: function get() {
            return this._margin;
          },
          set: function set(value) {
            this._margin.copy(value);
            this.handleSizeChanged();
          }
        }, {
          key: "childrenRenderOrder",
          get: function get() {
            return this._childrenRenderOrder;
          },
          set: function set(value) {
            if (this._childrenRenderOrder != value) {
              this._childrenRenderOrder = value;
              this.buildNativeDisplayList();
            }
          }
        }, {
          key: "apexIndex",
          get: function get() {
            return this._apexIndex;
          },
          set: function set(value) {
            if (this._apexIndex != value) {
              this._apexIndex = value;
              if (this._childrenRenderOrder == ChildrenRenderOrder.Arch) this.buildNativeDisplayList();
            }
          }
        }, {
          key: "mask",
          get: function get() {
            return this._maskContent;
          },
          set: function set(value) {
            this.setMask(value, false);
          }
        }, {
          key: "_pivotCorrectX",
          get: function get() {
            return -this.pivotX * this._width + this._margin.left;
          }
        }, {
          key: "_pivotCorrectY",
          get: function get() {
            return this.pivotY * this._height - this._margin.top;
          }
        }, {
          key: "baseUserData",
          get: function get() {
            var buffer = this.packageItem.rawData;
            buffer.seek(0, 4);
            return buffer.readS();
          }
        }, {
          key: "viewWidth",
          get: function get() {
            if (this._scrollPane) return this._scrollPane.viewWidth;else return this.width - this._margin.left - this._margin.right;
          },
          set: function set(value) {
            if (this._scrollPane) this._scrollPane.viewWidth = value;else this.width = value + this._margin.left + this._margin.right;
          }
        }, {
          key: "viewHeight",
          get: function get() {
            if (this._scrollPane) return this._scrollPane.viewHeight;else return this.height - this._margin.top - this._margin.bottom;
          },
          set: function set(value) {
            if (this._scrollPane) this._scrollPane.viewHeight = value;else this.height = value + this._margin.top + this._margin.bottom;
          }
        }]);
        return GComponent;
      }(GObject));
      var s_vec2$2 = new Vec2();
      var Window = exports('Window', /*#__PURE__*/function (_GComponent) {
        _inheritsLoose(Window, _GComponent);
        function Window() {
          var _this20;
          _this20 = _GComponent.call(this) || this;
          _this20._requestingCmd = 0; /**  */
          _this20.release_manage = new mk_release();
          _this20._uiSources = new Array();
          _this20.bringToFontOnClick = UIConfig.bringWindowToFrontOnClick;
          _this20._node.on(Event.TOUCH_BEGIN, _this20.onTouchBegin_1, _assertThisInitialized(_this20), true);
          return _this20;
        }
        var _proto47 = Window.prototype;
        _proto47.addUISource = function addUISource(source) {
          this._uiSources.push(source);
        };
        _proto47.show = function show() {
          GRoot.inst.showWindow(this);
        };
        _proto47.showOn = function showOn(root) {
          root.showWindow(this);
        };
        _proto47.hide = function hide() {
          if (this.isShowing) this.doHideAnimation();
        };
        _proto47.hideImmediately = function hideImmediately() {
          var r = this.parent instanceof GRoot ? this.parent : null;
          if (!r) r = GRoot.inst;
          r.hideWindowImmediately(this);
        };
        _proto47.centerOn = function centerOn(r, restraint) {
          this.setPosition(Math.round((r.width - this.width) / 2), Math.round((r.height - this.height) / 2));
          if (restraint) {
            this.addRelation(r, RelationType.Center_Center);
            this.addRelation(r, RelationType.Middle_Middle);
          }
        };
        _proto47.toggleStatus = function toggleStatus() {
          if (this.isTop) this.hide();else this.show();
        };
        _proto47.bringToFront = function bringToFront() {
          GRoot.inst.bringToFront(this);
        };
        _proto47.showModalWait = function showModalWait(requestingCmd) {
          if (requestingCmd != null) this._requestingCmd = requestingCmd;
          if (UIConfig.windowModalWaiting) {
            if (!this._modalWaitPane) this._modalWaitPane = UIPackage.createObjectFromURL(UIConfig.windowModalWaiting);
            this.layoutModalWaitPane();
            this.addChild(this._modalWaitPane);
          }
        };
        _proto47.layoutModalWaitPane = function layoutModalWaitPane() {
          if (this._contentArea) {
            var pt = this._frame.localToGlobal();
            pt = this.globalToLocal(pt.x, pt.y, pt);
            this._modalWaitPane.setPosition(pt.x + this._contentArea.x, pt.y + this._contentArea.y);
            this._modalWaitPane.setSize(this._contentArea.width, this._contentArea.height);
          } else this._modalWaitPane.setSize(this.width, this.height);
        };
        _proto47.closeModalWait = function closeModalWait(requestingCmd) {
          if (requestingCmd != null) {
            if (this._requestingCmd != requestingCmd) return false;
          }
          this._requestingCmd = 0;
          if (this._modalWaitPane && this._modalWaitPane.parent) this.removeChild(this._modalWaitPane);
          return true;
        };
        _proto47.init = function init() {
          if (this._inited || this._loading) return;
          if (this._uiSources.length > 0) {
            this._loading = false;
            var cnt = this._uiSources.length;
            for (var i = 0; i < cnt; i++) {
              var lib = this._uiSources[i];
              if (!lib.loaded) {
                lib.load(this.__uiLoadComplete, this);
                this._loading = true;
              }
            }
            if (!this._loading) this._init();
          } else this._init();
        };
        _proto47.onInit = function onInit() {};
        _proto47.onShown = function onShown() {};
        _proto47.onHide = function onHide() {};
        _proto47.doShowAnimation = function doShowAnimation() {
          this.onShown();
        };
        _proto47.doHideAnimation = function doHideAnimation() {
          this.hideImmediately();
        };
        _proto47.__uiLoadComplete = function __uiLoadComplete() {
          var cnt = this._uiSources.length;
          for (var i = 0; i < cnt; i++) {
            var lib = this._uiSources[i];
            if (!lib.loaded) return;
          }
          this._loading = false;
          this._init();
        };
        _proto47._init = function _init() {
          this._inited = true;
          this.onInit();
          if (this.isShowing) this.doShowAnimation();
        };
        _proto47.dispose = function dispose() {
          if (this.parent) this.hideImmediately(); // 
          this.release_manage.release();
          _GComponent.prototype.dispose.call(this);
        } /**
          * 
          * @param asset_ 
          */;
        _proto47.follow_release = function follow_release(object_) {
          if (!object_) {
            return object_;
          } // 
          this.release_manage.add(object_); // 
          if (this.isDisposed) {
            // this._log.debug("");
            this.release_manage.release_all();
          }
          return object_;
        };
        _proto47.cancel_release = function cancel_release(object_) {
          if (!object_) {
            return object_;
          } // 
          this.release_manage.release(object_);
          return object_;
        };
        _proto47.closeEventHandler = function closeEventHandler(evt) {
          this.hide();
        };
        _proto47.onEnable = function onEnable() {
          _GComponent.prototype.onEnable.call(this);
          if (!this._inited) this.init();else this.doShowAnimation();
        };
        _proto47.onDisable = function onDisable() {
          _GComponent.prototype.onDisable.call(this);
          this.closeModalWait();
          this.onHide();
        };
        _proto47.onTouchBegin_1 = function onTouchBegin_1(evt) {
          if (this.isShowing && this.bringToFontOnClick) this.bringToFront();
        };
        _proto47.onDragStart_1 = function onDragStart_1(evt) {
          var original = GObject.cast(evt.currentTarget);
          original.stopDrag();
          this.startDrag(evt.touchId);
        };
        _createClass(Window, [{
          key: "contentPane",
          get: function get() {
            return this._contentPane;
          },
          set: function set(val) {
            if (this._contentPane != val) {
              if (this._contentPane) this.removeChild(this._contentPane);
              this._contentPane = val;
              if (this._contentPane) {
                this.addChild(this._contentPane);
                this.setSize(this._contentPane.width, this._contentPane.height);
                this._contentPane.addRelation(this, RelationType.Size);
                this._frame = this._contentPane.getChild("frame");
                if (this._frame) {
                  this.closeButton = this._frame.getChild("closeButton");
                  this.dragArea = this._frame.getChild("dragArea");
                  this.contentArea = this._frame.getChild("contentArea");
                }
              }
            }
          }
        }, {
          key: "frame",
          get: function get() {
            return this._frame;
          }
        }, {
          key: "closeButton",
          get: function get() {
            return this._closeButton;
          },
          set: function set(value) {
            if (this._closeButton) this._closeButton.offClick(this.closeEventHandler, this);
            this._closeButton = value;
            if (this._closeButton) this._closeButton.onClick(this.closeEventHandler, this);
          }
        }, {
          key: "dragArea",
          get: function get() {
            return this._dragArea;
          },
          set: function set(value) {
            if (this._dragArea != value) {
              if (this._dragArea) {
                this._dragArea.draggable = false;
                this._dragArea.off(Event.DRAG_START, this.onDragStart_1, this);
              }
              this._dragArea = value;
              if (this._dragArea) {
                this._dragArea.draggable = true;
                this._dragArea.on(Event.DRAG_START, this.onDragStart_1, this);
              }
            }
          }
        }, {
          key: "contentArea",
          get: function get() {
            return this._contentArea;
          },
          set: function set(value) {
            this._contentArea = value;
          }
        }, {
          key: "isShowing",
          get: function get() {
            return this.parent != null;
          }
        }, {
          key: "isTop",
          get: function get() {
            return this.parent && this.parent.getChildIndex(this) == this.parent.numChildren - 1;
          }
        }, {
          key: "modal",
          get: function get() {
            return this._modal;
          },
          set: function set(val) {
            this._modal = val;
          }
        }, {
          key: "modalWaiting",
          get: function get() {
            return this._modalWaitPane && this._modalWaitPane.parent != null;
          }
        }]);
        return Window;
      }(GComponent));
      var GRoot = exports('GRoot', /*#__PURE__*/function (_GComponent2) {
        _inheritsLoose(GRoot, _GComponent2);
        GRoot.create = function create() {
          GRoot._inst = new GRoot();
          director.getScene().getChildByName('Canvas').addChild(GRoot._inst.node);
          GRoot._inst.onWinResize();
          return GRoot._inst;
        };
        function GRoot() {
          var _this21;
          _this21 = _GComponent2.call(this) || this;
          _this21._node.name = "GRoot";
          _this21.opaque = false;
          _this21._volumeScale = 1;
          _this21._popupStack = new Array();
          _this21._justClosedPopups = new Array();
          _this21._modalLayer = new GGraph();
          _this21._modalLayer.setSize(_this21.width, _this21.height);
          _this21._modalLayer.drawRect(0, Color.TRANSPARENT, UIConfig.modalLayerColor);
          _this21._modalLayer.addRelation(_assertThisInitialized(_this21), RelationType.Size);
          _this21._thisOnResized = _this21.onWinResize.bind(_assertThisInitialized(_this21));
          _this21._inputProcessor = _this21.node.addComponent(InputProcessor);
          _this21._inputProcessor._captureCallback = _this21.onTouchBegin_1;
          View.instance.on('design-resolution-changed', _this21.onWinResize, _assertThisInitialized(_this21));
          {
            View.instance.on('canvas-resize', _this21._thisOnResized);
            window.addEventListener('orientationchange', _this21._thisOnResized);
          }
          return _this21;
        }
        var _proto48 = GRoot.prototype;
        _proto48.onDestroy = function onDestroy() {
          View.instance.off('design-resolution-changed', this.onWinResize, this);
          {
            View.instance.off('canvas-resize', this._thisOnResized);
            window.removeEventListener('orientationchange', this._thisOnResized);
          }
          if (this == GRoot._inst) GRoot._inst = null;
        };
        _proto48.getTouchPosition = function getTouchPosition(touchId) {
          return this._inputProcessor.getTouchPosition(touchId);
        };
        _proto48.showWindow = function showWindow(win) {
          this.addChild(win);
          win.requestFocus();
          if (win.x > this.width) win.x = this.width - win.width;else if (win.x + win.width < 0) win.x = 0;
          if (win.y > this.height) win.y = this.height - win.height;else if (win.y + win.height < 0) win.y = 0;
          this.adjustModalLayer();
        };
        _proto48.hideWindow = function hideWindow(win) {
          win.hide();
        };
        _proto48.hideWindowImmediately = function hideWindowImmediately(win) {
          if (win.parent == this) this.removeChild(win);
          this.adjustModalLayer();
        };
        _proto48.bringToFront = function bringToFront(win) {
          var cnt = this.numChildren;
          var i;
          if (this._modalLayer.parent && !win.modal) i = this.getChildIndex(this._modalLayer) - 1;else i = cnt - 1;
          for (; i >= 0; i--) {
            var g = this.getChildAt(i);
            if (g == win) return;
            if (g instanceof Window) break;
          }
          if (i >= 0) this.setChildIndex(win, i);
        };
        _proto48.showModalWait = function showModalWait(msg) {
          if (UIConfig.globalModalWaiting != null) {
            if (this._modalWaitPane == null) this._modalWaitPane = UIPackage.createObjectFromURL(UIConfig.globalModalWaiting);
            this._modalWaitPane.setSize(this.width, this.height);
            this._modalWaitPane.addRelation(this, RelationType.Size);
            this.addChild(this._modalWaitPane);
            this._modalWaitPane.text = msg;
          }
        };
        _proto48.closeModalWait = function closeModalWait() {
          if (this._modalWaitPane && this._modalWaitPane.parent) this.removeChild(this._modalWaitPane);
        };
        _proto48.closeAllExceptModals = function closeAllExceptModals() {
          var arr = this._children.slice();
          var cnt = arr.length;
          for (var i = 0; i < cnt; i++) {
            var g = arr[i];
            if (g instanceof Window && !g.modal) g.hide();
          }
        };
        _proto48.closeAllWindows = function closeAllWindows() {
          var arr = this._children.slice();
          var cnt = arr.length;
          for (var i = 0; i < cnt; i++) {
            var g = arr[i];
            if (g instanceof Window) g.hide();
          }
        };
        _proto48.getTopWindow = function getTopWindow() {
          var cnt = this.numChildren;
          for (var i = cnt - 1; i >= 0; i--) {
            var g = this.getChildAt(i);
            if (g instanceof Window) {
              return g;
            }
          }
          return null;
        };
        _proto48.getPopupPosition = function getPopupPosition(popup, target, dir, result) {
          var pos = result || new Vec2();
          var sizeW = 0,
            sizeH = 0;
          if (target) {
            pos = target.localToGlobal();
            this.globalToLocal(pos.x, pos.y, pos);
            var pos2 = target.localToGlobal(target.width, target.height);
            this.globalToLocal(pos2.x, pos2.y, pos2);
            sizeW = pos2.x - pos.x;
            sizeH = pos2.y - pos.y;
          } else {
            pos = this.getTouchPosition();
            pos = this.globalToLocal(pos.x, pos.y);
          }
          if (pos.x + popup.width > this.width) pos.x = pos.x + sizeW - popup.width;
          pos.y += sizeH;
          if ((dir === undefined || dir === PopupDirection.Auto) && pos.y + popup.height > this.height || dir === false || dir === PopupDirection.Up) {
            pos.y = pos.y - sizeH - popup.height - 1;
            if (pos.y < 0) {
              pos.y = 0;
              pos.x += sizeW / 2;
            }
          }
          return pos;
        };
        _proto48.showPopup = function showPopup(popup, target, dir) {
          if (this._popupStack.length > 0) {
            var k = this._popupStack.indexOf(popup);
            if (k != -1) {
              for (var i = this._popupStack.length - 1; i >= k; i--) this.removeChild(this._popupStack.pop());
            }
          }
          this._popupStack.push(popup);
          if (target) {
            var p = target;
            while (p) {
              if (p.parent == this) {
                if (popup.sortingOrder < p.sortingOrder) {
                  popup.sortingOrder = p.sortingOrder;
                }
                break;
              }
              p = p.parent;
            }
          }
          this.addChild(popup);
          this.adjustModalLayer();
          var pt = this.getPopupPosition(popup, target, dir);
          popup.setPosition(pt.x, pt.y);
        };
        _proto48.togglePopup = function togglePopup(popup, target, dir) {
          if (this._justClosedPopups.indexOf(popup) != -1) return;
          this.showPopup(popup, target, dir);
        };
        _proto48.hidePopup = function hidePopup(popup) {
          if (popup) {
            var k = this._popupStack.indexOf(popup);
            if (k != -1) {
              for (var i = this._popupStack.length - 1; i >= k; i--) this.closePopup(this._popupStack.pop());
            }
          } else {
            var cnt = this._popupStack.length;
            for (i = cnt - 1; i >= 0; i--) this.closePopup(this._popupStack[i]);
            this._popupStack.length = 0;
          }
        };
        _proto48.closePopup = function closePopup(target) {
          if (target.parent) {
            if (target instanceof Window) target.hide();else this.removeChild(target);
          }
        };
        _proto48.showTooltips = function showTooltips(msg) {
          if (this._defaultTooltipWin == null) {
            var resourceURL = UIConfig.tooltipsWin;
            if (!resourceURL) {
              console.error("UIConfig.tooltipsWin not defined");
              return;
            }
            this._defaultTooltipWin = UIPackage.createObjectFromURL(resourceURL);
          }
          this._defaultTooltipWin.text = msg;
          this.showTooltipsWin(this._defaultTooltipWin);
        };
        _proto48.showTooltipsWin = function showTooltipsWin(tooltipWin) {
          this.hideTooltips();
          this._tooltipWin = tooltipWin;
          var pt = this.getTouchPosition();
          pt.x += 10;
          pt.y += 20;
          this.globalToLocal(pt.x, pt.y, pt);
          if (pt.x + this._tooltipWin.width > this.width) {
            pt.x = pt.x - this._tooltipWin.width - 1;
            if (pt.x < 0) pt.x = 10;
          }
          if (pt.y + this._tooltipWin.height > this.height) {
            pt.y = pt.y - this._tooltipWin.height - 1;
            if (pt.y < 0) pt.y = 10;
          }
          this._tooltipWin.setPosition(pt.x, pt.y);
          this.addChild(this._tooltipWin);
        };
        _proto48.hideTooltips = function hideTooltips() {
          if (this._tooltipWin) {
            if (this._tooltipWin.parent) this.removeChild(this._tooltipWin);
            this._tooltipWin = null;
          }
        };
        _proto48.playOneShotSound = function playOneShotSound(clip, volumeScale) {
          if (!this.audioEngine) {
            this.audioEngine = this.node.addComponent(AudioSourceComponent);
          }
          if (volumeScale === undefined) volumeScale = 1;
          if (this.audioEngine.isValid) {
            this.audioEngine.clip = clip;
            this.audioEngine.volume = this._volumeScale * volumeScale;
            this.audioEngine.loop = false;
            this.audioEngine.play();
          }
        };
        _proto48.adjustModalLayer = function adjustModalLayer() {
          var cnt = this.numChildren;
          if (this._modalWaitPane && this._modalWaitPane.parent) this.setChildIndex(this._modalWaitPane, cnt - 1);
          for (var i = cnt - 1; i >= 0; i--) {
            var g = this.getChildAt(i);
            if (g instanceof Window && g.modal) {
              this._modalLayer.sortingOrder = g.sortingOrder > 0 ? g.sortingOrder - 1 : 0;
              if (this._modalLayer.parent == null) this.addChildAt(this._modalLayer, i);else this.setChildIndexBefore(this._modalLayer, i);
              return;
            }
          }
          if (this._modalLayer.parent) this.removeChild(this._modalLayer);
        };
        _proto48.onTouchBegin_1 = function onTouchBegin_1(evt) {
          if (this._tooltipWin) this.hideTooltips();
          this._justClosedPopups.length = 0;
          if (this._popupStack.length > 0) {
            var mc = evt.initiator;
            while (mc && mc != this) {
              var pindex = this._popupStack.indexOf(mc);
              if (pindex != -1) {
                for (var i = this._popupStack.length - 1; i > pindex; i--) {
                  var popup = this._popupStack.pop();
                  this.closePopup(popup);
                  this._justClosedPopups.push(popup);
                }
                return;
              }
              mc = mc.findParent();
            }
            var cnt = this._popupStack.length;
            for (var _i6 = cnt - 1; _i6 >= 0; _i6--) {
              popup = this._popupStack[_i6];
              this.closePopup(popup);
              this._justClosedPopups.push(popup);
            }
            this._popupStack.length = 0;
          }
        };
        _proto48.onWinResize = function onWinResize() {
          updateScaler();
          this.setSize(UIContentScaler.rootSize.width, UIContentScaler.rootSize.height);
          var anchorPoint = this.node.getParent().getComponent(UITransform).anchorPoint;
          this.node.setPosition(-this._width * anchorPoint.x, this._height * (1 - anchorPoint.y));
        };
        _proto48.handlePositionChanged = function handlePositionChanged() {//nothing here
        };
        _createClass(GRoot, [{
          key: "touchTarget",
          get: function get() {
            return this._inputProcessor.getTouchTarget();
          }
        }, {
          key: "inputProcessor",
          get: function get() {
            return this._inputProcessor;
          }
        }, {
          key: "modalLayer",
          get: function get() {
            return this._modalLayer;
          }
        }, {
          key: "hasModalWindow",
          get: function get() {
            return this._modalLayer.parent != null;
          }
        }, {
          key: "modalWaiting",
          get: function get() {
            return this._modalWaitPane && this._modalWaitPane.node.activeInHierarchy;
          }
        }, {
          key: "hasAnyPopup",
          get: function get() {
            return this._popupStack.length != 0;
          }
        }, {
          key: "volumeScale",
          get: function get() {
            return this._volumeScale;
          },
          set: function set(value) {
            this._volumeScale = value;
          }
        }], [{
          key: "inst",
          get: function get() {
            if (!GRoot._inst) throw 'Call GRoot.create first!';
            return GRoot._inst;
          }
        }]);
        return GRoot;
      }(GComponent));
      Decls$1.GRoot = GRoot;
      var GTextInput = exports('GTextInput', /*#__PURE__*/function (_GTextField2) {
        _inheritsLoose(GTextInput, _GTextField2);
        function GTextInput() {
          var _this22;
          _this22 = _GTextField2.call(this) || this;
          _this22._node.name = "GTextInput";
          _this22._touchDisabled = false;
          return _this22;
        }
        var _proto49 = GTextInput.prototype;
        _proto49.createRenderer = function createRenderer() {
          this._editBox = this._node.addComponent(MyEditBox);
          this._editBox.maxLength = -1;
          this._editBox["_updateTextLabel"]();
          this._node.on('text-changed', this.onTextChanged, this);
          this.on(Event.TOUCH_END, this.onTouchEnd1, this);
          this.autoSize = AutoSizeType.None;
        };
        _proto49.requestFocus = function requestFocus() {
          this._editBox.focus();
        };
        _proto49.markSizeChanged = function markSizeChanged() {//
        };
        _proto49.updateText = function updateText() {
          var text2 = this._text;
          if (this._templateVars) text2 = this.parseTemplate(text2);
          if (this._ubbEnabled)
            //
            text2 = defaultParser.parse(text2, true);
          this._editBox.string = text2;
        };
        _proto49.updateFont = function updateFont() {
          this.assignFont(this._editBox.textLabel, this._realFont);
          if (this._editBox.placeholderLabel) this.assignFont(this._editBox.placeholderLabel, this._realFont);
        };
        _proto49.updateFontColor = function updateFontColor() {
          this.assignFontColor(this._editBox.textLabel, this._color);
        };
        _proto49.updateFontSize = function updateFontSize() {
          this._editBox.textLabel.fontSize = this._fontSize;
          this._editBox.textLabel.lineHeight = this._fontSize + this._leading;
          if (this._editBox.placeholderLabel) this._editBox.placeholderLabel.fontSize = this._editBox.textLabel.fontSize;
        };
        _proto49.updateOverflow = function updateOverflow() {//not supported
        };
        _proto49.onTextChanged = function onTextChanged() {
          var str = this._editBox.string;
          if (this._restrictRegExp && str.length > 0) {
            if (!this._restrictRegExp.test(str)) {
              this._editBox.string = this._text;
              return;
            }
          }
          this._text = this._editBox.string;
        };
        _proto49.onTouchEnd1 = function onTouchEnd1(evt) {
          this._editBox.openKeyboard();
          evt.propagationStopped = true;
        };
        _proto49.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          var _this23 = this;
          _GTextField2.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 4);
          var str = buffer.readS();
          if (str != null) this.promptText = str;else if (this._editBox.placeholderLabel) this._editBox.placeholderLabel.string = "";
          str = buffer.readS();
          if (str != null) this.restrict = str;
          var iv = buffer.readInt();
          if (iv != 0) this.maxLength = iv;
          iv = buffer.readInt();
          if (iv != 0) {
            //keyboardType
            var inputMode = EditBox.InputMode.ANY;
            switch (iv) {
              case 3:
                inputMode = EditBox.InputMode.URL;
                break;
              case 4:
                inputMode = EditBox.InputMode.NUMERIC;
                break;
              case 5:
                inputMode = EditBox.InputMode.PHONE_NUMBER;
                break;
              case 6:
                inputMode = EditBox.InputMode.EMAIL_ADDR;
                break;
              default:
                inputMode = EditBox.InputMode.ANY;
                break;
            }
            this._editBox.inputMode = inputMode;
          }
          if (buffer.readBool()) this.password = true; //
          if (this._editBox.placeholderLabel) {
            var hAlign = this._editBox.textLabel.horizontalAlign;
            this._editBox.placeholderLabel.horizontalAlign = hAlign;
            var vAlign = this._editBox.textLabel.verticalAlign;
            this._editBox.placeholderLabel.verticalAlign = vAlign; // cocos 
            this._editBox.scheduleOnce(function () {
              _this23._editBox.textLabel.horizontalAlign = hAlign;
              _this23._editBox.textLabel.verticalAlign = vAlign;
              if (_this23._editBox.inputMode == EditBox.InputMode.ANY) {
                _this23._editBox.doUpdateDOM();
              }
            });
          }
        };
        _createClass(GTextInput, [{
          key: "editable",
          get: function get() {
            return this._editBox.enabled;
          },
          set: function set(val) {
            this._editBox.enabled = val;
          }
        }, {
          key: "maxLength",
          get: function get() {
            return this._editBox.maxLength;
          },
          set: function set(val) {
            if (val == 0) val = -1;
            this._editBox.maxLength = val;
          }
        }, {
          key: "promptText",
          get: function get() {
            return this._promptText;
          },
          set: function set(val) {
            this._promptText = val;
            var newCreate = !this._editBox.placeholderLabel;
            this._editBox["_updatePlaceholderLabel"]();
            if (newCreate) this.assignFont(this._editBox.placeholderLabel, this._realFont);
            this._editBox.placeholderLabel.string = defaultParser.parse(this._promptText, true);
            if (defaultParser.lastColor) {
              var c = this._editBox.placeholderLabel.color;
              if (!c) c = new Color();
              c.fromHEX(defaultParser.lastColor);
              this.assignFontColor(this._editBox.placeholderLabel, c);
            } else this.assignFontColor(this._editBox.placeholderLabel, this._color);
            if (defaultParser.lastSize) this._editBox.placeholderLabel.fontSize = parseInt(defaultParser.lastSize);else this._editBox.placeholderLabel.fontSize = this._fontSize;
          }
        }, {
          key: "restrict",
          get: function get() {
            return this._restrictPattern;
          },
          set: function set(value) {
            this._restrictPattern = value;
            if (value && value.length > 0) this._restrictRegExp = new RegExp(value);else this._restrictRegExp = null;
          }
        }, {
          key: "password",
          get: function get() {
            return this._editBox.inputFlag == EditBox.InputFlag.PASSWORD;
          },
          set: function set(val) {
            this._editBox.inputFlag = val ? EditBox.InputFlag.PASSWORD : EditBox.InputFlag.DEFAULT;
          }
        }, {
          key: "align",
          get: function get() {
            return this._editBox.textLabel.horizontalAlign;
          },
          set: function set(value) {
            this._editBox.textLabel.horizontalAlign = value;
            if (this._editBox.placeholderLabel) {
              this._editBox.placeholderLabel.horizontalAlign = value;
            }
          }
        }, {
          key: "verticalAlign",
          get: function get() {
            return this._editBox.textLabel.verticalAlign;
          },
          set: function set(value) {
            this._editBox.textLabel.verticalAlign = value;
            if (this._editBox.placeholderLabel) {
              this._editBox.placeholderLabel.verticalAlign = value;
            }
          }
        }, {
          key: "singleLine",
          get: function get() {
            return this._editBox.inputMode != EditBox.InputMode.ANY;
          },
          set: function set(value) {
            this._editBox.inputMode = value ? EditBox.InputMode.SINGLE_LINE : EditBox.InputMode.ANY;
          }
        }]);
        return GTextInput;
      }(GTextField));
      var MyEditBox = /*#__PURE__*/function (_EditBox) {
        _inheritsLoose(MyEditBox, _EditBox);
        function MyEditBox() {
          return _EditBox.apply(this, arguments) || this;
        }
        var _proto50 = MyEditBox.prototype;
        _proto50._init = function _init() {
          _EditBox.prototype._init.call(this);
          this.placeholderLabel.getComponent(UITransform).setAnchorPoint(0, 1);
          this.textLabel.getComponent(UITransform).setAnchorPoint(0, 1);
          this.placeholderLabel.overflow = Overflow.CLAMP;
          this.textLabel.overflow = Overflow.CLAMP;
        };
        _proto50._registerEvent = function _registerEvent() {//
        } // protected _updateTextLabel() {
        //     super["_updateTextLabel"]();
        //     this.scheduleOnce(this.doUpdateDOM);
        // }
        ;
        _proto50.doUpdateDOM = function doUpdateDOM() {
          var impl = this["_impl"];
          if (!impl) return;
          var dom = impl["_edTxt"];
          if (dom) {
            // border-boxpadding
            dom.style.boxSizing = "border-box";
            var padding = 0;
            if (this.textLabel.verticalAlign == VerticalTextAlignment.TOP) padding = 0;else if (this.textLabel.verticalAlign == VerticalTextAlignment.CENTER) {
              // 
              var h = this.node.getComponent(UITransform).height;
              var fontSize = this.textLabel.fontSize;
              padding = Math.max(0, (h - fontSize) / 2 - fontSize / 10);
            } else if (this.textLabel.verticalAlign == VerticalTextAlignment.BOTTOM) {
              var _h = this.node.getComponent(UITransform).height;
              var _fontSize = this.textLabel.fontSize;
              padding = Math.max(0, _h - _fontSize);
            }
            dom.style.paddingTop = padding + "px"; // update placeholder style
            var styleEl = impl["_placeholderStyleSheet"];
            if (styleEl) {
              styleEl.innerHTML += "\n                    #" + dom.id + "::-webkit-input-placeholder{padding-top:" + padding + "px;}\n                    #" + dom.id + "::-moz-placeholder{padding-top:" + padding + "px;}\n                    #" + dom.id + "::-ms-input-placeholder{padding-top:" + padding + "px;}\n                ";
            }
          }
        };
        _proto50.openKeyboard = function openKeyboard() {
          var impl = this["_impl"];
          if (impl) {
            impl.beginEditing();
          }
        };
        return MyEditBox;
      }(EditBox);
      var GObjectPool = exports('GObjectPool', /*#__PURE__*/function () {
        function GObjectPool() {
          this._count = 0;
          this._pool = {};
        }
        var _proto51 = GObjectPool.prototype;
        _proto51.clear = function clear() {
          for (var i1 in this._pool) {
            var arr = this._pool[i1];
            var cnt = arr.length;
            for (var i = 0; i < cnt; i++) arr[i].dispose();
          }
          this._pool = {};
          this._count = 0;
        };
        _proto51.getObject = function getObject(url) {
          url = UIPackage.normalizeURL(url);
          if (url == null) return null;
          var arr = this._pool[url];
          if (arr && arr.length) {
            this._count--;
            return arr.shift();
          }
          var child = UIPackage.createObjectFromURL(url);
          return child;
        };
        _proto51.returnObject = function returnObject(obj) {
          var url = obj.resourceURL;
          if (!url) return;
          var arr = this._pool[url];
          if (arr == null) {
            arr = new Array();
            this._pool[url] = arr;
          }
          this._count++;
          arr.push(obj);
        };
        _createClass(GObjectPool, [{
          key: "count",
          get: function get() {
            return this._count;
          }
        }]);
        return GObjectPool;
      }());
      var GLoader3D = exports('GLoader3D', /*#__PURE__*/function (_GObject7) {
        _inheritsLoose(GLoader3D, _GObject7);
        function GLoader3D() {
          var _this24;
          _this24 = _GObject7.call(this) || this;
          _this24._frame = 0;
          _this24._node.name = "GLoader3D";
          _this24._playing = true;
          _this24._url = "";
          _this24._fill = LoaderFillType.None;
          _this24._align = AlignType.Left;
          _this24._verticalAlign = VertAlignType.Top;
          _this24._color = new Color(255, 255, 255, 255);
          _this24._container = new Node("Wrapper");
          _this24._container.layer = UIConfig.defaultUILayer;
          _this24._container.addComponent(UITransform).setAnchorPoint(0, 1);
          _this24._node.addChild(_this24._container);
          return _this24;
        }
        var _proto52 = GLoader3D.prototype;
        _proto52.dispose = function dispose() {
          _GObject7.prototype.dispose.call(this);
        };
        _proto52.loadContent = function loadContent() {
          this.clearContent();
          if (!this._url) return;
          if (this._url.startsWith("ui://")) this.loadFromPackage(this._url);else this.loadExternal();
        };
        _proto52.loadFromPackage = function loadFromPackage(itemURL) {
          this._contentItem = UIPackage.getItemByURL(itemURL);
          if (this._contentItem) {
            this._contentItem = this._contentItem.getBranch();
            this.sourceWidth = this._contentItem.width;
            this.sourceHeight = this._contentItem.height;
            this._contentItem = this._contentItem.getHighResolution();
            if (this._autoSize) this.setSize(this.sourceWidth, this.sourceHeight);
            if (this._contentItem.type == PackageItemType.Spine || this._contentItem.type == PackageItemType.DragonBones) this._contentItem.owner.getItemAssetAsync(this._contentItem, this.onLoaded.bind(this));
          }
        };
        _proto52.onLoaded = function onLoaded(err, item) {
          if (this._contentItem != item) return;
          if (err) console.warn(err);
          if (!this._contentItem.asset) return;
          if (this._contentItem.type == PackageItemType.Spine) this.setSpine(this._contentItem.asset, this._contentItem.skeletonAnchor);else if (this._contentItem.type == PackageItemType.DragonBones) this.setDragonBones(this._contentItem.asset, this._contentItem.atlasAsset, this._contentItem.skeletonAnchor);
        };
        _proto52.setSpine = function setSpine(asset, anchor, pma) {
          this.freeSpine();
          var node = new Node();
          this._container.addChild(node);
          node.layer = UIConfig.defaultUILayer;
          node.setPosition(anchor.x, -anchor.y);
          this._content = node.addComponent(sp.Skeleton);
          this._content.premultipliedAlpha = pma;
          this._content.skeletonData = asset;
          this._content.color = this._color;
          this.onChangeSpine();
          this.updateLayout();
        };
        _proto52.freeSpine = function freeSpine() {
          if (this._content) {
            this._content.destroy();
          }
        };
        _proto52.setDragonBones = function setDragonBones(asset, atlasAsset, anchor, pma) {
          this.freeDragonBones();
          var node = new Node();
          node.layer = UIConfig.defaultUILayer;
          this._container.addChild(node);
          node.setPosition(anchor.x, -anchor.y);
          this._content = node.addComponent(dragonBones.ArmatureDisplay);
          this._content.premultipliedAlpha = pma;
          this._content.dragonAsset = asset;
          this._content.dragonAtlasAsset = atlasAsset;
          this._content.color = this._color;
          var armatureKey = asset["init"](dragonBones.CCFactory.getInstance(), atlasAsset["_uuid"]);
          var dragonBonesData = this._content["_factory"].getDragonBonesData(armatureKey);
          this._content.armatureName = dragonBonesData.armatureNames[0];
          this.onChangeDragonBones();
          this.updateLayout();
        };
        _proto52.freeDragonBones = function freeDragonBones() {
          if (this._content) {
            this._content.destroy();
          }
        };
        _proto52.onChange = function onChange() {
          if (this._contentItem == null) return;
          if (this._contentItem.type == PackageItemType.Spine) {
            this.onChangeSpine();
          }
          if (this._contentItem.type == PackageItemType.DragonBones) {
            this.onChangeDragonBones();
          }
        };
        _proto52.onChangeSpine = function onChangeSpine() {
          var _a;
          if (!(this._content instanceof sp.Skeleton)) return;
          if (this._animationName) {
            var trackEntry = this._content.getCurrent(0);
            if (!trackEntry || trackEntry.animation.name != this._animationName || trackEntry.isComplete() && !trackEntry.loop) {
              this._content.animation = this._animationName;
              trackEntry = this._content.setAnimation(0, this._animationName, this._loop);
            }
            if (this._playing) this._content.paused = false;else {
              this._content.paused = true;
              trackEntry.trackTime = math.lerp(0, trackEntry.animationEnd - trackEntry.animationStart, this._frame / 100);
            }
          } else this._content.clearTrack(0);
          var skin = this._skinName || this._content.skeletonData.getRuntimeData().skins[0].name;
          if (((_a = this._content["_skeleton"].skin) === null || _a === void 0 ? void 0 : _a.name) != skin) this._content.setSkin(skin);
        };
        _proto52.onChangeDragonBones = function onChangeDragonBones() {
          if (!(this._content instanceof dragonBones.ArmatureDisplay)) return;
          if (this._animationName) {
            if (this._playing) this._content.playAnimation(this._animationName, this._loop ? 0 : 1);else this._content.armature().animation.gotoAndStopByFrame(this._animationName, this._frame);
          } else this._content.armature().animation.reset();
        };
        _proto52.loadExternal = function loadExternal() {
          if (this._url.startsWith("http://") || this._url.startsWith("https://") || this._url.startsWith('/')) assetManager.loadRemote(this._url, sp.SkeletonData, this.onLoaded2.bind(this));else resources.load(this._url, sp.SkeletonData, this.onLoaded2.bind(this));
        };
        _proto52.onLoaded2 = function onLoaded2(err, asset) {
          //url
          if (!this._url || !isValid(this._node)) return;
          if (err) console.warn(err);
        };
        _proto52.updateLayout = function updateLayout() {
          var cw = this.sourceWidth;
          var ch = this.sourceHeight;
          var pivotCorrectX = -this.pivotX * this._width;
          var pivotCorrectY = this.pivotY * this._height;
          if (this._autoSize) {
            this._updatingLayout = true;
            if (cw == 0) cw = 50;
            if (ch == 0) ch = 30;
            this.setSize(cw, ch);
            this._updatingLayout = false;
            if (cw == this._width && ch == this._height) {
              this._container.setScale(1, 1);
              this._container.setPosition(pivotCorrectX, pivotCorrectY);
              return;
            }
          }
          var sx = 1,
            sy = 1;
          if (this._fill != LoaderFillType.None) {
            sx = this.width / this.sourceWidth;
            sy = this.height / this.sourceHeight;
            if (sx != 1 || sy != 1) {
              if (this._fill == LoaderFillType.ScaleMatchHeight) sx = sy;else if (this._fill == LoaderFillType.ScaleMatchWidth) sy = sx;else if (this._fill == LoaderFillType.Scale) {
                if (sx > sy) sx = sy;else sy = sx;
              } else if (this._fill == LoaderFillType.ScaleNoBorder) {
                if (sx > sy) sy = sx;else sx = sy;
              }
              if (this._shrinkOnly) {
                if (sx > 1) sx = 1;
                if (sy > 1) sy = 1;
              }
              cw = this.sourceWidth * sx;
              ch = this.sourceHeight * sy;
            }
          }
          this._container.setScale(sx, sy);
          var nx, ny;
          if (this._align == AlignType.Left) nx = 0;else if (this._align == AlignType.Center) nx = Math.floor((this._width - cw) / 2);else nx = this._width - cw;
          if (this._verticalAlign == VertAlignType.Top) ny = 0;else if (this._verticalAlign == VertAlignType.Middle) ny = Math.floor((this._height - ch) / 2);else ny = this._height - ch;
          ny = -ny;
          this._container.setPosition(pivotCorrectX + nx, pivotCorrectY + ny);
        };
        _proto52.clearContent = function clearContent() {
          this._contentItem = null;
          if (this._content) {
            this._content.node.destroy();
            this._content = null;
          }
        };
        _proto52.handleSizeChanged = function handleSizeChanged() {
          _GObject7.prototype.handleSizeChanged.call(this);
          if (!this._updatingLayout) this.updateLayout();
        };
        _proto52.handleAnchorChanged = function handleAnchorChanged() {
          _GObject7.prototype.handleAnchorChanged.call(this);
          if (!this._updatingLayout) this.updateLayout();
        };
        _proto52.handleGrayedChanged = function handleGrayedChanged() {};
        _proto52.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.color;
            case ObjectPropID.Playing:
              return this.playing;
            case ObjectPropID.Frame:
              return this.frame;
            case ObjectPropID.TimeScale:
              return 1;
            default:
              return _GObject7.prototype.getProp.call(this, index);
          }
        };
        _proto52.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.color = value;
              break;
            case ObjectPropID.Playing:
              this.playing = value;
              break;
            case ObjectPropID.Frame:
              this.frame = value;
              break;
            case ObjectPropID.TimeScale:
              break;
            case ObjectPropID.DeltaTime:
              break;
            default:
              _GObject7.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto52.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject7.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this._url = buffer.readS();
          this._align = buffer.readByte();
          this._verticalAlign = buffer.readByte();
          this._fill = buffer.readByte();
          this._shrinkOnly = buffer.readBool();
          this._autoSize = buffer.readBool();
          this._animationName = buffer.readS();
          this._skinName = buffer.readS();
          this._playing = buffer.readBool();
          this._frame = buffer.readInt();
          this._loop = buffer.readBool();
          if (buffer.readBool()) this.color = buffer.readColor();
          if (this._url) this.loadContent();
        };
        _createClass(GLoader3D, [{
          key: "url",
          get: function get() {
            return this._url;
          },
          set: function set(value) {
            if (this._url == value) return;
            this._url = value;
            this.loadContent();
            this.updateGear(7);
          }
        }, {
          key: "icon",
          get: function get() {
            return this._url;
          },
          set: function set(value) {
            this.url = value;
          }
        }, {
          key: "align",
          get: function get() {
            return this._align;
          },
          set: function set(value) {
            if (this._align != value) {
              this._align = value;
              this.updateLayout();
            }
          }
        }, {
          key: "verticalAlign",
          get: function get() {
            return this._verticalAlign;
          },
          set: function set(value) {
            if (this._verticalAlign != value) {
              this._verticalAlign = value;
              this.updateLayout();
            }
          }
        }, {
          key: "fill",
          get: function get() {
            return this._fill;
          },
          set: function set(value) {
            if (this._fill != value) {
              this._fill = value;
              this.updateLayout();
            }
          }
        }, {
          key: "shrinkOnly",
          get: function get() {
            return this._shrinkOnly;
          },
          set: function set(value) {
            if (this._shrinkOnly != value) {
              this._shrinkOnly = value;
              this.updateLayout();
            }
          }
        }, {
          key: "autoSize",
          get: function get() {
            return this._autoSize;
          },
          set: function set(value) {
            if (this._autoSize != value) {
              this._autoSize = value;
              this.updateLayout();
            }
          }
        }, {
          key: "playing",
          get: function get() {
            return this._playing;
          },
          set: function set(value) {
            if (this._playing != value) {
              this._playing = value;
              this.updateGear(5);
              this.onChange();
            }
          }
        }, {
          key: "frame",
          get: function get() {
            return this._frame;
          },
          set: function set(value) {
            if (this._frame != value) {
              this._frame = value;
              this.updateGear(5);
              this.onChange();
            }
          }
        }, {
          key: "animationName",
          get: function get() {
            return this._animationName;
          },
          set: function set(value) {
            if (this._animationName != value) {
              this._animationName = value;
              this.onChange();
            }
          }
        }, {
          key: "skinName",
          get: function get() {
            return this._skinName;
          },
          set: function set(value) {
            if (this._skinName != value) {
              this._skinName = value;
              this.onChange();
            }
          }
        }, {
          key: "loop",
          get: function get() {
            return this._loop;
          },
          set: function set(value) {
            if (this._loop != value) {
              this._loop = value;
              this.onChange();
            }
          }
        }, {
          key: "color",
          get: function get() {
            return this._color;
          },
          set: function set(value) {
            this._color.set(value);
            this.updateGear(4);
            if (this._content) this._content.color = value;
          }
        }, {
          key: "content",
          get: function get() {
            return this._content;
          }
        }]);
        return GLoader3D;
      }(GObject));
      var __awaiter$1 = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      }; //  spine
      var GLoaderPrefab = exports('GloaderPrefab', /*#__PURE__*/function (_GLoader3D) {
        _inheritsLoose(GLoaderPrefab, _GLoader3D);
        function GLoaderPrefab() {
          var _this25;
          _this25 = _GLoader3D.call(this) || this;
          _this25._node.name = "GLoaderPrefab";
          return _this25;
        }
        var _proto53 = GLoaderPrefab.prototype;
        _proto53.setUrl = function setUrl(url, bundleName) {
          return __awaiter$1(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
            var isRemote, prefab, node;
            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  this._url = url;
                  this._assetBundle = bundleName;
                  if (url) {
                    _context.next = 5;
                    break;
                  }
                  this.clearContent();
                  return _context.abrupt("return");
                case 5:
                  isRemote = false;
                  if (this._url.startsWith("http://") || this._url.startsWith("https://") || this._url.startsWith('/')) {
                    isRemote = true;
                  }
                  _context.next = 9;
                  return mk_asset$1.get(url, Prefab, null, {
                    bundle_s: bundleName,
                    remote_option: isRemote ? {} : null
                  });
                case 9:
                  prefab = _context.sent;
                  if (!(url != this.url)) {
                    _context.next = 13;
                    break;
                  }
                  prefab.decRef();
                  return _context.abrupt("return");
                case 13:
                  node = instantiate(prefab);
                  this._initPrefabNode(node, prefab);
                  return _context.abrupt("return", node);
                case 16:
                case "end":
                  return _context.stop();
              }
            }, _callee, this);
          }));
        };
        _proto53.loadExternal = function loadExternal() {
          this.setUrl(this._url, this.bundle);
        };
        _proto53._initPrefabNode = function _initPrefabNode(node, asset) {
          this.clearContent();
          this._prefab = node;
          if (!isValid(node)) return;
          node.setPosition(0, 0);
          node.layer = UIConfig.defaultUILayer;
          this._container.addChild(node);
          var transform = node.getComponent(UITransform);
          if (transform) {
            this.sourceWidth = transform.width;
            this.sourceHeight = transform.height;
            if (this._autoSize) {
              this.setSize(this.sourceWidth, this.sourceHeight);
            } //  node  this._container 
            var anchorOffsetX = transform.width * transform.anchorX;
            var anchorOffsetY = -transform.height * (1 - transform.anchorY);
            node.setPosition(anchorOffsetX, anchorOffsetY);
          }
          var skeleton = node.getComponent(sp.Skeleton);
          if (skeleton) {
            this._prefabType = PackageItemType.Spine;
            this.setSpine2(skeleton);
            return;
          }
          var dragonBone = node.getComponent(dragonBones.ArmatureDisplay);
          if (dragonBone) {
            this._prefabType = PackageItemType.DragonBones;
            this.setDragonBones2(dragonBone);
            return;
          }
        };
        _proto53.setSpine2 = function setSpine2(asset) {
          var _a;
          this._content = asset;
          this._color = this._content.color;
          this._playing = !this._content.paused;
          this._animationName = this._content.animation;
          this._skinName = (_a = this._content._skeleton.skin) === null || _a === void 0 ? void 0 : _a.name;
          this.updateLayout();
        };
        _proto53.setDragonBones2 = function setDragonBones2(asset) {
          this._content = asset;
          this._color = this._content.color; // @ts-ignore
          this._playing = this.content._playing;
          this._animationName = this._content.animationName; // this._skinName = this._content;
          this.updateLayout();
        };
        _proto53.dispose = function dispose() {
          _GLoader3D.prototype.dispose.call(this);
          if (this._prefabAsset) {
            this._prefabAsset.decRef();
            this._prefabAsset = null;
          }
        };
        _proto53.onChange = function onChange() {
          if (this._prefab == null) return;
          if (this._prefabType == PackageItemType.Spine) {
            this.onChangeSpine();
          }
          if (this._prefabType == PackageItemType.DragonBones) {
            this.onChangeDragonBones();
          }
        };
        _proto53.clearContent = function clearContent() {
          _GLoader3D.prototype.clearContent.call(this);
          if (this._prefabAsset) {
            this._prefabAsset.decRef();
            this._prefabAsset = null;
          }
        };
        _createClass(GLoaderPrefab, [{
          key: "prefab",
          get: function get() {
            return this._prefab;
          },
          set: function set(val) {
            this._initPrefabNode(val);
          }
        }, {
          key: "bundle",
          get: function get() {
            if (this._assetBundle) {
              return this._assetBundle;
            }
            return UIConfig.loaderAssetsBundleName;
          },
          set: function set(val) {
            this._assetBundle = val;
          }
        }]);
        return GLoaderPrefab;
      }(GLoader3D));
      var __awaiter = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P ? value : new P(function (resolve) {
            resolve(value);
          });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator["throw"](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      var GLoader = exports('GLoader', /*#__PURE__*/function (_GObject8) {
        _inheritsLoose(GLoader, _GObject8);
        function GLoader() {
          var _this26;
          _this26 = _GObject8.call(this) || this;
          _this26._frame = 0;
          _this26._node.name = "GLoader";
          _this26._playing = true;
          _this26._url = "";
          _this26._fill = LoaderFillType.None;
          _this26._align = AlignType.Left;
          _this26._verticalAlign = VertAlignType.Top;
          _this26._showErrorSign = true;
          _this26._color = new Color(255, 255, 255, 255);
          _this26._container = new Node("Image");
          _this26._container.layer = UIConfig.defaultUILayer;
          _this26._containerUITrans = _this26._container.addComponent(UITransform);
          _this26._containerUITrans.setAnchorPoint(0, 1);
          _this26._node.addChild(_this26._container);
          _this26._content = _this26._container.addComponent(MovieClip);
          _this26._content.sizeMode = Sprite.SizeMode.CUSTOM;
          _this26._content.trim = false;
          _this26._content.setPlaySettings();
          return _this26;
        }
        var _proto54 = GLoader.prototype;
        _proto54.dispose = function dispose() {
          if (this._contentItem == null) {
            if (this._content.spriteFrame) this.freeExternal(this._content.spriteFrame);
          }
          if (this._content2) this._content2.dispose();
          if (this._content3) this._content3.dispose();
          if (this._asset) {
            this._asset.decRef();
            this._asset = null;
          }
          _GObject8.prototype.dispose.call(this);
        }; /**
           * 
           * @param url
           * @param bundleStr 
           */
        _proto54.setUrlWithBundle = function setUrlWithBundle(url, bundleStr) {
          if (bundleStr === void 0) {
            bundleStr = '';
          }
          this.bundle = bundleStr;
          this.url = url;
        };
        _proto54.loadContent = function loadContent() {
          this.clearContent();
          if (!this._url) return;
          if (this._url.startsWith("ui://")) this.loadFromPackage(this._url);else this.loadExternal2();
        };
        _proto54.loadFromPackage = function loadFromPackage(itemURL) {
          var contentItem = UIPackage.getItemByURL(itemURL);
          this._contentItem = contentItem;
          if (!contentItem) {
            this.setErrorState();
            return;
          }
          contentItem = contentItem.getBranch();
          this.sourceWidth = contentItem.width;
          this.sourceHeight = contentItem.height;
          contentItem = contentItem.getHighResolution();
          contentItem.load();
          if (this._autoSize) this.setSize(this.sourceWidth, this.sourceHeight);
          if (contentItem.type == PackageItemType.Image) {
            if (!contentItem.asset) {
              this.setErrorState();
            } else {
              this._content.spriteFrame = contentItem.asset;
              if (this._content.fillMethod == 0) {
                if (contentItem.scale9Grid) this._content.type = Sprite.Type.SLICED;else if (contentItem.scaleByTile) this._content.type = Sprite.Type.TILED;else this._content.type = Sprite.Type.SIMPLE;
              } else {
                this._content.type = Sprite.Type.FILLED;
              }
              this.updateLayout();
            }
          } else if (contentItem.type == PackageItemType.MovieClip) {
            this._content.interval = contentItem.interval;
            this._content.swing = contentItem.swing;
            this._content.repeatDelay = contentItem.repeatDelay;
            this._content.frames = contentItem.frames;
            this.updateLayout();
          } else if (contentItem.type == PackageItemType.Component) {
            var obj = UIPackage.createObjectFromURL(itemURL);
            if (!obj) this.setErrorState();else if (!(obj instanceof GComponent)) {
              obj.dispose();
              this.setErrorState();
            } else {
              this._content2 = obj;
              this._container.addChild(this._content2.node);
              this.updateLayout();
            }
          } else {
            this.setErrorState();
            return;
          }
          this.node.emit("ImgLoaded");
        };
        _proto54.loadExternal2 = function loadExternal2() {
          return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
            var _this27 = this;
            var url, loadAsset, prefabLoader, args, prefabName, bundleName, isRemote, sf, texture, _sf;
            return _regeneratorRuntime().wrap(function _callee2$(_context2) {
              while (1) switch (_context2.prev = _context2.next) {
                case 0:
                  url = this.url;
                  if (!this._url.startsWith('data:image/')) {
                    _context2.next = 8;
                    break;
                  }
                  _context2.next = 4;
                  return new Promise(function (resolve) {
                    var img = new Image();
                    img.src = _this27._url;
                    img.onload = function () {
                      var tex = new Texture2D();
                      tex.reset({
                        width: img.width,
                        height: img.height
                      });
                      tex.uploadData(img, 0, 0);
                      loadAsset = tex;
                      resolve(tex);
                    };
                  });
                case 4:
                  loadAsset = _context2.sent;
                  loadAsset.addRef();
                  _context2.next = 32;
                  break;
                case 8:
                  if (!this._url.startsWith('prefab:')) {
                    _context2.next = 27;
                    break;
                  }
                  prefabLoader = new GLoaderPrefab();
                  this._content3 = prefabLoader;
                  prefabLoader.width = this._width;
                  prefabLoader.height = this._height;
                  prefabLoader.pivotX = this.pivotX;
                  prefabLoader.pivotY = this.pivotY;
                  prefabLoader.align = this.align;
                  prefabLoader.verticalAlign = this._verticalAlign;
                  prefabLoader.fill = this.fill;
                  prefabLoader.shrinkOnly = this.shrinkOnly;
                  prefabLoader.autoSize = this._autoSize;
                  this._container.addChild(prefabLoader.node);
                  args = this._url.split(';');
                  prefabName = args[0].split(':')[1];
                  bundleName = args[1] ? args[1].split(':')[1] : "";
                  prefabLoader.setUrl(prefabName, bundleName);
                  _context2.next = 32;
                  break;
                case 27:
                  isRemote = false;
                  if (this._url.startsWith("http://") || this._url.startsWith("https://") || this._url.startsWith('/')) {
                    isRemote = true;
                  }
                  _context2.next = 31;
                  return mk_asset$1.get(url + (isRemote ? "" : "/spriteFrame"), Asset, null, {
                    bundle_s: this.bundle,
                    remote_option: isRemote ? {} : null
                  });
                case 31:
                  loadAsset = _context2.sent;
                case 32:
                  if (loadAsset) {
                    _context2.next = 34;
                    break;
                  }
                  return _context2.abrupt("return");
                case 34:
                  if (!(this._url != url || !isValid(this._node))) {
                    _context2.next = 37;
                    break;
                  }
                  loadAsset.decRef();
                  return _context2.abrupt("return");
                case 37:
                  this._asset = loadAsset;
                  if (loadAsset instanceof SpriteFrame) this.onExternalLoadSuccess(loadAsset);else if (loadAsset instanceof Texture2D) {
                    sf = new SpriteFrame();
                    sf.texture = loadAsset;
                    this.onExternalLoadSuccess(sf);
                  } else if (loadAsset instanceof ImageAsset) {
                    texture = new Texture2D();
                    texture.image = loadAsset;
                    _sf = new SpriteFrame();
                    _sf.texture = texture;
                    this.onExternalLoadSuccess(_sf);
                  } else {
                    console.warn("GLoader:cant load", this.url);
                  }
                case 39:
                case "end":
                  return _context2.stop();
              }
            }, _callee2, this);
          }));
        } // 
        ;
        _proto54.loadExternal = function loadExternal() {
          var _this28 = this;
          var url = this.url;
          var callback = function callback(err, asset) {
            //url
            if (_this28._url != url || !isValid(_this28._node)) return;
            if (err) console.warn(err);
            if (asset instanceof SpriteFrame) _this28.onExternalLoadSuccess(asset);else if (asset instanceof Texture2D) {
              var sf = new SpriteFrame();
              sf.texture = asset;
              _this28.onExternalLoadSuccess(sf);
            } else if (asset instanceof ImageAsset) {
              var texture = new Texture2D();
              texture.image = asset;
              var _sf2 = new SpriteFrame();
              _sf2.texture = texture;
              _this28.onExternalLoadSuccess(_sf2);
            } else {
              console.warn("GLoader:cant load", _this28.url);
            }
          };
          if (this._url.startsWith("http://") || this._url.startsWith("https://") || this._url.startsWith('/')) assetManager.loadRemote(this._url, callback);else if (this._url.startsWith('data:image/')) {
            var img = new Image();
            img.src = this._url;
            img.onload = function () {
              var tex = new Texture2D();
              tex.reset({
                width: img.width,
                height: img.height
              });
              tex.uploadData(img, 0, 0);
              callback(null, tex);
            };
          } else {
            var bundle = resources; // 
            if (this.bundle && assetManager.bundles.has(this.bundle)) {
              bundle = assetManager.getBundle(this.bundle);
            }
            bundle.load(this._url + "/spriteFrame", Asset, callback);
          }
        };
        _proto54.freeExternal = function freeExternal(texture) {};
        _proto54.onExternalLoadSuccess = function onExternalLoadSuccess(texture) {
          this._content.spriteFrame = texture;
          this._content.type = Sprite.Type.SIMPLE;
          this.sourceWidth = texture.originalSize.width;
          this.sourceHeight = texture.originalSize.height;
          if (this._autoSize) this.setSize(this.sourceWidth, this.sourceHeight);
          this.updateLayout();
          this.node.emit("ImgLoaded");
        };
        _proto54.onExternalLoadFailed = function onExternalLoadFailed() {
          this.setErrorState();
        };
        _proto54.setErrorState = function setErrorState() {
          if (!this._showErrorSign) return;
          if (this._errorSign == null) {
            if (UIConfig.loaderErrorSign != null) {
              this._errorSign = GLoader._errorSignPool.getObject(UIConfig.loaderErrorSign);
            }
          }
          if (this._errorSign) {
            this._errorSign.setSize(this.width, this.height);
            this._container.addChild(this._errorSign.node);
          }
        };
        _proto54.clearErrorState = function clearErrorState() {
          if (this._errorSign) {
            this._container.removeChild(this._errorSign.node);
            GLoader._errorSignPool.returnObject(this._errorSign);
            this._errorSign = null;
          }
        };
        _proto54.updateLayout = function updateLayout() {
          if (this._content2 == null && this._content == null) {
            if (this._autoSize) {
              this._updatingLayout = true;
              this.setSize(50, 30);
              this._updatingLayout = false;
            }
            return;
          }
          var cw = this.sourceWidth;
          var ch = this.sourceHeight;
          var pivotCorrectX = -this.pivotX * this._width;
          var pivotCorrectY = this.pivotY * this._height;
          if (this._autoSize) {
            this._updatingLayout = true;
            if (cw == 0) cw = 50;
            if (ch == 0) ch = 30;
            this.setSize(cw, ch);
            this._updatingLayout = false;
            this._containerUITrans.setContentSize(this._width, this._height);
            this._container.setPosition(pivotCorrectX, pivotCorrectY);
            if (this._content2) {
              this._content2.setPosition(pivotCorrectX + this._width * this.pivotX, pivotCorrectY - this._height * this.pivotY);
              this._content2.setScale(1, 1);
            }
            if (cw == this._width && ch == this._height) return;
          }
          var sx = 1,
            sy = 1;
          if (this._fill != LoaderFillType.None) {
            sx = this.width / this.sourceWidth;
            sy = this.height / this.sourceHeight;
            if (sx != 1 || sy != 1) {
              if (this._fill == LoaderFillType.ScaleMatchHeight) sx = sy;else if (this._fill == LoaderFillType.ScaleMatchWidth) sy = sx;else if (this._fill == LoaderFillType.Scale) {
                if (sx > sy) sx = sy;else sy = sx;
              } else if (this._fill == LoaderFillType.ScaleNoBorder) {
                if (sx > sy) sy = sx;else sx = sy;
              }
              if (this._shrinkOnly) {
                if (sx > 1) sx = 1;
                if (sy > 1) sy = 1;
              }
              cw = this.sourceWidth * sx;
              ch = this.sourceHeight * sy;
            }
          }
          this._containerUITrans.setContentSize(cw, ch);
          if (this._content2) {
            this._content2.setPosition(pivotCorrectX + this._width * this.pivotX, pivotCorrectY - this._height * this.pivotY);
            this._content2.setScale(sx, sy);
          }
          var nx, ny;
          if (this._align == AlignType.Left) nx = 0;else if (this._align == AlignType.Center) nx = Math.floor((this._width - cw) / 2);else nx = this._width - cw;
          if (this._verticalAlign == VertAlignType.Top) ny = 0;else if (this._verticalAlign == VertAlignType.Middle) ny = Math.floor((this._height - ch) / 2);else ny = this._height - ch;
          ny = -ny;
          this._container.setPosition(pivotCorrectX + nx, pivotCorrectY + ny);
        };
        _proto54.clearContent = function clearContent() {
          this.clearErrorState();
          if (!this._contentItem) {
            var texture = this._content.spriteFrame;
            if (texture) this.freeExternal(texture);
          }
          if (this._content2) {
            this._container.removeChild(this._content2.node);
            this._content2.dispose();
            this._content2 = null;
          }
          if (this._content3) {
            this._container.removeChild(this._content3.node);
            this._content3.dispose();
            this._content3 = null;
          }
          this._content.frames = null;
          this._content.spriteFrame = null;
          this._contentItem = null;
          if (this._asset) {
            this._asset.decRef();
            this._asset = null;
          }
        };
        _proto54.handleSizeChanged = function handleSizeChanged() {
          _GObject8.prototype.handleSizeChanged.call(this);
          if (!this._updatingLayout) this.updateLayout();
        };
        _proto54.handleAnchorChanged = function handleAnchorChanged() {
          _GObject8.prototype.handleAnchorChanged.call(this);
          if (!this._updatingLayout) this.updateLayout();
        };
        _proto54.handleGrayedChanged = function handleGrayedChanged() {
          this._content.grayscale = this._grayed;
        };
        _proto54._hitTest = function _hitTest(pt, globalPt) {
          if (this._content2) {
            var obj = this._content2.hitTest(globalPt);
            if (obj) return obj;
          }
          if (pt.x >= 0 && pt.y >= 0 && pt.x < this._width && pt.y < this._height) return this;else return null;
        };
        _proto54.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.color;
            case ObjectPropID.Playing:
              return this.playing;
            case ObjectPropID.Frame:
              return this.frame;
            case ObjectPropID.TimeScale:
              return this._content.timeScale;
            default:
              return _GObject8.prototype.getProp.call(this, index);
          }
        };
        _proto54.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.color = value;
              break;
            case ObjectPropID.Playing:
              this.playing = value;
              break;
            case ObjectPropID.Frame:
              this.frame = value;
              break;
            case ObjectPropID.TimeScale:
              this._content.timeScale = value;
              break;
            case ObjectPropID.DeltaTime:
              this._content.advance(value);
              break;
            default:
              _GObject8.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto54.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GObject8.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this._url = buffer.readS();
          this._align = buffer.readByte();
          this._verticalAlign = buffer.readByte();
          this._fill = buffer.readByte();
          this._shrinkOnly = buffer.readBool();
          this._autoSize = buffer.readBool();
          this._showErrorSign = buffer.readBool();
          this._playing = buffer.readBool();
          this._frame = buffer.readInt();
          if (buffer.readBool()) this.color = buffer.readColor();
          this._content.fillMethod = buffer.readByte();
          if (this._content.fillMethod != 0) {
            this._content.fillOrigin = buffer.readByte();
            this._content.fillClockwise = buffer.readBool();
            this._content.fillAmount = buffer.readFloat();
          }
          if (this._url) this.loadContent();
        };
        _createClass(GLoader, [{
          key: "url",
          get: function get() {
            return this._url;
          },
          set: function set(value) {
            if (this._url == value) return;
            this._url = value;
            this.loadContent();
            this.updateGear(7);
          }
        }, {
          key: "bundle",
          get: function get() {
            if (this._assetBundle) {
              return this._assetBundle;
            }
            return UIConfig.loaderAssetsBundleName;
          },
          set: function set(val) {
            this._assetBundle = val;
          }
        }, {
          key: "icon",
          get: function get() {
            return this._url;
          },
          set: function set(value) {
            this.url = value;
          }
        }, {
          key: "align",
          get: function get() {
            return this._align;
          },
          set: function set(value) {
            if (this._align != value) {
              this._align = value;
              this.updateLayout();
            }
          }
        }, {
          key: "verticalAlign",
          get: function get() {
            return this._verticalAlign;
          },
          set: function set(value) {
            if (this._verticalAlign != value) {
              this._verticalAlign = value;
              this.updateLayout();
            }
          }
        }, {
          key: "fill",
          get: function get() {
            return this._fill;
          },
          set: function set(value) {
            if (this._fill != value) {
              this._fill = value;
              this.updateLayout();
            }
          }
        }, {
          key: "shrinkOnly",
          get: function get() {
            return this._shrinkOnly;
          },
          set: function set(value) {
            if (this._shrinkOnly != value) {
              this._shrinkOnly = value;
              this.updateLayout();
            }
          }
        }, {
          key: "autoSize",
          get: function get() {
            return this._autoSize;
          },
          set: function set(value) {
            if (this._autoSize != value) {
              this._autoSize = value;
              this.updateLayout();
            }
          }
        }, {
          key: "playing",
          get: function get() {
            return this._playing;
          },
          set: function set(value) {
            if (this._playing != value) {
              this._playing = value;
              if (this._content instanceof MovieClip) this._content.playing = value;
              this.updateGear(5);
            }
          }
        }, {
          key: "frame",
          get: function get() {
            return this._frame;
          },
          set: function set(value) {
            if (this._frame != value) {
              this._frame = value;
              if (this._content instanceof MovieClip) this._content.frame = value;
              this.updateGear(5);
            }
          }
        }, {
          key: "color",
          get: function get() {
            return this._color;
          },
          set: function set(value) {
            this._color.set(value);
            this.updateGear(4);
            this._content.color = value;
          }
        }, {
          key: "fillMethod",
          get: function get() {
            return this._content.fillMethod;
          },
          set: function set(value) {
            this._content.fillMethod = value;
          }
        }, {
          key: "fillOrigin",
          get: function get() {
            return this._content.fillOrigin;
          },
          set: function set(value) {
            this._content.fillOrigin = value;
          }
        }, {
          key: "fillClockwise",
          get: function get() {
            return this._content.fillClockwise;
          },
          set: function set(value) {
            this._content.fillClockwise = value;
          }
        }, {
          key: "fillAmount",
          get: function get() {
            return this._content.fillAmount;
          },
          set: function set(value) {
            this._content.fillAmount = value;
          }
        }, {
          key: "showErrorSign",
          get: function get() {
            return this._showErrorSign;
          },
          set: function set(value) {
            this._showErrorSign = value;
          }
        }, {
          key: "component",
          get: function get() {
            return this._content2;
          }
        }, {
          key: "prefabLoader",
          get: function get() {
            return this._content3;
          }
        }, {
          key: "texture",
          get: function get() {
            return this._content.spriteFrame;
          },
          set: function set(value) {
            this.url = null;
            this._content.spriteFrame = value;
            this._content.type = Sprite.Type.SIMPLE;
            if (value != null) {
              this.sourceWidth = value.rect.width;
              this.sourceHeight = value.rect.height;
            } else {
              this.sourceWidth = this.sourceHeight = 0;
            }
            this.updateLayout();
          }
        }]);
        return GLoader;
      }(GObject));
      GLoader._errorSignPool = new GObjectPool();
      var GLabel = exports('GLabel', /*#__PURE__*/function (_GComponent3) {
        _inheritsLoose(GLabel, _GComponent3);
        function GLabel() {
          var _this29;
          _this29 = _GComponent3.call(this) || this;
          _this29._node.name = "GLabel";
          return _this29;
        }
        var _proto55 = GLabel.prototype;
        _proto55.getTextField = function getTextField() {
          if (this._titleObject instanceof GTextField) return this._titleObject;else if ('getTextField' in this._titleObject) return this._titleObject.getTextField();else return null;
        };
        _proto55.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.titleColor;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) return tf.strokeColor;else return 0;
              }
            case ObjectPropID.FontSize:
              return this.titleFontSize;
            default:
              return _GComponent3.prototype.getProp.call(this, index);
          }
        };
        _proto55.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.titleColor = value;
              break;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) tf.strokeColor = value;
              }
              break;
            case ObjectPropID.FontSize:
              this.titleFontSize = value;
              break;
            default:
              _GComponent3.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto55.constructExtension = function constructExtension(buffer) {
          this._titleObject = this.getChild("title");
          this._iconObject = this.getChild("icon");
        };
        _proto55.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent3.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!buffer.seek(beginPos, 6)) return;
          if (buffer.readByte() != this.packageItem.objectType) return;
          var str;
          str = buffer.readS();
          if (str != null) this.title = str;
          str = buffer.readS();
          if (str != null) this.icon = str;
          if (buffer.readBool()) this.titleColor = buffer.readColor();
          var iv = buffer.readInt();
          if (iv != 0) this.titleFontSize = iv;
          if (buffer.readBool()) {
            var input = this.getTextField();
            if (input instanceof GTextInput) {
              str = buffer.readS();
              if (str != null) input.promptText = str;
              str = buffer.readS();
              if (str != null) input.restrict = str;
              iv = buffer.readInt();
              if (iv != 0) input.maxLength = iv;
              iv = buffer.readInt();
              if (buffer.readBool()) input.password = true;
            } else buffer.skip(13);
          }
          str = buffer.readS();
          if (str != null) {
            this._sound = str;
            if (buffer.readBool()) {
              this._soundVolumeScale = buffer.readFloat();
            }
            this._node.on(Event.CLICK, this.onClick_1, this);
          }
        };
        _proto55.onClick_1 = function onClick_1() {
          if (this._sound) {
            var pi = UIPackage.getItemByURL(this._sound);
            if (pi) {
              var sound = pi.owner.getItemAsset(pi);
              if (sound) GRoot.inst.playOneShotSound(sound, this._soundVolumeScale);
            }
          }
        };
        _createClass(GLabel, [{
          key: "icon",
          get: function get() {
            if (this._iconObject) return this._iconObject.icon;
          },
          set: function set(value) {
            if (this._iconObject) this._iconObject.icon = value;
            this.updateGear(7);
          }
        }, {
          key: "title",
          get: function get() {
            if (this._titleObject) return this._titleObject.text;else return null;
          },
          set: function set(value) {
            if (this._titleObject) this._titleObject.text = value;
            this.updateGear(6);
          }
        }, {
          key: "text",
          get: function get() {
            return this.title;
          },
          set: function set(value) {
            this.title = value;
          }
        }, {
          key: "titleColor",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.color;else return Color.WHITE;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.color = value;
            this.updateGear(4);
          }
        }, {
          key: "titleFontSize",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.fontSize;else return 0;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.fontSize = value;
          }
        }, {
          key: "editable",
          get: function get() {
            if (this._titleObject && this._titleObject instanceof GTextInput) return this._titleObject.editable;else return false;
          },
          set: function set(val) {
            if (this._titleObject && this._titleObject instanceof GTextInput) this._titleObject.editable = val;
          }
        }]);
        return GLabel;
      }(GComponent));
      var GButton = exports('GButton', /*#__PURE__*/function (_GComponent4) {
        _inheritsLoose(GButton, _GComponent4);
        function GButton() {
          var _this30;
          _this30 = _GComponent4.call(this) || this;
          _this30._node.name = "GButton";
          _this30._mode = ButtonMode.Common;
          _this30._title = "";
          _this30._icon = "";
          _this30._sound = UIConfig.buttonSound;
          _this30._soundVolumeScale = UIConfig.buttonSoundVolumeScale;
          _this30._changeStateOnClick = true;
          _this30._downEffect = 0;
          _this30._downEffectValue = 0.8;
          return _this30;
        }
        var _proto56 = GButton.prototype;
        _proto56.getTextField = function getTextField() {
          if (this._titleObject instanceof GTextField) return this._titleObject;else if ('getTextField' in this._titleObject) return this._titleObject.getTextField();else return null;
        };
        _proto56.fireClick = function fireClick() {
          GRoot.inst.inputProcessor.simulateClick(this);
        };
        _proto56.setState = function setState(val) {
          if (this._buttonController) this._buttonController.selectedPage = val;
          if (this._downEffect == 1) {
            var cnt = this.numChildren;
            if (val == GButton.DOWN || val == GButton.SELECTED_OVER || val == GButton.SELECTED_DISABLED) {
              if (!this._downColor) this._downColor = new Color();
              var r = this._downEffectValue * 255;
              this._downColor.r = this._downColor.g = this._downColor.b = r;
              for (var i = 0; i < cnt; i++) {
                var obj = this.getChildAt(i);
                if (!(obj instanceof GTextField)) obj.setProp(ObjectPropID.Color, this._downColor);
              }
            } else {
              for (var i = 0; i < cnt; i++) {
                var obj = this.getChildAt(i);
                if (!(obj instanceof GTextField)) obj.setProp(ObjectPropID.Color, Color.WHITE);
              }
            }
          } else if (this._downEffect == 2) {
            if (val == GButton.DOWN || val == GButton.SELECTED_OVER || val == GButton.SELECTED_DISABLED) {
              if (!this._downScaled) {
                this._downScaled = true;
                this.setScale(this.scaleX * this._downEffectValue, this.scaleY * this._downEffectValue);
              }
            } else {
              if (this._downScaled) {
                this._downScaled = false;
                this.setScale(this.scaleX / this._downEffectValue, this.scaleY / this._downEffectValue);
              }
            }
          }
        };
        _proto56.setCurrentState = function setCurrentState() {
          if (this.grayed && this._buttonController && this._buttonController.hasPage(GButton.DISABLED)) {
            if (this._selected) this.setState(GButton.SELECTED_DISABLED);else this.setState(GButton.DISABLED);
          } else {
            if (this._selected) this.setState(this._over ? GButton.SELECTED_OVER : GButton.DOWN);else this.setState(this._over ? GButton.OVER : GButton.UP);
          }
        };
        _proto56.handleControllerChanged = function handleControllerChanged(c) {
          _GComponent4.prototype.handleControllerChanged.call(this, c);
          if (this._relatedController == c) this.selected = this._relatedPageId == c.selectedPageId;
        };
        _proto56.handleGrayedChanged = function handleGrayedChanged() {
          if (this._buttonController && this._buttonController.hasPage(GButton.DISABLED)) {
            if (this.grayed) {
              if (this._selected && this._buttonController.hasPage(GButton.SELECTED_DISABLED)) this.setState(GButton.SELECTED_DISABLED);else this.setState(GButton.DISABLED);
            } else if (this._selected) this.setState(GButton.DOWN);else this.setState(GButton.UP);
          } else _GComponent4.prototype.handleGrayedChanged.call(this);
        };
        _proto56.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.titleColor;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) return tf.strokeColor;else return 0;
              }
            case ObjectPropID.FontSize:
              return this.titleFontSize;
            case ObjectPropID.Selected:
              return this.selected;
            default:
              return _GComponent4.prototype.getProp.call(this, index);
          }
        };
        _proto56.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.titleColor = value;
              break;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) tf.strokeColor = value;
              }
              break;
            case ObjectPropID.FontSize:
              this.titleFontSize = value;
              break;
            case ObjectPropID.Selected:
              this.selected = value;
              break;
            default:
              _GComponent4.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto56.constructExtension = function constructExtension(buffer) {
          buffer.seek(0, 6);
          this._mode = buffer.readByte();
          var str = buffer.readS();
          if (str) this._sound = str;
          this._soundVolumeScale = buffer.readFloat();
          this._downEffect = buffer.readByte();
          this._downEffectValue = buffer.readFloat();
          if (this._downEffect == 2) this.setPivot(0.5, 0.5, this.pivotAsAnchor);
          this._buttonController = this.getController("button");
          this._titleObject = this.getChild("title");
          this._iconObject = this.getChild("icon");
          if (this._titleObject) this._title = this._titleObject.text;
          if (this._iconObject) this._icon = this._iconObject.icon;
          if (this._mode == ButtonMode.Common) this.setState(GButton.UP);
          this._node.on(Event.TOUCH_BEGIN, this.onTouchBegin_1, this);
          this._node.on(Event.TOUCH_END, this.onTouchEnd_1, this);
          this._node.on(Event.ROLL_OVER, this.onRollOver_1, this);
          this._node.on(Event.ROLL_OUT, this.onRollOut_1, this);
          this._node.on(Event.CLICK, this.onClick_1, this);
        };
        _proto56.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent4.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!buffer.seek(beginPos, 6)) return;
          if (buffer.readByte() != this.packageItem.objectType) return;
          var str;
          var iv;
          str = buffer.readS();
          if (str != null) this.title = str;
          str = buffer.readS();
          if (str != null) this.selectedTitle = str;
          str = buffer.readS();
          if (str != null) this.icon = str;
          str = buffer.readS();
          if (str != null) this.selectedIcon = str;
          if (buffer.readBool()) this.titleColor = buffer.readColor();
          iv = buffer.readInt();
          if (iv != 0) this.titleFontSize = iv;
          iv = buffer.readShort();
          if (iv >= 0) this._relatedController = this.parent.getControllerAt(iv);
          this._relatedPageId = buffer.readS();
          str = buffer.readS();
          if (str != null) this._sound = str;
          if (buffer.readBool()) this._soundVolumeScale = buffer.readFloat();
          this.selected = buffer.readBool();
        };
        _proto56.onRollOver_1 = function onRollOver_1() {
          if (!this._buttonController || !this._buttonController.hasPage(GButton.OVER)) return;
          this._over = true;
          if (this._down) return;
          if (this.grayed && this._buttonController.hasPage(GButton.DISABLED)) return;
          this.setState(this._selected ? GButton.SELECTED_OVER : GButton.OVER);
        };
        _proto56.onRollOut_1 = function onRollOut_1() {
          if (!this._buttonController || !this._buttonController.hasPage(GButton.OVER)) return;
          this._over = false;
          if (this._down) return;
          if (this.grayed && this._buttonController.hasPage(GButton.DISABLED)) return;
          this.setState(this._selected ? GButton.DOWN : GButton.UP);
        };
        _proto56.onTouchBegin_1 = function onTouchBegin_1(evt) {
          if (evt.button != EventMouse.BUTTON_LEFT) return;
          this._down = true;
          evt.captureTouch();
          if (this._mode == ButtonMode.Common) {
            if (this.grayed && this._buttonController && this._buttonController.hasPage(GButton.DISABLED)) this.setState(GButton.SELECTED_DISABLED);else this.setState(GButton.DOWN);
          }
          if (this._linkedPopup) {
            if (this._linkedPopup instanceof Window) this._linkedPopup.toggleStatus();else GRoot.inst.togglePopup(this._linkedPopup, this);
          }
        };
        _proto56.onTouchEnd_1 = function onTouchEnd_1(evt) {
          if (evt.button != EventMouse.BUTTON_LEFT) return;
          if (this._down) {
            this._down = false;
            if (this._node == null) return;
            if (this._mode == ButtonMode.Common) {
              if (this.grayed && this._buttonController && this._buttonController.hasPage(GButton.DISABLED)) this.setState(GButton.DISABLED);else if (this._over) this.setState(GButton.OVER);else this.setState(GButton.UP);
            } else {
              if (!this._over && this._buttonController != null && (this._buttonController.selectedPage == GButton.OVER || this._buttonController.selectedPage == GButton.SELECTED_OVER)) {
                this.setCurrentState();
              }
            }
          }
        };
        _proto56.onClick_1 = function onClick_1() {
          if (this._sound) {
            var pi = UIPackage.getItemByURL(this._sound);
            if (pi) {
              var sound = pi.owner.getItemAsset(pi);
              if (sound) GRoot.inst.playOneShotSound(sound, this._soundVolumeScale);
            }
          }
          if (this._mode == ButtonMode.Check) {
            if (this._changeStateOnClick) {
              this.selected = !this._selected;
              this._node.emit(Event.STATUS_CHANGED, this);
            }
          } else if (this._mode == ButtonMode.Radio) {
            if (this._changeStateOnClick && !this._selected) {
              this.selected = true;
              this._node.emit(Event.STATUS_CHANGED, this);
            }
          } else {
            if (this._relatedController) this._relatedController.selectedPageId = this._relatedPageId;
          }
        };
        _createClass(GButton, [{
          key: "icon",
          get: function get() {
            return this._icon;
          },
          set: function set(value) {
            this._icon = value;
            value = this._selected && this._selectedIcon ? this._selectedIcon : this._icon;
            if (this._iconObject) this._iconObject.icon = value;
            this.updateGear(7);
          }
        }, {
          key: "selectedIcon",
          get: function get() {
            return this._selectedIcon;
          },
          set: function set(value) {
            this._selectedIcon = value;
            value = this._selected && this._selectedIcon ? this._selectedIcon : this._icon;
            if (this._iconObject) this._iconObject.icon = value;
          }
        }, {
          key: "title",
          get: function get() {
            return this._title;
          },
          set: function set(value) {
            this._title = value;
            if (this._titleObject) this._titleObject.text = this._selected && this._selectedTitle ? this._selectedTitle : this._title;
            this.updateGear(6);
          }
        }, {
          key: "text",
          get: function get() {
            return this.title;
          },
          set: function set(value) {
            this.title = value;
          }
        }, {
          key: "selectedTitle",
          get: function get() {
            return this._selectedTitle;
          },
          set: function set(value) {
            this._selectedTitle = value;
            if (this._titleObject) this._titleObject.text = this._selected && this._selectedTitle ? this._selectedTitle : this._title;
          }
        }, {
          key: "titleColor",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.color;else return Color.BLACK;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.color = value;
          }
        }, {
          key: "titleFontSize",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.fontSize;else return 0;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.fontSize = value;
          }
        }, {
          key: "sound",
          get: function get() {
            return this._sound;
          },
          set: function set(val) {
            this._sound = val;
          }
        }, {
          key: "soundVolumeScale",
          get: function get() {
            return this._soundVolumeScale;
          },
          set: function set(value) {
            this._soundVolumeScale = value;
          }
        }, {
          key: "selected",
          get: function get() {
            return this._selected;
          },
          set: function set(val) {
            if (this._mode == ButtonMode.Common) return;
            if (this._selected != val) {
              this._selected = val;
              this.setCurrentState();
              if (this._selectedTitle && this._titleObject) this._titleObject.text = this._selected ? this._selectedTitle : this._title;
              if (this._selectedIcon) {
                var str = this._selected ? this._selectedIcon : this._icon;
                if (this._iconObject) this._iconObject.icon = str;
              }
              if (this._relatedController && this._parent && !this._parent._buildingDisplayList) {
                if (this._selected) {
                  this._relatedController.selectedPageId = this._relatedPageId;
                  if (this._relatedController.autoRadioGroupDepth) this._parent.adjustRadioGroupDepth(this, this._relatedController);
                } else if (this._mode == ButtonMode.Check && this._relatedController.selectedPageId == this._relatedPageId) this._relatedController.oppositePageId = this._relatedPageId;
              }
            }
          }
        }, {
          key: "mode",
          get: function get() {
            return this._mode;
          },
          set: function set(value) {
            if (this._mode != value) {
              if (value == ButtonMode.Common) this.selected = false;
              this._mode = value;
            }
          }
        }, {
          key: "relatedController",
          get: function get() {
            return this._relatedController;
          },
          set: function set(val) {
            this._relatedController = val;
          }
        }, {
          key: "relatedPageId",
          get: function get() {
            return this._relatedPageId;
          },
          set: function set(val) {
            this._relatedPageId = val;
          }
        }, {
          key: "changeStateOnClick",
          get: function get() {
            return this._changeStateOnClick;
          },
          set: function set(value) {
            this._changeStateOnClick = value;
          }
        }, {
          key: "linkedPopup",
          get: function get() {
            return this._linkedPopup;
          },
          set: function set(value) {
            this._linkedPopup = value;
          }
        }]);
        return GButton;
      }(GComponent));
      GButton.UP = "up";
      GButton.DOWN = "down";
      GButton.OVER = "over";
      GButton.SELECTED_OVER = "selectedOver";
      GButton.DISABLED = "disabled";
      GButton.SELECTED_DISABLED = "selectedDisabled";
      var GList = exports('GList', /*#__PURE__*/function (_GComponent5) {
        _inheritsLoose(GList, _GComponent5);
        function GList() {
          var _this31;
          _this31 = _GComponent5.call(this) || this;
          _this31.scrollItemToViewOnClick = true;
          _this31.foldInvisibleItems = false;
          _this31._lineCount = 0;
          _this31._columnCount = 0;
          _this31._lineGap = 0;
          _this31._columnGap = 0;
          _this31._lastSelectedIndex = 0;
          _this31._numItems = 0;
          _this31._realNumItems = 0;
          _this31._firstIndex = 0; //the top left index
          _this31._curLineItemCount = 0; //item count in one line
          _this31._curLineItemCount2 = 0; //
          _this31._virtualListChanged = 0; //1-content changed, 2-size changed
          _this31.itemInfoVer = 0; //item
          _this31._node.name = "GList";
          _this31._trackBounds = true;
          _this31._pool = new GObjectPool();
          _this31._layout = ListLayoutType.SingleColumn;
          _this31._autoResizeItem = true;
          _this31._lastSelectedIndex = -1;
          _this31._selectionMode = ListSelectionMode.Single;
          _this31.opaque = true;
          _this31._align = AlignType.Left;
          _this31._verticalAlign = VertAlignType.Top;
          return _this31;
        }
        var _proto57 = GList.prototype;
        _proto57.dispose = function dispose() {
          this._partner.unschedule(this._refreshVirtualList);
          this._pool.clear();
          _GComponent5.prototype.dispose.call(this);
        };
        _proto57.getFromPool = function getFromPool(url) {
          if (!url) url = this._defaultItem;
          var obj = this._pool.getObject(url);
          if (obj) obj.visible = true;
          return obj;
        };
        _proto57.returnToPool = function returnToPool(obj) {
          this._pool.returnObject(obj);
        };
        _proto57.addChildAt = function addChildAt(child, index) {
          _GComponent5.prototype.addChildAt.call(this, child, index);
          if (child instanceof GButton) {
            child.selected = false;
            child.changeStateOnClick = false;
          }
          child.on(Event.CLICK, this.onClickItem, this);
          return child;
        };
        _proto57.addItem = function addItem(url) {
          if (!url) url = this._defaultItem;
          return this.addChild(UIPackage.createObjectFromURL(url));
        };
        _proto57.addItemFromPool = function addItemFromPool(url) {
          return this.addChild(this.getFromPool(url));
        };
        _proto57.removeChildAt = function removeChildAt(index, dispose) {
          var child = _GComponent5.prototype.removeChildAt.call(this, index, dispose);
          if (!dispose) child.off(Event.CLICK, this.onClickItem, this);
          return child;
        };
        _proto57.removeChildToPoolAt = function removeChildToPoolAt(index) {
          var child = _GComponent5.prototype.removeChildAt.call(this, index);
          this.returnToPool(child);
        };
        _proto57.removeChildToPool = function removeChildToPool(child) {
          _GComponent5.prototype.removeChild.call(this, child);
          this.returnToPool(child);
        };
        _proto57.removeChildrenToPool = function removeChildrenToPool(beginIndex, endIndex) {
          if (beginIndex == undefined) beginIndex = 0;
          if (endIndex == undefined) endIndex = -1;
          if (endIndex < 0 || endIndex >= this._children.length) endIndex = this._children.length - 1;
          for (var i = beginIndex; i <= endIndex; ++i) this.removeChildToPoolAt(beginIndex);
        };
        _proto57.getSelection = function getSelection(result) {
          if (!result) result = new Array();
          var i;
          if (this._virtual) {
            for (i = 0; i < this._realNumItems; i++) {
              var ii = this._virtualItems[i];
              if (ii.obj instanceof GButton && ii.obj.selected || !ii.obj && ii.selected) {
                var j = i;
                if (this._loop) {
                  j = i % this._numItems;
                  if (result.indexOf(j) != -1) continue;
                }
                result.push(j);
              }
            }
          } else {
            var cnt = this._children.length;
            for (i = 0; i < cnt; i++) {
              var obj = this._children[i];
              if (obj instanceof GButton && obj.selected) result.push(i);
            }
          }
          return result;
        };
        _proto57.addSelection = function addSelection(index, scrollItToView) {
          if (this._selectionMode == ListSelectionMode.None) return;
          this.checkVirtualList();
          if (this._selectionMode == ListSelectionMode.Single) this.clearSelection();
          if (scrollItToView) this.scrollToView(index);
          this._lastSelectedIndex = index;
          var obj;
          if (this._virtual) {
            var ii = this._virtualItems[index];
            if (ii.obj) obj = ii.obj;
            ii.selected = true;
          } else obj = this.getChildAt(index);
          if (obj instanceof GButton && !obj.selected) {
            obj.selected = true;
            this.updateSelectionController(index);
          }
        };
        _proto57.removeSelection = function removeSelection(index) {
          if (this._selectionMode == ListSelectionMode.None) return;
          var obj;
          if (this._virtual) {
            var ii = this._virtualItems[index];
            if (ii.obj) obj = ii.obj;
            ii.selected = false;
          } else obj = this.getChildAt(index);
          if (obj instanceof GButton) obj.selected = false;
        };
        _proto57.clearSelection = function clearSelection() {
          var i;
          if (this._virtual) {
            for (i = 0; i < this._realNumItems; i++) {
              var ii = this._virtualItems[i];
              if (ii.obj instanceof GButton) ii.obj.selected = false;
              ii.selected = false;
            }
          } else {
            var cnt = this._children.length;
            for (i = 0; i < cnt; i++) {
              var obj = this._children[i];
              if (obj instanceof GButton) obj.selected = false;
            }
          }
        };
        _proto57.clearSelectionExcept = function clearSelectionExcept(g) {
          var i;
          if (this._virtual) {
            for (i = 0; i < this._realNumItems; i++) {
              var ii = this._virtualItems[i];
              if (ii.obj != g) {
                if (ii.obj instanceof GButton) ii.obj.selected = false;
                ii.selected = false;
              }
            }
          } else {
            var cnt = this._children.length;
            for (i = 0; i < cnt; i++) {
              var obj = this._children[i];
              if (obj instanceof GButton && obj != g) obj.selected = false;
            }
          }
        };
        _proto57.selectAll = function selectAll() {
          this.checkVirtualList();
          var last = -1;
          var i;
          if (this._virtual) {
            for (i = 0; i < this._realNumItems; i++) {
              var ii = this._virtualItems[i];
              if (ii.obj instanceof GButton && !ii.obj.selected) {
                ii.obj.selected = true;
                last = i;
              }
              ii.selected = true;
            }
          } else {
            var cnt = this._children.length;
            for (i = 0; i < cnt; i++) {
              var obj = this._children[i];
              if (obj instanceof GButton && !obj.selected) {
                obj.selected = true;
                last = i;
              }
            }
          }
          if (last != -1) this.updateSelectionController(last);
        };
        _proto57.selectNone = function selectNone() {
          this.clearSelection();
        };
        _proto57.selectReverse = function selectReverse() {
          this.checkVirtualList();
          var last = -1;
          var i;
          if (this._virtual) {
            for (i = 0; i < this._realNumItems; i++) {
              var ii = this._virtualItems[i];
              if (ii.obj instanceof GButton) {
                ii.obj.selected = !ii.obj.selected;
                if (ii.obj.selected) last = i;
              }
              ii.selected = !ii.selected;
            }
          } else {
            var cnt = this._children.length;
            for (i = 0; i < cnt; i++) {
              var obj = this._children[i];
              if (obj instanceof GButton) {
                obj.selected = !obj.selected;
                if (obj.selected) last = i;
              }
            }
          }
          if (last != -1) this.updateSelectionController(last);
        };
        _proto57.handleArrowKey = function handleArrowKey(dir) {
          var index = this.selectedIndex;
          if (index == -1) return;
          switch (dir) {
            case 1:
              //up
              if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowVertical) {
                index--;
                if (index >= 0) {
                  this.clearSelection();
                  this.addSelection(index, true);
                }
              } else if (this._layout == ListLayoutType.FlowHorizontal || this._layout == ListLayoutType.Pagination) {
                var current = this._children[index];
                var k = 0;
                for (var i = index - 1; i >= 0; i--) {
                  var obj = this._children[i];
                  if (obj.y != current.y) {
                    current = obj;
                    break;
                  }
                  k++;
                }
                for (; i >= 0; i--) {
                  obj = this._children[i];
                  if (obj.y != current.y) {
                    this.clearSelection();
                    this.addSelection(i + k + 1, true);
                    break;
                  }
                }
              }
              break;
            case 3:
              //right
              if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowHorizontal || this._layout == ListLayoutType.Pagination) {
                index++;
                if (index < this._children.length) {
                  this.clearSelection();
                  this.addSelection(index, true);
                }
              } else if (this._layout == ListLayoutType.FlowVertical) {
                current = this._children[index];
                k = 0;
                var cnt = this._children.length;
                for (i = index + 1; i < cnt; i++) {
                  obj = this._children[i];
                  if (obj.x != current.x) {
                    current = obj;
                    break;
                  }
                  k++;
                }
                for (; i < cnt; i++) {
                  obj = this._children[i];
                  if (obj.x != current.x) {
                    this.clearSelection();
                    this.addSelection(i - k - 1, true);
                    break;
                  }
                }
              }
              break;
            case 5:
              //down
              if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowVertical) {
                index++;
                if (index < this._children.length) {
                  this.clearSelection();
                  this.addSelection(index, true);
                }
              } else if (this._layout == ListLayoutType.FlowHorizontal || this._layout == ListLayoutType.Pagination) {
                current = this._children[index];
                k = 0;
                cnt = this._children.length;
                for (i = index + 1; i < cnt; i++) {
                  obj = this._children[i];
                  if (obj.y != current.y) {
                    current = obj;
                    break;
                  }
                  k++;
                }
                for (; i < cnt; i++) {
                  obj = this._children[i];
                  if (obj.y != current.y) {
                    this.clearSelection();
                    this.addSelection(i - k - 1, true);
                    break;
                  }
                }
              }
              break;
            case 7:
              //left
              if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowHorizontal || this._layout == ListLayoutType.Pagination) {
                index--;
                if (index >= 0) {
                  this.clearSelection();
                  this.addSelection(index, true);
                }
              } else if (this._layout == ListLayoutType.FlowVertical) {
                current = this._children[index];
                k = 0;
                for (i = index - 1; i >= 0; i--) {
                  obj = this._children[i];
                  if (obj.x != current.x) {
                    current = obj;
                    break;
                  }
                  k++;
                }
                for (; i >= 0; i--) {
                  obj = this._children[i];
                  if (obj.x != current.x) {
                    this.clearSelection();
                    this.addSelection(i + k + 1, true);
                    break;
                  }
                }
              }
              break;
          }
        };
        _proto57.onClickItem = function onClickItem(evt) {
          if (this._scrollPane && this._scrollPane.isDragged) return;
          var item = GObject.cast(evt.currentTarget);
          this.setSelectionOnEvent(item, evt);
          if (this._scrollPane && this.scrollItemToViewOnClick) this._scrollPane.scrollToView(item, true);
          this.dispatchItemEvent(item, evt);
        };
        _proto57.dispatchItemEvent = function dispatchItemEvent(item, evt) {
          this._node.emit(Event.CLICK_ITEM, item, evt);
        };
        _proto57.setSelectionOnEvent = function setSelectionOnEvent(item, evt) {
          if (!(item instanceof GButton) || this._selectionMode == ListSelectionMode.None) return;
          var dontChangeLastIndex = false;
          var index = this.childIndexToItemIndex(this.getChildIndex(item));
          if (this._selectionMode == ListSelectionMode.Single) {
            if (!item.selected) {
              this.clearSelectionExcept(item);
              item.selected = true;
            }
          } else {
            if (evt.isShiftDown) {
              if (!item.selected) {
                if (this._lastSelectedIndex != -1) {
                  var min = Math.min(this._lastSelectedIndex, index);
                  var max = Math.max(this._lastSelectedIndex, index);
                  max = Math.min(max, this.numItems - 1);
                  var i;
                  if (this._virtual) {
                    for (i = min; i <= max; i++) {
                      var ii = this._virtualItems[i];
                      if (ii.obj instanceof GButton) ii.obj.selected = true;
                      ii.selected = true;
                    }
                  } else {
                    for (i = min; i <= max; i++) {
                      var obj = this.getChildAt(i);
                      if (obj instanceof GButton) obj.selected = true;
                    }
                  }
                  dontChangeLastIndex = true;
                } else {
                  item.selected = true;
                }
              }
            } else if (evt.isCtrlDown || this._selectionMode == ListSelectionMode.Multiple_SingleClick) {
              item.selected = !item.selected;
            } else {
              if (!item.selected) {
                this.clearSelectionExcept(item);
                item.selected = true;
              } else this.clearSelectionExcept(item);
            }
          }
          if (!dontChangeLastIndex) this._lastSelectedIndex = index;
          if (item.selected) this.updateSelectionController(index);
        };
        _proto57.resizeToFit = function resizeToFit(itemCount, minSize) {
          if (itemCount === void 0) {
            itemCount = Number.POSITIVE_INFINITY;
          }
          if (minSize === void 0) {
            minSize = 0;
          }
          this.ensureBoundsCorrect();
          var curCount = this.numItems;
          if (itemCount > curCount) itemCount = curCount;
          if (this._virtual) {
            var lineCount = Math.ceil(itemCount / this._curLineItemCount);
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) this.viewHeight = lineCount * this._itemSize.height + Math.max(0, lineCount - 1) * this._lineGap;else this.viewWidth = lineCount * this._itemSize.width + Math.max(0, lineCount - 1) * this._columnGap;
          } else if (itemCount == 0) {
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) this.viewHeight = minSize;else this.viewWidth = minSize;
          } else {
            var i = itemCount - 1;
            var obj = null;
            while (i >= 0) {
              obj = this.getChildAt(i);
              if (!this.foldInvisibleItems || obj.visible) break;
              i--;
            }
            if (i < 0) {
              if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) this.viewHeight = minSize;else this.viewWidth = minSize;
            } else {
              var size = 0;
              if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
                size = obj.y + obj.height;
                if (size < minSize) size = minSize;
                this.viewHeight = size;
              } else {
                size = obj.x + obj.width;
                if (size < minSize) size = minSize;
                this.viewWidth = size;
              }
            }
          }
        };
        _proto57.getMaxItemWidth = function getMaxItemWidth() {
          var cnt = this._children.length;
          var max = 0;
          for (var i = 0; i < cnt; i++) {
            var child = this.getChildAt(i);
            if (child.width > max) max = child.width;
          }
          return max;
        };
        _proto57.handleSizeChanged = function handleSizeChanged() {
          _GComponent5.prototype.handleSizeChanged.call(this);
          this.setBoundsChangedFlag();
          if (this._virtual) this.setVirtualListChangedFlag(true);
        };
        _proto57.handleControllerChanged = function handleControllerChanged(c) {
          _GComponent5.prototype.handleControllerChanged.call(this, c);
          if (this._selectionController == c) this.selectedIndex = c.selectedIndex;
        };
        _proto57.updateSelectionController = function updateSelectionController(index) {
          if (this._selectionController && !this._selectionController.changing && index < this._selectionController.pageCount) {
            var c = this._selectionController;
            this._selectionController = null;
            c.selectedIndex = index;
            this._selectionController = c;
          }
        };
        _proto57.getSnappingPosition = function getSnappingPosition(xValue, yValue, resultPoint) {
          if (this._virtual) {
            resultPoint = resultPoint || new Vec2();
            var saved;
            var index;
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
              saved = yValue;
              s_n = yValue;
              index = this.getIndexOnPos1(false);
              yValue = s_n;
              if (index < this._virtualItems.length && saved - yValue > this._virtualItems[index].height / 2 && index < this._realNumItems) yValue += this._virtualItems[index].height + this._lineGap;
            } else if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowVertical) {
              saved = xValue;
              s_n = xValue;
              index = this.getIndexOnPos2(false);
              xValue = s_n;
              if (index < this._virtualItems.length && saved - xValue > this._virtualItems[index].width / 2 && index < this._realNumItems) xValue += this._virtualItems[index].width + this._columnGap;
            } else {
              saved = xValue;
              s_n = xValue;
              index = this.getIndexOnPos3(false);
              xValue = s_n;
              if (index < this._virtualItems.length && saved - xValue > this._virtualItems[index].width / 2 && index < this._realNumItems) xValue += this._virtualItems[index].width + this._columnGap;
            }
            resultPoint.x = xValue;
            resultPoint.y = yValue;
            return resultPoint;
          } else {
            return _GComponent5.prototype.getSnappingPosition.call(this, xValue, yValue, resultPoint);
          }
        };
        _proto57.scrollToView = function scrollToView(index, ani, setFirst) {
          if (this._virtual) {
            if (this._numItems == 0) return;
            this.checkVirtualList();
            if (index >= this._virtualItems.length) throw new Error("Invalid child index: " + index + ">" + this._virtualItems.length);
            if (this._loop) index = Math.floor(this._firstIndex / this._numItems) * this._numItems + index;
            var rect;
            var ii = this._virtualItems[index];
            var pos = 0;
            var i;
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
              for (i = this._curLineItemCount - 1; i < index; i += this._curLineItemCount) pos += this._virtualItems[i].height + this._lineGap;
              rect = new Rect(0, pos, this._itemSize.width, ii.height);
            } else if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowVertical) {
              for (i = this._curLineItemCount - 1; i < index; i += this._curLineItemCount) pos += this._virtualItems[i].width + this._columnGap;
              rect = new Rect(pos, 0, ii.width, this._itemSize.height);
            } else {
              var page = index / (this._curLineItemCount * this._curLineItemCount2);
              rect = new Rect(page * this.viewWidth + index % this._curLineItemCount * (ii.width + this._columnGap), index / this._curLineItemCount % this._curLineItemCount2 * (ii.height + this._lineGap), ii.width, ii.height);
            }
            if (this._scrollPane) this._scrollPane.scrollToView(rect, ani, setFirst);
          } else {
            var obj = this.getChildAt(index);
            if (obj) {
              if (this._scrollPane) this._scrollPane.scrollToView(obj, ani, setFirst);else if (this.parent && this.parent.scrollPane) this.parent.scrollPane.scrollToView(obj, ani, setFirst);
            }
          }
        };
        _proto57.getFirstChildInView = function getFirstChildInView() {
          return this.childIndexToItemIndex(_GComponent5.prototype.getFirstChildInView.call(this));
        };
        _proto57.childIndexToItemIndex = function childIndexToItemIndex(index) {
          if (!this._virtual) return index;
          if (this._layout == ListLayoutType.Pagination) {
            for (var i = this._firstIndex; i < this._realNumItems; i++) {
              if (this._virtualItems[i].obj) {
                index--;
                if (index < 0) return i;
              }
            }
            return index;
          } else {
            index += this._firstIndex;
            if (this._loop && this._numItems > 0) index = index % this._numItems;
            return index;
          }
        };
        _proto57.itemIndexToChildIndex = function itemIndexToChildIndex(index) {
          if (!this._virtual) return index;
          if (this._layout == ListLayoutType.Pagination) {
            return this.getChildIndex(this._virtualItems[index].obj);
          } else {
            if (this._loop && this._numItems > 0) {
              var j = this._firstIndex % this._numItems;
              if (index >= j) index = index - j;else index = this._numItems - j + index;
            } else index -= this._firstIndex;
            return index;
          }
        };
        _proto57.setVirtual = function setVirtual() {
          this._setVirtual(false);
        } /// <summary>
        /// Set the list to be virtual list, and has loop behavior.
        /// </summary>
        ;
        _proto57.setVirtualAndLoop = function setVirtualAndLoop() {
          this._setVirtual(true);
        } /// <summary>
        /// Set the list to be virtual list.
        /// </summary>
        ;
        _proto57._setVirtual = function _setVirtual(loop) {
          if (!this._virtual) {
            if (!this._scrollPane) throw new Error("Virtual list must be scrollable!");
            if (loop) {
              if (this._layout == ListLayoutType.FlowHorizontal || this._layout == ListLayoutType.FlowVertical) throw new Error("Loop list is not supported for FlowHorizontal or FlowVertical layout!");
              this._scrollPane.bouncebackEffect = false;
            }
            this._virtual = true;
            this._loop = loop;
            this._virtualItems = new Array();
            this.removeChildrenToPool();
            if (this._itemSize == null) {
              this._itemSize = new Size(0, 0);
              var obj = this.getFromPool(null);
              if (!obj) {
                throw new Error("Virtual List must have a default list item resource.");
              } else {
                this._itemSize.width = obj.width;
                this._itemSize.height = obj.height;
              }
              this.returnToPool(obj);
            }
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
              this._scrollPane.scrollStep = this._itemSize.height;
              if (this._loop) this._scrollPane._loop = 2;
            } else {
              this._scrollPane.scrollStep = this._itemSize.width;
              if (this._loop) this._scrollPane._loop = 1;
            }
            this._node.on(Event.SCROLL, this.__scrolled, this);
            this.setVirtualListChangedFlag(true);
          }
        } /// <summary>
        /// Set the list item count. 
        /// If the list is not virtual, specified number of items will be created. 
        /// If the list is virtual, only items in view will be created.
        /// </summary>
        ;
        _proto57.refreshVirtualList = function refreshVirtualList() {
          this.setVirtualListChangedFlag(false);
        };
        _proto57.checkVirtualList = function checkVirtualList() {
          if (this._virtualListChanged != 0) {
            this._refreshVirtualList();
            this._partner.unschedule(this._refreshVirtualList);
          }
        };
        _proto57.setVirtualListChangedFlag = function setVirtualListChangedFlag(layoutChanged) {
          if (layoutChanged) this._virtualListChanged = 2;else if (this._virtualListChanged == 0) this._virtualListChanged = 1;
          this._partner.callLater(this._refreshVirtualList);
        };
        _proto57._refreshVirtualList = function _refreshVirtualList(dt) {
          if (!isNaN(dt)) {
            var _t = GObject.cast(this.node);
            _t._refreshVirtualList();
            return;
          }
          var layoutChanged = this._virtualListChanged == 2;
          this._virtualListChanged = 0;
          this._eventLocked = true;
          if (layoutChanged) {
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.SingleRow) this._curLineItemCount = 1;else if (this._layout == ListLayoutType.FlowHorizontal) {
              if (this._columnCount > 0) this._curLineItemCount = this._columnCount;else {
                this._curLineItemCount = Math.floor((this._scrollPane.viewWidth + this._columnGap) / (this._itemSize.width + this._columnGap));
                if (this._curLineItemCount <= 0) this._curLineItemCount = 1;
              }
            } else if (this._layout == ListLayoutType.FlowVertical) {
              if (this._lineCount > 0) this._curLineItemCount = this._lineCount;else {
                this._curLineItemCount = Math.floor((this._scrollPane.viewHeight + this._lineGap) / (this._itemSize.height + this._lineGap));
                if (this._curLineItemCount <= 0) this._curLineItemCount = 1;
              }
            } else
              //pagination
              {
                if (this._columnCount > 0) this._curLineItemCount = this._columnCount;else {
                  this._curLineItemCount = Math.floor((this._scrollPane.viewWidth + this._columnGap) / (this._itemSize.width + this._columnGap));
                  if (this._curLineItemCount <= 0) this._curLineItemCount = 1;
                }
                if (this._lineCount > 0) this._curLineItemCount2 = this._lineCount;else {
                  this._curLineItemCount2 = Math.floor((this._scrollPane.viewHeight + this._lineGap) / (this._itemSize.height + this._lineGap));
                  if (this._curLineItemCount2 <= 0) this._curLineItemCount2 = 1;
                }
              }
          }
          var ch = 0,
            cw = 0;
          if (this._realNumItems > 0) {
            var i;
            var len = Math.ceil(this._realNumItems / this._curLineItemCount) * this._curLineItemCount;
            var len2 = Math.min(this._curLineItemCount, this._realNumItems);
            if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
              for (i = 0; i < len; i += this._curLineItemCount) ch += this._virtualItems[i].height + this._lineGap;
              if (ch > 0) ch -= this._lineGap;
              if (this._autoResizeItem) cw = this._scrollPane.viewWidth;else {
                for (i = 0; i < len2; i++) cw += this._virtualItems[i].width + this._columnGap;
                if (cw > 0) cw -= this._columnGap;
              }
            } else if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowVertical) {
              for (i = 0; i < len; i += this._curLineItemCount) cw += this._virtualItems[i].width + this._columnGap;
              if (cw > 0) cw -= this._columnGap;
              if (this._autoResizeItem) ch = this._scrollPane.viewHeight;else {
                for (i = 0; i < len2; i++) ch += this._virtualItems[i].height + this._lineGap;
                if (ch > 0) ch -= this._lineGap;
              }
            } else {
              var pageCount = Math.ceil(len / (this._curLineItemCount * this._curLineItemCount2));
              cw = pageCount * this.viewWidth;
              ch = this.viewHeight;
            }
          }
          this.handleAlign(cw, ch);
          this._scrollPane.setContentSize(cw, ch);
          this._eventLocked = false;
          this.handleScroll(true);
        };
        _proto57.__scrolled = function __scrolled(evt) {
          this.handleScroll(false);
        };
        _proto57.getIndexOnPos1 = function getIndexOnPos1(forceUpdate) {
          if (this._realNumItems < this._curLineItemCount) {
            s_n = 0;
            return 0;
          }
          var i;
          var pos2;
          var pos3;
          if (this.numChildren > 0 && !forceUpdate) {
            pos2 = this.getChildAt(0).y;
            if (pos2 > s_n) {
              for (i = this._firstIndex - this._curLineItemCount; i >= 0; i -= this._curLineItemCount) {
                pos2 -= this._virtualItems[i].height + this._lineGap;
                if (pos2 <= s_n) {
                  s_n = pos2;
                  return i;
                }
              }
              s_n = 0;
              return 0;
            } else {
              for (i = this._firstIndex; i < this._realNumItems; i += this._curLineItemCount) {
                pos3 = pos2 + this._virtualItems[i].height + this._lineGap;
                if (pos3 > s_n) {
                  s_n = pos2;
                  return i;
                }
                pos2 = pos3;
              }
              s_n = pos2;
              return this._realNumItems - this._curLineItemCount;
            }
          } else {
            pos2 = 0;
            for (i = 0; i < this._realNumItems; i += this._curLineItemCount) {
              pos3 = pos2 + this._virtualItems[i].height + this._lineGap;
              if (pos3 > s_n) {
                s_n = pos2;
                return i;
              }
              pos2 = pos3;
            }
            s_n = pos2;
            return this._realNumItems - this._curLineItemCount;
          }
        };
        _proto57.getIndexOnPos2 = function getIndexOnPos2(forceUpdate) {
          if (this._realNumItems < this._curLineItemCount) {
            s_n = 0;
            return 0;
          }
          var i;
          var pos2;
          var pos3;
          if (this.numChildren > 0 && !forceUpdate) {
            pos2 = this.getChildAt(0).x;
            if (pos2 > s_n) {
              for (i = this._firstIndex - this._curLineItemCount; i >= 0; i -= this._curLineItemCount) {
                pos2 -= this._virtualItems[i].width + this._columnGap;
                if (pos2 <= s_n) {
                  s_n = pos2;
                  return i;
                }
              }
              s_n = 0;
              return 0;
            } else {
              for (i = this._firstIndex; i < this._realNumItems; i += this._curLineItemCount) {
                pos3 = pos2 + this._virtualItems[i].width + this._columnGap;
                if (pos3 > s_n) {
                  s_n = pos2;
                  return i;
                }
                pos2 = pos3;
              }
              s_n = pos2;
              return this._realNumItems - this._curLineItemCount;
            }
          } else {
            pos2 = 0;
            for (i = 0; i < this._realNumItems; i += this._curLineItemCount) {
              pos3 = pos2 + this._virtualItems[i].width + this._columnGap;
              if (pos3 > s_n) {
                s_n = pos2;
                return i;
              }
              pos2 = pos3;
            }
            s_n = pos2;
            return this._realNumItems - this._curLineItemCount;
          }
        };
        _proto57.getIndexOnPos3 = function getIndexOnPos3(forceUpdate) {
          if (this._realNumItems < this._curLineItemCount) {
            s_n = 0;
            return 0;
          }
          var viewWidth = this.viewWidth;
          var page = Math.floor(s_n / viewWidth);
          var startIndex = page * (this._curLineItemCount * this._curLineItemCount2);
          var pos2 = page * viewWidth;
          var i;
          var pos3;
          for (i = 0; i < this._curLineItemCount; i++) {
            pos3 = pos2 + this._virtualItems[startIndex + i].width + this._columnGap;
            if (pos3 > s_n) {
              s_n = pos2;
              return startIndex + i;
            }
            pos2 = pos3;
          }
          s_n = pos2;
          return startIndex + this._curLineItemCount - 1;
        };
        _proto57.handleScroll = function handleScroll(forceUpdate) {
          if (this._eventLocked) return;
          if (this._layout == ListLayoutType.SingleColumn || this._layout == ListLayoutType.FlowHorizontal) {
            var enterCounter = 0;
            while (this.handleScroll1(forceUpdate)) {
              enterCounter++;
              forceUpdate = false;
              if (enterCounter > 20) {
                console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");
                break;
              }
            }
            this.handleArchOrder1();
          } else if (this._layout == ListLayoutType.SingleRow || this._layout == ListLayoutType.FlowVertical) {
            enterCounter = 0;
            while (this.handleScroll2(forceUpdate)) {
              enterCounter++;
              forceUpdate = false;
              if (enterCounter > 20) {
                console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");
                break;
              }
            }
            this.handleArchOrder2();
          } else {
            this.handleScroll3(forceUpdate);
          }
          this._boundsChanged = false;
        };
        _proto57.handleScroll1 = function handleScroll1(forceUpdate) {
          var pos = this._scrollPane.scrollingPosY;
          var max = pos + this._scrollPane.viewHeight;
          var end = max == this._scrollPane.contentHeight; //
          //
          s_n = pos;
          var newFirstIndex = this.getIndexOnPos1(forceUpdate);
          pos = s_n;
          if (newFirstIndex == this._firstIndex && !forceUpdate) {
            return false;
          }
          var oldFirstIndex = this._firstIndex;
          this._firstIndex = newFirstIndex;
          var curIndex = newFirstIndex;
          var forward = oldFirstIndex > newFirstIndex;
          var childCount = this.numChildren;
          var lastIndex = oldFirstIndex + childCount - 1;
          var reuseIndex = forward ? lastIndex : oldFirstIndex;
          var curX = 0,
            curY = pos;
          var needRender;
          var deltaSize = 0;
          var firstItemDeltaSize = 0;
          var url = this._defaultItem;
          var ii, ii2;
          var i, j;
          var partSize = (this._scrollPane.viewWidth - this._columnGap * (this._curLineItemCount - 1)) / this._curLineItemCount;
          this.itemInfoVer++;
          while (curIndex < this._realNumItems && (end || curY < max)) {
            ii = this._virtualItems[curIndex];
            if (!ii.obj || forceUpdate) {
              if (this.itemProvider != null) {
                url = this.itemProvider(curIndex % this._numItems);
                if (url == null) url = this._defaultItem;
                url = UIPackage.normalizeURL(url);
              }
              if (ii.obj && ii.obj.resourceURL != url) {
                if (ii.obj instanceof GButton) ii.selected = ii.obj.selected;
                this.removeChildToPool(ii.obj);
                ii.obj = null;
              }
            }
            if (!ii.obj) {
              //itemrenderitem
              if (forward) {
                for (j = reuseIndex; j >= oldFirstIndex; j--) {
                  ii2 = this._virtualItems[j];
                  if (ii2.obj && ii2.updateFlag != this.itemInfoVer && ii2.obj.resourceURL == url) {
                    if (ii2.obj instanceof GButton) ii2.selected = ii2.obj.selected;
                    ii.obj = ii2.obj;
                    ii2.obj = null;
                    if (j == reuseIndex) reuseIndex--;
                    break;
                  }
                }
              } else {
                for (j = reuseIndex; j <= lastIndex; j++) {
                  ii2 = this._virtualItems[j];
                  if (ii2.obj && ii2.updateFlag != this.itemInfoVer && ii2.obj.resourceURL == url) {
                    if (ii2.obj instanceof GButton) ii2.selected = ii2.obj.selected;
                    ii.obj = ii2.obj;
                    ii2.obj = null;
                    if (j == reuseIndex) reuseIndex++;
                    break;
                  }
                }
              }
              if (ii.obj) {
                this.setChildIndex(ii.obj, forward ? curIndex - newFirstIndex : this.numChildren);
              } else {
                ii.obj = this._pool.getObject(url);
                if (forward) this.addChildAt(ii.obj, curIndex - newFirstIndex);else this.addChild(ii.obj);
              }
              if (ii.obj instanceof GButton) ii.obj.selected = ii.selected;
              needRender = true;
            } else needRender = forceUpdate;
            if (needRender) {
              if (this._autoResizeItem && (this._layout == ListLayoutType.SingleColumn || this._columnCount > 0)) ii.obj.setSize(partSize, ii.obj.height, true);
              this.itemRenderer(curIndex % this._numItems, ii.obj);
              if (curIndex % this._curLineItemCount == 0) {
                deltaSize += Math.ceil(ii.obj.height) - ii.height;
                if (curIndex == newFirstIndex && oldFirstIndex > newFirstIndex) {
                  //
                  firstItemDeltaSize = Math.ceil(ii.obj.height) - ii.height;
                }
              }
              ii.width = Math.ceil(ii.obj.width);
              ii.height = Math.ceil(ii.obj.height);
            }
            ii.updateFlag = this.itemInfoVer;
            ii.obj.setPosition(curX, curY);
            if (curIndex == newFirstIndex)
              //
              max += ii.height;
            curX += ii.width + this._columnGap;
            if (curIndex % this._curLineItemCount == this._curLineItemCount - 1) {
              curX = 0;
              curY += ii.height + this._lineGap;
            }
            curIndex++;
          }
          for (i = 0; i < childCount; i++) {
            ii = this._virtualItems[oldFirstIndex + i];
            if (ii.updateFlag != this.itemInfoVer && ii.obj) {
              if (ii.obj instanceof GButton) ii.selected = ii.obj.selected;
              this.removeChildToPool(ii.obj);
              ii.obj = null;
            }
          }
          childCount = this._children.length;
          for (i = 0; i < childCount; i++) {
            var obj = this._virtualItems[newFirstIndex + i].obj;
            if (this._children[i] != obj) this.setChildIndex(obj, i);
          }
          if (deltaSize != 0 || firstItemDeltaSize != 0) this._scrollPane.changeContentSizeOnScrolling(0, deltaSize, 0, firstItemDeltaSize);
          if (curIndex > 0 && this.numChildren > 0 && this._container.position.y <= 0 && this.getChildAt(0).y > -this._container.position.y)
            //
            return true;else return false;
        };
        _proto57.handleScroll2 = function handleScroll2(forceUpdate) {
          var pos = this._scrollPane.scrollingPosX;
          var max = pos + this._scrollPane.viewWidth;
          var end = pos == this._scrollPane.contentWidth; //
          //
          s_n = pos;
          var newFirstIndex = this.getIndexOnPos2(forceUpdate);
          pos = s_n;
          if (newFirstIndex == this._firstIndex && !forceUpdate) {
            return false;
          }
          var oldFirstIndex = this._firstIndex;
          this._firstIndex = newFirstIndex;
          var curIndex = newFirstIndex;
          var forward = oldFirstIndex > newFirstIndex;
          var childCount = this.numChildren;
          var lastIndex = oldFirstIndex + childCount - 1;
          var reuseIndex = forward ? lastIndex : oldFirstIndex;
          var curX = pos,
            curY = 0;
          var needRender;
          var deltaSize = 0;
          var firstItemDeltaSize = 0;
          var url = this._defaultItem;
          var ii, ii2;
          var i, j;
          var partSize = (this._scrollPane.viewHeight - this._lineGap * (this._curLineItemCount - 1)) / this._curLineItemCount;
          this.itemInfoVer++;
          while (curIndex < this._realNumItems && (end || curX < max)) {
            ii = this._virtualItems[curIndex];
            if (!ii.obj || forceUpdate) {
              if (this.itemProvider != null) {
                url = this.itemProvider(curIndex % this._numItems);
                if (url == null) url = this._defaultItem;
                url = UIPackage.normalizeURL(url);
              }
              if (ii.obj && ii.obj.resourceURL != url) {
                if (ii.obj instanceof GButton) ii.selected = ii.obj.selected;
                this.removeChildToPool(ii.obj);
                ii.obj = null;
              }
            }
            if (!ii.obj) {
              if (forward) {
                for (j = reuseIndex; j >= oldFirstIndex; j--) {
                  ii2 = this._virtualItems[j];
                  if (ii2.obj && ii2.updateFlag != this.itemInfoVer && ii2.obj.resourceURL == url) {
                    if (ii2.obj instanceof GButton) ii2.selected = ii2.obj.selected;
                    ii.obj = ii2.obj;
                    ii2.obj = null;
                    if (j == reuseIndex) reuseIndex--;
                    break;
                  }
                }
              } else {
                for (j = reuseIndex; j <= lastIndex; j++) {
                  ii2 = this._virtualItems[j];
                  if (ii2.obj && ii2.updateFlag != this.itemInfoVer && ii2.obj.resourceURL == url) {
                    if (ii2.obj instanceof GButton) ii2.selected = ii2.obj.selected;
                    ii.obj = ii2.obj;
                    ii2.obj = null;
                    if (j == reuseIndex) reuseIndex++;
                    break;
                  }
                }
              }
              if (ii.obj) {
                this.setChildIndex(ii.obj, forward ? curIndex - newFirstIndex : this.numChildren);
              } else {
                ii.obj = this._pool.getObject(url);
                if (forward) this.addChildAt(ii.obj, curIndex - newFirstIndex);else this.addChild(ii.obj);
              }
              if (ii.obj instanceof GButton) ii.obj.selected = ii.selected;
              needRender = true;
            } else needRender = forceUpdate;
            if (needRender) {
              if (this._autoResizeItem && (this._layout == ListLayoutType.SingleRow || this._lineCount > 0)) ii.obj.setSize(ii.obj.width, partSize, true);
              this.itemRenderer(curIndex % this._numItems, ii.obj);
              if (curIndex % this._curLineItemCount == 0) {
                deltaSize += Math.ceil(ii.obj.width) - ii.width;
                if (curIndex == newFirstIndex && oldFirstIndex > newFirstIndex) {
                  //
                  firstItemDeltaSize = Math.ceil(ii.obj.width) - ii.width;
                }
              }
              ii.width = Math.ceil(ii.obj.width);
              ii.height = Math.ceil(ii.obj.height);
            }
            ii.updateFlag = this.itemInfoVer;
            ii.obj.setPosition(curX, curY);
            if (curIndex == newFirstIndex)
              //
              max += ii.width;
            curY += ii.height + this._lineGap;
            if (curIndex % this._curLineItemCount == this._curLineItemCount - 1) {
              curY = 0;
              curX += ii.width + this._columnGap;
            }
            curIndex++;
          }
          for (i = 0; i < childCount; i++) {
            ii = this._virtualItems[oldFirstIndex + i];
            if (ii.updateFlag != this.itemInfoVer && ii.obj) {
              if (ii.obj instanceof GButton) ii.selected = ii.obj.selected;
              this.removeChildToPool(ii.obj);
              ii.obj = null;
            }
          }
          childCount = this._children.length;
          for (i = 0; i < childCount; i++) {
            var obj = this._virtualItems[newFirstIndex + i].obj;
            if (this._children[i] != obj) this.setChildIndex(obj, i);
          }
          if (deltaSize != 0 || firstItemDeltaSize != 0) this._scrollPane.changeContentSizeOnScrolling(deltaSize, 0, firstItemDeltaSize, 0);
          if (curIndex > 0 && this.numChildren > 0 && this._container.position.x <= 0 && this.getChildAt(0).x > -this._container.position.x)
            //
            return true;else return false;
        };
        _proto57.handleScroll3 = function handleScroll3(forceUpdate) {
          var pos = this._scrollPane.scrollingPosX; //
          s_n = pos;
          var newFirstIndex = this.getIndexOnPos3(forceUpdate);
          pos = s_n;
          if (newFirstIndex == this._firstIndex && !forceUpdate) return;
          var oldFirstIndex = this._firstIndex;
          this._firstIndex = newFirstIndex; //
          var reuseIndex = oldFirstIndex;
          var virtualItemCount = this._virtualItems.length;
          var pageSize = this._curLineItemCount * this._curLineItemCount2;
          var startCol = newFirstIndex % this._curLineItemCount;
          var viewWidth = this.viewWidth;
          var page = Math.floor(newFirstIndex / pageSize);
          var startIndex = page * pageSize;
          var lastIndex = startIndex + pageSize * 2; //
          var needRender;
          var i;
          var ii, ii2;
          var col;
          var url = this._defaultItem;
          var partWidth = (this._scrollPane.viewWidth - this._columnGap * (this._curLineItemCount - 1)) / this._curLineItemCount;
          var partHeight = (this._scrollPane.viewHeight - this._lineGap * (this._curLineItemCount2 - 1)) / this._curLineItemCount2;
          this.itemInfoVer++; //
          for (i = startIndex; i < lastIndex; i++) {
            if (i >= this._realNumItems) continue;
            col = i % this._curLineItemCount;
            if (i - startIndex < pageSize) {
              if (col < startCol) continue;
            } else {
              if (col > startCol) continue;
            }
            ii = this._virtualItems[i];
            ii.updateFlag = this.itemInfoVer;
          }
          var lastObj = null;
          var insertIndex = 0;
          for (i = startIndex; i < lastIndex; i++) {
            if (i >= this._realNumItems) continue;
            ii = this._virtualItems[i];
            if (ii.updateFlag != this.itemInfoVer) continue;
            if (!ii.obj) {
              //
              while (reuseIndex < virtualItemCount) {
                ii2 = this._virtualItems[reuseIndex];
                if (ii2.obj && ii2.updateFlag != this.itemInfoVer) {
                  if (ii2.obj instanceof GButton) ii2.selected = ii2.obj.selected;
                  ii.obj = ii2.obj;
                  ii2.obj = null;
                  break;
                }
                reuseIndex++;
              }
              if (insertIndex == -1) insertIndex = this.getChildIndex(lastObj) + 1;
              if (!ii.obj) {
                if (this.itemProvider != null) {
                  url = this.itemProvider(i % this._numItems);
                  if (url == null) url = this._defaultItem;
                  url = UIPackage.normalizeURL(url);
                }
                ii.obj = this._pool.getObject(url);
                this.addChildAt(ii.obj, insertIndex);
              } else {
                insertIndex = this.setChildIndexBefore(ii.obj, insertIndex);
              }
              insertIndex++;
              if (ii.obj instanceof GButton) ii.obj.selected = ii.selected;
              needRender = true;
            } else {
              needRender = forceUpdate;
              insertIndex = -1;
              lastObj = ii.obj;
            }
            if (needRender) {
              if (this._autoResizeItem) {
                if (this._curLineItemCount == this._columnCount && this._curLineItemCount2 == this._lineCount) ii.obj.setSize(partWidth, partHeight, true);else if (this._curLineItemCount == this._columnCount) ii.obj.setSize(partWidth, ii.obj.height, true);else if (this._curLineItemCount2 == this._lineCount) ii.obj.setSize(ii.obj.width, partHeight, true);
              }
              this.itemRenderer(i % this._numItems, ii.obj);
              ii.width = Math.ceil(ii.obj.width);
              ii.height = Math.ceil(ii.obj.height);
            }
          } //item
          var borderX = startIndex / pageSize * viewWidth;
          var xx = borderX;
          var yy = 0;
          var lineHeight = 0;
          for (i = startIndex; i < lastIndex; i++) {
            if (i >= this._realNumItems) continue;
            ii = this._virtualItems[i];
            if (ii.updateFlag == this.itemInfoVer) ii.obj.setPosition(xx, yy);
            if (ii.height > lineHeight) lineHeight = ii.height;
            if (i % this._curLineItemCount == this._curLineItemCount - 1) {
              xx = borderX;
              yy += lineHeight + this._lineGap;
              lineHeight = 0;
              if (i == startIndex + pageSize - 1) {
                borderX += viewWidth;
                xx = borderX;
                yy = 0;
              }
            } else xx += ii.width + this._columnGap;
          } //
          for (i = reuseIndex; i < virtualItemCount; i++) {
            ii = this._virtualItems[i];
            if (ii.updateFlag != this.itemInfoVer && ii.obj) {
              if (ii.obj instanceof GButton) ii.selected = ii.obj.selected;
              this.removeChildToPool(ii.obj);
              ii.obj = null;
            }
          }
        };
        _proto57.handleArchOrder1 = function handleArchOrder1() {
          if (this._childrenRenderOrder == ChildrenRenderOrder.Arch) {
            var mid = this._scrollPane.posY + this.viewHeight / 2;
            var minDist = Number.POSITIVE_INFINITY;
            var dist = 0;
            var apexIndex = 0;
            var cnt = this.numChildren;
            for (var i = 0; i < cnt; i++) {
              var obj = this.getChildAt(i);
              if (!this.foldInvisibleItems || obj.visible) {
                dist = Math.abs(mid - obj.y - obj.height / 2);
                if (dist < minDist) {
                  minDist = dist;
                  apexIndex = i;
                }
              }
            }
            this.apexIndex = apexIndex;
          }
        };
        _proto57.handleArchOrder2 = function handleArchOrder2() {
          if (this._childrenRenderOrder == ChildrenRenderOrder.Arch) {
            var mid = this._scrollPane.posX + this.viewWidth / 2;
            var minDist = Number.POSITIVE_INFINITY;
            var dist = 0;
            var apexIndex = 0;
            var cnt = this.numChildren;
            for (var i = 0; i < cnt; i++) {
              var obj = this.getChildAt(i);
              if (!this.foldInvisibleItems || obj.visible) {
                dist = Math.abs(mid - obj.x - obj.width / 2);
                if (dist < minDist) {
                  minDist = dist;
                  apexIndex = i;
                }
              }
            }
            this.apexIndex = apexIndex;
          }
        };
        _proto57.handleAlign = function handleAlign(contentWidth, contentHeight) {
          var newOffsetX = 0;
          var newOffsetY = 0;
          if (contentHeight < this.viewHeight) {
            if (this._verticalAlign == VertAlignType.Middle) newOffsetY = Math.floor((this.viewHeight - contentHeight) / 2);else if (this._verticalAlign == VertAlignType.Bottom) newOffsetY = this.viewHeight - contentHeight;
          }
          if (contentWidth < this.viewWidth) {
            if (this._align == AlignType.Center) newOffsetX = Math.floor((this.viewWidth - contentWidth) / 2);else if (this._align == AlignType.Right) newOffsetX = this.viewWidth - contentWidth;
          }
          if (newOffsetX != this._alignOffset.x || newOffsetY != this._alignOffset.y) {
            this._alignOffset.x = newOffsetX;
            this._alignOffset.y = newOffsetY;
            if (this._scrollPane) this._scrollPane.adjustMaskContainer();else this._container.setPosition(this._pivotCorrectX + this._alignOffset.x, this._pivotCorrectY - this._alignOffset.y);
          }
        };
        _proto57.updateBounds = function updateBounds() {
          if (this._virtual) return;
          var i;
          var child;
          var curX = 0;
          var curY = 0;
          var maxWidth = 0;
          var maxHeight = 0;
          var cw = 0,
            ch = 0;
          var j = 0;
          var page = 0;
          var k = 0;
          var cnt = this._children.length;
          var viewWidth = this.viewWidth;
          var viewHeight = this.viewHeight;
          var lineSize = 0;
          var lineStart = 0;
          var ratio = 0;
          if (this._layout == ListLayoutType.SingleColumn) {
            for (i = 0; i < cnt; i++) {
              child = this.getChildAt(i);
              if (this.foldInvisibleItems && !child.visible) continue;
              if (curY != 0) curY += this._lineGap;
              child.y = curY;
              if (this._autoResizeItem) child.setSize(viewWidth, child.height, true);
              curY += Math.ceil(child.height);
              if (child.width > maxWidth) maxWidth = child.width;
            }
            ch = curY;
            if (ch <= viewHeight && this._autoResizeItem && this._scrollPane && this._scrollPane._displayInDemand && this._scrollPane.vtScrollBar) {
              viewWidth += this._scrollPane.vtScrollBar.width;
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                child.setSize(viewWidth, child.height, true);
                if (child.width > maxWidth) maxWidth = child.width;
              }
            }
            cw = Math.ceil(maxWidth);
          } else if (this._layout == ListLayoutType.SingleRow) {
            for (i = 0; i < cnt; i++) {
              child = this.getChildAt(i);
              if (this.foldInvisibleItems && !child.visible) continue;
              if (curX != 0) curX += this._columnGap;
              child.x = curX;
              if (this._autoResizeItem) child.setSize(child.width, viewHeight, true);
              curX += Math.ceil(child.width);
              if (child.height > maxHeight) maxHeight = child.height;
            }
            cw = curX;
            if (cw <= viewWidth && this._autoResizeItem && this._scrollPane && this._scrollPane._displayInDemand && this._scrollPane.hzScrollBar) {
              viewHeight += this._scrollPane.hzScrollBar.height;
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                child.setSize(child.width, viewHeight, true);
                if (child.height > maxHeight) maxHeight = child.height;
              }
            }
            ch = Math.ceil(maxHeight);
          } else if (this._layout == ListLayoutType.FlowHorizontal) {
            if (this._autoResizeItem && this._columnCount > 0) {
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                lineSize += child.sourceWidth;
                j++;
                if (j == this._columnCount || i == cnt - 1) {
                  ratio = (viewWidth - lineSize - (j - 1) * this._columnGap) / lineSize;
                  curX = 0;
                  for (j = lineStart; j <= i; j++) {
                    child = this.getChildAt(j);
                    if (this.foldInvisibleItems && !child.visible) continue;
                    child.setPosition(curX, curY);
                    if (j < i) {
                      child.setSize(child.sourceWidth + Math.round(child.sourceWidth * ratio), child.height, true);
                      curX += Math.ceil(child.width) + this._columnGap;
                    } else {
                      child.setSize(viewWidth - curX, child.height, true);
                    }
                    if (child.height > maxHeight) maxHeight = child.height;
                  } //new line
                  curY += Math.ceil(maxHeight) + this._lineGap;
                  maxHeight = 0;
                  j = 0;
                  lineStart = i + 1;
                  lineSize = 0;
                }
              }
              ch = curY + Math.ceil(maxHeight);
              cw = viewWidth;
            } else {
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                if (curX != 0) curX += this._columnGap;
                if (this._columnCount != 0 && j >= this._columnCount || this._columnCount == 0 && curX + child.width > viewWidth && maxHeight != 0) {
                  //new line
                  curX = 0;
                  curY += Math.ceil(maxHeight) + this._lineGap;
                  maxHeight = 0;
                  j = 0;
                }
                child.setPosition(curX, curY);
                curX += Math.ceil(child.width);
                if (curX > maxWidth) maxWidth = curX;
                if (child.height > maxHeight) maxHeight = child.height;
                j++;
              }
              ch = curY + Math.ceil(maxHeight);
              cw = Math.ceil(maxWidth);
            }
          } else if (this._layout == ListLayoutType.FlowVertical) {
            if (this._autoResizeItem && this._lineCount > 0) {
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                lineSize += child.sourceHeight;
                j++;
                if (j == this._lineCount || i == cnt - 1) {
                  ratio = (viewHeight - lineSize - (j - 1) * this._lineGap) / lineSize;
                  curY = 0;
                  for (j = lineStart; j <= i; j++) {
                    child = this.getChildAt(j);
                    if (this.foldInvisibleItems && !child.visible) continue;
                    child.setPosition(curX, curY);
                    if (j < i) {
                      child.setSize(child.width, child.sourceHeight + Math.round(child.sourceHeight * ratio), true);
                      curY += Math.ceil(child.height) + this._lineGap;
                    } else {
                      child.setSize(child.width, viewHeight - curY, true);
                    }
                    if (child.width > maxWidth) maxWidth = child.width;
                  } //new line
                  curX += Math.ceil(maxWidth) + this._columnGap;
                  maxWidth = 0;
                  j = 0;
                  lineStart = i + 1;
                  lineSize = 0;
                }
              }
              cw = curX + Math.ceil(maxWidth);
              ch = viewHeight;
            } else {
              for (i = 0; i < cnt; i++) {
                child = this.getChildAt(i);
                if (this.foldInvisibleItems && !child.visible) continue;
                if (curY != 0) curY += this._lineGap;
                if (this._lineCount != 0 && j >= this._lineCount || this._lineCount == 0 && curY + child.height > viewHeight && maxWidth != 0) {
                  curY = 0;
                  curX += Math.ceil(maxWidth) + this._columnGap;
                  maxWidth = 0;
                  j = 0;
                }
                child.setPosition(curX, curY);
                curY += Math.ceil(child.height);
                if (curY > maxHeight) maxHeight = curY;
                if (child.width > maxWidth) maxWidth = child.width;
                j++;
              }
              cw = curX + Math.ceil(maxWidth);
              ch = Math.ceil(maxHeight);
            }
          } else
            //pagination
            {
              var eachHeight;
              if (this._autoResizeItem && this._lineCount > 0) eachHeight = Math.floor((viewHeight - (this._lineCount - 1) * this._lineGap) / this._lineCount);
              if (this._autoResizeItem && this._columnCount > 0) {
                for (i = 0; i < cnt; i++) {
                  child = this.getChildAt(i);
                  if (this.foldInvisibleItems && !child.visible) continue;
                  if (j == 0 && (this._lineCount != 0 && k >= this._lineCount || this._lineCount == 0 && curY + (this._lineCount > 0 ? eachHeight : child.height) > viewHeight)) {
                    //new page
                    page++;
                    curY = 0;
                    k = 0;
                  }
                  lineSize += child.sourceWidth;
                  j++;
                  if (j == this._columnCount || i == cnt - 1) {
                    ratio = (viewWidth - lineSize - (j - 1) * this._columnGap) / lineSize;
                    curX = 0;
                    for (j = lineStart; j <= i; j++) {
                      child = this.getChildAt(j);
                      if (this.foldInvisibleItems && !child.visible) continue;
                      child.setPosition(page * viewWidth + curX, curY);
                      if (j < i) {
                        child.setSize(child.sourceWidth + Math.round(child.sourceWidth * ratio), this._lineCount > 0 ? eachHeight : child.height, true);
                        curX += Math.ceil(child.width) + this._columnGap;
                      } else {
                        child.setSize(viewWidth - curX, this._lineCount > 0 ? eachHeight : child.height, true);
                      }
                      if (child.height > maxHeight) maxHeight = child.height;
                    } //new line
                    curY += Math.ceil(maxHeight) + this._lineGap;
                    maxHeight = 0;
                    j = 0;
                    lineStart = i + 1;
                    lineSize = 0;
                    k++;
                  }
                }
              } else {
                for (i = 0; i < cnt; i++) {
                  child = this.getChildAt(i);
                  if (this.foldInvisibleItems && !child.visible) continue;
                  if (curX != 0) curX += this._columnGap;
                  if (this._autoResizeItem && this._lineCount > 0) child.setSize(child.width, eachHeight, true);
                  if (this._columnCount != 0 && j >= this._columnCount || this._columnCount == 0 && curX + child.width > viewWidth && maxHeight != 0) {
                    //new line
                    curX = 0;
                    curY += Math.ceil(maxHeight) + this._lineGap;
                    maxHeight = 0;
                    j = 0;
                    k++;
                    if (this._lineCount != 0 && k >= this._lineCount || this._lineCount == 0 && curY + child.height > viewHeight && maxWidth != 0)
                      //new page
                      {
                        page++;
                        curY = 0;
                        k = 0;
                      }
                  }
                  child.setPosition(page * viewWidth + curX, curY);
                  curX += Math.ceil(child.width);
                  if (curX > maxWidth) maxWidth = curX;
                  if (child.height > maxHeight) maxHeight = child.height;
                  j++;
                }
              }
              ch = page > 0 ? viewHeight : curY + Math.ceil(maxHeight);
              cw = (page + 1) * viewWidth;
            }
          this.handleAlign(cw, ch);
          this.setBounds(0, 0, cw, ch);
        };
        _proto57.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GComponent5.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 5);
          this._layout = buffer.readByte();
          this._selectionMode = buffer.readByte();
          this._align = buffer.readByte();
          this._verticalAlign = buffer.readByte();
          this._lineGap = buffer.readShort();
          this._columnGap = buffer.readShort();
          this._lineCount = buffer.readShort();
          this._columnCount = buffer.readShort();
          this._autoResizeItem = buffer.readBool();
          this._childrenRenderOrder = buffer.readByte();
          this._apexIndex = buffer.readShort();
          if (buffer.readBool()) {
            this._margin.top = buffer.readInt();
            this._margin.bottom = buffer.readInt();
            this._margin.left = buffer.readInt();
            this._margin.right = buffer.readInt();
          }
          var overflow = buffer.readByte();
          if (overflow == OverflowType.Scroll) {
            var savedPos = buffer.position;
            buffer.seek(beginPos, 7);
            this.setupScroll(buffer);
            buffer.position = savedPos;
          } else this.setupOverflow(overflow);
          if (overflow != OverflowType.Visible) {
            //  list
            this.node["sortRoot"] = true;
            this._container["sortRoot"] = true;
          }
          if (buffer.readBool())
            //clipSoftness
            buffer.skip(8);
          if (buffer.version >= 2) {
            this.scrollItemToViewOnClick = buffer.readBool();
            this.foldInvisibleItems = buffer.readBool();
          }
          buffer.seek(beginPos, 8);
          this._defaultItem = buffer.readS();
          this.readItems(buffer);
        };
        _proto57.readItems = function readItems(buffer) {
          var cnt;
          var i;
          var nextPos;
          var str;
          cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            str = buffer.readS();
            if (str == null) {
              str = this._defaultItem;
              if (!str) {
                buffer.position = nextPos;
                continue;
              }
            }
            var obj = this.getFromPool(str);
            if (obj) {
              this.addChild(obj);
              this.setupItem(buffer, obj);
            }
            buffer.position = nextPos;
          }
        };
        _proto57.setupItem = function setupItem(buffer, obj) {
          var str;
          str = buffer.readS();
          if (str != null) obj.text = str;
          str = buffer.readS();
          if (str != null && obj instanceof GButton) obj.selectedTitle = str;
          str = buffer.readS();
          if (str != null) obj.icon = str;
          str = buffer.readS();
          if (str != null && obj instanceof GButton) obj.selectedIcon = str;
          str = buffer.readS();
          if (str != null) obj.name = str;
          var cnt;
          var i;
          if (obj instanceof GComponent) {
            cnt = buffer.readShort();
            for (i = 0; i < cnt; i++) {
              var cc = obj.getController(buffer.readS());
              str = buffer.readS();
              if (cc) cc.selectedPageId = str;
            }
            if (buffer.version >= 2) {
              cnt = buffer.readShort();
              for (i = 0; i < cnt; i++) {
                var target = buffer.readS();
                var propertyId = buffer.readShort();
                var value = buffer.readS();
                var obj2 = obj.getChildByPath(target);
                if (obj2) obj2.setProp(propertyId, value);
              }
            }
          }
        };
        _proto57.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent5.prototype.setup_afterAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 6);
          var i = buffer.readShort();
          if (i != -1) this._selectionController = this.parent.getControllerAt(i);
        };
        _createClass(GList, [{
          key: "layout",
          get: function get() {
            return this._layout;
          },
          set: function set(value) {
            if (this._layout != value) {
              this._layout = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "lineCount",
          get: function get() {
            return this._lineCount;
          },
          set: function set(value) {
            if (this._lineCount != value) {
              this._lineCount = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "columnCount",
          get: function get() {
            return this._columnCount;
          },
          set: function set(value) {
            if (this._columnCount != value) {
              this._columnCount = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "lineGap",
          get: function get() {
            return this._lineGap;
          },
          set: function set(value) {
            if (this._lineGap != value) {
              this._lineGap = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "columnGap",
          get: function get() {
            return this._columnGap;
          },
          set: function set(value) {
            if (this._columnGap != value) {
              this._columnGap = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "align",
          get: function get() {
            return this._align;
          },
          set: function set(value) {
            if (this._align != value) {
              this._align = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "verticalAlign",
          get: function get() {
            return this._verticalAlign;
          },
          set: function set(value) {
            if (this._verticalAlign != value) {
              this._verticalAlign = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "virtualItemSize",
          get: function get() {
            return this._itemSize;
          },
          set: function set(value) {
            if (this._virtual) {
              if (this._itemSize == null) this._itemSize = new Size(0, 0);
              this._itemSize.width = value.width;
              this._itemSize.height = value.height;
              this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "defaultItem",
          get: function get() {
            return this._defaultItem;
          },
          set: function set(val) {
            this._defaultItem = UIPackage.normalizeURL(val);
          }
        }, {
          key: "autoResizeItem",
          get: function get() {
            return this._autoResizeItem;
          },
          set: function set(value) {
            if (this._autoResizeItem != value) {
              this._autoResizeItem = value;
              this.setBoundsChangedFlag();
              if (this._virtual) this.setVirtualListChangedFlag(true);
            }
          }
        }, {
          key: "selectionMode",
          get: function get() {
            return this._selectionMode;
          },
          set: function set(value) {
            this._selectionMode = value;
          }
        }, {
          key: "selectionController",
          get: function get() {
            return this._selectionController;
          },
          set: function set(value) {
            this._selectionController = value;
          }
        }, {
          key: "itemPool",
          get: function get() {
            return this._pool;
          }
        }, {
          key: "selectedIndex",
          get: function get() {
            var i;
            if (this._virtual) {
              for (i = 0; i < this._realNumItems; i++) {
                var ii = this._virtualItems[i];
                if (ii.obj instanceof GButton && ii.obj.selected || !ii.obj && ii.selected) {
                  if (this._loop) return i % this._numItems;else return i;
                }
              }
            } else {
              var cnt = this._children.length;
              for (i = 0; i < cnt; i++) {
                var obj = this._children[i];
                if (obj instanceof GButton && obj.selected) return i;
              }
            }
            return -1;
          },
          set: function set(value) {
            if (value >= 0 && value < this.numItems) {
              if (this._selectionMode != ListSelectionMode.Single) this.clearSelection();
              this.addSelection(value);
            } else this.clearSelection();
          }
        }, {
          key: "numItems",
          get: function get() {
            if (this._virtual) return this._numItems;else return this._children.length;
          },
          set: function set(value) {
            if (this._virtual) {
              if (this.itemRenderer == null) throw new Error("Set itemRenderer first!");
              this._numItems = value;
              if (this._loop) this._realNumItems = this._numItems * 6; //6
              else this._realNumItems = this._numItems; //_virtualItems
              var oldCount = this._virtualItems.length;
              if (this._realNumItems > oldCount) {
                for (i = oldCount; i < this._realNumItems; i++) {
                  var ii = {
                    width: this._itemSize.width,
                    height: this._itemSize.height,
                    updateFlag: 0
                  };
                  this._virtualItems.push(ii);
                }
              } else {
                for (i = this._realNumItems; i < oldCount; i++) this._virtualItems[i].selected = false;
              }
              if (this._virtualListChanged != 0) this._partner.unschedule(this._refreshVirtualList); //
              this._refreshVirtualList();
            } else {
              var cnt = this._children.length;
              if (value > cnt) {
                for (var i = cnt; i < value; i++) {
                  if (this.itemProvider == null) this.addItemFromPool();else this.addItemFromPool(this.itemProvider(i));
                }
              } else {
                this.removeChildrenToPool(value, cnt);
              }
              if (this.itemRenderer != null) {
                for (i = 0; i < value; i++) this.itemRenderer(i, this.getChildAt(i));
              }
            }
          }
        }]);
        return GList;
      }(GComponent));
      var s_n = 0;
      var GComboBox = exports('GComboBox', /*#__PURE__*/function (_GComponent6) {
        _inheritsLoose(GComboBox, _GComponent6);
        function GComboBox() {
          var _this32;
          _this32 = _GComponent6.call(this) || this;
          _this32._visibleItemCount = 0;
          _this32._selectedIndex = 0;
          _this32._popupDirection = PopupDirection.Auto;
          _this32._node.name = "GComboBox";
          _this32._visibleItemCount = UIConfig.defaultComboBoxVisibleItemCount;
          _this32._itemsUpdated = true;
          _this32._selectedIndex = -1;
          _this32._items = [];
          _this32._values = [];
          return _this32;
        }
        var _proto58 = GComboBox.prototype;
        _proto58.getTextField = function getTextField() {
          if (this._titleObject instanceof GTextField) return this._titleObject;else if ('getTextField' in this._titleObject) return this._titleObject.getTextField();else return null;
        };
        _proto58.setState = function setState(val) {
          if (this._buttonController) this._buttonController.selectedPage = val;
        };
        _proto58.getProp = function getProp(index) {
          switch (index) {
            case ObjectPropID.Color:
              return this.titleColor;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) return tf.strokeColor;else return 0;
              }
            case ObjectPropID.FontSize:
              {
                tf = this.getTextField();
                if (tf) return tf.fontSize;else return 0;
              }
            default:
              return _GComponent6.prototype.getProp.call(this, index);
          }
        };
        _proto58.setProp = function setProp(index, value) {
          switch (index) {
            case ObjectPropID.Color:
              this.titleColor = value;
              break;
            case ObjectPropID.OutlineColor:
              {
                var tf = this.getTextField();
                if (tf) tf.strokeColor = value;
              }
              break;
            case ObjectPropID.FontSize:
              {
                tf = this.getTextField();
                if (tf) tf.fontSize = value;
              }
              break;
            default:
              _GComponent6.prototype.setProp.call(this, index, value);
              break;
          }
        };
        _proto58.constructExtension = function constructExtension(buffer) {
          var str;
          this._buttonController = this.getController("button");
          this._titleObject = this.getChild("title");
          this._iconObject = this.getChild("icon");
          str = buffer.readS();
          if (str) {
            var obj = UIPackage.createObjectFromURL(str);
            if (!(obj instanceof GComponent)) {
              console.error("");
              return;
            }
            this.dropdown = obj;
            this.dropdown.name = "this.dropdown";
            this._list = this.dropdown.getChild("list", GList);
            if (this._list == null) {
              console.error(this.resourceURL + ": list");
              return;
            }
            this._list.on(Event.CLICK_ITEM, this.onClickItem, this);
            this._list.addRelation(this.dropdown, RelationType.Width);
            this._list.removeRelation(this.dropdown, RelationType.Height);
            this.dropdown.addRelation(this._list, RelationType.Height);
            this.dropdown.removeRelation(this._list, RelationType.Width);
            this.dropdown.on(Event.UNDISPLAY, this.onPopupClosed, this);
          }
          this._node.on(Event.TOUCH_BEGIN, this.onTouchBegin_1, this);
          this._node.on(Event.TOUCH_END, this.onTouchEnd_1, this);
          this._node.on(Event.ROLL_OVER, this.onRollOver_1, this);
          this._node.on(Event.ROLL_OUT, this.onRollOut_1, this);
        };
        _proto58.handleControllerChanged = function handleControllerChanged(c) {
          _GComponent6.prototype.handleControllerChanged.call(this, c);
          if (this._selectionController == c) this.selectedIndex = c.selectedIndex;
        };
        _proto58.updateSelectionController = function updateSelectionController() {
          if (this._selectionController && !this._selectionController.changing && this._selectedIndex < this._selectionController.pageCount) {
            var c = this._selectionController;
            this._selectionController = null;
            c.selectedIndex = this._selectedIndex;
            this._selectionController = c;
          }
        };
        _proto58.dispose = function dispose() {
          if (this.dropdown) {
            this.dropdown.dispose();
            this.dropdown = null;
          }
          _GComponent6.prototype.dispose.call(this);
        };
        _proto58.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent6.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!buffer.seek(beginPos, 6)) return;
          if (buffer.readByte() != this.packageItem.objectType) return;
          var i;
          var iv;
          var nextPos;
          var str;
          var itemCount = buffer.readShort();
          for (i = 0; i < itemCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            this._items[i] = buffer.readS();
            this._values[i] = buffer.readS();
            str = buffer.readS();
            if (str != null) {
              if (this._icons == null) this._icons = new Array();
              this._icons[i] = str;
            }
            buffer.position = nextPos;
          }
          str = buffer.readS();
          if (str != null) {
            this.text = str;
            this._selectedIndex = this._items.indexOf(str);
          } else if (this._items.length > 0) {
            this._selectedIndex = 0;
            this.text = this._items[0];
          } else this._selectedIndex = -1;
          str = buffer.readS();
          if (str != null) this.icon = str;
          if (buffer.readBool()) this.titleColor = buffer.readColor();
          iv = buffer.readInt();
          if (iv > 0) this._visibleItemCount = iv;
          this._popupDirection = buffer.readByte();
          iv = buffer.readShort();
          if (iv >= 0) this._selectionController = this.parent.getControllerAt(iv);
        };
        _proto58.showDropdown = function showDropdown() {
          if (this._itemsUpdated) {
            this._itemsUpdated = false;
            this._list.removeChildrenToPool();
            var cnt = this._items.length;
            for (var i = 0; i < cnt; i++) {
              var item = this._list.addItemFromPool();
              item.name = i < this._values.length ? this._values[i] : "";
              item.text = this._items[i];
              item.icon = this._icons && i < this._icons.length ? this._icons[i] : null;
            }
            this._list.resizeToFit(this._visibleItemCount);
          }
          this._list.selectedIndex = -1;
          this.dropdown.width = this.width;
          this._list.ensureBoundsCorrect();
          GRoot.inst.togglePopup(this.dropdown, this, this._popupDirection);
          if (this.dropdown.parent) this.setState(GButton.DOWN);
        };
        _proto58.onPopupClosed = function onPopupClosed() {
          if (this._over) this.setState(GButton.OVER);else this.setState(GButton.UP);
        };
        _proto58.onClickItem = function onClickItem(itemObject) {
          var _t = this;
          var index = this._list.getChildIndex(itemObject);
          this._partner.callLater(function (dt) {
            _t.onClickItem2(index);
          }, 0.1);
        };
        _proto58.onClickItem2 = function onClickItem2(index) {
          if (this.dropdown.parent instanceof GRoot) this.dropdown.parent.hidePopup();
          this._selectedIndex = -1;
          this.selectedIndex = index;
          this._node.emit(Event.STATUS_CHANGED, this);
        };
        _proto58.onRollOver_1 = function onRollOver_1() {
          this._over = true;
          if (this._down || this.dropdown && this.dropdown.parent) return;
          this.setState(GButton.OVER);
        };
        _proto58.onRollOut_1 = function onRollOut_1() {
          this._over = false;
          if (this._down || this.dropdown && this.dropdown.parent) return;
          this.setState(GButton.UP);
        };
        _proto58.onTouchBegin_1 = function onTouchBegin_1(evt) {
          if (evt.button != EventMouse.BUTTON_LEFT) return;
          if (evt.initiator instanceof GTextInput && evt.initiator.editable) return;
          this._down = true;
          evt.captureTouch();
          if (this.dropdown) this.showDropdown();
        };
        _proto58.onTouchEnd_1 = function onTouchEnd_1(evt) {
          if (evt.button != EventMouse.BUTTON_LEFT) return;
          if (this._down) {
            this._down = false;
            if (this.dropdown && !this.dropdown.parent) {
              if (this._over) this.setState(GButton.OVER);else this.setState(GButton.UP);
            }
          }
        };
        _createClass(GComboBox, [{
          key: "text",
          get: function get() {
            if (this._titleObject) return this._titleObject.text;else return null;
          },
          set: function set(value) {
            if (this._titleObject) this._titleObject.text = value;
            this.updateGear(6);
          }
        }, {
          key: "icon",
          get: function get() {
            if (this._iconObject) return this._iconObject.icon;else return null;
          },
          set: function set(value) {
            if (this._iconObject) this._iconObject.icon = value;
            this.updateGear(7);
          }
        }, {
          key: "titleColor",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.color;else return Color.BLACK;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.color = value;
          }
        }, {
          key: "titleFontSize",
          get: function get() {
            var tf = this.getTextField();
            if (tf) return tf.fontSize;else return 0;
          },
          set: function set(value) {
            var tf = this.getTextField();
            if (tf) tf.fontSize = value;
          }
        }, {
          key: "visibleItemCount",
          get: function get() {
            return this._visibleItemCount;
          },
          set: function set(value) {
            this._visibleItemCount = value;
          }
        }, {
          key: "popupDirection",
          get: function get() {
            return this._popupDirection;
          },
          set: function set(value) {
            this._popupDirection = value;
          }
        }, {
          key: "items",
          get: function get() {
            return this._items;
          },
          set: function set(value) {
            if (!value) this._items.length = 0;else this._items = value.concat();
            if (this._items.length > 0) {
              if (this._selectedIndex >= this._items.length) this._selectedIndex = this._items.length - 1;else if (this._selectedIndex == -1) this._selectedIndex = 0;
              this.text = this._items[this._selectedIndex];
              if (this._icons && this._selectedIndex < this._icons.length) this.icon = this._icons[this._selectedIndex];
            } else {
              this.text = "";
              if (this._icons) this.icon = null;
              this._selectedIndex = -1;
            }
            this._itemsUpdated = true;
          }
        }, {
          key: "icons",
          get: function get() {
            return this._icons;
          },
          set: function set(value) {
            this._icons = value;
            if (this._icons && this._selectedIndex != -1 && this._selectedIndex < this._icons.length) this.icon = this._icons[this._selectedIndex];
          }
        }, {
          key: "values",
          get: function get() {
            return this._values;
          },
          set: function set(value) {
            if (!value) this._values.length = 0;else this._values = value.concat();
          }
        }, {
          key: "selectedIndex",
          get: function get() {
            return this._selectedIndex;
          },
          set: function set(val) {
            if (this._selectedIndex == val) return;
            this._selectedIndex = val;
            if (this._selectedIndex >= 0 && this._selectedIndex < this._items.length) {
              this.text = this._items[this._selectedIndex];
              if (this._icons && this._selectedIndex < this._icons.length) this.icon = this._icons[this._selectedIndex];
            } else {
              this.text = "";
              if (this._icons) this.icon = null;
            }
            this.updateSelectionController();
          }
        }, {
          key: "value",
          get: function get() {
            return this._values[this._selectedIndex];
          },
          set: function set(val) {
            var index = this._values.indexOf(val);
            if (index == -1 && val == null) index = this._values.indexOf("");
            this.selectedIndex = index;
          }
        }, {
          key: "selectionController",
          get: function get() {
            return this._selectionController;
          },
          set: function set(value) {
            this._selectionController = value;
          }
        }]);
        return GComboBox;
      }(GComponent));
      var GSlider = exports('GSlider', /*#__PURE__*/function (_GComponent7) {
        _inheritsLoose(GSlider, _GComponent7);
        function GSlider() {
          var _this33;
          _this33 = _GComponent7.call(this) || this;
          _this33._min = 0;
          _this33._max = 0;
          _this33._value = 0;
          _this33._barMaxWidth = 0;
          _this33._barMaxHeight = 0;
          _this33._barMaxWidthDelta = 0;
          _this33._barMaxHeightDelta = 0;
          _this33._clickPercent = 0;
          _this33._barStartX = 0;
          _this33._barStartY = 0;
          _this33.changeOnClick = true;
          _this33.canDrag = true;
          _this33._node.name = "GSlider";
          _this33._titleType = ProgressTitleType.Percent;
          _this33._value = 50;
          _this33._max = 100;
          _this33._clickPos = new Vec2();
          return _this33;
        }
        var _proto59 = GSlider.prototype;
        _proto59.update = function update() {
          this.updateWithPercent((this._value - this._min) / (this._max - this._min));
        };
        _proto59.updateWithPercent = function updateWithPercent(percent, manual) {
          percent = math.clamp01(percent);
          if (manual) {
            var newValue = math.clamp(this._min + (this._max - this._min) * percent, this._min, this._max);
            if (this._wholeNumbers) {
              newValue = Math.round(newValue);
              percent = math.clamp01((newValue - this._min) / (this._max - this._min));
            }
            if (newValue != this._value) {
              this._value = newValue;
              this._node.emit(Event.STATUS_CHANGED, this);
            }
          }
          if (this._titleObject) {
            switch (this._titleType) {
              case ProgressTitleType.Percent:
                this._titleObject.text = Math.floor(percent * 100) + "%";
                break;
              case ProgressTitleType.ValueAndMax:
                this._titleObject.text = this._value + "/" + this._max;
                break;
              case ProgressTitleType.Value:
                this._titleObject.text = "" + this._value;
                break;
              case ProgressTitleType.Max:
                this._titleObject.text = "" + this._max;
                break;
            }
          }
          var fullWidth = this.width - this._barMaxWidthDelta;
          var fullHeight = this.height - this._barMaxHeightDelta;
          if (!this._reverse) {
            if (this._barObjectH) this._barObjectH.width = Math.round(fullWidth * percent);
            if (this._barObjectV) this._barObjectV.height = Math.round(fullHeight * percent);
          } else {
            if (this._barObjectH) {
              this._barObjectH.width = Math.round(fullWidth * percent);
              this._barObjectH.x = this._barStartX + (fullWidth - this._barObjectH.width);
            }
            if (this._barObjectV) {
              this._barObjectV.height = Math.round(fullHeight * percent);
              this._barObjectV.y = this._barStartY + (fullHeight - this._barObjectV.height);
            }
          }
        };
        _proto59.constructExtension = function constructExtension(buffer) {
          buffer.seek(0, 6);
          this._titleType = buffer.readByte();
          this._reverse = buffer.readBool();
          if (buffer.version >= 2) {
            this._wholeNumbers = buffer.readBool();
            this.changeOnClick = buffer.readBool();
          }
          this._titleObject = this.getChild("title");
          this._barObjectH = this.getChild("bar");
          this._barObjectV = this.getChild("bar_v");
          this._gripObject = this.getChild("grip");
          if (this._barObjectH) {
            this._barMaxWidth = this._barObjectH.width;
            this._barMaxWidthDelta = this.width - this._barMaxWidth;
            this._barStartX = this._barObjectH.x;
          }
          if (this._barObjectV) {
            this._barMaxHeight = this._barObjectV.height;
            this._barMaxHeightDelta = this.height - this._barMaxHeight;
            this._barStartY = this._barObjectV.y;
          }
          if (this._gripObject) {
            this._gripObject.on(Event.TOUCH_BEGIN, this.onGripTouchBegin, this);
            this._gripObject.on(Event.TOUCH_MOVE, this.onGripTouchMove, this);
          }
          this._node.on(Event.TOUCH_BEGIN, this.onBarTouchBegin, this);
        };
        _proto59.handleSizeChanged = function handleSizeChanged() {
          _GComponent7.prototype.handleSizeChanged.call(this);
          if (this._barObjectH) this._barMaxWidth = this.width - this._barMaxWidthDelta;
          if (this._barObjectV) this._barMaxHeight = this.height - this._barMaxHeightDelta;
          if (!this._underConstruct) this.update();
        };
        _proto59.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent7.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!buffer.seek(beginPos, 6)) {
            this.update();
            return;
          }
          if (buffer.readByte() != this.packageItem.objectType) {
            this.update();
            return;
          }
          this._value = buffer.readInt();
          this._max = buffer.readInt();
          if (buffer.version >= 2) this._min = buffer.readInt();
          this.update();
        };
        _proto59.onGripTouchBegin = function onGripTouchBegin(evt) {
          this.canDrag = true;
          evt.propagationStopped = true;
          evt.captureTouch();
          this._clickPos = this.globalToLocal(evt.pos.x, evt.pos.y);
          this._clickPercent = math.clamp01((this._value - this._min) / (this._max - this._min));
        };
        _proto59.onGripTouchMove = function onGripTouchMove(evt) {
          if (!this.canDrag) {
            return;
          }
          var pt = this.globalToLocal(evt.pos.x, evt.pos.y, s_vec2$1);
          var deltaX = pt.x - this._clickPos.x;
          var deltaY = pt.y - this._clickPos.y;
          if (this._reverse) {
            deltaX = -deltaX;
            deltaY = -deltaY;
          }
          var percent;
          if (this._barObjectH) percent = this._clickPercent + deltaX / this._barMaxWidth;else percent = this._clickPercent + deltaY / this._barMaxHeight;
          this.updateWithPercent(percent, true);
        };
        _proto59.onBarTouchBegin = function onBarTouchBegin(evt) {
          if (!this.changeOnClick) return;
          var pt = this._gripObject.globalToLocal(evt.pos.x, evt.pos.y, s_vec2$1);
          var percent = math.clamp01((this._value - this._min) / (this._max - this._min));
          var delta = 0;
          if (this._barObjectH != null) delta = (pt.x - this._gripObject.width / 2) / this._barMaxWidth;
          if (this._barObjectV != null) delta = (pt.y - this._gripObject.height / 2) / this._barMaxHeight;
          if (this._reverse) percent -= delta;else percent += delta;
          this.updateWithPercent(percent, true);
        };
        _createClass(GSlider, [{
          key: "titleType",
          get: function get() {
            return this._titleType;
          },
          set: function set(value) {
            this._titleType = value;
          }
        }, {
          key: "wholeNumbers",
          get: function get() {
            return this._wholeNumbers;
          },
          set: function set(value) {
            if (this._wholeNumbers != value) {
              this._wholeNumbers = value;
              this.update();
            }
          }
        }, {
          key: "min",
          get: function get() {
            return this._min;
          },
          set: function set(value) {
            if (this._min != value) {
              this._min = value;
              this.update();
            }
          }
        }, {
          key: "max",
          get: function get() {
            return this._max;
          },
          set: function set(value) {
            if (this._max != value) {
              this._max = value;
              this.update();
            }
          }
        }, {
          key: "value",
          get: function get() {
            return this._value;
          },
          set: function set(value) {
            if (this._value != value) {
              this._value = value;
              this.update();
            }
          }
        }]);
        return GSlider;
      }(GComponent));
      var s_vec2$1 = new Vec2();
      var GProgressBar = exports('GProgressBar', /*#__PURE__*/function (_GComponent8) {
        _inheritsLoose(GProgressBar, _GComponent8);
        function GProgressBar() {
          var _this34;
          _this34 = _GComponent8.call(this) || this;
          _this34._min = 0;
          _this34._max = 0;
          _this34._value = 0;
          _this34._barMaxWidth = 0;
          _this34._barMaxHeight = 0;
          _this34._barMaxWidthDelta = 0;
          _this34._barMaxHeightDelta = 0;
          _this34._barStartX = 0;
          _this34._barStartY = 0;
          _this34._node.name = "GProgressBar";
          _this34._titleType = ProgressTitleType.Percent;
          _this34._value = 50;
          _this34._max = 100;
          return _this34;
        }
        var _proto60 = GProgressBar.prototype;
        _proto60.tweenValue = function tweenValue(value, duration) {
          var oldValule;
          var tweener = GTween.getTween(this, this.update);
          if (tweener) {
            oldValule = tweener.value.x;
            tweener.kill();
          } else oldValule = this._value;
          this._value = value;
          return GTween.to(oldValule, this._value, duration).setTarget(this, this.update).setEase(EaseType.Linear);
        };
        _proto60.update = function update(newValue) {
          var percent = math.clamp01((newValue - this._min) / (this._max - this._min));
          if (this._titleObject) {
            switch (this._titleType) {
              case ProgressTitleType.Percent:
                this._titleObject.text = Math.floor(percent * 100) + "%";
                break;
              case ProgressTitleType.ValueAndMax:
                this._titleObject.text = Math.floor(newValue) + "/" + Math.floor(this._max);
                break;
              case ProgressTitleType.Value:
                this._titleObject.text = "" + Math.floor(newValue);
                break;
              case ProgressTitleType.Max:
                this._titleObject.text = "" + Math.floor(this._max);
                break;
            }
          }
          var fullWidth = this.width - this._barMaxWidthDelta;
          var fullHeight = this.height - this._barMaxHeightDelta;
          if (!this._reverse) {
            if (this._barObjectH) {
              if (!this.setFillAmount(this._barObjectH, percent)) this._barObjectH.width = Math.round(fullWidth * percent);
            }
            if (this._barObjectV) {
              if (!this.setFillAmount(this._barObjectV, percent)) this._barObjectV.height = Math.round(fullHeight * percent);
            }
          } else {
            if (this._barObjectH) {
              if (!this.setFillAmount(this._barObjectH, 1 - percent)) {
                this._barObjectH.width = Math.round(fullWidth * percent);
                this._barObjectH.x = this._barStartX + (fullWidth - this._barObjectH.width);
              }
            }
            if (this._barObjectV) {
              if (!this.setFillAmount(this._barObjectV, 1 - percent)) {
                this._barObjectV.height = Math.round(fullHeight * percent);
                this._barObjectV.y = this._barStartY + (fullHeight - this._barObjectV.height);
              }
            }
          }
          if (this._aniObject) this._aniObject.setProp(ObjectPropID.Frame, Math.floor(percent * 100));
        };
        _proto60.setFillAmount = function setFillAmount(bar, percent) {
          if ((bar instanceof GImage || bar instanceof GLoader) && bar.fillMethod != FillMethod.None) {
            bar.fillAmount = percent;
            return true;
          } else return false;
        };
        _proto60.constructExtension = function constructExtension(buffer) {
          buffer.seek(0, 6);
          this._titleType = buffer.readByte();
          this._reverse = buffer.readBool();
          this._titleObject = this.getChild("title");
          this._barObjectH = this.getChild("bar");
          this._barObjectV = this.getChild("bar_v");
          this._aniObject = this.getChild("ani");
          if (this._barObjectH) {
            this._barMaxWidth = this._barObjectH.width;
            this._barMaxWidthDelta = this.width - this._barMaxWidth;
            this._barStartX = this._barObjectH.x;
          }
          if (this._barObjectV) {
            this._barMaxHeight = this._barObjectV.height;
            this._barMaxHeightDelta = this.height - this._barMaxHeight;
            this._barStartY = this._barObjectV.y;
          }
        };
        _proto60.handleSizeChanged = function handleSizeChanged() {
          _GComponent8.prototype.handleSizeChanged.call(this);
          if (this._barObjectH) this._barMaxWidth = this.width - this._barMaxWidthDelta;
          if (this._barObjectV) this._barMaxHeight = this.height - this._barMaxHeightDelta;
          if (!this._underConstruct) this.update(this._value);
        };
        _proto60.setup_afterAdd = function setup_afterAdd(buffer, beginPos) {
          _GComponent8.prototype.setup_afterAdd.call(this, buffer, beginPos);
          if (!buffer.seek(beginPos, 6)) {
            this.update(this._value);
            return;
          }
          if (buffer.readByte() != this.packageItem.objectType) {
            this.update(this._value);
            return;
          }
          this._value = buffer.readInt();
          this._max = buffer.readInt();
          if (buffer.version >= 2) this._min = buffer.readInt();
          this.update(this._value);
        };
        _createClass(GProgressBar, [{
          key: "titleType",
          get: function get() {
            return this._titleType;
          },
          set: function set(value) {
            if (this._titleType != value) {
              this._titleType = value;
              this.update(this._value);
            }
          }
        }, {
          key: "min",
          get: function get() {
            return this._min;
          },
          set: function set(value) {
            if (this._min != value) {
              this._min = value;
              this.update(this._value);
            }
          }
        }, {
          key: "max",
          get: function get() {
            return this._max;
          },
          set: function set(value) {
            if (this._max != value) {
              this._max = value;
              this.update(this._value);
            }
          }
        }, {
          key: "value",
          get: function get() {
            return this._value;
          },
          set: function set(value) {
            if (this._value != value) {
              GTween.kill(this, false, this.update);
              this._value = value;
              this.update(value);
            }
          }
        }]);
        return GProgressBar;
      }(GComponent));
      var GScrollBar = exports('GScrollBar', /*#__PURE__*/function (_GComponent9) {
        _inheritsLoose(GScrollBar, _GComponent9);
        function GScrollBar() {
          var _this35;
          _this35 = _GComponent9.call(this) || this;
          _this35._node.name = "GScrollBar";
          _this35._dragOffset = new Vec2();
          _this35._scrollPerc = 0;
          return _this35;
        }
        var _proto61 = GScrollBar.prototype;
        _proto61.setScrollPane = function setScrollPane(target, vertical) {
          this._target = target;
          this._vertical = vertical;
        };
        _proto61.setDisplayPerc = function setDisplayPerc(value) {
          if (this._vertical) {
            if (!this._fixedGripSize) this._grip.height = Math.floor(value * this._bar.height);
            this._grip.y = this._bar.y + (this._bar.height - this._grip.height) * this._scrollPerc;
          } else {
            if (!this._fixedGripSize) this._grip.width = Math.floor(value * this._bar.width);
            this._grip.x = this._bar.x + (this._bar.width - this._grip.width) * this._scrollPerc;
          }
          this._grip.visible = value != 0 && value != 1;
        };
        _proto61.setScrollPerc = function setScrollPerc(val) {
          this._scrollPerc = val;
          if (this._vertical) this._grip.y = this._bar.y + (this._bar.height - this._grip.height) * this._scrollPerc;else this._grip.x = this._bar.x + (this._bar.width - this._grip.width) * this._scrollPerc;
        };
        _proto61.constructExtension = function constructExtension(buffer) {
          buffer.seek(0, 6);
          this._fixedGripSize = buffer.readBool();
          this._grip = this.getChild("grip");
          if (!this._grip) {
            console.error("grip");
            return;
          }
          this._bar = this.getChild("bar");
          if (!this._bar) {
            console.error("bar");
            return;
          }
          this._arrowButton1 = this.getChild("arrow1");
          this._arrowButton2 = this.getChild("arrow2");
          this._grip.on(Event.TOUCH_BEGIN, this.onGripTouchDown, this);
          this._grip.on(Event.TOUCH_MOVE, this.onGripTouchMove, this);
          this._grip.on(Event.TOUCH_END, this.onGripTouchEnd, this);
          if (this._arrowButton1) this._arrowButton1.on(Event.TOUCH_BEGIN, this.onClickArrow1, this);
          if (this._arrowButton2) this._arrowButton2.on(Event.TOUCH_BEGIN, this.onClickArrow2, this);
          this.on(Event.TOUCH_BEGIN, this.onBarTouchBegin, this);
        };
        _proto61.onGripTouchDown = function onGripTouchDown(evt) {
          evt.propagationStopped = true;
          evt.captureTouch();
          this._gripDragging = true;
          this._target.updateScrollBarVisible();
          this.globalToLocal(evt.pos.x, evt.pos.y, this._dragOffset);
          this._dragOffset.x -= this._grip.x;
          this._dragOffset.y -= this._grip.y;
        };
        _proto61.onGripTouchMove = function onGripTouchMove(evt) {
          if (!this.onStage) return;
          var pt = this.globalToLocal(evt.pos.x, evt.pos.y, s_vec2);
          if (this._vertical) {
            var curY = pt.y - this._dragOffset.y;
            this._target.setPercY((curY - this._bar.y) / (this._bar.height - this._grip.height), false);
          } else {
            var curX = pt.x - this._dragOffset.x;
            this._target.setPercX((curX - this._bar.x) / (this._bar.width - this._grip.width), false);
          }
        };
        _proto61.onGripTouchEnd = function onGripTouchEnd(evt) {
          if (!this.onStage) return;
          this._gripDragging = false;
          this._target.updateScrollBarVisible();
        };
        _proto61.onClickArrow1 = function onClickArrow1(evt) {
          evt.propagationStopped = true;
          if (this._vertical) this._target.scrollUp();else this._target.scrollLeft();
        };
        _proto61.onClickArrow2 = function onClickArrow2(evt) {
          evt.propagationStopped = true;
          if (this._vertical) this._target.scrollDown();else this._target.scrollRight();
        };
        _proto61.onBarTouchBegin = function onBarTouchBegin(evt) {
          evt.propagationStopped = true;
          var pt = this._grip.globalToLocal(evt.pos.x, evt.pos.y, s_vec2);
          if (this._vertical) {
            if (pt.y < 0) this._target.scrollUp(4);else this._target.scrollDown(4);
          } else {
            if (pt.x < 0) this._target.scrollLeft(4);else this._target.scrollRight(4);
          }
        };
        _createClass(GScrollBar, [{
          key: "minSize",
          get: function get() {
            if (this._vertical) return (this._arrowButton1 ? this._arrowButton1.height : 0) + (this._arrowButton2 ? this._arrowButton2.height : 0);else return (this._arrowButton1 ? this._arrowButton1.width : 0) + (this._arrowButton2 ? this._arrowButton2.width : 0);
          }
        }, {
          key: "gripDragging",
          get: function get() {
            return this._gripDragging;
          }
        }]);
        return GScrollBar;
      }(GComponent));
      var s_vec2 = new Vec2();
      var GTreeNode = exports('GTreeNode', /*#__PURE__*/function () {
        function GTreeNode(hasChild, resURL) {
          this._level = 0;
          this._resURL = resURL;
          if (hasChild) this._children = new Array();
        }
        var _proto62 = GTreeNode.prototype;
        _proto62._setLevel = function _setLevel(value) {
          this._level = value;
        };
        _proto62.addChild = function addChild(child) {
          this.addChildAt(child, this._children.length);
          return child;
        };
        _proto62.addChildAt = function addChildAt(child, index) {
          if (!child) throw new Error("child is null");
          var numChildren = this._children.length;
          if (index >= 0 && index <= numChildren) {
            if (child._parent == this) {
              this.setChildIndex(child, index);
            } else {
              if (child._parent) child._parent.removeChild(child);
              var cnt = this._children.length;
              if (index == cnt) this._children.push(child);else this._children.splice(index, 0, child);
              child._parent = this;
              child._level = this._level + 1;
              child._setTree(this._tree);
              if (this._tree && this == this._tree.rootNode || this._cell && this._cell.parent && this._expanded) this._tree._afterInserted(child);
            }
            return child;
          } else {
            throw new RangeError("Invalid child index");
          }
        };
        _proto62.removeChild = function removeChild(child) {
          var childIndex = this._children.indexOf(child);
          if (childIndex != -1) {
            this.removeChildAt(childIndex);
          }
          return child;
        };
        _proto62.removeChildAt = function removeChildAt(index) {
          if (index >= 0 && index < this.numChildren) {
            var child = this._children[index];
            this._children.splice(index, 1);
            child._parent = null;
            if (this._tree) {
              child._setTree(null);
              this._tree._afterRemoved(child);
            }
            return child;
          } else {
            throw new Error("Invalid child index");
          }
        };
        _proto62.removeChildren = function removeChildren(beginIndex, endIndex) {
          beginIndex = beginIndex || 0;
          if (endIndex == null) endIndex = -1;
          if (endIndex < 0 || endIndex >= this.numChildren) endIndex = this.numChildren - 1;
          for (var i = beginIndex; i <= endIndex; ++i) this.removeChildAt(beginIndex);
        };
        _proto62.getChildAt = function getChildAt(index) {
          if (index >= 0 && index < this.numChildren) return this._children[index];else throw new Error("Invalid child index");
        };
        _proto62.getChildIndex = function getChildIndex(child) {
          return this._children.indexOf(child);
        };
        _proto62.getPrevSibling = function getPrevSibling() {
          if (this._parent == null) return null;
          var i = this._parent._children.indexOf(this);
          if (i <= 0) return null;
          return this._parent._children[i - 1];
        };
        _proto62.getNextSibling = function getNextSibling() {
          if (this._parent == null) return null;
          var i = this._parent._children.indexOf(this);
          if (i < 0 || i >= this._parent._children.length - 1) return null;
          return this._parent._children[i + 1];
        };
        _proto62.setChildIndex = function setChildIndex(child, index) {
          var oldIndex = this._children.indexOf(child);
          if (oldIndex == -1) throw new Error("Not a child of this container");
          var cnt = this._children.length;
          if (index < 0) index = 0;else if (index > cnt) index = cnt;
          if (oldIndex == index) return;
          this._children.splice(oldIndex, 1);
          this._children.splice(index, 0, child);
          if (this._tree && this == this._tree.rootNode || this._cell && this._cell.parent && this._expanded) this._tree._afterMoved(child);
        };
        _proto62.swapChildren = function swapChildren(child1, child2) {
          var index1 = this._children.indexOf(child1);
          var index2 = this._children.indexOf(child2);
          if (index1 == -1 || index2 == -1) throw new Error("Not a child of this container");
          this.swapChildrenAt(index1, index2);
        };
        _proto62.swapChildrenAt = function swapChildrenAt(index1, index2) {
          var child1 = this._children[index1];
          var child2 = this._children[index2];
          this.setChildIndex(child1, index2);
          this.setChildIndex(child2, index1);
        };
        _proto62.expandToRoot = function expandToRoot() {
          var p = this;
          while (p) {
            p.expanded = true;
            p = p.parent;
          }
        };
        _proto62._setTree = function _setTree(value) {
          this._tree = value;
          if (this._tree && this._tree.treeNodeWillExpand && this._expanded) this._tree.treeNodeWillExpand(this, true);
          if (this._children) {
            var cnt = this._children.length;
            for (var i = 0; i < cnt; i++) {
              var node = this._children[i];
              node._level = this._level + 1;
              node._setTree(value);
            }
          }
        };
        _createClass(GTreeNode, [{
          key: "expanded",
          get: function get() {
            return this._expanded;
          },
          set: function set(value) {
            if (this._children == null) return;
            if (this._expanded != value) {
              this._expanded = value;
              if (this._tree) {
                if (this._expanded) this._tree._afterExpanded(this);else this._tree._afterCollapsed(this);
              }
            }
          }
        }, {
          key: "isFolder",
          get: function get() {
            return this._children != null;
          }
        }, {
          key: "parent",
          get: function get() {
            return this._parent;
          }
        }, {
          key: "text",
          get: function get() {
            if (this._cell) return this._cell.text;else return null;
          },
          set: function set(value) {
            if (this._cell) this._cell.text = value;
          }
        }, {
          key: "icon",
          get: function get() {
            if (this._cell) return this._cell.icon;else return null;
          },
          set: function set(value) {
            if (this._cell) this._cell.icon = value;
          }
        }, {
          key: "cell",
          get: function get() {
            return this._cell;
          }
        }, {
          key: "level",
          get: function get() {
            return this._level;
          }
        }, {
          key: "numChildren",
          get: function get() {
            return this._children.length;
          }
        }, {
          key: "tree",
          get: function get() {
            return this._tree;
          }
        }]);
        return GTreeNode;
      }());
      var GTree = exports('GTree', /*#__PURE__*/function (_GList) {
        _inheritsLoose(GTree, _GList);
        function GTree() {
          var _this36;
          _this36 = _GList.call(this) || this;
          _this36._indent = 15;
          _this36._rootNode = new GTreeNode(true);
          _this36._rootNode._setTree(_assertThisInitialized(_this36));
          _this36._rootNode.expanded = true;
          return _this36;
        }
        var _proto63 = GTree.prototype;
        _proto63.getSelectedNode = function getSelectedNode() {
          if (this.selectedIndex != -1) return this.getChildAt(this.selectedIndex)._treeNode;else return null;
        };
        _proto63.getSelectedNodes = function getSelectedNodes(result) {
          if (!result) result = new Array();
          s_list.length = 0;
          _GList.prototype.getSelection.call(this, s_list);
          var cnt = s_list.length;
          var ret = new Array();
          for (var i = 0; i < cnt; i++) {
            var node = this.getChildAt(s_list[i])._treeNode;
            ret.push(node);
          }
          return ret;
        };
        _proto63.selectNode = function selectNode(node, scrollItToView) {
          var parentNode = node.parent;
          while (parentNode && parentNode != this._rootNode) {
            parentNode.expanded = true;
            parentNode = parentNode.parent;
          }
          if (!node._cell) return;
          this.addSelection(this.getChildIndex(node._cell), scrollItToView);
        };
        _proto63.unselectNode = function unselectNode(node) {
          if (!node._cell) return;
          this.removeSelection(this.getChildIndex(node._cell));
        };
        _proto63.expandAll = function expandAll(folderNode) {
          if (!folderNode) folderNode = this._rootNode;
          folderNode.expanded = true;
          var cnt = folderNode.numChildren;
          for (var i = 0; i < cnt; i++) {
            var node = folderNode.getChildAt(i);
            if (node.isFolder) this.expandAll(node);
          }
        };
        _proto63.collapseAll = function collapseAll(folderNode) {
          if (!folderNode) folderNode = this._rootNode;
          if (folderNode != this._rootNode) folderNode.expanded = false;
          var cnt = folderNode.numChildren;
          for (var i = 0; i < cnt; i++) {
            var node = folderNode.getChildAt(i);
            if (node.isFolder) this.collapseAll(node);
          }
        };
        _proto63.createCell = function createCell(node) {
          var child = this.getFromPool(node._resURL);
          if (!(child instanceof GComponent)) throw new Error("cannot create tree node object.");
          child._treeNode = node;
          node._cell = child;
          var indentObj = child.getChild("indent");
          if (indentObj) indentObj.width = (node.level - 1) * this._indent;
          var cc;
          cc = child.getController("expanded");
          if (cc) {
            cc.on(Event.STATUS_CHANGED, this.__expandedStateChanged, this);
            cc.selectedIndex = node.expanded ? 1 : 0;
          }
          cc = child.getController("leaf");
          if (cc) cc.selectedIndex = node.isFolder ? 0 : 1;
          if (node.isFolder) node._cell.on(Event.TOUCH_BEGIN, this.__cellMouseDown, this);
          if (this.treeNodeRender) this.treeNodeRender(node, child);
        };
        _proto63._afterInserted = function _afterInserted(node) {
          if (!node._cell) this.createCell(node);
          var index = this.getInsertIndexForNode(node);
          this.addChildAt(node._cell, index);
          if (this.treeNodeRender) this.treeNodeRender(node, node._cell);
          if (node.isFolder && node.expanded) this.checkChildren(node, index);
        };
        _proto63.getInsertIndexForNode = function getInsertIndexForNode(node) {
          var prevNode = node.getPrevSibling();
          if (prevNode == null) prevNode = node.parent;
          var insertIndex = this.getChildIndex(prevNode._cell) + 1;
          var myLevel = node.level;
          var cnt = this.numChildren;
          for (var i = insertIndex; i < cnt; i++) {
            var testNode = this.getChildAt(i)._treeNode;
            if (testNode.level <= myLevel) break;
            insertIndex++;
          }
          return insertIndex;
        };
        _proto63._afterRemoved = function _afterRemoved(node) {
          this.removeNode(node);
        };
        _proto63._afterExpanded = function _afterExpanded(node) {
          if (node == this._rootNode) {
            this.checkChildren(this._rootNode, 0);
            return;
          }
          if (this.treeNodeWillExpand != null) this.treeNodeWillExpand(node, true);
          if (node._cell == null) return;
          if (this.treeNodeRender) this.treeNodeRender(node, node._cell);
          var cc = node._cell.getController("expanded");
          if (cc) cc.selectedIndex = 1;
          if (node._cell.parent) this.checkChildren(node, this.getChildIndex(node._cell));
        };
        _proto63._afterCollapsed = function _afterCollapsed(node) {
          if (node == this._rootNode) {
            this.checkChildren(this._rootNode, 0);
            return;
          }
          if (this.treeNodeWillExpand) this.treeNodeWillExpand(node, false);
          if (node._cell == null) return;
          if (this.treeNodeRender) this.treeNodeRender(node, node._cell);
          var cc = node._cell.getController("expanded");
          if (cc) cc.selectedIndex = 0;
          if (node._cell.parent) this.hideFolderNode(node);
        };
        _proto63._afterMoved = function _afterMoved(node) {
          var startIndex = this.getChildIndex(node._cell);
          var endIndex;
          if (node.isFolder) endIndex = this.getFolderEndIndex(startIndex, node.level);else endIndex = startIndex + 1;
          var insertIndex = this.getInsertIndexForNode(node);
          var i;
          var cnt = endIndex - startIndex;
          var obj;
          if (insertIndex < startIndex) {
            for (i = 0; i < cnt; i++) {
              obj = this.getChildAt(startIndex + i);
              this.setChildIndex(obj, insertIndex + i);
            }
          } else {
            for (i = 0; i < cnt; i++) {
              obj = this.getChildAt(startIndex);
              this.setChildIndex(obj, insertIndex);
            }
          }
        };
        _proto63.getFolderEndIndex = function getFolderEndIndex(startIndex, level) {
          var cnt = this.numChildren;
          for (var i = startIndex + 1; i < cnt; i++) {
            var node = this.getChildAt(i)._treeNode;
            if (node.level <= level) return i;
          }
          return cnt;
        };
        _proto63.checkChildren = function checkChildren(folderNode, index) {
          var cnt = folderNode.numChildren;
          for (var i = 0; i < cnt; i++) {
            index++;
            var node = folderNode.getChildAt(i);
            if (node._cell == null) this.createCell(node);
            if (!node._cell.parent) this.addChildAt(node._cell, index);
            if (node.isFolder && node.expanded) index = this.checkChildren(node, index);
          }
          return index;
        };
        _proto63.hideFolderNode = function hideFolderNode(folderNode) {
          var cnt = folderNode.numChildren;
          for (var i = 0; i < cnt; i++) {
            var node = folderNode.getChildAt(i);
            if (node._cell) this.removeChild(node._cell);
            if (node.isFolder && node.expanded) this.hideFolderNode(node);
          }
        };
        _proto63.removeNode = function removeNode(node) {
          if (node._cell) {
            if (node._cell.parent) this.removeChild(node._cell);
            this.returnToPool(node._cell);
            node._cell._treeNode = null;
            node._cell = null;
          }
          if (node.isFolder) {
            var cnt = node.numChildren;
            for (var i = 0; i < cnt; i++) {
              var node2 = node.getChildAt(i);
              this.removeNode(node2);
            }
          }
        };
        _proto63.__cellMouseDown = function __cellMouseDown(evt) {
          var node = GObject.cast(evt.currentTarget)._treeNode;
          this._expandedStatusInEvt = node.expanded;
        };
        _proto63.__expandedStateChanged = function __expandedStateChanged(cc) {
          var node = cc.parent._treeNode;
          node.expanded = cc.selectedIndex == 1;
        };
        _proto63.dispatchItemEvent = function dispatchItemEvent(item, evt) {
          if (this._clickToExpand != 0) {
            var node = item._treeNode;
            if (node && this._expandedStatusInEvt == node.expanded) {
              if (this._clickToExpand == 2) ;else node.expanded = !node.expanded;
            }
          }
          _GList.prototype.dispatchItemEvent.call(this, item, evt);
        };
        _proto63.setup_beforeAdd = function setup_beforeAdd(buffer, beginPos) {
          _GList.prototype.setup_beforeAdd.call(this, buffer, beginPos);
          buffer.seek(beginPos, 9);
          this._indent = buffer.readInt();
          this._clickToExpand = buffer.readByte();
        };
        _proto63.readItems = function readItems(buffer) {
          var cnt;
          var i;
          var nextPos;
          var str;
          var isFolder;
          var lastNode;
          var level;
          var prevLevel = 0;
          cnt = buffer.readShort();
          for (i = 0; i < cnt; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            str = buffer.readS();
            if (str == null) {
              str = this.defaultItem;
              if (!str) {
                buffer.position = nextPos;
                continue;
              }
            }
            isFolder = buffer.readBool();
            level = buffer.readByte();
            var node = new GTreeNode(isFolder, str);
            node.expanded = true;
            if (i == 0) this._rootNode.addChild(node);else {
              if (level > prevLevel) lastNode.addChild(node);else if (level < prevLevel) {
                for (var j = level; j <= prevLevel; j++) lastNode = lastNode.parent;
                lastNode.addChild(node);
              } else lastNode.parent.addChild(node);
            }
            lastNode = node;
            prevLevel = level;
            this.setupItem(buffer, node.cell);
            buffer.position = nextPos;
          }
        };
        _createClass(GTree, [{
          key: "rootNode",
          get: function get() {
            return this._rootNode;
          }
        }, {
          key: "indent",
          get: function get() {
            return this._indent;
          },
          set: function set(value) {
            this._indent = value;
          }
        }, {
          key: "clickToExpand",
          get: function get() {
            return this._clickToExpand;
          },
          set: function set(value) {
            this._clickToExpand = value;
          }
        }]);
        return GTree;
      }(GList));
      var s_list = new Array();
      var PopupMenu = exports('PopupMenu', /*#__PURE__*/function () {
        function PopupMenu(url) {
          if (!url) {
            url = UIConfig.popupMenu;
            if (!url) throw new Error("UIConfig.popupMenu not defined");
          }
          this._contentPane = UIPackage.createObjectFromURL(url);
          this._contentPane.on(Event.DISPLAY, this.onDisplay, this);
          this._list = this._contentPane.getChild("list");
          this._list.removeChildrenToPool();
          this._list.addRelation(this._contentPane, RelationType.Width);
          this._list.removeRelation(this._contentPane, RelationType.Height);
          this._contentPane.addRelation(this._list, RelationType.Height);
          this._list.on(Event.CLICK_ITEM, this.onClickItem, this);
        }
        var _proto64 = PopupMenu.prototype;
        _proto64.dispose = function dispose() {
          this._contentPane.dispose();
        };
        _proto64.addItem = function addItem(caption, callback) {
          var item = this._list.addItemFromPool();
          item.title = caption;
          item.data = callback;
          item.grayed = false;
          var c = item.getController("checked");
          if (c) c.selectedIndex = 0;
          return item;
        };
        _proto64.addItemAt = function addItemAt(caption, index, callback) {
          var item = this._list.getFromPool();
          this._list.addChildAt(item, index);
          item.title = caption;
          item.data = callback;
          item.grayed = false;
          var c = item.getController("checked");
          if (c) c.selectedIndex = 0;
          return item;
        };
        _proto64.addSeperator = function addSeperator() {
          if (UIConfig.popupMenu_seperator == null) throw new Error("UIConfig.popupMenu_seperator not defined");
          this.list.addItemFromPool(UIConfig.popupMenu_seperator);
        };
        _proto64.getItemName = function getItemName(index) {
          var item = this._list.getChildAt(index);
          return item.name;
        };
        _proto64.setItemText = function setItemText(name, caption) {
          var item = this._list.getChild(name);
          item.title = caption;
        };
        _proto64.setItemVisible = function setItemVisible(name, visible) {
          var item = this._list.getChild(name);
          if (item.visible != visible) {
            item.visible = visible;
            this._list.setBoundsChangedFlag();
          }
        };
        _proto64.setItemGrayed = function setItemGrayed(name, grayed) {
          var item = this._list.getChild(name);
          item.grayed = grayed;
        };
        _proto64.setItemCheckable = function setItemCheckable(name, checkable) {
          var item = this._list.getChild(name);
          var c = item.getController("checked");
          if (c) {
            if (checkable) {
              if (c.selectedIndex == 0) c.selectedIndex = 1;
            } else c.selectedIndex = 0;
          }
        };
        _proto64.setItemChecked = function setItemChecked(name, checked) {
          var item = this._list.getChild(name);
          var c = item.getController("checked");
          if (c) c.selectedIndex = checked ? 2 : 1;
        };
        _proto64.isItemChecked = function isItemChecked(name) {
          var item = this._list.getChild(name);
          var c = item.getController("checked");
          if (c) return c.selectedIndex == 2;else return false;
        };
        _proto64.removeItem = function removeItem(name) {
          var item = this._list.getChild(name);
          if (item) {
            var index = this._list.getChildIndex(item);
            this._list.removeChildToPoolAt(index);
            return true;
          } else return false;
        };
        _proto64.clearItems = function clearItems() {
          this._list.removeChildrenToPool();
        };
        _proto64.show = function show(target, dir) {
          GRoot.inst.showPopup(this.contentPane, target instanceof GRoot ? null : target, dir);
        };
        _proto64.onClickItem = function onClickItem(item, evt) {
          var _this37 = this;
          this._list._partner.callLater(function (dt) {
            _this37.onClickItem2(item, evt);
          }, 0.1);
        };
        _proto64.onClickItem2 = function onClickItem2(item, evt) {
          if (!(item instanceof GButton)) return;
          if (item.grayed) {
            this._list.selectedIndex = -1;
            return;
          }
          var c = item.getController("checked");
          if (c && c.selectedIndex != 0) {
            if (c.selectedIndex == 1) c.selectedIndex = 2;else c.selectedIndex = 1;
          }
          var r = this._contentPane.parent;
          r.hidePopup(this.contentPane);
          if (item.data instanceof Function) item.data(item, evt);
        };
        _proto64.onDisplay = function onDisplay() {
          this._list.selectedIndex = -1;
          this._list.resizeToFit(100000, 10);
        };
        _createClass(PopupMenu, [{
          key: "itemCount",
          get: function get() {
            return this._list.numChildren;
          }
        }, {
          key: "contentPane",
          get: function get() {
            return this._contentPane;
          }
        }, {
          key: "list",
          get: function get() {
            return this._list;
          }
        }]);
        return PopupMenu;
      }());
      var UIObjectFactory = exports('UIObjectFactory', /*#__PURE__*/function () {
        function UIObjectFactory() {}
        UIObjectFactory.setExtension = function setExtension(url, type) {
          if (url == null) throw new Error("Invaild url: " + url);
          var pi = UIPackage.getItemByURL(url);
          if (pi) pi.extensionType = type;
          UIObjectFactory.extensions[url] = type;
        };
        UIObjectFactory.setLoaderExtension = function setLoaderExtension(type) {
          UIObjectFactory.loaderType = type;
        };
        UIObjectFactory.resolveExtension = function resolveExtension(pi) {
          var extensionType = UIObjectFactory.extensions["ui://" + pi.owner.id + pi.id];
          if (!extensionType) extensionType = UIObjectFactory.extensions["ui://" + pi.owner.name + "/" + pi.name];
          if (extensionType) pi.extensionType = extensionType;
        };
        UIObjectFactory.newObject = function newObject(type, userClass) {
          var obj;
          UIObjectFactory.counter++;
          if (typeof type === 'number') {
            switch (type) {
              case ObjectType.Image:
                return new GImage();
              case ObjectType.MovieClip:
                return new GMovieClip();
              case ObjectType.Component:
                return new GComponent();
              case ObjectType.Text:
                return new GTextField();
              case ObjectType.RichText:
                return new GRichTextField();
              case ObjectType.InputText:
                return new GTextInput();
              case ObjectType.Group:
                return new GGroup();
              case ObjectType.List:
                return new GList();
              case ObjectType.Graph:
                return new GGraph();
              case ObjectType.Loader:
                if (UIObjectFactory.loaderType) return new UIObjectFactory.loaderType();else return new GLoader();
              case ObjectType.Button:
                return new GButton();
              case ObjectType.Label:
                return new GLabel();
              case ObjectType.ProgressBar:
                return new GProgressBar();
              case ObjectType.Slider:
                return new GSlider();
              case ObjectType.ScrollBar:
                return new GScrollBar();
              case ObjectType.ComboBox:
                return new GComboBox();
              case ObjectType.Tree:
                return new GTree();
              case ObjectType.Loader3D:
                return new GLoader3D();
              default:
                return null;
            }
          } else {
            if (type.type == PackageItemType.Component) {
              if (userClass) obj = new userClass();else if (type.extensionType) obj = new type.extensionType();else obj = UIObjectFactory.newObject(type.objectType);
            } else obj = UIObjectFactory.newObject(type.objectType);
            if (obj) obj.packageItem = type;
          }
          return obj;
        };
        return UIObjectFactory;
      }());
      UIObjectFactory.counter = 0;
      UIObjectFactory.extensions = {};
      Decls.UIObjectFactory = UIObjectFactory;
      var DragDropManager = exports('DragDropManager', /*#__PURE__*/function () {
        function DragDropManager() {
          this._agent = new GLoader();
          this._agent.draggable = true;
          this._agent.touchable = false; //important
          this._agent.setSize(100, 100);
          this._agent.setPivot(0.5, 0.5, true);
          this._agent.align = AlignType.Center;
          this._agent.verticalAlign = VertAlignType.Middle;
          this._agent.sortingOrder = 1e9;
          this._agent.on(Event.DRAG_END, this.onDragEnd, this);
        }
        var _proto65 = DragDropManager.prototype;
        _proto65.startDrag = function startDrag(source, icon, sourceData, touchId) {
          if (this._agent.parent) return;
          this._sourceData = sourceData;
          this._agent.url = icon;
          GRoot.inst.addChild(this._agent);
          var pt = GRoot.inst.getTouchPosition(touchId);
          pt = GRoot.inst.globalToLocal(pt.x, pt.y);
          this._agent.setPosition(pt.x, pt.y);
          this._agent.startDrag(touchId);
        };
        _proto65.cancel = function cancel() {
          if (this._agent.parent) {
            this._agent.stopDrag();
            GRoot.inst.removeChild(this._agent);
            this._sourceData = null;
          }
        };
        _proto65.onDragEnd = function onDragEnd() {
          if (!this._agent.parent)
            //cancelled
            return;
          GRoot.inst.removeChild(this._agent);
          var sourceData = this._sourceData;
          this._sourceData = null;
          var obj = GRoot.inst.touchTarget;
          while (obj) {
            if (obj.node.hasEventListener(Event.DROP)) {
              obj.requestFocus();
              obj.node.emit(Event.DROP, obj, sourceData);
              return;
            }
            obj = obj.parent;
          }
        };
        _createClass(DragDropManager, [{
          key: "dragAgent",
          get: function get() {
            return this._agent;
          }
        }, {
          key: "dragging",
          get: function get() {
            return this._agent.parent != null;
          }
        }], [{
          key: "inst",
          get: function get() {
            if (!DragDropManager._inst) DragDropManager._inst = new DragDropManager();
            return DragDropManager._inst;
          }
        }]);
        return DragDropManager;
      }());
      var AsyncOperation = exports('AsyncOperation', /*#__PURE__*/function () {
        function AsyncOperation() {}
        var _proto66 = AsyncOperation.prototype;
        _proto66.createObject = function createObject(pkgName, resName) {
          if (this._node) throw 'Already running';
          var pkg = UIPackage.getByName(pkgName);
          if (pkg) {
            var pi = pkg.getItemByName(resName);
            if (!pi) throw new Error("resource not found: " + resName);
            this.internalCreateObject(pi);
          } else throw new Error("package not found: " + pkgName);
        };
        _proto66.createObjectFromURL = function createObjectFromURL(url) {
          if (this._node) throw 'Already running';
          var pi = UIPackage.getItemByURL(url);
          if (pi) this.internalCreateObject(pi);else throw new Error("resource not found: " + url);
        };
        _proto66.cancel = function cancel() {
          if (this._node) {
            this._node.destroy();
            this._node = null;
          }
        };
        _proto66.internalCreateObject = function internalCreateObject(item) {
          this._node = new Node("[AsyncCreating:" + item.name + "]");
          game.addPersistRootNode(this._node);
          this._node.on("#", this.completed, this);
          this._node.addComponent(AsyncOperationRunner).init(item);
        };
        _proto66.completed = function completed(result) {
          this.cancel();
          if (this.callback) this.callback(result);
        };
        return AsyncOperation;
      }());
      var AsyncOperationRunner = /*#__PURE__*/function (_Component4) {
        _inheritsLoose(AsyncOperationRunner, _Component4);
        function AsyncOperationRunner() {
          var _this38;
          _this38 = _Component4.call(this) || this;
          _this38._itemList = new Array();
          _this38._objectPool = new Array();
          return _this38;
        }
        var _proto67 = AsyncOperationRunner.prototype;
        _proto67.init = function init(item) {
          this._itemList.length = 0;
          this._objectPool.length = 0;
          var di = {
            pi: item,
            type: item.objectType
          };
          di.childCount = this.collectComponentChildren(item);
          this._itemList.push(di);
          this._index = 0;
        };
        _proto67.onDestroy = function onDestroy() {
          this._itemList.length = 0;
          var cnt = this._objectPool.length;
          if (cnt > 0) {
            for (var i = 0; i < cnt; i++) this._objectPool[i].dispose();
            this._objectPool.length = 0;
          }
        };
        _proto67.collectComponentChildren = function collectComponentChildren(item) {
          var buffer = item.rawData;
          buffer.seek(0, 2);
          var di;
          var pi;
          var i;
          var dataLen;
          var curPos;
          var pkg;
          var dcnt = buffer.readShort();
          for (i = 0; i < dcnt; i++) {
            dataLen = buffer.readShort();
            curPos = buffer.position;
            buffer.seek(curPos, 0);
            var type = buffer.readByte();
            var src = buffer.readS();
            var pkgId = buffer.readS();
            buffer.position = curPos;
            if (src != null) {
              if (pkgId != null) pkg = UIPackage.getById(pkgId);else pkg = item.owner;
              pi = pkg != null ? pkg.getItemById(src) : null;
              di = {
                pi: pi,
                type: type
              };
              if (pi && pi.type == PackageItemType.Component) di.childCount = this.collectComponentChildren(pi);
            } else {
              di = {
                type: type
              };
              if (type == ObjectType.List)
                //list
                di.listItemCount = this.collectListChildren(buffer);
            }
            this._itemList.push(di);
            buffer.position = curPos + dataLen;
          }
          return dcnt;
        };
        _proto67.collectListChildren = function collectListChildren(buffer) {
          buffer.seek(buffer.position, 8);
          var listItemCount = 0;
          var i;
          var nextPos;
          var url;
          var pi;
          var di;
          var defaultItem = buffer.readS();
          var itemCount = buffer.readShort();
          for (i = 0; i < itemCount; i++) {
            nextPos = buffer.readShort();
            nextPos += buffer.position;
            url = buffer.readS();
            if (url == null) url = defaultItem;
            if (url) {
              pi = UIPackage.getItemByURL(url);
              if (pi) {
                di = {
                  pi: pi,
                  type: pi.objectType
                };
                if (pi.type == PackageItemType.Component) di.childCount = this.collectComponentChildren(pi);
                this._itemList.push(di);
                listItemCount++;
              }
            }
            buffer.position = nextPos;
          }
          return listItemCount;
        };
        _proto67.update = function update() {
          var obj;
          var di;
          var poolStart;
          var k;
          var t = game.totalTime / 1000;
          var frameTime = UIConfig.frameTimeForAsyncUIConstruction;
          var totalItems = this._itemList.length;
          while (this._index < totalItems) {
            di = this._itemList[this._index];
            if (di.pi) {
              obj = UIObjectFactory.newObject(di.pi);
              this._objectPool.push(obj);
              constructingDepth.n++;
              if (di.pi.type == PackageItemType.Component) {
                poolStart = this._objectPool.length - di.childCount - 1;
                obj.constructFromResource2(this._objectPool, poolStart);
                this._objectPool.splice(poolStart, di.childCount);
              } else {
                obj.constructFromResource();
              }
              constructingDepth.n--;
            } else {
              obj = UIObjectFactory.newObject(di.type);
              this._objectPool.push(obj);
              if (di.type == ObjectType.List && di.listItemCount > 0) {
                poolStart = this._objectPool.length - di.listItemCount - 1;
                for (k = 0; k < di.listItemCount; k++)
                //poolGList
                obj.itemPool.returnObject(this._objectPool[k + poolStart]);
                this._objectPool.splice(poolStart, di.listItemCount);
              }
            }
            this._index++;
            if (this._index % 5 == 0 && game.totalTime / 1000 - t >= frameTime) return;
          }
          var result = this._objectPool[0];
          this._itemList.length = 0;
          this._objectPool.length = 0;
          this.node.emit("#", result);
        };
        return AsyncOperationRunner;
      }(Component);
    }
  };
});

System.register("chunks:///_virtual/firefox_shim.js", ['./cjs-loader.mjs', './utils.js', './getusermedia2.js', './getdisplaymedia.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.shimAddTransceiver = shimAddTransceiver;
        exports.shimCreateAnswer = shimCreateAnswer;
        exports.shimCreateOffer = shimCreateOffer;
        Object.defineProperty(exports, "shimGetDisplayMedia", {
          enumerable: true,
          get: function get() {
            return _getdisplaymedia.shimGetDisplayMedia;
          }
        });
        exports.shimGetParameters = shimGetParameters;
        Object.defineProperty(exports, "shimGetUserMedia", {
          enumerable: true,
          get: function get() {
            return _getusermedia.shimGetUserMedia;
          }
        });
        exports.shimOnTrack = shimOnTrack;
        exports.shimPeerConnection = shimPeerConnection;
        exports.shimRTCDataChannel = shimRTCDataChannel;
        exports.shimReceiverGetStats = shimReceiverGetStats;
        exports.shimRemoveStream = shimRemoveStream;
        exports.shimSenderGetStats = shimSenderGetStats;
        var utils = _interopRequireWildcard(require("../utils"));
        var _getusermedia = require("./getusermedia");
        var _getdisplaymedia = require("./getdisplaymedia");
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _toConsumableArray(r) {
          return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();
        }
        function _nonIterableSpread() {
          throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
        }
        function _unsupportedIterableToArray(r, a) {
          if (r) {
            if ("string" == typeof r) return _arrayLikeToArray(r, a);
            var t = {}.toString.call(r).slice(8, -1);
            return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;
          }
        }
        function _iterableToArray(r) {
          if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r);
        }
        function _arrayWithoutHoles(r) {
          if (Array.isArray(r)) return _arrayLikeToArray(r);
        }
        function _arrayLikeToArray(r, a) {
          (null == a || a > r.length) && (a = r.length);
          for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];
          return n;
        }
        function _defineProperty(e, r, t) {
          return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {
            value: t,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }) : e[r] = t, e;
        }
        function _toPropertyKey(t) {
          var i = _toPrimitive(t, "string");
          return "symbol" == _typeof(i) ? i : i + "";
        }
        function _toPrimitive(t, r) {
          if ("object" != _typeof(t) || !t) return t;
          var e = t[Symbol.toPrimitive];
          if (void 0 !== e) {
            var i = e.call(t, r || "default");
            if ("object" != _typeof(i)) return i;
            throw new TypeError("@@toPrimitive must return a primitive value.");
          }
          return ("string" === r ? String : Number)(t);
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        function shimOnTrack(window) {
          if (_typeof(window) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {
            Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {
              get: function get() {
                return {
                  receiver: this.receiver
                };
              }
            });
          }
        }
        function shimPeerConnection(window, browserDetails) {
          if (_typeof(window) !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {
            return; // probably media.peerconnection.enabled=false in about:config
          }

          if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {
            // very basic support for old versions.
            window.RTCPeerConnection = window.mozRTCPeerConnection;
          }
          if (browserDetails.version < 53) {
            // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.
            ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {
              var nativeMethod = window.RTCPeerConnection.prototype[method];
              var methodObj = _defineProperty({}, method, function () {
                arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);
                return nativeMethod.apply(this, arguments);
              });
              window.RTCPeerConnection.prototype[method] = methodObj[method];
            });
          }
          var modernStatsTypes = {
            inboundrtp: 'inbound-rtp',
            outboundrtp: 'outbound-rtp',
            candidatepair: 'candidate-pair',
            localcandidate: 'local-candidate',
            remotecandidate: 'remote-candidate'
          };
          var nativeGetStats = window.RTCPeerConnection.prototype.getStats;
          window.RTCPeerConnection.prototype.getStats = function getStats() {
            var _arguments = Array.prototype.slice.call(arguments),
              selector = _arguments[0],
              onSucc = _arguments[1],
              onErr = _arguments[2];
            return nativeGetStats.apply(this, [selector || null]).then(function (stats) {
              if (browserDetails.version < 53 && !onSucc) {
                // Shim only promise getStats with spec-hyphens in type names
                // Leave callback version alone; misc old uses of forEach before Map
                try {
                  stats.forEach(function (stat) {
                    stat.type = modernStatsTypes[stat.type] || stat.type;
                  });
                } catch (e) {
                  if (e.name !== 'TypeError') {
                    throw e;
                  }
                  // Avoid TypeError: "type" is read-only, in old versions. 34-43ish
                  stats.forEach(function (stat, i) {
                    stats.set(i, Object.assign({}, stat, {
                      type: modernStatsTypes[stat.type] || stat.type
                    }));
                  });
                }
              }
              return stats;
            }).then(onSucc, onErr);
          };
        }
        function shimSenderGetStats(window) {
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {
            return;
          }
          if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {
            return;
          }
          var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
          if (origGetSenders) {
            window.RTCPeerConnection.prototype.getSenders = function getSenders() {
              var _this = this;
              var senders = origGetSenders.apply(this, []);
              senders.forEach(function (sender) {
                return sender._pc = _this;
              });
              return senders;
            };
          }
          var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
          if (origAddTrack) {
            window.RTCPeerConnection.prototype.addTrack = function addTrack() {
              var sender = origAddTrack.apply(this, arguments);
              sender._pc = this;
              return sender;
            };
          }
          window.RTCRtpSender.prototype.getStats = function getStats() {
            return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());
          };
        }
        function shimReceiverGetStats(window) {
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {
            return;
          }
          if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {
            return;
          }
          var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;
          if (origGetReceivers) {
            window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {
              var _this2 = this;
              var receivers = origGetReceivers.apply(this, []);
              receivers.forEach(function (receiver) {
                return receiver._pc = _this2;
              });
              return receivers;
            };
          }
          utils.wrapPeerConnectionEvent(window, 'track', function (e) {
            e.receiver._pc = e.srcElement;
            return e;
          });
          window.RTCRtpReceiver.prototype.getStats = function getStats() {
            return this._pc.getStats(this.track);
          };
        }
        function shimRemoveStream(window) {
          if (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {
            return;
          }
          window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {
            var _this3 = this;
            utils.deprecated('removeStream', 'removeTrack');
            this.getSenders().forEach(function (sender) {
              if (sender.track && stream.getTracks().includes(sender.track)) {
                _this3.removeTrack(sender);
              }
            });
          };
        }
        function shimRTCDataChannel(window) {
          // rename DataChannel to RTCDataChannel (native fix in FF60):
          // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851
          if (window.DataChannel && !window.RTCDataChannel) {
            window.RTCDataChannel = window.DataChannel;
          }
        }
        function shimAddTransceiver(window) {
          // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647
          // Firefox ignores the init sendEncodings options passed to addTransceiver
          // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection)) {
            return;
          }
          var origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;
          if (origAddTransceiver) {
            window.RTCPeerConnection.prototype.addTransceiver = function addTransceiver() {
              this.setParametersPromises = [];
              // WebIDL input coercion and validation
              var sendEncodings = arguments[1] && arguments[1].sendEncodings;
              if (sendEncodings === undefined) {
                sendEncodings = [];
              }
              sendEncodings = _toConsumableArray(sendEncodings);
              var shouldPerformCheck = sendEncodings.length > 0;
              if (shouldPerformCheck) {
                // If sendEncodings params are provided, validate grammar
                sendEncodings.forEach(function (encodingParam) {
                  if ('rid' in encodingParam) {
                    var ridRegex = /^[a-z0-9]{0,16}$/i;
                    if (!ridRegex.test(encodingParam.rid)) {
                      throw new TypeError('Invalid RID value provided.');
                    }
                  }
                  if ('scaleResolutionDownBy' in encodingParam) {
                    if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {
                      throw new RangeError('scale_resolution_down_by must be >= 1.0');
                    }
                  }
                  if ('maxFramerate' in encodingParam) {
                    if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {
                      throw new RangeError('max_framerate must be >= 0.0');
                    }
                  }
                });
              }
              var transceiver = origAddTransceiver.apply(this, arguments);
              if (shouldPerformCheck) {
                // Check if the init options were applied. If not we do this in an
                // asynchronous way and save the promise reference in a global object.
                // This is an ugly hack, but at the same time is way more robust than
                // checking the sender parameters before and after the createOffer
                // Also note that after the createoffer we are not 100% sure that
                // the params were asynchronously applied so we might miss the
                // opportunity to recreate offer.
                var sender = transceiver.sender;
                var params = sender.getParameters();
                if (!('encodings' in params) ||
                // Avoid being fooled by patched getParameters() below.
                params.encodings.length === 1 && Object.keys(params.encodings[0]).length === 0) {
                  params.encodings = sendEncodings;
                  sender.sendEncodings = sendEncodings;
                  this.setParametersPromises.push(sender.setParameters(params).then(function () {
                    delete sender.sendEncodings;
                  })["catch"](function () {
                    delete sender.sendEncodings;
                  }));
                }
              }
              return transceiver;
            };
          }
        }
        function shimGetParameters(window) {
          if (!(_typeof(window) === 'object' && window.RTCRtpSender)) {
            return;
          }
          var origGetParameters = window.RTCRtpSender.prototype.getParameters;
          if (origGetParameters) {
            window.RTCRtpSender.prototype.getParameters = function getParameters() {
              var params = origGetParameters.apply(this, arguments);
              if (!('encodings' in params)) {
                params.encodings = [].concat(this.sendEncodings || [{}]);
              }
              return params;
            };
          }
        }
        function shimCreateOffer(window) {
          // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647
          // Firefox ignores the init sendEncodings options passed to addTransceiver
          // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection)) {
            return;
          }
          var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;
          window.RTCPeerConnection.prototype.createOffer = function createOffer() {
            var _arguments2 = arguments,
              _this4 = this;
            if (this.setParametersPromises && this.setParametersPromises.length) {
              return Promise.all(this.setParametersPromises).then(function () {
                return origCreateOffer.apply(_this4, _arguments2);
              })["finally"](function () {
                _this4.setParametersPromises = [];
              });
            }
            return origCreateOffer.apply(this, arguments);
          };
        }
        function shimCreateAnswer(window) {
          // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647
          // Firefox ignores the init sendEncodings options passed to addTransceiver
          // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918
          if (!(_typeof(window) === 'object' && window.RTCPeerConnection)) {
            return;
          }
          var origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;
          window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {
            var _arguments3 = arguments,
              _this5 = this;
            if (this.setParametersPromises && this.setParametersPromises.length) {
              return Promise.all(this.setParametersPromises).then(function () {
                return origCreateAnswer.apply(_this5, _arguments3);
              })["finally"](function () {
                _this5.setParametersPromises = [];
              });
            }
            return origCreateAnswer.apply(this, arguments);
          };
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.shimAddTransceiver;
        module.exports.shimCreateAnswer;
        module.exports.shimCreateOffer;
        module.exports.shimGetDisplayMedia;
        module.exports.shimGetParameters;
        module.exports.shimGetUserMedia;
        module.exports.shimOnTrack;
        module.exports.shimPeerConnection;
        module.exports.shimRTCDataChannel;
        module.exports.shimReceiverGetStats;
        module.exports.shimRemoveStream;
        module.exports.shimSenderGetStats;
      }, function () {
        return {
          '../utils': __cjsMetaURL$1,
          './getusermedia': __cjsMetaURL$2,
          './getdisplaymedia': __cjsMetaURL$3
        };
      });
    }
  };
});

System.register("chunks:///_virtual/getdisplaymedia.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.shimGetDisplayMedia = shimGetDisplayMedia;
        function shimGetDisplayMedia(window, preferredMediaSource) {
          if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {
            return;
          }
          if (!window.navigator.mediaDevices) {
            return;
          }
          window.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {
            if (!(constraints && constraints.video)) {
              var err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');
              err.name = 'NotFoundError';
              // from https://heycam.github.io/webidl/#idl-DOMException-error-names
              err.code = 8;
              return Promise.reject(err);
            }
            if (constraints.video === true) {
              constraints.video = {
                mediaSource: preferredMediaSource
              };
            } else {
              constraints.video.mediaSource = preferredMediaSource;
            }
            return window.navigator.mediaDevices.getUserMedia(constraints);
          };
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.shimGetDisplayMedia;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/getusermedia.js", ['./cjs-loader.mjs', './utils.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.shimGetUserMedia = shimGetUserMedia;
        var utils = _interopRequireWildcard(require("../utils.js"));
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        var logging = utils.log;
        function shimGetUserMedia(window, browserDetails) {
          var navigator = window && window.navigator;
          if (!navigator.mediaDevices) {
            return;
          }
          var constraintsToChrome_ = function constraintsToChrome_(c) {
            if (_typeof(c) !== 'object' || c.mandatory || c.optional) {
              return c;
            }
            var cc = {};
            Object.keys(c).forEach(function (key) {
              if (key === 'require' || key === 'advanced' || key === 'mediaSource') {
                return;
              }
              var r = _typeof(c[key]) === 'object' ? c[key] : {
                ideal: c[key]
              };
              if (r.exact !== undefined && typeof r.exact === 'number') {
                r.min = r.max = r.exact;
              }
              var oldname_ = function oldname_(prefix, name) {
                if (prefix) {
                  return prefix + name.charAt(0).toUpperCase() + name.slice(1);
                }
                return name === 'deviceId' ? 'sourceId' : name;
              };
              if (r.ideal !== undefined) {
                cc.optional = cc.optional || [];
                var oc = {};
                if (typeof r.ideal === 'number') {
                  oc[oldname_('min', key)] = r.ideal;
                  cc.optional.push(oc);
                  oc = {};
                  oc[oldname_('max', key)] = r.ideal;
                  cc.optional.push(oc);
                } else {
                  oc[oldname_('', key)] = r.ideal;
                  cc.optional.push(oc);
                }
              }
              if (r.exact !== undefined && typeof r.exact !== 'number') {
                cc.mandatory = cc.mandatory || {};
                cc.mandatory[oldname_('', key)] = r.exact;
              } else {
                ['min', 'max'].forEach(function (mix) {
                  if (r[mix] !== undefined) {
                    cc.mandatory = cc.mandatory || {};
                    cc.mandatory[oldname_(mix, key)] = r[mix];
                  }
                });
              }
            });
            if (c.advanced) {
              cc.optional = (cc.optional || []).concat(c.advanced);
            }
            return cc;
          };
          var shimConstraints_ = function shimConstraints_(constraints, func) {
            if (browserDetails.version >= 61) {
              return func(constraints);
            }
            constraints = JSON.parse(JSON.stringify(constraints));
            if (constraints && _typeof(constraints.audio) === 'object') {
              var remap = function remap(obj, a, b) {
                if (a in obj && !(b in obj)) {
                  obj[b] = obj[a];
                  delete obj[a];
                }
              };
              constraints = JSON.parse(JSON.stringify(constraints));
              remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');
              remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');
              constraints.audio = constraintsToChrome_(constraints.audio);
            }
            if (constraints && _typeof(constraints.video) === 'object') {
              // Shim facingMode for mobile & surface pro.
              var face = constraints.video.facingMode;
              face = face && (_typeof(face) === 'object' ? face : {
                ideal: face
              });
              var getSupportedFacingModeLies = browserDetails.version < 66;
              if (face && (face.exact === 'user' || face.exact === 'environment' || face.ideal === 'user' || face.ideal === 'environment') && !(navigator.mediaDevices.getSupportedConstraints && navigator.mediaDevices.getSupportedConstraints().facingMode && !getSupportedFacingModeLies)) {
                delete constraints.video.facingMode;
                var matches;
                if (face.exact === 'environment' || face.ideal === 'environment') {
                  matches = ['back', 'rear'];
                } else if (face.exact === 'user' || face.ideal === 'user') {
                  matches = ['front'];
                }
                if (matches) {
                  // Look for matches in label, or use last cam for back (typical).
                  return navigator.mediaDevices.enumerateDevices().then(function (devices) {
                    devices = devices.filter(function (d) {
                      return d.kind === 'videoinput';
                    });
                    var dev = devices.find(function (d) {
                      return matches.some(function (match) {
                        return d.label.toLowerCase().includes(match);
                      });
                    });
                    if (!dev && devices.length && matches.includes('back')) {
                      dev = devices[devices.length - 1]; // more likely the back cam
                    }

                    if (dev) {
                      constraints.video.deviceId = face.exact ? {
                        exact: dev.deviceId
                      } : {
                        ideal: dev.deviceId
                      };
                    }
                    constraints.video = constraintsToChrome_(constraints.video);
                    logging('chrome: ' + JSON.stringify(constraints));
                    return func(constraints);
                  });
                }
              }
              constraints.video = constraintsToChrome_(constraints.video);
            }
            logging('chrome: ' + JSON.stringify(constraints));
            return func(constraints);
          };
          var shimError_ = function shimError_(e) {
            if (browserDetails.version >= 64) {
              return e;
            }
            return {
              name: {
                PermissionDeniedError: 'NotAllowedError',
                PermissionDismissedError: 'NotAllowedError',
                InvalidStateError: 'NotAllowedError',
                DevicesNotFoundError: 'NotFoundError',
                ConstraintNotSatisfiedError: 'OverconstrainedError',
                TrackStartError: 'NotReadableError',
                MediaDeviceFailedDueToShutdown: 'NotAllowedError',
                MediaDeviceKillSwitchOn: 'NotAllowedError',
                TabCaptureError: 'AbortError',
                ScreenCaptureError: 'AbortError',
                DeviceCaptureError: 'AbortError'
              }[e.name] || e.name,
              message: e.message,
              constraint: e.constraint || e.constraintName,
              toString: function toString() {
                return this.name + (this.message && ': ') + this.message;
              }
            };
          };
          var getUserMedia_ = function getUserMedia_(constraints, onSuccess, onError) {
            shimConstraints_(constraints, function (c) {
              navigator.webkitGetUserMedia(c, onSuccess, function (e) {
                if (onError) {
                  onError(shimError_(e));
                }
              });
            });
          };
          navigator.getUserMedia = getUserMedia_.bind(navigator);

          // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia
          // function which returns a Promise, it does not accept spec-style
          // constraints.
          if (navigator.mediaDevices.getUserMedia) {
            var origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
            navigator.mediaDevices.getUserMedia = function (cs) {
              return shimConstraints_(cs, function (c) {
                return origGetUserMedia(c).then(function (stream) {
                  if (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {
                    stream.getTracks().forEach(function (track) {
                      track.stop();
                    });
                    throw new DOMException('', 'NotFoundError');
                  }
                  return stream;
                }, function (e) {
                  return Promise.reject(shimError_(e));
                });
              });
            };
          }
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.shimGetUserMedia;
      }, function () {
        return {
          '../utils.js': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/getusermedia2.js", ['./cjs-loader.mjs', './utils.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.shimGetUserMedia = shimGetUserMedia;
        var utils = _interopRequireWildcard(require("../utils"));
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        function shimGetUserMedia(window, browserDetails) {
          var navigator = window && window.navigator;
          var MediaStreamTrack = window && window.MediaStreamTrack;
          navigator.getUserMedia = function (constraints, onSuccess, onError) {
            // Replace Firefox 44+'s deprecation warning with unprefixed version.
            utils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');
            navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);
          };
          if (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {
            var remap = function remap(obj, a, b) {
              if (a in obj && !(b in obj)) {
                obj[b] = obj[a];
                delete obj[a];
              }
            };
            var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
            navigator.mediaDevices.getUserMedia = function (c) {
              if (_typeof(c) === 'object' && _typeof(c.audio) === 'object') {
                c = JSON.parse(JSON.stringify(c));
                remap(c.audio, 'autoGainControl', 'mozAutoGainControl');
                remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');
              }
              return nativeGetUserMedia(c);
            };
            if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {
              var nativeGetSettings = MediaStreamTrack.prototype.getSettings;
              MediaStreamTrack.prototype.getSettings = function () {
                var obj = nativeGetSettings.apply(this, arguments);
                remap(obj, 'mozAutoGainControl', 'autoGainControl');
                remap(obj, 'mozNoiseSuppression', 'noiseSuppression');
                return obj;
              };
            }
            if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {
              var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;
              MediaStreamTrack.prototype.applyConstraints = function (c) {
                if (this.kind === 'audio' && _typeof(c) === 'object') {
                  c = JSON.parse(JSON.stringify(c));
                  remap(c, 'autoGainControl', 'mozAutoGainControl');
                  remap(c, 'noiseSuppression', 'mozNoiseSuppression');
                }
                return nativeApplyConstraints.apply(this, [c]);
              };
            }
          }
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.shimGetUserMedia;
      }, function () {
        return {
          '../utils': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/index.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        var has = Object.prototype.hasOwnProperty,
          prefix = '~';

        /**
         * Constructor to create a storage for our `EE` objects.
         * An `Events` instance is a plain object whose properties are event names.
         *
         * @constructor
         * @private
         */
        function Events() {}

        //
        // We try to not inherit from `Object.prototype`. In some engines creating an
        // instance in this way is faster than calling `Object.create(null)` directly.
        // If `Object.create(null)` is not supported we prefix the event names with a
        // character to make sure that the built-in object properties are not
        // overridden or used as an attack vector.
        //
        if (Object.create) {
          Events.prototype = Object.create(null);

          //
          // This hack is needed because the `__proto__` property is still inherited in
          // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.
          //
          if (!new Events().__proto__) prefix = false;
        }

        /**
         * Representation of a single event listener.
         *
         * @param {Function} fn The listener function.
         * @param {*} context The context to invoke the listener with.
         * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
         * @constructor
         * @private
         */
        function EE(fn, context, once) {
          this.fn = fn;
          this.context = context;
          this.once = once || false;
        }

        /**
         * Add a listener for a given event.
         *
         * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
         * @param {(String|Symbol)} event The event name.
         * @param {Function} fn The listener function.
         * @param {*} context The context to invoke the listener with.
         * @param {Boolean} once Specify if the listener is a one-time listener.
         * @returns {EventEmitter}
         * @private
         */
        function addListener(emitter, event, fn, context, once) {
          if (typeof fn !== 'function') {
            throw new TypeError('The listener must be a function');
          }
          var listener = new EE(fn, context || emitter, once),
            evt = prefix ? prefix + event : event;
          if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);else emitter._events[evt] = [emitter._events[evt], listener];
          return emitter;
        }

        /**
         * Clear event by name.
         *
         * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
         * @param {(String|Symbol)} evt The Event name.
         * @private
         */
        function clearEvent(emitter, evt) {
          if (--emitter._eventsCount === 0) emitter._events = new Events();else delete emitter._events[evt];
        }

        /**
         * Minimal `EventEmitter` interface that is molded against the Node.js
         * `EventEmitter` interface.
         *
         * @constructor
         * @public
         */
        function EventEmitter() {
          this._events = new Events();
          this._eventsCount = 0;
        }

        /**
         * Return an array listing the events for which the emitter has registered
         * listeners.
         *
         * @returns {Array}
         * @public
         */
        EventEmitter.prototype.eventNames = function eventNames() {
          var names = [],
            events,
            name;
          if (this._eventsCount === 0) return names;
          for (name in events = this._events) {
            if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);
          }
          if (Object.getOwnPropertySymbols) {
            return names.concat(Object.getOwnPropertySymbols(events));
          }
          return names;
        };

        /**
         * Return the listeners registered for a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @returns {Array} The registered listeners.
         * @public
         */
        EventEmitter.prototype.listeners = function listeners(event) {
          var evt = prefix ? prefix + event : event,
            handlers = this._events[evt];
          if (!handlers) return [];
          if (handlers.fn) return [handlers.fn];
          for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {
            ee[i] = handlers[i].fn;
          }
          return ee;
        };

        /**
         * Return the number of listeners listening to a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @returns {Number} The number of listeners.
         * @public
         */
        EventEmitter.prototype.listenerCount = function listenerCount(event) {
          var evt = prefix ? prefix + event : event,
            listeners = this._events[evt];
          if (!listeners) return 0;
          if (listeners.fn) return 1;
          return listeners.length;
        };

        /**
         * Calls each of the listeners registered for a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @returns {Boolean} `true` if the event had listeners, else `false`.
         * @public
         */
        EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {
          var evt = prefix ? prefix + event : event;
          if (!this._events[evt]) return false;
          var listeners = this._events[evt],
            len = arguments.length,
            args,
            i;
          if (listeners.fn) {
            if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);
            switch (len) {
              case 1:
                return listeners.fn.call(listeners.context), true;
              case 2:
                return listeners.fn.call(listeners.context, a1), true;
              case 3:
                return listeners.fn.call(listeners.context, a1, a2), true;
              case 4:
                return listeners.fn.call(listeners.context, a1, a2, a3), true;
              case 5:
                return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;
              case 6:
                return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;
            }
            for (i = 1, args = new Array(len - 1); i < len; i++) {
              args[i - 1] = arguments[i];
            }
            listeners.fn.apply(listeners.context, args);
          } else {
            var length = listeners.length,
              j;
            for (i = 0; i < length; i++) {
              if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);
              switch (len) {
                case 1:
                  listeners[i].fn.call(listeners[i].context);
                  break;
                case 2:
                  listeners[i].fn.call(listeners[i].context, a1);
                  break;
                case 3:
                  listeners[i].fn.call(listeners[i].context, a1, a2);
                  break;
                case 4:
                  listeners[i].fn.call(listeners[i].context, a1, a2, a3);
                  break;
                default:
                  if (!args) for (j = 1, args = new Array(len - 1); j < len; j++) {
                    args[j - 1] = arguments[j];
                  }
                  listeners[i].fn.apply(listeners[i].context, args);
              }
            }
          }
          return true;
        };

        /**
         * Add a listener for a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @param {Function} fn The listener function.
         * @param {*} [context=this] The context to invoke the listener with.
         * @returns {EventEmitter} `this`.
         * @public
         */
        EventEmitter.prototype.on = function on(event, fn, context) {
          return addListener(this, event, fn, context, false);
        };

        /**
         * Add a one-time listener for a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @param {Function} fn The listener function.
         * @param {*} [context=this] The context to invoke the listener with.
         * @returns {EventEmitter} `this`.
         * @public
         */
        EventEmitter.prototype.once = function once(event, fn, context) {
          return addListener(this, event, fn, context, true);
        };

        /**
         * Remove the listeners of a given event.
         *
         * @param {(String|Symbol)} event The event name.
         * @param {Function} fn Only remove the listeners that match this function.
         * @param {*} context Only remove the listeners that have this context.
         * @param {Boolean} once Only remove one-time listeners.
         * @returns {EventEmitter} `this`.
         * @public
         */
        EventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {
          var evt = prefix ? prefix + event : event;
          if (!this._events[evt]) return this;
          if (!fn) {
            clearEvent(this, evt);
            return this;
          }
          var listeners = this._events[evt];
          if (listeners.fn) {
            if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) {
              clearEvent(this, evt);
            }
          } else {
            for (var i = 0, events = [], length = listeners.length; i < length; i++) {
              if (listeners[i].fn !== fn || once && !listeners[i].once || context && listeners[i].context !== context) {
                events.push(listeners[i]);
              }
            }

            //
            // Reset the array, or remove it completely if we have no more listeners.
            //
            if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;else clearEvent(this, evt);
          }
          return this;
        };

        /**
         * Remove all listeners, or those of the specified event.
         *
         * @param {(String|Symbol)} [event] The event name.
         * @returns {EventEmitter} `this`.
         * @public
         */
        EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {
          var evt;
          if (event) {
            evt = prefix ? prefix + event : event;
            if (this._events[evt]) clearEvent(this, evt);
          } else {
            this._events = new Events();
            this._eventsCount = 0;
          }
          return this;
        };

        //
        // Alias methods names because people roll like that.
        //
        EventEmitter.prototype.off = EventEmitter.prototype.removeListener;
        EventEmitter.prototype.addListener = EventEmitter.prototype.on;

        //
        // Expose the prefix.
        //
        EventEmitter.prefixed = prefix;

        //
        // Allow `EventEmitter` to be imported as module namespace.
        //
        EventEmitter.EventEmitter = EventEmitter;

        //
        // Expose the module.
        //
        if ('undefined' !== typeof module) {
          module.exports = EventEmitter;
        }

        // #endregion ORIGINAL CODE

        module.exports;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/index2.js", ['./cjs-loader.mjs', './encode.js', './decode.js', './decodeAsync.js', './Decoder.js', './DecodeError.js', './Encoder.js', './ExtensionCodec.js', './ExtData.js', './timestamp.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2, __cjsMetaURL$3, __cjsMetaURL$4, __cjsMetaURL$5, __cjsMetaURL$6, __cjsMetaURL$7, __cjsMetaURL$8, __cjsMetaURL$9;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$3 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$4 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$5 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$6 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$7 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$8 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$9 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // Main Functions:
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.decodeTimestampExtension = exports.encodeTimestampExtension = exports.decodeTimestampToTimeSpec = exports.encodeTimeSpecToTimestamp = exports.encodeDateToTimeSpec = exports.EXT_TIMESTAMP = exports.ExtData = exports.ExtensionCodec = exports.Encoder = exports.DataViewIndexOutOfBoundsError = exports.DecodeError = exports.Decoder = exports.decodeStream = exports.decodeMultiStream = exports.decodeArrayStream = exports.decodeAsync = exports.decodeMulti = exports.decode = exports.encode = void 0;
        var encode_1 = require("./encode");
        Object.defineProperty(exports, "encode", {
          enumerable: true,
          get: function get() {
            return encode_1.encode;
          }
        });
        var decode_1 = require("./decode");
        Object.defineProperty(exports, "decode", {
          enumerable: true,
          get: function get() {
            return decode_1.decode;
          }
        });
        Object.defineProperty(exports, "decodeMulti", {
          enumerable: true,
          get: function get() {
            return decode_1.decodeMulti;
          }
        });
        var decodeAsync_1 = require("./decodeAsync");
        Object.defineProperty(exports, "decodeAsync", {
          enumerable: true,
          get: function get() {
            return decodeAsync_1.decodeAsync;
          }
        });
        Object.defineProperty(exports, "decodeArrayStream", {
          enumerable: true,
          get: function get() {
            return decodeAsync_1.decodeArrayStream;
          }
        });
        Object.defineProperty(exports, "decodeMultiStream", {
          enumerable: true,
          get: function get() {
            return decodeAsync_1.decodeMultiStream;
          }
        });
        Object.defineProperty(exports, "decodeStream", {
          enumerable: true,
          get: function get() {
            return decodeAsync_1.decodeStream;
          }
        });
        var Decoder_1 = require("./Decoder");
        Object.defineProperty(exports, "Decoder", {
          enumerable: true,
          get: function get() {
            return Decoder_1.Decoder;
          }
        });
        Object.defineProperty(exports, "DataViewIndexOutOfBoundsError", {
          enumerable: true,
          get: function get() {
            return Decoder_1.DataViewIndexOutOfBoundsError;
          }
        });
        var DecodeError_1 = require("./DecodeError");
        Object.defineProperty(exports, "DecodeError", {
          enumerable: true,
          get: function get() {
            return DecodeError_1.DecodeError;
          }
        });
        var Encoder_1 = require("./Encoder");
        Object.defineProperty(exports, "Encoder", {
          enumerable: true,
          get: function get() {
            return Encoder_1.Encoder;
          }
        });
        // Utilitiies for Extension Types:
        var ExtensionCodec_1 = require("./ExtensionCodec");
        Object.defineProperty(exports, "ExtensionCodec", {
          enumerable: true,
          get: function get() {
            return ExtensionCodec_1.ExtensionCodec;
          }
        });
        var ExtData_1 = require("./ExtData");
        Object.defineProperty(exports, "ExtData", {
          enumerable: true,
          get: function get() {
            return ExtData_1.ExtData;
          }
        });
        var timestamp_1 = require("./timestamp");
        Object.defineProperty(exports, "EXT_TIMESTAMP", {
          enumerable: true,
          get: function get() {
            return timestamp_1.EXT_TIMESTAMP;
          }
        });
        Object.defineProperty(exports, "encodeDateToTimeSpec", {
          enumerable: true,
          get: function get() {
            return timestamp_1.encodeDateToTimeSpec;
          }
        });
        Object.defineProperty(exports, "encodeTimeSpecToTimestamp", {
          enumerable: true,
          get: function get() {
            return timestamp_1.encodeTimeSpecToTimestamp;
          }
        });
        Object.defineProperty(exports, "decodeTimestampToTimeSpec", {
          enumerable: true,
          get: function get() {
            return timestamp_1.decodeTimestampToTimeSpec;
          }
        });
        Object.defineProperty(exports, "encodeTimestampExtension", {
          enumerable: true,
          get: function get() {
            return timestamp_1.encodeTimestampExtension;
          }
        });
        Object.defineProperty(exports, "decodeTimestampExtension", {
          enumerable: true,
          get: function get() {
            return timestamp_1.decodeTimestampExtension;
          }
        });

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.decodeTimestampExtension;
        module.exports.encodeTimestampExtension;
        module.exports.decodeTimestampToTimeSpec;
        module.exports.encodeTimeSpecToTimestamp;
        module.exports.encodeDateToTimeSpec;
        module.exports.EXT_TIMESTAMP;
        module.exports.ExtData;
        module.exports.ExtensionCodec;
        module.exports.Encoder;
        module.exports.DataViewIndexOutOfBoundsError;
        module.exports.DecodeError;
        module.exports.Decoder;
        module.exports.decodeStream;
        module.exports.decodeMultiStream;
        module.exports.decodeArrayStream;
        module.exports.decodeAsync;
        module.exports.decodeMulti;
        module.exports.decode;
        module.exports.encode;
      }, function () {
        return {
          './encode': __cjsMetaURL$1,
          './decode': __cjsMetaURL$2,
          './decodeAsync': __cjsMetaURL$3,
          './Decoder': __cjsMetaURL$4,
          './DecodeError': __cjsMetaURL$5,
          './Encoder': __cjsMetaURL$6,
          './ExtensionCodec': __cjsMetaURL$7,
          './ExtData': __cjsMetaURL$8,
          './timestamp': __cjsMetaURL$9
        };
      });
    }
  };
});

System.register("chunks:///_virtual/int.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // Integer Utility
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.getUint64 = exports.getInt64 = exports.setInt64 = exports.setUint64 = exports.UINT32_MAX = void 0;
        exports.UINT32_MAX = 4294967295;
        // DataView extension to handle int64 / uint64,
        // where the actual range is 53-bits integer (a.k.a. safe integer)
        function setUint64(view, offset, value) {
          var high = value / 4294967296;
          var low = value; // high bits are truncated by DataView
          view.setUint32(offset, high);
          view.setUint32(offset + 4, low);
        }
        exports.setUint64 = setUint64;
        function setInt64(view, offset, value) {
          var high = Math.floor(value / 4294967296);
          var low = value; // high bits are truncated by DataView
          view.setUint32(offset, high);
          view.setUint32(offset + 4, low);
        }
        exports.setInt64 = setInt64;
        function getInt64(view, offset) {
          var high = view.getInt32(offset);
          var low = view.getUint32(offset + 4);
          return high * 4294967296 + low;
        }
        exports.getInt64 = getInt64;
        function getUint64(view, offset) {
          var high = view.getUint32(offset);
          var low = view.getUint32(offset + 4);
          return high * 4294967296 + low;
        }
        exports.getUint64 = getUint64;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.getUint64;
        module.exports.getInt64;
        module.exports.setInt64;
        module.exports.setUint64;
        module.exports.UINT32_MAX;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/prettyByte.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.prettyByte = void 0;
        function prettyByte(_byte) {
          return (_byte < 0 ? "-" : "") + "0x" + Math.abs(_byte).toString(16).padStart(2, "0");
        }
        exports.prettyByte = prettyByte;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.prettyByte;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/rollupPluginModLoBabelHelpers.js", [], function (exports) {
  return {
    execute: function () {
      exports({
        applyDecoratedDescriptor: _applyDecoratedDescriptor,
        arrayLikeToArray: _arrayLikeToArray,
        assertThisInitialized: _assertThisInitialized,
        asyncToGenerator: _asyncToGenerator,
        construct: _construct,
        createClass: _createClass,
        createForOfIteratorHelperLoose: _createForOfIteratorHelperLoose,
        extends: _extends,
        inheritsLoose: _inheritsLoose,
        initializerDefineProperty: _initializerDefineProperty,
        isNativeReflectConstruct: _isNativeReflectConstruct,
        regeneratorRuntime: _regeneratorRuntime,
        setPrototypeOf: _setPrototypeOf,
        toPrimitive: _toPrimitive,
        toPropertyKey: _toPropertyKey,
        unsupportedIterableToArray: _unsupportedIterableToArray
      });
      function _regeneratorRuntime() {
        /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
        _regeneratorRuntime = exports('regeneratorRuntime', function () {
          return e;
        });
        var t,
          e = {},
          r = Object.prototype,
          n = r.hasOwnProperty,
          o = Object.defineProperty || function (t, e, r) {
            t[e] = r.value;
          },
          i = "function" == typeof Symbol ? Symbol : {},
          a = i.iterator || "@@iterator",
          c = i.asyncIterator || "@@asyncIterator",
          u = i.toStringTag || "@@toStringTag";
        function define(t, e, r) {
          return Object.defineProperty(t, e, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }), t[e];
        }
        try {
          define({}, "");
        } catch (t) {
          define = function (t, e, r) {
            return t[e] = r;
          };
        }
        function wrap(t, e, r, n) {
          var i = e && e.prototype instanceof Generator ? e : Generator,
            a = Object.create(i.prototype),
            c = new Context(n || []);
          return o(a, "_invoke", {
            value: makeInvokeMethod(t, r, c)
          }), a;
        }
        function tryCatch(t, e, r) {
          try {
            return {
              type: "normal",
              arg: t.call(e, r)
            };
          } catch (t) {
            return {
              type: "throw",
              arg: t
            };
          }
        }
        e.wrap = wrap;
        var h = "suspendedStart",
          l = "suspendedYield",
          f = "executing",
          s = "completed",
          y = {};
        function Generator() {}
        function GeneratorFunction() {}
        function GeneratorFunctionPrototype() {}
        var p = {};
        define(p, a, function () {
          return this;
        });
        var d = Object.getPrototypeOf,
          v = d && d(d(values([])));
        v && v !== r && n.call(v, a) && (p = v);
        var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);
        function defineIteratorMethods(t) {
          ["next", "throw", "return"].forEach(function (e) {
            define(t, e, function (t) {
              return this._invoke(e, t);
            });
          });
        }
        function AsyncIterator(t, e) {
          function invoke(r, o, i, a) {
            var c = tryCatch(t[r], t, o);
            if ("throw" !== c.type) {
              var u = c.arg,
                h = u.value;
              return h && "object" == typeof h && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) {
                invoke("next", t, i, a);
              }, function (t) {
                invoke("throw", t, i, a);
              }) : e.resolve(h).then(function (t) {
                u.value = t, i(u);
              }, function (t) {
                return invoke("throw", t, i, a);
              });
            }
            a(c.arg);
          }
          var r;
          o(this, "_invoke", {
            value: function (t, n) {
              function callInvokeWithMethodAndArg() {
                return new e(function (e, r) {
                  invoke(t, n, e, r);
                });
              }
              return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
          });
        }
        function makeInvokeMethod(e, r, n) {
          var o = h;
          return function (i, a) {
            if (o === f) throw new Error("Generator is already running");
            if (o === s) {
              if ("throw" === i) throw a;
              return {
                value: t,
                done: !0
              };
            }
            for (n.method = i, n.arg = a;;) {
              var c = n.delegate;
              if (c) {
                var u = maybeInvokeDelegate(c, n);
                if (u) {
                  if (u === y) continue;
                  return u;
                }
              }
              if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) {
                if (o === h) throw o = s, n.arg;
                n.dispatchException(n.arg);
              } else "return" === n.method && n.abrupt("return", n.arg);
              o = f;
              var p = tryCatch(e, r, n);
              if ("normal" === p.type) {
                if (o = n.done ? s : l, p.arg === y) continue;
                return {
                  value: p.arg,
                  done: n.done
                };
              }
              "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg);
            }
          };
        }
        function maybeInvokeDelegate(e, r) {
          var n = r.method,
            o = e.iterator[n];
          if (o === t) return r.delegate = null, "throw" === n && e.iterator.return && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y;
          var i = tryCatch(o, e.iterator, r.arg);
          if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y;
          var a = i.arg;
          return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y);
        }
        function pushTryEntry(t) {
          var e = {
            tryLoc: t[0]
          };
          1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
        }
        function resetTryEntry(t) {
          var e = t.completion || {};
          e.type = "normal", delete e.arg, t.completion = e;
        }
        function Context(t) {
          this.tryEntries = [{
            tryLoc: "root"
          }], t.forEach(pushTryEntry, this), this.reset(!0);
        }
        function values(e) {
          if (e || "" === e) {
            var r = e[a];
            if (r) return r.call(e);
            if ("function" == typeof e.next) return e;
            if (!isNaN(e.length)) {
              var o = -1,
                i = function next() {
                  for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;
                  return next.value = t, next.done = !0, next;
                };
              return i.next = i;
            }
          }
          throw new TypeError(typeof e + " is not iterable");
        }
        return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", {
          value: GeneratorFunctionPrototype,
          configurable: !0
        }), o(GeneratorFunctionPrototype, "constructor", {
          value: GeneratorFunction,
          configurable: !0
        }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
          var e = "function" == typeof t && t.constructor;
          return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name));
        }, e.mark = function (t) {
          return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t;
        }, e.awrap = function (t) {
          return {
            __await: t
          };
        }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {
          return this;
        }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {
          void 0 === i && (i = Promise);
          var a = new AsyncIterator(wrap(t, r, n, o), i);
          return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {
            return t.done ? t.value : a.next();
          });
        }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () {
          return this;
        }), define(g, "toString", function () {
          return "[object Generator]";
        }), e.keys = function (t) {
          var e = Object(t),
            r = [];
          for (var n in e) r.push(n);
          return r.reverse(), function next() {
            for (; r.length;) {
              var t = r.pop();
              if (t in e) return next.value = t, next.done = !1, next;
            }
            return next.done = !0, next;
          };
        }, e.values = values, Context.prototype = {
          constructor: Context,
          reset: function (e) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);
          },
          stop: function () {
            this.done = !0;
            var t = this.tryEntries[0].completion;
            if ("throw" === t.type) throw t.arg;
            return this.rval;
          },
          dispatchException: function (e) {
            if (this.done) throw e;
            var r = this;
            function handle(n, o) {
              return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o;
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var i = this.tryEntries[o],
                a = i.completion;
              if ("root" === i.tryLoc) return handle("end");
              if (i.tryLoc <= this.prev) {
                var c = n.call(i, "catchLoc"),
                  u = n.call(i, "finallyLoc");
                if (c && u) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                } else if (c) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                } else {
                  if (!u) throw new Error("try statement without catch or finally");
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                }
              }
            }
          },
          abrupt: function (t, e) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var o = this.tryEntries[r];
              if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                var i = o;
                break;
              }
            }
            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
            var a = i ? i.completion : {};
            return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a);
          },
          complete: function (t, e) {
            if ("throw" === t.type) throw t.arg;
            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y;
          },
          finish: function (t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;
            }
          },
          catch: function (t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.tryLoc === t) {
                var n = r.completion;
                if ("throw" === n.type) {
                  var o = n.arg;
                  resetTryEntry(r);
                }
                return o;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function (e, r, n) {
            return this.delegate = {
              iterator: values(e),
              resultName: r,
              nextLoc: n
            }, "next" === this.method && (this.arg = t), y;
          }
        }, e;
      }
      function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }
        if (info.done) {
          resolve(value);
        } else {
          Promise.resolve(value).then(_next, _throw);
        }
      }
      function _asyncToGenerator(fn) {
        return function () {
          var self = this,
            args = arguments;
          return new Promise(function (resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
              asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
          });
        };
      }
      function _defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
          var descriptor = props[i];
          descriptor.enumerable = descriptor.enumerable || false;
          descriptor.configurable = true;
          if ("value" in descriptor) descriptor.writable = true;
          Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);
        }
      }
      function _createClass(Constructor, protoProps, staticProps) {
        if (protoProps) _defineProperties(Constructor.prototype, protoProps);
        if (staticProps) _defineProperties(Constructor, staticProps);
        Object.defineProperty(Constructor, "prototype", {
          writable: false
        });
        return Constructor;
      }
      function _extends() {
        _extends = exports('extends', Object.assign ? Object.assign.bind() : function (target) {
          for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i];
            for (var key in source) {
              if (Object.prototype.hasOwnProperty.call(source, key)) {
                target[key] = source[key];
              }
            }
          }
          return target;
        });
        return _extends.apply(this, arguments);
      }
      function _inheritsLoose(subClass, superClass) {
        subClass.prototype = Object.create(superClass.prototype);
        subClass.prototype.constructor = subClass;
        _setPrototypeOf(subClass, superClass);
      }
      function _setPrototypeOf(o, p) {
        _setPrototypeOf = exports('setPrototypeOf', Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {
          o.__proto__ = p;
          return o;
        });
        return _setPrototypeOf(o, p);
      }
      function _isNativeReflectConstruct() {
        if (typeof Reflect === "undefined" || !Reflect.construct) return false;
        if (Reflect.construct.sham) return false;
        if (typeof Proxy === "function") return true;
        try {
          Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));
          return true;
        } catch (e) {
          return false;
        }
      }
      function _construct(Parent, args, Class) {
        if (_isNativeReflectConstruct()) {
          _construct = exports('construct', Reflect.construct.bind());
        } else {
          _construct = exports('construct', function _construct(Parent, args, Class) {
            var a = [null];
            a.push.apply(a, args);
            var Constructor = Function.bind.apply(Parent, a);
            var instance = new Constructor();
            if (Class) _setPrototypeOf(instance, Class.prototype);
            return instance;
          });
        }
        return _construct.apply(null, arguments);
      }
      function _assertThisInitialized(self) {
        if (self === void 0) {
          throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        }
        return self;
      }
      function _unsupportedIterableToArray(o, minLen) {
        if (!o) return;
        if (typeof o === "string") return _arrayLikeToArray(o, minLen);
        var n = Object.prototype.toString.call(o).slice(8, -1);
        if (n === "Object" && o.constructor) n = o.constructor.name;
        if (n === "Map" || n === "Set") return Array.from(o);
        if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
      }
      function _arrayLikeToArray(arr, len) {
        if (len == null || len > arr.length) len = arr.length;
        for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
        return arr2;
      }
      function _createForOfIteratorHelperLoose(o, allowArrayLike) {
        var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
        if (it) return (it = it.call(o)).next.bind(it);
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
          if (it) o = it;
          var i = 0;
          return function () {
            if (i >= o.length) return {
              done: true
            };
            return {
              done: false,
              value: o[i++]
            };
          };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
      }
      function _toPrimitive(input, hint) {
        if (typeof input !== "object" || input === null) return input;
        var prim = input[Symbol.toPrimitive];
        if (prim !== undefined) {
          var res = prim.call(input, hint || "default");
          if (typeof res !== "object") return res;
          throw new TypeError("@@toPrimitive must return a primitive value.");
        }
        return (hint === "string" ? String : Number)(input);
      }
      function _toPropertyKey(arg) {
        var key = _toPrimitive(arg, "string");
        return typeof key === "symbol" ? key : String(key);
      }
      function _initializerDefineProperty(target, property, descriptor, context) {
        if (!descriptor) return;
        Object.defineProperty(target, property, {
          enumerable: descriptor.enumerable,
          configurable: descriptor.configurable,
          writable: descriptor.writable,
          value: descriptor.initializer ? descriptor.initializer.call(context) : void 0
        });
      }
      function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
        var desc = {};
        Object.keys(descriptor).forEach(function (key) {
          desc[key] = descriptor[key];
        });
        desc.enumerable = !!desc.enumerable;
        desc.configurable = !!desc.configurable;
        if ('value' in desc || desc.initializer) {
          desc.writable = true;
        }
        desc = decorators.slice().reverse().reduce(function (desc, decorator) {
          return decorator(target, property, desc) || desc;
        }, desc);
        if (context && desc.initializer !== void 0) {
          desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
          desc.initializer = undefined;
        }
        if (desc.initializer === void 0) {
          Object.defineProperty(target, property, desc);
          desc = null;
        }
        return desc;
      }
    }
  };
});

System.register("chunks:///_virtual/safari_shim.js", ['./cjs-loader.mjs', './utils.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.shimAudioContext = shimAudioContext;
        exports.shimCallbacksAPI = shimCallbacksAPI;
        exports.shimConstraints = shimConstraints;
        exports.shimCreateOfferLegacy = shimCreateOfferLegacy;
        exports.shimGetUserMedia = shimGetUserMedia;
        exports.shimLocalStreamsAPI = shimLocalStreamsAPI;
        exports.shimRTCIceServerUrls = shimRTCIceServerUrls;
        exports.shimRemoteStreamsAPI = shimRemoteStreamsAPI;
        exports.shimTrackEventTransceiver = shimTrackEventTransceiver;
        var utils = _interopRequireWildcard(require("../utils"));
        function _getRequireWildcardCache(e) {
          if ("function" != typeof WeakMap) return null;
          var r = new WeakMap(),
            t = new WeakMap();
          return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
            return e ? t : r;
          })(e);
        }
        function _interopRequireWildcard(e, r) {
          if (!r && e && e.__esModule) return e;
          if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
            "default": e
          };
          var t = _getRequireWildcardCache(r);
          if (t && t.has(e)) return t.get(e);
          var n = {
              __proto__: null
            },
            a = Object.defineProperty && Object.getOwnPropertyDescriptor;
          for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
            var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
            i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
          }
          return n["default"] = e, t && t.set(e, n), n;
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        function shimLocalStreamsAPI(window) {
          if (_typeof(window) !== 'object' || !window.RTCPeerConnection) {
            return;
          }
          if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {
            window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {
              if (!this._localStreams) {
                this._localStreams = [];
              }
              return this._localStreams;
            };
          }
          if (!('addStream' in window.RTCPeerConnection.prototype)) {
            var _addTrack = window.RTCPeerConnection.prototype.addTrack;
            window.RTCPeerConnection.prototype.addStream = function addStream(stream) {
              var _this = this;
              if (!this._localStreams) {
                this._localStreams = [];
              }
              if (!this._localStreams.includes(stream)) {
                this._localStreams.push(stream);
              }
              // Try to emulate Chrome's behaviour of adding in audio-video order.
              // Safari orders by track id.
              stream.getAudioTracks().forEach(function (track) {
                return _addTrack.call(_this, track, stream);
              });
              stream.getVideoTracks().forEach(function (track) {
                return _addTrack.call(_this, track, stream);
              });
            };
            window.RTCPeerConnection.prototype.addTrack = function addTrack(track) {
              var _this2 = this;
              for (var _len = arguments.length, streams = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                streams[_key - 1] = arguments[_key];
              }
              if (streams) {
                streams.forEach(function (stream) {
                  if (!_this2._localStreams) {
                    _this2._localStreams = [stream];
                  } else if (!_this2._localStreams.includes(stream)) {
                    _this2._localStreams.push(stream);
                  }
                });
              }
              return _addTrack.apply(this, arguments);
            };
          }
          if (!('removeStream' in window.RTCPeerConnection.prototype)) {
            window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {
              var _this3 = this;
              if (!this._localStreams) {
                this._localStreams = [];
              }
              var index = this._localStreams.indexOf(stream);
              if (index === -1) {
                return;
              }
              this._localStreams.splice(index, 1);
              var tracks = stream.getTracks();
              this.getSenders().forEach(function (sender) {
                if (tracks.includes(sender.track)) {
                  _this3.removeTrack(sender);
                }
              });
            };
          }
        }
        function shimRemoteStreamsAPI(window) {
          if (_typeof(window) !== 'object' || !window.RTCPeerConnection) {
            return;
          }
          if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {
            window.RTCPeerConnection.prototype.getRemoteStreams = function getRemoteStreams() {
              return this._remoteStreams ? this._remoteStreams : [];
            };
          }
          if (!('onaddstream' in window.RTCPeerConnection.prototype)) {
            Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {
              get: function get() {
                return this._onaddstream;
              },
              set: function set(f) {
                var _this4 = this;
                if (this._onaddstream) {
                  this.removeEventListener('addstream', this._onaddstream);
                  this.removeEventListener('track', this._onaddstreampoly);
                }
                this.addEventListener('addstream', this._onaddstream = f);
                this.addEventListener('track', this._onaddstreampoly = function (e) {
                  e.streams.forEach(function (stream) {
                    if (!_this4._remoteStreams) {
                      _this4._remoteStreams = [];
                    }
                    if (_this4._remoteStreams.includes(stream)) {
                      return;
                    }
                    _this4._remoteStreams.push(stream);
                    var event = new Event('addstream');
                    event.stream = stream;
                    _this4.dispatchEvent(event);
                  });
                });
              }
            });
            var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;
            window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {
              var pc = this;
              if (!this._onaddstreampoly) {
                this.addEventListener('track', this._onaddstreampoly = function (e) {
                  e.streams.forEach(function (stream) {
                    if (!pc._remoteStreams) {
                      pc._remoteStreams = [];
                    }
                    if (pc._remoteStreams.indexOf(stream) >= 0) {
                      return;
                    }
                    pc._remoteStreams.push(stream);
                    var event = new Event('addstream');
                    event.stream = stream;
                    pc.dispatchEvent(event);
                  });
                });
              }
              return origSetRemoteDescription.apply(pc, arguments);
            };
          }
        }
        function shimCallbacksAPI(window) {
          if (_typeof(window) !== 'object' || !window.RTCPeerConnection) {
            return;
          }
          var prototype = window.RTCPeerConnection.prototype;
          var origCreateOffer = prototype.createOffer;
          var origCreateAnswer = prototype.createAnswer;
          var setLocalDescription = prototype.setLocalDescription;
          var setRemoteDescription = prototype.setRemoteDescription;
          var addIceCandidate = prototype.addIceCandidate;
          prototype.createOffer = function createOffer(successCallback, failureCallback) {
            var options = arguments.length >= 2 ? arguments[2] : arguments[0];
            var promise = origCreateOffer.apply(this, [options]);
            if (!failureCallback) {
              return promise;
            }
            promise.then(successCallback, failureCallback);
            return Promise.resolve();
          };
          prototype.createAnswer = function createAnswer(successCallback, failureCallback) {
            var options = arguments.length >= 2 ? arguments[2] : arguments[0];
            var promise = origCreateAnswer.apply(this, [options]);
            if (!failureCallback) {
              return promise;
            }
            promise.then(successCallback, failureCallback);
            return Promise.resolve();
          };
          var withCallback = function withCallback(description, successCallback, failureCallback) {
            var promise = setLocalDescription.apply(this, [description]);
            if (!failureCallback) {
              return promise;
            }
            promise.then(successCallback, failureCallback);
            return Promise.resolve();
          };
          prototype.setLocalDescription = withCallback;
          withCallback = function withCallback(description, successCallback, failureCallback) {
            var promise = setRemoteDescription.apply(this, [description]);
            if (!failureCallback) {
              return promise;
            }
            promise.then(successCallback, failureCallback);
            return Promise.resolve();
          };
          prototype.setRemoteDescription = withCallback;
          withCallback = function withCallback(candidate, successCallback, failureCallback) {
            var promise = addIceCandidate.apply(this, [candidate]);
            if (!failureCallback) {
              return promise;
            }
            promise.then(successCallback, failureCallback);
            return Promise.resolve();
          };
          prototype.addIceCandidate = withCallback;
        }
        function shimGetUserMedia(window) {
          var navigator = window && window.navigator;
          if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // shim not needed in Safari 12.1
            var mediaDevices = navigator.mediaDevices;
            var _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);
            navigator.mediaDevices.getUserMedia = function (constraints) {
              return _getUserMedia(shimConstraints(constraints));
            };
          }
          if (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {
              navigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);
            }.bind(navigator);
          }
        }
        function shimConstraints(constraints) {
          if (constraints && constraints.video !== undefined) {
            return Object.assign({}, constraints, {
              video: utils.compactObject(constraints.video)
            });
          }
          return constraints;
        }
        function shimRTCIceServerUrls(window) {
          if (!window.RTCPeerConnection) {
            return;
          }
          // migrate from non-spec RTCIceServer.url to RTCIceServer.urls
          var OrigPeerConnection = window.RTCPeerConnection;
          window.RTCPeerConnection = function RTCPeerConnection(pcConfig, pcConstraints) {
            if (pcConfig && pcConfig.iceServers) {
              var newIceServers = [];
              for (var i = 0; i < pcConfig.iceServers.length; i++) {
                var server = pcConfig.iceServers[i];
                if (server.urls === undefined && server.url) {
                  utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');
                  server = JSON.parse(JSON.stringify(server));
                  server.urls = server.url;
                  delete server.url;
                  newIceServers.push(server);
                } else {
                  newIceServers.push(pcConfig.iceServers[i]);
                }
              }
              pcConfig.iceServers = newIceServers;
            }
            return new OrigPeerConnection(pcConfig, pcConstraints);
          };
          window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;
          // wrap static methods. Currently just generateCertificate.
          if ('generateCertificate' in OrigPeerConnection) {
            Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {
              get: function get() {
                return OrigPeerConnection.generateCertificate;
              }
            });
          }
        }
        function shimTrackEventTransceiver(window) {
          // Add event.transceiver member over deprecated event.receiver
          if (_typeof(window) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {
            Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {
              get: function get() {
                return {
                  receiver: this.receiver
                };
              }
            });
          }
        }
        function shimCreateOfferLegacy(window) {
          var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;
          window.RTCPeerConnection.prototype.createOffer = function createOffer(offerOptions) {
            if (offerOptions) {
              if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {
                // support bit values
                offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;
              }
              var audioTransceiver = this.getTransceivers().find(function (transceiver) {
                return transceiver.receiver.track.kind === 'audio';
              });
              if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {
                if (audioTransceiver.direction === 'sendrecv') {
                  if (audioTransceiver.setDirection) {
                    audioTransceiver.setDirection('sendonly');
                  } else {
                    audioTransceiver.direction = 'sendonly';
                  }
                } else if (audioTransceiver.direction === 'recvonly') {
                  if (audioTransceiver.setDirection) {
                    audioTransceiver.setDirection('inactive');
                  } else {
                    audioTransceiver.direction = 'inactive';
                  }
                }
              } else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {
                this.addTransceiver('audio', {
                  direction: 'recvonly'
                });
              }
              if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {
                // support bit values
                offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;
              }
              var videoTransceiver = this.getTransceivers().find(function (transceiver) {
                return transceiver.receiver.track.kind === 'video';
              });
              if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {
                if (videoTransceiver.direction === 'sendrecv') {
                  if (videoTransceiver.setDirection) {
                    videoTransceiver.setDirection('sendonly');
                  } else {
                    videoTransceiver.direction = 'sendonly';
                  }
                } else if (videoTransceiver.direction === 'recvonly') {
                  if (videoTransceiver.setDirection) {
                    videoTransceiver.setDirection('inactive');
                  } else {
                    videoTransceiver.direction = 'inactive';
                  }
                }
              } else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {
                this.addTransceiver('video', {
                  direction: 'recvonly'
                });
              }
            }
            return origCreateOffer.apply(this, arguments);
          };
        }
        function shimAudioContext(window) {
          if (_typeof(window) !== 'object' || window.AudioContext) {
            return;
          }
          window.AudioContext = window.webkitAudioContext;
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.shimAudioContext;
        module.exports.shimCallbacksAPI;
        module.exports.shimConstraints;
        module.exports.shimCreateOfferLegacy;
        module.exports.shimGetUserMedia;
        module.exports.shimLocalStreamsAPI;
        module.exports.shimRTCIceServerUrls;
        module.exports.shimRemoteStreamsAPI;
        module.exports.shimTrackEventTransceiver;
      }, function () {
        return {
          '../utils': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/sdp.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // SDP helpers.
        var SDPUtils = {};

        // Generate an alphanumeric identifier for cname or mids.
        // TODO: use UUIDs instead? https://gist.github.com/jed/982883
        SDPUtils.generateIdentifier = function () {
          return Math.random().toString(36).substring(2, 12);
        };

        // The RTCP CNAME used by all peerconnections from the same JS.
        SDPUtils.localCName = SDPUtils.generateIdentifier();

        // Splits SDP into lines, dealing with both CRLF and LF.
        SDPUtils.splitLines = function (blob) {
          return blob.trim().split('\n').map(function (line) {
            return line.trim();
          });
        };
        // Splits SDP into sessionpart and mediasections. Ensures CRLF.
        SDPUtils.splitSections = function (blob) {
          var parts = blob.split('\nm=');
          return parts.map(function (part, index) {
            return (index > 0 ? 'm=' + part : part).trim() + '\r\n';
          });
        };

        // Returns the session description.
        SDPUtils.getDescription = function (blob) {
          var sections = SDPUtils.splitSections(blob);
          return sections && sections[0];
        };

        // Returns the individual media sections.
        SDPUtils.getMediaSections = function (blob) {
          var sections = SDPUtils.splitSections(blob);
          sections.shift();
          return sections;
        };

        // Returns lines that start with a certain prefix.
        SDPUtils.matchPrefix = function (blob, prefix) {
          return SDPUtils.splitLines(blob).filter(function (line) {
            return line.indexOf(prefix) === 0;
          });
        };

        // Parses an ICE candidate line. Sample input:
        // candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8
        // rport 55996"
        // Input can be prefixed with a=.
        SDPUtils.parseCandidate = function (line) {
          var parts;
          // Parse both variants.
          if (line.indexOf('a=candidate:') === 0) {
            parts = line.substring(12).split(' ');
          } else {
            parts = line.substring(10).split(' ');
          }
          var candidate = {
            foundation: parts[0],
            component: {
              1: 'rtp',
              2: 'rtcp'
            }[parts[1]] || parts[1],
            protocol: parts[2].toLowerCase(),
            priority: parseInt(parts[3], 10),
            ip: parts[4],
            address: parts[4],
            // address is an alias for ip.
            port: parseInt(parts[5], 10),
            // skip parts[6] == 'typ'
            type: parts[7]
          };
          for (var i = 8; i < parts.length; i += 2) {
            switch (parts[i]) {
              case 'raddr':
                candidate.relatedAddress = parts[i + 1];
                break;
              case 'rport':
                candidate.relatedPort = parseInt(parts[i + 1], 10);
                break;
              case 'tcptype':
                candidate.tcpType = parts[i + 1];
                break;
              case 'ufrag':
                candidate.ufrag = parts[i + 1]; // for backward compatibility.
                candidate.usernameFragment = parts[i + 1];
                break;
              default:
                // extension handling, in particular ufrag. Don't overwrite.
                if (candidate[parts[i]] === undefined) {
                  candidate[parts[i]] = parts[i + 1];
                }
                break;
            }
          }
          return candidate;
        };

        // Translates a candidate object into SDP candidate attribute.
        // This does not include the a= prefix!
        SDPUtils.writeCandidate = function (candidate) {
          var sdp = [];
          sdp.push(candidate.foundation);
          var component = candidate.component;
          if (component === 'rtp') {
            sdp.push(1);
          } else if (component === 'rtcp') {
            sdp.push(2);
          } else {
            sdp.push(component);
          }
          sdp.push(candidate.protocol.toUpperCase());
          sdp.push(candidate.priority);
          sdp.push(candidate.address || candidate.ip);
          sdp.push(candidate.port);
          var type = candidate.type;
          sdp.push('typ');
          sdp.push(type);
          if (type !== 'host' && candidate.relatedAddress && candidate.relatedPort) {
            sdp.push('raddr');
            sdp.push(candidate.relatedAddress);
            sdp.push('rport');
            sdp.push(candidate.relatedPort);
          }
          if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {
            sdp.push('tcptype');
            sdp.push(candidate.tcpType);
          }
          if (candidate.usernameFragment || candidate.ufrag) {
            sdp.push('ufrag');
            sdp.push(candidate.usernameFragment || candidate.ufrag);
          }
          return 'candidate:' + sdp.join(' ');
        };

        // Parses an ice-options line, returns an array of option tags.
        // Sample input:
        // a=ice-options:foo bar
        SDPUtils.parseIceOptions = function (line) {
          return line.substring(14).split(' ');
        };

        // Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:
        // a=rtpmap:111 opus/48000/2
        SDPUtils.parseRtpMap = function (line) {
          var parts = line.substring(9).split(' ');
          var parsed = {
            payloadType: parseInt(parts.shift(), 10) // was: id
          };

          parts = parts[0].split('/');
          parsed.name = parts[0];
          parsed.clockRate = parseInt(parts[1], 10); // was: clockrate
          parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;
          // legacy alias, got renamed back to channels in ORTC.
          parsed.numChannels = parsed.channels;
          return parsed;
        };

        // Generates a rtpmap line from RTCRtpCodecCapability or
        // RTCRtpCodecParameters.
        SDPUtils.writeRtpMap = function (codec) {
          var pt = codec.payloadType;
          if (codec.preferredPayloadType !== undefined) {
            pt = codec.preferredPayloadType;
          }
          var channels = codec.channels || codec.numChannels || 1;
          return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate + (channels !== 1 ? '/' + channels : '') + '\r\n';
        };

        // Parses a extmap line (headerextension from RFC 5285). Sample input:
        // a=extmap:2 urn:ietf:params:rtp-hdrext:toffset
        // a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset
        SDPUtils.parseExtmap = function (line) {
          var parts = line.substring(9).split(' ');
          return {
            id: parseInt(parts[0], 10),
            direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',
            uri: parts[1],
            attributes: parts.slice(2).join(' ')
          };
        };

        // Generates an extmap line from RTCRtpHeaderExtensionParameters or
        // RTCRtpHeaderExtension.
        SDPUtils.writeExtmap = function (headerExtension) {
          return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) + (headerExtension.direction && headerExtension.direction !== 'sendrecv' ? '/' + headerExtension.direction : '') + ' ' + headerExtension.uri + (headerExtension.attributes ? ' ' + headerExtension.attributes : '') + '\r\n';
        };

        // Parses a fmtp line, returns dictionary. Sample input:
        // a=fmtp:96 vbr=on;cng=on
        // Also deals with vbr=on; cng=on
        // Non-key-value such as telephone-events `0-15` get parsed as
        // {`0-15`:undefined}
        SDPUtils.parseFmtp = function (line) {
          var parsed = {};
          var kv;
          var parts = line.substring(line.indexOf(' ') + 1).split(';');
          for (var j = 0; j < parts.length; j++) {
            kv = parts[j].trim().split('=');
            parsed[kv[0].trim()] = kv[1];
          }
          return parsed;
        };

        // Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.
        SDPUtils.writeFmtp = function (codec) {
          var line = '';
          var pt = codec.payloadType;
          if (codec.preferredPayloadType !== undefined) {
            pt = codec.preferredPayloadType;
          }
          if (codec.parameters && Object.keys(codec.parameters).length) {
            var params = [];
            Object.keys(codec.parameters).forEach(function (param) {
              if (codec.parameters[param] !== undefined) {
                params.push(param + '=' + codec.parameters[param]);
              } else {
                params.push(param);
              }
            });
            line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\r\n';
          }
          return line;
        };

        // Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:
        // a=rtcp-fb:98 nack rpsi
        SDPUtils.parseRtcpFb = function (line) {
          var parts = line.substring(line.indexOf(' ') + 1).split(' ');
          return {
            type: parts.shift(),
            parameter: parts.join(' ')
          };
        };

        // Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.
        SDPUtils.writeRtcpFb = function (codec) {
          var lines = '';
          var pt = codec.payloadType;
          if (codec.preferredPayloadType !== undefined) {
            pt = codec.preferredPayloadType;
          }
          if (codec.rtcpFeedback && codec.rtcpFeedback.length) {
            // FIXME: special handling for trr-int?
            codec.rtcpFeedback.forEach(function (fb) {
              lines += 'a=rtcp-fb:' + pt + ' ' + fb.type + (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') + '\r\n';
            });
          }
          return lines;
        };

        // Parses a RFC 5576 ssrc media attribute. Sample input:
        // a=ssrc:3735928559 cname:something
        SDPUtils.parseSsrcMedia = function (line) {
          var sp = line.indexOf(' ');
          var parts = {
            ssrc: parseInt(line.substring(7, sp), 10)
          };
          var colon = line.indexOf(':', sp);
          if (colon > -1) {
            parts.attribute = line.substring(sp + 1, colon);
            parts.value = line.substring(colon + 1);
          } else {
            parts.attribute = line.substring(sp + 1);
          }
          return parts;
        };

        // Parse a ssrc-group line (see RFC 5576). Sample input:
        // a=ssrc-group:semantics 12 34
        SDPUtils.parseSsrcGroup = function (line) {
          var parts = line.substring(13).split(' ');
          return {
            semantics: parts.shift(),
            ssrcs: parts.map(function (ssrc) {
              return parseInt(ssrc, 10);
            })
          };
        };

        // Extracts the MID (RFC 5888) from a media section.
        // Returns the MID or undefined if no mid line was found.
        SDPUtils.getMid = function (mediaSection) {
          var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];
          if (mid) {
            return mid.substring(6);
          }
        };

        // Parses a fingerprint line for DTLS-SRTP.
        SDPUtils.parseFingerprint = function (line) {
          var parts = line.substring(14).split(' ');
          return {
            algorithm: parts[0].toLowerCase(),
            // algorithm is case-sensitive in Edge.
            value: parts[1].toUpperCase() // the definition is upper-case in RFC 4572.
          };
        };

        // Extracts DTLS parameters from SDP media section or sessionpart.
        // FIXME: for consistency with other functions this should only
        //   get the fingerprint line as input. See also getIceParameters.
        SDPUtils.getDtlsParameters = function (mediaSection, sessionpart) {
          var lines = SDPUtils.matchPrefix(mediaSection + sessionpart, 'a=fingerprint:');
          // Note: a=setup line is ignored since we use the 'auto' role in Edge.
          return {
            role: 'auto',
            fingerprints: lines.map(SDPUtils.parseFingerprint)
          };
        };

        // Serializes DTLS parameters to SDP.
        SDPUtils.writeDtlsParameters = function (params, setupType) {
          var sdp = 'a=setup:' + setupType + '\r\n';
          params.fingerprints.forEach(function (fp) {
            sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\r\n';
          });
          return sdp;
        };

        // Parses a=crypto lines into
        //   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members
        SDPUtils.parseCryptoLine = function (line) {
          var parts = line.substring(9).split(' ');
          return {
            tag: parseInt(parts[0], 10),
            cryptoSuite: parts[1],
            keyParams: parts[2],
            sessionParams: parts.slice(3)
          };
        };
        SDPUtils.writeCryptoLine = function (parameters) {
          return 'a=crypto:' + parameters.tag + ' ' + parameters.cryptoSuite + ' ' + (typeof parameters.keyParams === 'object' ? SDPUtils.writeCryptoKeyParams(parameters.keyParams) : parameters.keyParams) + (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') + '\r\n';
        };

        // Parses the crypto key parameters into
        //   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*
        SDPUtils.parseCryptoKeyParams = function (keyParams) {
          if (keyParams.indexOf('inline:') !== 0) {
            return null;
          }
          var parts = keyParams.substring(7).split('|');
          return {
            keyMethod: 'inline',
            keySalt: parts[0],
            lifeTime: parts[1],
            mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,
            mkiLength: parts[2] ? parts[2].split(':')[1] : undefined
          };
        };
        SDPUtils.writeCryptoKeyParams = function (keyParams) {
          return keyParams.keyMethod + ':' + keyParams.keySalt + (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') + (keyParams.mkiValue && keyParams.mkiLength ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength : '');
        };

        // Extracts all SDES parameters.
        SDPUtils.getCryptoParameters = function (mediaSection, sessionpart) {
          var lines = SDPUtils.matchPrefix(mediaSection + sessionpart, 'a=crypto:');
          return lines.map(SDPUtils.parseCryptoLine);
        };

        // Parses ICE information from SDP media section or sessionpart.
        // FIXME: for consistency with other functions this should only
        //   get the ice-ufrag and ice-pwd lines as input.
        SDPUtils.getIceParameters = function (mediaSection, sessionpart) {
          var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart, 'a=ice-ufrag:')[0];
          var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart, 'a=ice-pwd:')[0];
          if (!(ufrag && pwd)) {
            return null;
          }
          return {
            usernameFragment: ufrag.substring(12),
            password: pwd.substring(10)
          };
        };

        // Serializes ICE parameters to SDP.
        SDPUtils.writeIceParameters = function (params) {
          var sdp = 'a=ice-ufrag:' + params.usernameFragment + '\r\n' + 'a=ice-pwd:' + params.password + '\r\n';
          if (params.iceLite) {
            sdp += 'a=ice-lite\r\n';
          }
          return sdp;
        };

        // Parses the SDP media section and returns RTCRtpParameters.
        SDPUtils.parseRtpParameters = function (mediaSection) {
          var description = {
            codecs: [],
            headerExtensions: [],
            fecMechanisms: [],
            rtcp: []
          };
          var lines = SDPUtils.splitLines(mediaSection);
          var mline = lines[0].split(' ');
          description.profile = mline[2];
          for (var i = 3; i < mline.length; i++) {
            // find all codecs from mline[3..]
            var pt = mline[i];
            var rtpmapline = SDPUtils.matchPrefix(mediaSection, 'a=rtpmap:' + pt + ' ')[0];
            if (rtpmapline) {
              var codec = SDPUtils.parseRtpMap(rtpmapline);
              var fmtps = SDPUtils.matchPrefix(mediaSection, 'a=fmtp:' + pt + ' ');
              // Only the first a=fmtp:<pt> is considered.
              codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};
              codec.rtcpFeedback = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:' + pt + ' ').map(SDPUtils.parseRtcpFb);
              description.codecs.push(codec);
              // parse FEC mechanisms from rtpmap lines.
              switch (codec.name.toUpperCase()) {
                case 'RED':
                case 'ULPFEC':
                  description.fecMechanisms.push(codec.name.toUpperCase());
                  break;
              }
            }
          }
          SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function (line) {
            description.headerExtensions.push(SDPUtils.parseExtmap(line));
          });
          var wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ').map(SDPUtils.parseRtcpFb);
          description.codecs.forEach(function (codec) {
            wildcardRtcpFb.forEach(function (fb) {
              var duplicate = codec.rtcpFeedback.find(function (existingFeedback) {
                return existingFeedback.type === fb.type && existingFeedback.parameter === fb.parameter;
              });
              if (!duplicate) {
                codec.rtcpFeedback.push(fb);
              }
            });
          });
          // FIXME: parse rtcp.
          return description;
        };

        // Generates parts of the SDP media section describing the capabilities /
        // parameters.
        SDPUtils.writeRtpDescription = function (kind, caps) {
          var sdp = '';

          // Build the mline.
          sdp += 'm=' + kind + ' ';
          sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.
          sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';
          sdp += caps.codecs.map(function (codec) {
            if (codec.preferredPayloadType !== undefined) {
              return codec.preferredPayloadType;
            }
            return codec.payloadType;
          }).join(' ') + '\r\n';
          sdp += 'c=IN IP4 0.0.0.0\r\n';
          sdp += 'a=rtcp:9 IN IP4 0.0.0.0\r\n';

          // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.
          caps.codecs.forEach(function (codec) {
            sdp += SDPUtils.writeRtpMap(codec);
            sdp += SDPUtils.writeFmtp(codec);
            sdp += SDPUtils.writeRtcpFb(codec);
          });
          var maxptime = 0;
          caps.codecs.forEach(function (codec) {
            if (codec.maxptime > maxptime) {
              maxptime = codec.maxptime;
            }
          });
          if (maxptime > 0) {
            sdp += 'a=maxptime:' + maxptime + '\r\n';
          }
          if (caps.headerExtensions) {
            caps.headerExtensions.forEach(function (extension) {
              sdp += SDPUtils.writeExtmap(extension);
            });
          }
          // FIXME: write fecMechanisms.
          return sdp;
        };

        // Parses the SDP media section and returns an array of
        // RTCRtpEncodingParameters.
        SDPUtils.parseRtpEncodingParameters = function (mediaSection) {
          var encodingParameters = [];
          var description = SDPUtils.parseRtpParameters(mediaSection);
          var hasRed = description.fecMechanisms.indexOf('RED') !== -1;
          var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;

          // filter a=ssrc:... cname:, ignore PlanB-msid
          var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:').map(function (line) {
            return SDPUtils.parseSsrcMedia(line);
          }).filter(function (parts) {
            return parts.attribute === 'cname';
          });
          var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;
          var secondarySsrc;
          var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID').map(function (line) {
            var parts = line.substring(17).split(' ');
            return parts.map(function (part) {
              return parseInt(part, 10);
            });
          });
          if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {
            secondarySsrc = flows[0][1];
          }
          description.codecs.forEach(function (codec) {
            if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {
              var encParam = {
                ssrc: primarySsrc,
                codecPayloadType: parseInt(codec.parameters.apt, 10)
              };
              if (primarySsrc && secondarySsrc) {
                encParam.rtx = {
                  ssrc: secondarySsrc
                };
              }
              encodingParameters.push(encParam);
              if (hasRed) {
                encParam = JSON.parse(JSON.stringify(encParam));
                encParam.fec = {
                  ssrc: primarySsrc,
                  mechanism: hasUlpfec ? 'red+ulpfec' : 'red'
                };
                encodingParameters.push(encParam);
              }
            }
          });
          if (encodingParameters.length === 0 && primarySsrc) {
            encodingParameters.push({
              ssrc: primarySsrc
            });
          }

          // we support both b=AS and b=TIAS but interpret AS as TIAS.
          var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');
          if (bandwidth.length) {
            if (bandwidth[0].indexOf('b=TIAS:') === 0) {
              bandwidth = parseInt(bandwidth[0].substring(7), 10);
            } else if (bandwidth[0].indexOf('b=AS:') === 0) {
              // use formula from JSEP to convert b=AS to TIAS value.
              bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95 - 50 * 40 * 8;
            } else {
              bandwidth = undefined;
            }
            encodingParameters.forEach(function (params) {
              params.maxBitrate = bandwidth;
            });
          }
          return encodingParameters;
        };

        // parses http://draft.ortc.org/#rtcrtcpparameters*
        SDPUtils.parseRtcpParameters = function (mediaSection) {
          var rtcpParameters = {};

          // Gets the first SSRC. Note that with RTX there might be multiple
          // SSRCs.
          var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:').map(function (line) {
            return SDPUtils.parseSsrcMedia(line);
          }).filter(function (obj) {
            return obj.attribute === 'cname';
          })[0];
          if (remoteSsrc) {
            rtcpParameters.cname = remoteSsrc.value;
            rtcpParameters.ssrc = remoteSsrc.ssrc;
          }

          // Edge uses the compound attribute instead of reducedSize
          // compound is !reducedSize
          var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');
          rtcpParameters.reducedSize = rsize.length > 0;
          rtcpParameters.compound = rsize.length === 0;

          // parses the rtcp-mux attrbute.
          // Note that Edge does not support unmuxed RTCP.
          var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');
          rtcpParameters.mux = mux.length > 0;
          return rtcpParameters;
        };
        SDPUtils.writeRtcpParameters = function (rtcpParameters) {
          var sdp = '';
          if (rtcpParameters.reducedSize) {
            sdp += 'a=rtcp-rsize\r\n';
          }
          if (rtcpParameters.mux) {
            sdp += 'a=rtcp-mux\r\n';
          }
          if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {
            sdp += 'a=ssrc:' + rtcpParameters.ssrc + ' cname:' + rtcpParameters.cname + '\r\n';
          }
          return sdp;
        };

        // parses either a=msid: or a=ssrc:... msid lines and returns
        // the id of the MediaStream and MediaStreamTrack.
        SDPUtils.parseMsid = function (mediaSection) {
          var parts;
          var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');
          if (spec.length === 1) {
            parts = spec[0].substring(7).split(' ');
            return {
              stream: parts[0],
              track: parts[1]
            };
          }
          var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:').map(function (line) {
            return SDPUtils.parseSsrcMedia(line);
          }).filter(function (msidParts) {
            return msidParts.attribute === 'msid';
          });
          if (planB.length > 0) {
            parts = planB[0].value.split(' ');
            return {
              stream: parts[0],
              track: parts[1]
            };
          }
        };

        // SCTP
        // parses draft-ietf-mmusic-sctp-sdp-26 first and falls back
        // to draft-ietf-mmusic-sctp-sdp-05
        SDPUtils.parseSctpDescription = function (mediaSection) {
          var mline = SDPUtils.parseMLine(mediaSection);
          var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');
          var maxMessageSize;
          if (maxSizeLine.length > 0) {
            maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);
          }
          if (isNaN(maxMessageSize)) {
            maxMessageSize = 65536;
          }
          var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');
          if (sctpPort.length > 0) {
            return {
              port: parseInt(sctpPort[0].substring(12), 10),
              protocol: mline.fmt,
              maxMessageSize: maxMessageSize
            };
          }
          var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');
          if (sctpMapLines.length > 0) {
            var parts = sctpMapLines[0].substring(10).split(' ');
            return {
              port: parseInt(parts[0], 10),
              protocol: parts[1],
              maxMessageSize: maxMessageSize
            };
          }
        };

        // SCTP
        // outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers
        // support by now receiving in this format, unless we originally parsed
        // as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line
        // protocol of DTLS/SCTP -- without UDP/ or TCP/)
        SDPUtils.writeSctpDescription = function (media, sctp) {
          var output = [];
          if (media.protocol !== 'DTLS/SCTP') {
            output = ['m=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\r\n', 'c=IN IP4 0.0.0.0\r\n', 'a=sctp-port:' + sctp.port + '\r\n'];
          } else {
            output = ['m=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\r\n', 'c=IN IP4 0.0.0.0\r\n', 'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\r\n'];
          }
          if (sctp.maxMessageSize !== undefined) {
            output.push('a=max-message-size:' + sctp.maxMessageSize + '\r\n');
          }
          return output.join('');
        };

        // Generate a session ID for SDP.
        // https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1
        // recommends using a cryptographically random +ve 64-bit value
        // but right now this should be acceptable and within the right range
        SDPUtils.generateSessionId = function () {
          return Math.random().toString().substr(2, 22);
        };

        // Write boiler plate for start of SDP
        // sessId argument is optional - if not supplied it will
        // be generated randomly
        // sessVersion is optional and defaults to 2
        // sessUser is optional and defaults to 'thisisadapterortc'
        SDPUtils.writeSessionBoilerplate = function (sessId, sessVer, sessUser) {
          var sessionId;
          var version = sessVer !== undefined ? sessVer : 2;
          if (sessId) {
            sessionId = sessId;
          } else {
            sessionId = SDPUtils.generateSessionId();
          }
          var user = sessUser || 'thisisadapterortc';
          // FIXME: sess-id should be an NTP timestamp.
          return 'v=0\r\n' + 'o=' + user + ' ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\r\n' + 's=-\r\n' + 't=0 0\r\n';
        };

        // Gets the direction from the mediaSection or the sessionpart.
        SDPUtils.getDirection = function (mediaSection, sessionpart) {
          // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.
          var lines = SDPUtils.splitLines(mediaSection);
          for (var i = 0; i < lines.length; i++) {
            switch (lines[i]) {
              case 'a=sendrecv':
              case 'a=sendonly':
              case 'a=recvonly':
              case 'a=inactive':
                return lines[i].substring(2);
              // FIXME: What should happen here?
            }
          }

          if (sessionpart) {
            return SDPUtils.getDirection(sessionpart);
          }
          return 'sendrecv';
        };
        SDPUtils.getKind = function (mediaSection) {
          var lines = SDPUtils.splitLines(mediaSection);
          var mline = lines[0].split(' ');
          return mline[0].substring(2);
        };
        SDPUtils.isRejected = function (mediaSection) {
          return mediaSection.split(' ', 2)[1] === '0';
        };
        SDPUtils.parseMLine = function (mediaSection) {
          var lines = SDPUtils.splitLines(mediaSection);
          var parts = lines[0].substring(2).split(' ');
          return {
            kind: parts[0],
            port: parseInt(parts[1], 10),
            protocol: parts[2],
            fmt: parts.slice(3).join(' ')
          };
        };
        SDPUtils.parseOLine = function (mediaSection) {
          var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];
          var parts = line.substring(2).split(' ');
          return {
            username: parts[0],
            sessionId: parts[1],
            sessionVersion: parseInt(parts[2], 10),
            netType: parts[3],
            addressType: parts[4],
            address: parts[5]
          };
        };

        // a very naive interpretation of a valid SDP.
        SDPUtils.isValidSDP = function (blob) {
          if (typeof blob !== 'string' || blob.length === 0) {
            return false;
          }
          var lines = SDPUtils.splitLines(blob);
          for (var i = 0; i < lines.length; i++) {
            if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {
              return false;
            }
            // TODO: check the modifier a bit more.
          }

          return true;
        };

        // Expose public methods.
        if (typeof module === 'object') {
          module.exports = SDPUtils;
        }

        // #endregion ORIGINAL CODE

        module.exports;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/stream.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      function _regeneratorRuntime() {
        /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime = function _regeneratorRuntime() {
          return e;
        };
        var t,
          e = {},
          r = Object.prototype,
          n = r.hasOwnProperty,
          o = Object.defineProperty || function (t, e, r) {
            t[e] = r.value;
          },
          i = "function" == typeof Symbol ? Symbol : {},
          a = i.iterator || "@@iterator",
          c = i.asyncIterator || "@@asyncIterator",
          u = i.toStringTag || "@@toStringTag";
        function define(t, e, r) {
          return Object.defineProperty(t, e, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }), t[e];
        }
        try {
          define({}, "");
        } catch (t) {
          define = function define(t, e, r) {
            return t[e] = r;
          };
        }
        function wrap(t, e, r, n) {
          var i = e && e.prototype instanceof Generator ? e : Generator,
            a = Object.create(i.prototype),
            c = new Context(n || []);
          return o(a, "_invoke", {
            value: makeInvokeMethod(t, r, c)
          }), a;
        }
        function tryCatch(t, e, r) {
          try {
            return {
              type: "normal",
              arg: t.call(e, r)
            };
          } catch (t) {
            return {
              type: "throw",
              arg: t
            };
          }
        }
        e.wrap = wrap;
        var h = "suspendedStart",
          l = "suspendedYield",
          f = "executing",
          s = "completed",
          y = {};
        function Generator() {}
        function GeneratorFunction() {}
        function GeneratorFunctionPrototype() {}
        var p = {};
        define(p, a, function () {
          return this;
        });
        var d = Object.getPrototypeOf,
          v = d && d(d(values([])));
        v && v !== r && n.call(v, a) && (p = v);
        var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p);
        function defineIteratorMethods(t) {
          ["next", "throw", "return"].forEach(function (e) {
            define(t, e, function (t) {
              return this._invoke(e, t);
            });
          });
        }
        function AsyncIterator(t, e) {
          function invoke(r, o, i, a) {
            var c = tryCatch(t[r], t, o);
            if ("throw" !== c.type) {
              var u = c.arg,
                h = u.value;
              return h && "object" == typeof h && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) {
                invoke("next", t, i, a);
              }, function (t) {
                invoke("throw", t, i, a);
              }) : e.resolve(h).then(function (t) {
                u.value = t, i(u);
              }, function (t) {
                return invoke("throw", t, i, a);
              });
            }
            a(c.arg);
          }
          var r;
          o(this, "_invoke", {
            value: function value(t, n) {
              function callInvokeWithMethodAndArg() {
                return new e(function (e, r) {
                  invoke(t, n, e, r);
                });
              }
              return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
          });
        }
        function makeInvokeMethod(e, r, n) {
          var o = h;
          return function (i, a) {
            if (o === f) throw new Error("Generator is already running");
            if (o === s) {
              if ("throw" === i) throw a;
              return {
                value: t,
                done: !0
              };
            }
            for (n.method = i, n.arg = a;;) {
              var c = n.delegate;
              if (c) {
                var u = maybeInvokeDelegate(c, n);
                if (u) {
                  if (u === y) continue;
                  return u;
                }
              }
              if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) {
                if (o === h) throw o = s, n.arg;
                n.dispatchException(n.arg);
              } else "return" === n.method && n.abrupt("return", n.arg);
              o = f;
              var p = tryCatch(e, r, n);
              if ("normal" === p.type) {
                if (o = n.done ? s : l, p.arg === y) continue;
                return {
                  value: p.arg,
                  done: n.done
                };
              }
              "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg);
            }
          };
        }
        function maybeInvokeDelegate(e, r) {
          var n = r.method,
            o = e.iterator[n];
          if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y;
          var i = tryCatch(o, e.iterator, r.arg);
          if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y;
          var a = i.arg;
          return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y);
        }
        function pushTryEntry(t) {
          var e = {
            tryLoc: t[0]
          };
          1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
        }
        function resetTryEntry(t) {
          var e = t.completion || {};
          e.type = "normal", delete e.arg, t.completion = e;
        }
        function Context(t) {
          this.tryEntries = [{
            tryLoc: "root"
          }], t.forEach(pushTryEntry, this), this.reset(!0);
        }
        function values(e) {
          if (e || "" === e) {
            var r = e[a];
            if (r) return r.call(e);
            if ("function" == typeof e.next) return e;
            if (!isNaN(e.length)) {
              var o = -1,
                i = function next() {
                  for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next;
                  return next.value = t, next.done = !0, next;
                };
              return i.next = i;
            }
          }
          throw new TypeError(typeof e + " is not iterable");
        }
        return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", {
          value: GeneratorFunctionPrototype,
          configurable: !0
        }), o(GeneratorFunctionPrototype, "constructor", {
          value: GeneratorFunction,
          configurable: !0
        }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) {
          var e = "function" == typeof t && t.constructor;
          return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name));
        }, e.mark = function (t) {
          return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t;
        }, e.awrap = function (t) {
          return {
            __await: t
          };
        }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () {
          return this;
        }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) {
          void 0 === i && (i = Promise);
          var a = new AsyncIterator(wrap(t, r, n, o), i);
          return e.isGeneratorFunction(r) ? a : a.next().then(function (t) {
            return t.done ? t.value : a.next();
          });
        }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () {
          return this;
        }), define(g, "toString", function () {
          return "[object Generator]";
        }), e.keys = function (t) {
          var e = Object(t),
            r = [];
          for (var n in e) r.push(n);
          return r.reverse(), function next() {
            for (; r.length;) {
              var t = r.pop();
              if (t in e) return next.value = t, next.done = !1, next;
            }
            return next.done = !0, next;
          };
        }, e.values = values, Context.prototype = {
          constructor: Context,
          reset: function reset(e) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t);
          },
          stop: function stop() {
            this.done = !0;
            var t = this.tryEntries[0].completion;
            if ("throw" === t.type) throw t.arg;
            return this.rval;
          },
          dispatchException: function dispatchException(e) {
            if (this.done) throw e;
            var r = this;
            function handle(n, o) {
              return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o;
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var i = this.tryEntries[o],
                a = i.completion;
              if ("root" === i.tryLoc) return handle("end");
              if (i.tryLoc <= this.prev) {
                var c = n.call(i, "catchLoc"),
                  u = n.call(i, "finallyLoc");
                if (c && u) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                } else if (c) {
                  if (this.prev < i.catchLoc) return handle(i.catchLoc, !0);
                } else {
                  if (!u) throw new Error("try statement without catch or finally");
                  if (this.prev < i.finallyLoc) return handle(i.finallyLoc);
                }
              }
            }
          },
          abrupt: function abrupt(t, e) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var o = this.tryEntries[r];
              if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                var i = o;
                break;
              }
            }
            i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null);
            var a = i ? i.completion : {};
            return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a);
          },
          complete: function complete(t, e) {
            if ("throw" === t.type) throw t.arg;
            return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y;
          },
          finish: function finish(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y;
            }
          },
          "catch": function _catch(t) {
            for (var e = this.tryEntries.length - 1; e >= 0; --e) {
              var r = this.tryEntries[e];
              if (r.tryLoc === t) {
                var n = r.completion;
                if ("throw" === n.type) {
                  var o = n.arg;
                  resetTryEntry(r);
                }
                return o;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function delegateYield(e, r, n) {
            return this.delegate = {
              iterator: values(e),
              resultName: r,
              nextLoc: n
            }, "next" === this.method && (this.arg = t), y;
          }
        }, e;
      }
      function _awaitAsyncGenerator(e) {
        return new _OverloadYield(e, 0);
      }
      function _wrapAsyncGenerator(fn) {
        return function () {
          return new _AsyncGenerator(fn.apply(this, arguments));
        };
      }
      function _AsyncGenerator(e) {
        var r, t;
        function resume(r, t) {
          try {
            var n = e[r](t),
              o = n.value,
              u = o instanceof _OverloadYield;
            Promise.resolve(u ? o.v : o).then(function (t) {
              if (u) {
                var i = "return" === r ? "return" : "next";
                if (!o.k || t.done) return resume(i, t);
                t = e[i](t).value;
              }
              settle(n.done ? "return" : "normal", t);
            }, function (e) {
              resume("throw", e);
            });
          } catch (e) {
            settle("throw", e);
          }
        }
        function settle(e, n) {
          switch (e) {
            case "return":
              r.resolve({
                value: n,
                done: !0
              });
              break;
            case "throw":
              r.reject(n);
              break;
            default:
              r.resolve({
                value: n,
                done: !1
              });
          }
          (r = r.next) ? resume(r.key, r.arg) : t = null;
        }
        this._invoke = function (e, n) {
          return new Promise(function (o, u) {
            var i = {
              key: e,
              arg: n,
              resolve: o,
              reject: u,
              next: null
            };
            t ? t = t.next = i : (r = t = i, resume(e, n));
          });
        }, "function" != typeof e["return"] && (this["return"] = void 0);
      }
      _AsyncGenerator.prototype["function" == typeof Symbol && Symbol.asyncIterator || "@@asyncIterator"] = function () {
        return this;
      }, _AsyncGenerator.prototype.next = function (e) {
        return this._invoke("next", e);
      }, _AsyncGenerator.prototype["throw"] = function (e) {
        return this._invoke("throw", e);
      }, _AsyncGenerator.prototype["return"] = function (e) {
        return this._invoke("return", e);
      };
      function _OverloadYield(t, e) {
        this.v = t, this.k = e;
      }
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        // utility for whatwg streams
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.ensureAsyncIterable = exports.asyncIterableFromStream = exports.isAsyncIterable = void 0;
        function isAsyncIterable(object) {
          return object[Symbol.asyncIterator] != null;
        }
        exports.isAsyncIterable = isAsyncIterable;
        function assertNonNull(value) {
          if (value == null) {
            throw new Error("Assertion Failure: value must not be null nor undefined");
          }
        }
        function asyncIterableFromStream(_x) {
          return _asyncIterableFromStream2.apply(this, arguments);
        }
        function _asyncIterableFromStream2() {
          _asyncIterableFromStream2 = _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(stream) {
            var reader, _yield$_awaitAsyncGen, done, value;
            return _regeneratorRuntime().wrap(function _callee$(_context) {
              while (1) switch (_context.prev = _context.next) {
                case 0:
                  reader = stream.getReader();
                  _context.prev = 1;
                case 2:
                  _context.next = 5;
                  return _awaitAsyncGenerator(reader.read());
                case 5:
                  _yield$_awaitAsyncGen = _context.sent;
                  done = _yield$_awaitAsyncGen.done;
                  value = _yield$_awaitAsyncGen.value;
                  if (!done) {
                    _context.next = 10;
                    break;
                  }
                  return _context.abrupt("return");
                case 10:
                  assertNonNull(value);
                  _context.next = 13;
                  return value;
                case 13:
                  _context.next = 2;
                  break;
                case 15:
                  _context.prev = 15;
                  reader.releaseLock();
                  return _context.finish(15);
                case 18:
                case "end":
                  return _context.stop();
              }
            }, _callee, null, [[1,, 15, 18]]);
          }));
          return _asyncIterableFromStream2.apply(this, arguments);
        }
        exports.asyncIterableFromStream = asyncIterableFromStream;
        function ensureAsyncIterable(streamLike) {
          if (isAsyncIterable(streamLike)) {
            return streamLike;
          } else {
            return asyncIterableFromStream(streamLike);
          }
        }
        exports.ensureAsyncIterable = ensureAsyncIterable;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.ensureAsyncIterable;
        module.exports.asyncIterableFromStream;
        module.exports.isAsyncIterable;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/timestamp.js", ['./cjs-loader.mjs', './DecodeError.js', './int.js'], function (exports, module) {
  var loader, __cjsMetaURL$1, __cjsMetaURL$2;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }, function (module) {
      __cjsMetaURL$2 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.timestampExtension = exports.decodeTimestampExtension = exports.decodeTimestampToTimeSpec = exports.encodeTimestampExtension = exports.encodeDateToTimeSpec = exports.encodeTimeSpecToTimestamp = exports.EXT_TIMESTAMP = void 0;
        // https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type
        var DecodeError_1 = require("./DecodeError");
        var int_1 = require("./utils/int");
        exports.EXT_TIMESTAMP = -1;
        var TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int
        var TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int
        function encodeTimeSpecToTimestamp(_ref) {
          var sec = _ref.sec,
            nsec = _ref.nsec;
          if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {
            // Here sec >= 0 && nsec >= 0
            if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {
              // timestamp 32 = { sec32 (unsigned) }
              var rv = new Uint8Array(4);
              var view = new DataView(rv.buffer);
              view.setUint32(0, sec);
              return rv;
            } else {
              // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }
              var secHigh = sec / 0x100000000;
              var secLow = sec & 0xffffffff;
              var _rv = new Uint8Array(8);
              var _view = new DataView(_rv.buffer);
              // nsec30 | secHigh2
              _view.setUint32(0, nsec << 2 | secHigh & 0x3);
              // secLow32
              _view.setUint32(4, secLow);
              return _rv;
            }
          } else {
            // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }
            var _rv2 = new Uint8Array(12);
            var _view2 = new DataView(_rv2.buffer);
            _view2.setUint32(0, nsec);
            (0, int_1.setInt64)(_view2, 4, sec);
            return _rv2;
          }
        }
        exports.encodeTimeSpecToTimestamp = encodeTimeSpecToTimestamp;
        function encodeDateToTimeSpec(date) {
          var msec = date.getTime();
          var sec = Math.floor(msec / 1e3);
          var nsec = (msec - sec * 1e3) * 1e6;
          // Normalizes { sec, nsec } to ensure nsec is unsigned.
          var nsecInSec = Math.floor(nsec / 1e9);
          return {
            sec: sec + nsecInSec,
            nsec: nsec - nsecInSec * 1e9
          };
        }
        exports.encodeDateToTimeSpec = encodeDateToTimeSpec;
        function encodeTimestampExtension(object) {
          if (object instanceof Date) {
            var timeSpec = encodeDateToTimeSpec(object);
            return encodeTimeSpecToTimestamp(timeSpec);
          } else {
            return null;
          }
        }
        exports.encodeTimestampExtension = encodeTimestampExtension;
        function decodeTimestampToTimeSpec(data) {
          var view = new DataView(data.buffer, data.byteOffset, data.byteLength);
          // data may be 32, 64, or 96 bits
          switch (data.byteLength) {
            case 4:
              {
                // timestamp 32 = { sec32 }
                var sec = view.getUint32(0);
                var nsec = 0;
                return {
                  sec: sec,
                  nsec: nsec
                };
              }
            case 8:
              {
                // timestamp 64 = { nsec30, sec34 }
                var nsec30AndSecHigh2 = view.getUint32(0);
                var secLow32 = view.getUint32(4);
                var _sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;
                var _nsec = nsec30AndSecHigh2 >>> 2;
                return {
                  sec: _sec,
                  nsec: _nsec
                };
              }
            case 12:
              {
                // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }
                var _sec2 = (0, int_1.getInt64)(view, 4);
                var _nsec2 = view.getUint32(0);
                return {
                  sec: _sec2,
                  nsec: _nsec2
                };
              }
            default:
              throw new DecodeError_1.DecodeError("Unrecognized data size for timestamp (expected 4, 8, or 12): " + data.length);
          }
        }
        exports.decodeTimestampToTimeSpec = decodeTimestampToTimeSpec;
        function decodeTimestampExtension(data) {
          var timeSpec = decodeTimestampToTimeSpec(data);
          return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);
        }
        exports.decodeTimestampExtension = decodeTimestampExtension;
        exports.timestampExtension = {
          type: exports.EXT_TIMESTAMP,
          encode: encodeTimestampExtension,
          decode: decodeTimestampExtension
        };

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.timestampExtension;
        module.exports.decodeTimestampExtension;
        module.exports.decodeTimestampToTimeSpec;
        module.exports.encodeTimestampExtension;
        module.exports.encodeDateToTimeSpec;
        module.exports.encodeTimeSpecToTimestamp;
        module.exports.EXT_TIMESTAMP;
      }, function () {
        return {
          './DecodeError': __cjsMetaURL$1,
          './utils/int': __cjsMetaURL$2
        };
      });
    }
  };
});

System.register("chunks:///_virtual/typedArrays.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.createDataView = exports.ensureUint8Array = void 0;
        function ensureUint8Array(buffer) {
          if (buffer instanceof Uint8Array) {
            return buffer;
          } else if (ArrayBuffer.isView(buffer)) {
            return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);
          } else if (buffer instanceof ArrayBuffer) {
            return new Uint8Array(buffer);
          } else {
            // ArrayLike<number>
            return Uint8Array.from(buffer);
          }
        }
        exports.ensureUint8Array = ensureUint8Array;
        function createDataView(buffer) {
          if (buffer instanceof ArrayBuffer) {
            return new DataView(buffer);
          }
          var bufferView = ensureUint8Array(buffer);
          return new DataView(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);
        }
        exports.createDataView = createDataView;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.createDataView;
        module.exports.ensureUint8Array;
      }, {});
    }
  };
});

System.register("chunks:///_virtual/utf8.js", ['./cjs-loader.mjs', './int.js'], function (exports, module) {
  var loader, __cjsMetaURL$1;
  return {
    setters: [function (module) {
      loader = module.default;
    }, function (module) {
      __cjsMetaURL$1 = module.__cjsMetaURL;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        var _a, _b, _c;
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.utf8DecodeTD = exports.TEXT_DECODER_THRESHOLD = exports.utf8DecodeJs = exports.utf8EncodeTE = exports.TEXT_ENCODER_THRESHOLD = exports.utf8EncodeJs = exports.utf8Count = void 0;
        /* eslint-disable @typescript-eslint/no-unnecessary-condition */
        var int_1 = require("./int");
        var TEXT_ENCODING_AVAILABLE = (typeof process === "undefined" || ((_a = process === null || process === void 0 ? void 0 : process.env) === null || _a === void 0 ? void 0 : _a["TEXT_ENCODING"]) !== "never") && typeof TextEncoder !== "undefined" && typeof TextDecoder !== "undefined";
        function utf8Count(str) {
          var strLength = str.length;
          var byteLength = 0;
          var pos = 0;
          while (pos < strLength) {
            var value = str.charCodeAt(pos++);
            if ((value & 0xffffff80) === 0) {
              // 1-byte
              byteLength++;
              continue;
            } else if ((value & 0xfffff800) === 0) {
              // 2-bytes
              byteLength += 2;
            } else {
              // handle surrogate pair
              if (value >= 0xd800 && value <= 0xdbff) {
                // high surrogate
                if (pos < strLength) {
                  var extra = str.charCodeAt(pos);
                  if ((extra & 0xfc00) === 0xdc00) {
                    ++pos;
                    value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;
                  }
                }
              }
              if ((value & 0xffff0000) === 0) {
                // 3-byte
                byteLength += 3;
              } else {
                // 4-byte
                byteLength += 4;
              }
            }
          }
          return byteLength;
        }
        exports.utf8Count = utf8Count;
        function utf8EncodeJs(str, output, outputOffset) {
          var strLength = str.length;
          var offset = outputOffset;
          var pos = 0;
          while (pos < strLength) {
            var value = str.charCodeAt(pos++);
            if ((value & 0xffffff80) === 0) {
              // 1-byte
              output[offset++] = value;
              continue;
            } else if ((value & 0xfffff800) === 0) {
              // 2-bytes
              output[offset++] = value >> 6 & 0x1f | 0xc0;
            } else {
              // handle surrogate pair
              if (value >= 0xd800 && value <= 0xdbff) {
                // high surrogate
                if (pos < strLength) {
                  var extra = str.charCodeAt(pos);
                  if ((extra & 0xfc00) === 0xdc00) {
                    ++pos;
                    value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;
                  }
                }
              }
              if ((value & 0xffff0000) === 0) {
                // 3-byte
                output[offset++] = value >> 12 & 0x0f | 0xe0;
                output[offset++] = value >> 6 & 0x3f | 0x80;
              } else {
                // 4-byte
                output[offset++] = value >> 18 & 0x07 | 0xf0;
                output[offset++] = value >> 12 & 0x3f | 0x80;
                output[offset++] = value >> 6 & 0x3f | 0x80;
              }
            }
            output[offset++] = value & 0x3f | 0x80;
          }
        }
        exports.utf8EncodeJs = utf8EncodeJs;
        var sharedTextEncoder = TEXT_ENCODING_AVAILABLE ? new TextEncoder() : undefined;
        exports.TEXT_ENCODER_THRESHOLD = !TEXT_ENCODING_AVAILABLE ? int_1.UINT32_MAX : typeof process !== "undefined" && ((_b = process === null || process === void 0 ? void 0 : process.env) === null || _b === void 0 ? void 0 : _b["TEXT_ENCODING"]) !== "force" ? 200 : 0;
        function utf8EncodeTEencode(str, output, outputOffset) {
          output.set(sharedTextEncoder.encode(str), outputOffset);
        }
        function utf8EncodeTEencodeInto(str, output, outputOffset) {
          sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));
        }
        exports.utf8EncodeTE = (sharedTextEncoder === null || sharedTextEncoder === void 0 ? void 0 : sharedTextEncoder.encodeInto) ? utf8EncodeTEencodeInto : utf8EncodeTEencode;
        var CHUNK_SIZE = 4096;
        function utf8DecodeJs(bytes, inputOffset, byteLength) {
          var offset = inputOffset;
          var end = offset + byteLength;
          var units = [];
          var result = "";
          while (offset < end) {
            var byte1 = bytes[offset++];
            if ((byte1 & 0x80) === 0) {
              // 1 byte
              units.push(byte1);
            } else if ((byte1 & 0xe0) === 0xc0) {
              // 2 bytes
              var byte2 = bytes[offset++] & 0x3f;
              units.push((byte1 & 0x1f) << 6 | byte2);
            } else if ((byte1 & 0xf0) === 0xe0) {
              // 3 bytes
              var _byte = bytes[offset++] & 0x3f;
              var byte3 = bytes[offset++] & 0x3f;
              units.push((byte1 & 0x1f) << 12 | _byte << 6 | byte3);
            } else if ((byte1 & 0xf8) === 0xf0) {
              // 4 bytes
              var _byte2 = bytes[offset++] & 0x3f;
              var _byte3 = bytes[offset++] & 0x3f;
              var byte4 = bytes[offset++] & 0x3f;
              var unit = (byte1 & 0x07) << 0x12 | _byte2 << 0x0c | _byte3 << 0x06 | byte4;
              if (unit > 0xffff) {
                unit -= 0x10000;
                units.push(unit >>> 10 & 0x3ff | 0xd800);
                unit = 0xdc00 | unit & 0x3ff;
              }
              units.push(unit);
            } else {
              units.push(byte1);
            }
            if (units.length >= CHUNK_SIZE) {
              result += String.fromCharCode.apply(String, units);
              units.length = 0;
            }
          }
          if (units.length > 0) {
            result += String.fromCharCode.apply(String, units);
          }
          return result;
        }
        exports.utf8DecodeJs = utf8DecodeJs;
        var sharedTextDecoder = TEXT_ENCODING_AVAILABLE ? new TextDecoder() : null;
        exports.TEXT_DECODER_THRESHOLD = !TEXT_ENCODING_AVAILABLE ? int_1.UINT32_MAX : typeof process !== "undefined" && ((_c = process === null || process === void 0 ? void 0 : process.env) === null || _c === void 0 ? void 0 : _c["TEXT_DECODER"]) !== "force" ? 200 : 0;
        function utf8DecodeTD(bytes, inputOffset, byteLength) {
          var stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);
          return sharedTextDecoder.decode(stringBytes);
        }
        exports.utf8DecodeTD = utf8DecodeTD;

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.utf8DecodeTD;
        module.exports.TEXT_DECODER_THRESHOLD;
        module.exports.utf8DecodeJs;
        module.exports.utf8EncodeTE;
        module.exports.TEXT_ENCODER_THRESHOLD;
        module.exports.utf8EncodeJs;
        module.exports.utf8Count;
      }, function () {
        return {
          './int': __cjsMetaURL$1
        };
      });
    }
  };
});

System.register("chunks:///_virtual/utils.js", ['./cjs-loader.mjs'], function (exports, module) {
  var loader;
  return {
    setters: [function (module) {
      loader = module.default;
    }],
    execute: function () {
      var __cjsMetaURL = exports('__cjsMetaURL', module.meta.url);
      loader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {
        Object.defineProperty(exports, "__esModule", {
          value: true
        });
        exports.compactObject = compactObject;
        exports.deprecated = deprecated;
        exports.detectBrowser = detectBrowser;
        exports.disableLog = disableLog;
        exports.disableWarnings = disableWarnings;
        exports.extractVersion = extractVersion;
        exports.filterStats = filterStats;
        exports.log = log;
        exports.walkStats = walkStats;
        exports.wrapPeerConnectionEvent = wrapPeerConnectionEvent;
        function _defineProperty(e, r, t) {
          return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {
            value: t,
            enumerable: !0,
            configurable: !0,
            writable: !0
          }) : e[r] = t, e;
        }
        function _toPropertyKey(t) {
          var i = _toPrimitive(t, "string");
          return "symbol" == _typeof(i) ? i : i + "";
        }
        function _toPrimitive(t, r) {
          if ("object" != _typeof(t) || !t) return t;
          var e = t[Symbol.toPrimitive];
          if (void 0 !== e) {
            var i = e.call(t, r || "default");
            if ("object" != _typeof(i)) return i;
            throw new TypeError("@@toPrimitive must return a primitive value.");
          }
          return ("string" === r ? String : Number)(t);
        }
        function _typeof(o) {
          "@babel/helpers - typeof";

          return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
            return typeof o;
          } : function (o) {
            return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
          }, _typeof(o);
        }
        var logDisabled_ = true;
        var deprecationWarnings_ = true;

        /**
         * Extract browser version out of the provided user agent string.
         *
         * @param {!string} uastring userAgent string.
         * @param {!string} expr Regular expression used as match criteria.
         * @param {!number} pos position in the version string to be returned.
         * @return {!number} browser version.
         */
        function extractVersion(uastring, expr, pos) {
          var match = uastring.match(expr);
          return match && match.length >= pos && parseFloat(match[pos], 10);
        }

        // Wraps the peerconnection event eventNameToWrap in a function
        // which returns the modified event object (or false to prevent
        // the event).
        function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {
          if (!window.RTCPeerConnection) {
            return;
          }
          var proto = window.RTCPeerConnection.prototype;
          var nativeAddEventListener = proto.addEventListener;
          proto.addEventListener = function (nativeEventName, cb) {
            if (nativeEventName !== eventNameToWrap) {
              return nativeAddEventListener.apply(this, arguments);
            }
            var wrappedCallback = function wrappedCallback(e) {
              var modifiedEvent = wrapper(e);
              if (modifiedEvent) {
                if (cb.handleEvent) {
                  cb.handleEvent(modifiedEvent);
                } else {
                  cb(modifiedEvent);
                }
              }
            };
            this._eventMap = this._eventMap || {};
            if (!this._eventMap[eventNameToWrap]) {
              this._eventMap[eventNameToWrap] = new Map();
            }
            this._eventMap[eventNameToWrap].set(cb, wrappedCallback);
            return nativeAddEventListener.apply(this, [nativeEventName, wrappedCallback]);
          };
          var nativeRemoveEventListener = proto.removeEventListener;
          proto.removeEventListener = function (nativeEventName, cb) {
            if (nativeEventName !== eventNameToWrap || !this._eventMap || !this._eventMap[eventNameToWrap]) {
              return nativeRemoveEventListener.apply(this, arguments);
            }
            if (!this._eventMap[eventNameToWrap].has(cb)) {
              return nativeRemoveEventListener.apply(this, arguments);
            }
            var unwrappedCb = this._eventMap[eventNameToWrap].get(cb);
            this._eventMap[eventNameToWrap]["delete"](cb);
            if (this._eventMap[eventNameToWrap].size === 0) {
              delete this._eventMap[eventNameToWrap];
            }
            if (Object.keys(this._eventMap).length === 0) {
              delete this._eventMap;
            }
            return nativeRemoveEventListener.apply(this, [nativeEventName, unwrappedCb]);
          };
          Object.defineProperty(proto, 'on' + eventNameToWrap, {
            get: function get() {
              return this['_on' + eventNameToWrap];
            },
            set: function set(cb) {
              if (this['_on' + eventNameToWrap]) {
                this.removeEventListener(eventNameToWrap, this['_on' + eventNameToWrap]);
                delete this['_on' + eventNameToWrap];
              }
              if (cb) {
                this.addEventListener(eventNameToWrap, this['_on' + eventNameToWrap] = cb);
              }
            },
            enumerable: true,
            configurable: true
          });
        }
        function disableLog(bool) {
          if (typeof bool !== 'boolean') {
            return new Error('Argument type: ' + _typeof(bool) + '. Please use a boolean.');
          }
          logDisabled_ = bool;
          return bool ? 'adapter.js logging disabled' : 'adapter.js logging enabled';
        }

        /**
         * Disable or enable deprecation warnings
         * @param {!boolean} bool set to true to disable warnings.
         */
        function disableWarnings(bool) {
          if (typeof bool !== 'boolean') {
            return new Error('Argument type: ' + _typeof(bool) + '. Please use a boolean.');
          }
          deprecationWarnings_ = !bool;
          return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');
        }
        function log() {
          if ((typeof window === "undefined" ? "undefined" : _typeof(window)) === 'object') {
            if (logDisabled_) {
              return;
            }
            if (typeof console !== 'undefined' && typeof console.log === 'function') {
              console.log.apply(console, arguments);
            }
          }
        }

        /**
         * Shows a deprecation warning suggesting the modern and spec-compatible API.
         */
        function deprecated(oldMethod, newMethod) {
          if (!deprecationWarnings_) {
            return;
          }
          console.warn(oldMethod + ' is deprecated, please use ' + newMethod + ' instead.');
        }

        /**
         * Browser detector.
         *
         * @return {object} result containing browser and version
         *     properties.
         */
        function detectBrowser(window) {
          // Returned result object.
          var result = {
            browser: null,
            version: null
          };

          // Fail early if it's not a browser
          if (typeof window === 'undefined' || !window.navigator || !window.navigator.userAgent) {
            result.browser = 'Not a browser.';
            return result;
          }
          var navigator = window.navigator;

          // Prefer navigator.userAgentData.
          if (navigator.userAgentData && navigator.userAgentData.brands) {
            var chromium = navigator.userAgentData.brands.find(function (brand) {
              return brand.brand === 'Chromium';
            });
            if (chromium) {
              return {
                browser: 'chrome',
                version: parseInt(chromium.version, 10)
              };
            }
          }
          if (navigator.mozGetUserMedia) {
            // Firefox.
            result.browser = 'firefox';
            result.version = parseInt(extractVersion(navigator.userAgent, /Firefox\/(\d+)\./, 1));
          } else if (navigator.webkitGetUserMedia || window.isSecureContext === false && window.webkitRTCPeerConnection) {
            // Chrome, Chromium, Webview, Opera.
            // Version matches Chrome/WebRTC version.
            // Chrome 74 removed webkitGetUserMedia on http as well so we need the
            // more complicated fallback to webkitRTCPeerConnection.
            result.browser = 'chrome';
            result.version = parseInt(extractVersion(navigator.userAgent, /Chrom(e|ium)\/(\d+)\./, 2));
          } else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\/(\d+)\./)) {
            // Safari.
            result.browser = 'safari';
            result.version = parseInt(extractVersion(navigator.userAgent, /AppleWebKit\/(\d+)\./, 1));
            result.supportsUnifiedPlan = window.RTCRtpTransceiver && 'currentDirection' in window.RTCRtpTransceiver.prototype;
            // Only for internal usage.
            result._safariVersion = extractVersion(navigator.userAgent, /Version\/(\d+(\.?\d+))/, 1);
          } else {
            // Default fallthrough: not supported.
            result.browser = 'Not a supported browser.';
            return result;
          }
          return result;
        }

        /**
         * Checks if something is an object.
         *
         * @param {*} val The something you want to check.
         * @return true if val is an object, false otherwise.
         */
        function isObject(val) {
          return Object.prototype.toString.call(val) === '[object Object]';
        }

        /**
         * Remove all empty objects and undefined values
         * from a nested object -- an enhanced and vanilla version
         * of Lodash's `compact`.
         */
        function compactObject(data) {
          if (!isObject(data)) {
            return data;
          }
          return Object.keys(data).reduce(function (accumulator, key) {
            var isObj = isObject(data[key]);
            var value = isObj ? compactObject(data[key]) : data[key];
            var isEmptyObject = isObj && !Object.keys(value).length;
            if (value === undefined || isEmptyObject) {
              return accumulator;
            }
            return Object.assign(accumulator, _defineProperty({}, key, value));
          }, {});
        }

        /* iterates the stats graph recursively. */
        function walkStats(stats, base, resultSet) {
          if (!base || resultSet.has(base.id)) {
            return;
          }
          resultSet.set(base.id, base);
          Object.keys(base).forEach(function (name) {
            if (name.endsWith('Id')) {
              walkStats(stats, stats.get(base[name]), resultSet);
            } else if (name.endsWith('Ids')) {
              base[name].forEach(function (id) {
                walkStats(stats, stats.get(id), resultSet);
              });
            }
          });
        }

        /* filter getStats for a sender/receiver track. */
        function filterStats(result, track, outbound) {
          var streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';
          var filteredResult = new Map();
          if (track === null) {
            return filteredResult;
          }
          var trackStats = [];
          result.forEach(function (value) {
            if (value.type === 'track' && value.trackIdentifier === track.id) {
              trackStats.push(value);
            }
          });
          trackStats.forEach(function (trackStat) {
            result.forEach(function (stats) {
              if (stats.type === streamStatsType && stats.trackId === trackStat.id) {
                walkStats(result, stats, filteredResult);
              }
            });
          });
          return filteredResult;
        }

        // #endregion ORIGINAL CODE

        module.exports;
        module.exports.__esModule;
        module.exports.compactObject;
        module.exports.deprecated;
        module.exports.detectBrowser;
        module.exports.disableLog;
        module.exports.disableWarnings;
        module.exports.extractVersion;
        module.exports.filterStats;
        module.exports.log;
        module.exports.walkStats;
        module.exports.wrapPeerConnectionEvent;
      }, {});
    }
  };
});

} }; });